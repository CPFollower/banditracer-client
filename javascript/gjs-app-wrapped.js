(function(o){var g=function(){throw"Synchronous require() is not supported.";};g.unit={};var p="",j,k,q,r=2E4,m,C=document.getElementsByTagName("head")[0],l=Object.prototype.hasOwnProperty;if(function(){for(var a in{hasOwnProperty:!0})return a}()=="hasOwnProperty")var s=function(a,b,d){for(var c in a)l.call(a,c)&&b.call(d,c)};else var y=["isPrototypeOf","hasOwnProperty","toLocaleString","toString","valueOf"],s=function(a,b,d){for(var c in a)l.call(a,c)&&b.call(d,c);for(var e=y.length;e--;)c=y[e],
l.call(a,c)&&b.call(d,c)};var D=function(a,b){for(var d=0;d<a.length;)b.call(null,a[d],d)===!0?a.splice(d,1):d++},z=function(a,b){var d=a.split("/"),b=b||"";b.length&&b.charAt(b.length-1)!="/"&&(b+="/");var c=b.split("/");c.pop();for(var e;e=d.shift();)e!="."&&(e==".."&&c.length&&c[c.length-1]!=".."?c.pop():c.push(e));return c.join("/")},n=g.unit.resolveModuleId=function(a,b){return a.charAt(0)!="."?a:z(a,b)},t=function(a){return a.charAt(0)!="."?p+a+".js":this._resolveModuleId(a,p)+".js"},i=function(a){if(!l.call(j,
a))return null;return j[a]},E=function(a,b){k.push([a.slice(0),b])},B=function(a,b,d){for(var c=[],e=a.length;e--;){var h=n(a[e],d);i(h);u(h)||c.push(h)}c.length?(E(c,function(){b(v(d))}),A(c)):setTimeout(function(){b(v(d))},0)},v=function(a){var b=function(b){var c=n(b,a);if(b=i(c)){if(b.error)throw"Error loading module";}else throw"Module not loaded";if(!b.exports){b.exports={};for(var c=c.substring(0,c.lastIndexOf("/")+1),e=b.injects,h=[],f=0,w=e.length;f<w;f++)e[f]=="require"?h.push(v(c)):e[f]==
"exports"?h.push(b.exports):e[f]=="module"&&h.push(b.module);b.factory.apply(null,h)}return b.exports};b.ensure=function(b,c){B(b,c,a)};if(m!=null)b.main=i(m).module;return b},A=function(a){for(var b=a.length;b--;){var d=a[b];i(d)==null&&(j[d]={},q(d))}},u=function(a){var b={},d=function(a){if(b[a]==!0)return!0;b[a]=!0;a=i(a);if(!a||!a.defined)return!1;else{for(var a=a.deps||[],e=a.length;e--;)if(!d(a[e]))return!1;return!0}};return d(a)},x=function(){for(var a=0;a<k.length;){for(var b=k[a][0],d=k[a][1],
c=0;c<b.length;)u(b[c])?b.splice(c,1):c++;b.length?a++:(k.splice(a,1),d!=null&&setTimeout(d,0))}};q=function(a){var b,d=function(){var b=i(a);if(!b.defined)b.defined=b.error=!0,x()},c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e=t(a);c.open("GET",e,!0);c.onreadystatechange=function(){if(c.readyState===4)if(clearTimeout(b),c.status==200||c.status===0){for(var h=c.responseText,f=F(h),w=a.substring(0,a.lastIndexOf("/")+1),i={},k=f.length;k--;)f[k]=n(f[k],w);try{i[a]=
o("({fn: function(require, exports, module) {\r\n"+h+"\r\n}})").fn}catch(j){throw j instanceof SyntaxError&&(h="Syntax Error: ",j.lineNumber?h+="line "+(j.lineNumber-581):console.log("GameJs tip: use Firefox to see line numbers in Syntax Errors."),h+=" in file "+e,console.log(h)),j;}g.define(i,f)}else d()};b=setTimeout(d,r);c.send(null)};var F=g.unit.determineShallowDependencies=function(a){for(var b={},d,c=/(?:^|[^\w\$_.])require\s*\(\s*("[^"\\]*(?:\\.[^"\\]*)*"|'[^'\\]*(?:\\.[^'\\]*)*')\s*\)/g;d=
c.exec(a);)d=eval(d[1]),l.call(b,d)||(b[d]=!0);for(c=/(?:^|[^\w\$_.])require.ensure\s*\(\s*(\[("[^"\\]*(?:\\.[^"\\]*)*"|'[^'\\]*(?:\\.[^'\\]*)*'|\s*|,)*\])/g;d=c.exec(a);)for(var e=eval(d[1]),h=e.length;h--;)d=e[h],delete b[d];var f=[];s(b,function(a){f.push(a)});return f},G=function(a){var b=document.createElement("script");b.type="text/javascript";b.src=t(a);var d=!!b.addEventListener,c,e=function(){f(!1)},h=function(){(d||b.readyState=="complete"||b.readyState=="loaded")&&f(i(a).defined)},f=function(f){clearTimeout(c);
d?(b.removeEventListener("load",h,!1),b.removeEventListener("error",e,!1)):b.detachEvent("onreadystatechange",h);if(!f&&(f=i(a),!f.defined))f.defined=f.error=!0,x()};d?(b.addEventListener("load",h,!1),b.addEventListener("error",e,!1)):b.attachEvent("onreadystatechange",h);c=setTimeout(e,r);C.appendChild(b)},H=function(a,b,d){var c={modules:[]},e=["require","exports","module"];typeof a=="object"?(c.deps=b||[],s(a,function(b){var d={id:b};typeof a[b]=="function"?(d.factory=a[b],d.injects=e):(d.factory=
a[b].factory,d.injects=a[b].injects||e);c.modules.push(d)})):(c.deps=b.slice(0),D(c.deps,function(a){a:{for(var b=e.length;b--;)if(e[b]==a){a=b;break a}a=-1}return a>=0}),c.modules.push({id:a,factory:d,injects:b}));return c};g.setModuleRoot=function(a){if(!/^http(s?):\/\//.test(a))var b=window.location.href,b=b.substr(0,b.lastIndexOf("/")+1),a=z(a,b);a.length&&a.charAt(a.length-1)!="/"&&(a+="/");p=a};g.setTimeoutLength=function(a){r=a};g.useScriptTags=function(){q=G};g.def=g.define=function(){for(var a=
H.apply(null,arguments),b=[],d=[],c=a.deps,e=a.modules.length;e--;){var h=a.modules[e],f=h.id,g=i(f);g||(g=j[f]={});g.module={id:f,uri:t(f)};g.defined=!0;g.deps=c.slice(0);g.injects=h.injects;g.factory=h.factory;d.push(g)}for(e=c.length;e--;)f=c[e],g=i(f),(!g||!u(f))&&b.push(f);b.length&&setTimeout(function(){A(b)},0);x()};g.isKnown=function(a){return i(a)!=null};g.isDefined=function(a){a=i(a);return!(!a||!a.defined)};g.ensure=function(a,b){B(a,b,"")};g.run=function(a,b){a=m=n(a,"");g.ensure([a],
function(d){d(a);b!=null&&b()})};g.reset=function(){m=null;j={};k=[];g.define({system:function(){}})};g.reset();window.require=g})(function(o){with(window)return eval(o)});
require.define({animation:function(v,c){var a=v("./utils");v("gamejs");c.Animation=function(c){this.position=a.vectorToList(c.position);this.filename=c.filename;this.world=c.world;this.age=0;this.duration=c.duration;this.type="animation";this.getState=function(){return null};this.interpolate=function(){};this.setState=function(){};this.update=function(a){this.age+=a;this.age>this.duration&&this.world.destroyObj(this.id)};this.draw=function(a){var c=a.cache.getAnimationFrameCount(this.filename);a.drawAnimation(this.filename,
this.position,Math.min(parseInt(this.age/(this.duration/c)),c-1))};return this};c.animations={small_explosion:{filename:"explosion_small.png",duration:500},smoke:{filename:"smoke.png",duration:300},explosion:{filename:"explosion.png",duration:1E3}}}},["utils","gamejs"]);
require.define({bots:function(v,c){c.names=["Bob","The Dominator","Desert Penguin","Smiley"];var a=v("./car_descriptions");c.generateBotCarDescr=function(){var c=[],k;for(k in a)c.push(k);k=["Machinegun","MissileLauncher"];return{type:c[Math.floor(Math.random()*c.length)],front_weapon:{type:k[Math.floor(Math.random()*k.length)],ammo_upgrades:0,dmg_upgrades:0},util:null,rear_weapon:null,acc_upgrades:0,speed_upgrades:0,armor_upgrades:0}}}},["car_descriptions"]);
require.define({box2d:function(v,c){var a={};(function(a,d){function l(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function)Object.defineProperty=function(a,b,d){d.get instanceof Function&&a.__defineGetter__(b,d.get);d.set instanceof Function&&a.__defineSetter__(b,d.set)};a.inherit=function(a,b){l.prototype=b.prototype;a.prototype=new l;a.prototype.constructor=a};a.generateCallback=
function(a,b){return function(){b.apply(a,arguments)}};a.NVector=function(a){a===d&&(a=0);for(var b=Array(a||0),l=0;l<a;++l)b[l]=0;return b};a.is=function(a,b){if(a===null)return!1;if(b instanceof Function&&a instanceof b)return!0;if(a.constructor.__implements!=d&&a.constructor.__implements[b])return!0;return!1};a.parseUInt=function(a){return Math.abs(parseInt(a))}})(a);var p=Array,k=a.NVector;typeof a==="undefined"&&(a={});if(typeof a.Collision==="undefined")a.Collision={};if(typeof a.Collision.Shapes===
"undefined")a.Collision.Shapes={};if(typeof a.Common==="undefined")a.Common={};if(typeof a.Common.Math==="undefined")a.Common.Math={};if(typeof a.Dynamics==="undefined")a.Dynamics={};if(typeof a.Dynamics.Contacts==="undefined")a.Dynamics.Contacts={};if(typeof a.Dynamics.Controllers==="undefined")a.Dynamics.Controllers={};if(typeof a.Dynamics.Joints==="undefined")a.Dynamics.Joints={};(function(){function b(){b.b2AABB.apply(this,arguments)}function d(){d.b2Bound.apply(this,arguments)}function l(){l.b2BoundValues.apply(this,
arguments);this.constructor===l&&this.b2BoundValues.apply(this,arguments)}function c(){c.b2Collision.apply(this,arguments)}function u(){u.b2ContactID.apply(this,arguments);this.constructor===u&&this.b2ContactID.apply(this,arguments)}function h(){h.b2ContactPoint.apply(this,arguments)}function k(){k.b2Distance.apply(this,arguments)}function e(){e.b2DistanceInput.apply(this,arguments)}function t(){t.b2DistanceOutput.apply(this,arguments)}function o(){o.b2DistanceProxy.apply(this,arguments)}function p(){p.b2DynamicTree.apply(this,
arguments);this.constructor===p&&this.b2DynamicTree.apply(this,arguments)}function C(){C.b2DynamicTreeBroadPhase.apply(this,arguments)}function J(){J.b2DynamicTreeNode.apply(this,arguments)}function x(){x.b2DynamicTreePair.apply(this,arguments)}function O(){O.b2Manifold.apply(this,arguments);this.constructor===O&&this.b2Manifold.apply(this,arguments)}function v(){v.b2ManifoldPoint.apply(this,arguments);this.constructor===v&&this.b2ManifoldPoint.apply(this,arguments)}function j(){j.b2Point.apply(this,
arguments)}function P(){P.b2RayCastInput.apply(this,arguments);this.constructor===P&&this.b2RayCastInput.apply(this,arguments)}function B(){B.b2RayCastOutput.apply(this,arguments)}function D(){D.b2Segment.apply(this,arguments)}function G(){G.b2SeparationFunction.apply(this,arguments)}function N(){N.b2Simplex.apply(this,arguments);this.constructor===N&&this.b2Simplex.apply(this,arguments)}function E(){E.b2SimplexCache.apply(this,arguments)}function S(){S.b2SimplexVertex.apply(this,arguments)}function F(){F.b2TimeOfImpact.apply(this,
arguments)}function I(){I.b2TOIInput.apply(this,arguments)}function T(){T.b2WorldManifold.apply(this,arguments);this.constructor===T&&this.b2WorldManifold.apply(this,arguments)}function M(){M.ClipVertex.apply(this,arguments)}function m(){m.Features.apply(this,arguments)}function q(){q.b2CircleShape.apply(this,arguments);this.constructor===q&&this.b2CircleShape.apply(this,arguments)}function A(){A.b2EdgeChainDef.apply(this,arguments);this.constructor===A&&this.b2EdgeChainDef.apply(this,arguments)}
function z(){z.b2EdgeShape.apply(this,arguments);this.constructor===z&&this.b2EdgeShape.apply(this,arguments)}function K(){K.b2MassData.apply(this,arguments)}function R(){R.b2PolygonShape.apply(this,arguments);this.constructor===R&&this.b2PolygonShape.apply(this,arguments)}function g(){g.b2Shape.apply(this,arguments);this.constructor===g&&this.b2Shape.apply(this,arguments)}function f(){f.b2Color.apply(this,arguments);this.constructor===f&&this.b2Color.apply(this,arguments)}function n(){n.b2Settings.apply(this,
arguments)}function w(){w.b2Mat22.apply(this,arguments);this.constructor===w&&this.b2Mat22.apply(this,arguments)}function U(){U.b2Mat33.apply(this,arguments);this.constructor===U&&this.b2Mat33.apply(this,arguments)}function Ga(){Ga.b2Math.apply(this,arguments)}function Ha(){Ha.b2Sweep.apply(this,arguments)}function V(){V.b2Transform.apply(this,arguments);this.constructor===V&&this.b2Transform.apply(this,arguments)}function W(){W.b2Vec2.apply(this,arguments);this.constructor===W&&this.b2Vec2.apply(this,
arguments)}function X(){X.b2Vec3.apply(this,arguments);this.constructor===X&&this.b2Vec3.apply(this,arguments)}function Y(){Y.b2Body.apply(this,arguments);this.constructor===Y&&this.b2Body.apply(this,arguments)}function Z(){Z.b2BodyDef.apply(this,arguments);this.constructor===Z&&this.b2BodyDef.apply(this,arguments)}function Ia(){Ia.b2ContactFilter.apply(this,arguments)}function Ja(){Ja.b2ContactImpulse.apply(this,arguments)}function Ka(){Ka.b2ContactListener.apply(this,arguments)}function aa(){aa.b2ContactManager.apply(this,
arguments);this.constructor===aa&&this.b2ContactManager.apply(this,arguments)}function ba(){ba.b2DebugDraw.apply(this,arguments);this.constructor===ba&&this.b2DebugDraw.apply(this,arguments)}function La(){La.b2DestructionListener.apply(this,arguments)}function Ma(){Ma.b2FilterData.apply(this,arguments)}function ca(){ca.b2Fixture.apply(this,arguments);this.constructor===ca&&this.b2Fixture.apply(this,arguments)}function da(){da.b2FixtureDef.apply(this,arguments);this.constructor===da&&this.b2FixtureDef.apply(this,
arguments)}function ea(){ea.b2Island.apply(this,arguments);this.constructor===ea&&this.b2Island.apply(this,arguments)}function Na(){Na.b2TimeStep.apply(this,arguments)}function fa(){fa.b2World.apply(this,arguments);this.constructor===fa&&this.b2World.apply(this,arguments)}function Oa(){Oa.b2CircleContact.apply(this,arguments)}function ga(){ga.b2Contact.apply(this,arguments);this.constructor===ga&&this.b2Contact.apply(this,arguments)}function ha(){ha.b2ContactConstraint.apply(this,arguments);this.constructor===
ha&&this.b2ContactConstraint.apply(this,arguments)}function Pa(){Pa.b2ContactConstraintPoint.apply(this,arguments)}function Qa(){Qa.b2ContactEdge.apply(this,arguments)}function ia(){ia.b2ContactFactory.apply(this,arguments);this.constructor===ia&&this.b2ContactFactory.apply(this,arguments)}function Ra(){Ra.b2ContactRegister.apply(this,arguments)}function Sa(){Sa.b2ContactResult.apply(this,arguments)}function ja(){ja.b2ContactSolver.apply(this,arguments);this.constructor===ja&&this.b2ContactSolver.apply(this,
arguments)}function Ta(){Ta.b2EdgeAndCircleContact.apply(this,arguments)}function ka(){ka.b2NullContact.apply(this,arguments);this.constructor===ka&&this.b2NullContact.apply(this,arguments)}function Ua(){Ua.b2PolyAndCircleContact.apply(this,arguments)}function Va(){Va.b2PolyAndEdgeContact.apply(this,arguments)}function Wa(){Wa.b2PolygonContact.apply(this,arguments)}function la(){la.b2PositionSolverManifold.apply(this,arguments);this.constructor===la&&this.b2PositionSolverManifold.apply(this,arguments)}
function Xa(){Xa.b2BuoyancyController.apply(this,arguments)}function Ya(){Ya.b2ConstantAccelController.apply(this,arguments)}function Za(){Za.b2ConstantForceController.apply(this,arguments)}function $a(){$a.b2Controller.apply(this,arguments)}function ab(){ab.b2ControllerEdge.apply(this,arguments)}function bb(){bb.b2GravityController.apply(this,arguments)}function cb(){cb.b2TensorDampingController.apply(this,arguments)}function ma(){ma.b2DistanceJoint.apply(this,arguments);this.constructor===ma&&this.b2DistanceJoint.apply(this,
arguments)}function na(){na.b2DistanceJointDef.apply(this,arguments);this.constructor===na&&this.b2DistanceJointDef.apply(this,arguments)}function oa(){oa.b2FrictionJoint.apply(this,arguments);this.constructor===oa&&this.b2FrictionJoint.apply(this,arguments)}function pa(){pa.b2FrictionJointDef.apply(this,arguments);this.constructor===pa&&this.b2FrictionJointDef.apply(this,arguments)}function qa(){qa.b2GearJoint.apply(this,arguments);this.constructor===qa&&this.b2GearJoint.apply(this,arguments)}function ra(){ra.b2GearJointDef.apply(this,
arguments);this.constructor===ra&&this.b2GearJointDef.apply(this,arguments)}function db(){db.b2Jacobian.apply(this,arguments)}function sa(){sa.b2Joint.apply(this,arguments);this.constructor===sa&&this.b2Joint.apply(this,arguments)}function ta(){ta.b2JointDef.apply(this,arguments);this.constructor===ta&&this.b2JointDef.apply(this,arguments)}function eb(){eb.b2JointEdge.apply(this,arguments)}function ua(){ua.b2LineJoint.apply(this,arguments);this.constructor===ua&&this.b2LineJoint.apply(this,arguments)}
function va(){va.b2LineJointDef.apply(this,arguments);this.constructor===va&&this.b2LineJointDef.apply(this,arguments)}function wa(){wa.b2MouseJoint.apply(this,arguments);this.constructor===wa&&this.b2MouseJoint.apply(this,arguments)}function xa(){xa.b2MouseJointDef.apply(this,arguments);this.constructor===xa&&this.b2MouseJointDef.apply(this,arguments)}function ya(){ya.b2PrismaticJoint.apply(this,arguments);this.constructor===ya&&this.b2PrismaticJoint.apply(this,arguments)}function za(){za.b2PrismaticJointDef.apply(this,
arguments);this.constructor===za&&this.b2PrismaticJointDef.apply(this,arguments)}function Aa(){Aa.b2PulleyJoint.apply(this,arguments);this.constructor===Aa&&this.b2PulleyJoint.apply(this,arguments)}function Ba(){Ba.b2PulleyJointDef.apply(this,arguments);this.constructor===Ba&&this.b2PulleyJointDef.apply(this,arguments)}function Ca(){Ca.b2RevoluteJoint.apply(this,arguments);this.constructor===Ca&&this.b2RevoluteJoint.apply(this,arguments)}function Da(){Da.b2RevoluteJointDef.apply(this,arguments);this.constructor===
Da&&this.b2RevoluteJointDef.apply(this,arguments)}function Ea(){Ea.b2WeldJoint.apply(this,arguments);this.constructor===Ea&&this.b2WeldJoint.apply(this,arguments)}function Fa(){Fa.b2WeldJointDef.apply(this,arguments);this.constructor===Fa&&this.b2WeldJointDef.apply(this,arguments)}a.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";a.Collision.b2AABB=b;a.Collision.b2Bound=d;a.Collision.b2BoundValues=l;a.Collision.b2Collision=c;a.Collision.b2ContactID=u;a.Collision.b2ContactPoint=h;a.Collision.b2Distance=
k;a.Collision.b2DistanceInput=e;a.Collision.b2DistanceOutput=t;a.Collision.b2DistanceProxy=o;a.Collision.b2DynamicTree=p;a.Collision.b2DynamicTreeBroadPhase=C;a.Collision.b2DynamicTreeNode=J;a.Collision.b2DynamicTreePair=x;a.Collision.b2Manifold=O;a.Collision.b2ManifoldPoint=v;a.Collision.b2Point=j;a.Collision.b2RayCastInput=P;a.Collision.b2RayCastOutput=B;a.Collision.b2Segment=D;a.Collision.b2SeparationFunction=G;a.Collision.b2Simplex=N;a.Collision.b2SimplexCache=E;a.Collision.b2SimplexVertex=S;
a.Collision.b2TimeOfImpact=F;a.Collision.b2TOIInput=I;a.Collision.b2WorldManifold=T;a.Collision.ClipVertex=M;a.Collision.Features=m;a.Collision.Shapes.b2CircleShape=q;a.Collision.Shapes.b2EdgeChainDef=A;a.Collision.Shapes.b2EdgeShape=z;a.Collision.Shapes.b2MassData=K;a.Collision.Shapes.b2PolygonShape=R;a.Collision.Shapes.b2Shape=g;a.Common.b2internal="Box2D.Common.b2internal";a.Common.b2Color=f;a.Common.b2Settings=n;a.Common.Math.b2Mat22=w;a.Common.Math.b2Mat33=U;a.Common.Math.b2Math=Ga;a.Common.Math.b2Sweep=
Ha;a.Common.Math.b2Transform=V;a.Common.Math.b2Vec2=W;a.Common.Math.b2Vec3=X;a.Dynamics.b2Body=Y;a.Dynamics.b2BodyDef=Z;a.Dynamics.b2ContactFilter=Ia;a.Dynamics.b2ContactImpulse=Ja;a.Dynamics.b2ContactListener=Ka;a.Dynamics.b2ContactManager=aa;a.Dynamics.b2DebugDraw=ba;a.Dynamics.b2DestructionListener=La;a.Dynamics.b2FilterData=Ma;a.Dynamics.b2Fixture=ca;a.Dynamics.b2FixtureDef=da;a.Dynamics.b2Island=ea;a.Dynamics.b2TimeStep=Na;a.Dynamics.b2World=fa;a.Dynamics.Contacts.b2CircleContact=Oa;a.Dynamics.Contacts.b2Contact=
ga;a.Dynamics.Contacts.b2ContactConstraint=ha;a.Dynamics.Contacts.b2ContactConstraintPoint=Pa;a.Dynamics.Contacts.b2ContactEdge=Qa;a.Dynamics.Contacts.b2ContactFactory=ia;a.Dynamics.Contacts.b2ContactRegister=Ra;a.Dynamics.Contacts.b2ContactResult=Sa;a.Dynamics.Contacts.b2ContactSolver=ja;a.Dynamics.Contacts.b2EdgeAndCircleContact=Ta;a.Dynamics.Contacts.b2NullContact=ka;a.Dynamics.Contacts.b2PolyAndCircleContact=Ua;a.Dynamics.Contacts.b2PolyAndEdgeContact=Va;a.Dynamics.Contacts.b2PolygonContact=Wa;
a.Dynamics.Contacts.b2PositionSolverManifold=la;a.Dynamics.Controllers.b2BuoyancyController=Xa;a.Dynamics.Controllers.b2ConstantAccelController=Ya;a.Dynamics.Controllers.b2ConstantForceController=Za;a.Dynamics.Controllers.b2Controller=$a;a.Dynamics.Controllers.b2ControllerEdge=ab;a.Dynamics.Controllers.b2GravityController=bb;a.Dynamics.Controllers.b2TensorDampingController=cb;a.Dynamics.Joints.b2DistanceJoint=ma;a.Dynamics.Joints.b2DistanceJointDef=na;a.Dynamics.Joints.b2FrictionJoint=oa;a.Dynamics.Joints.b2FrictionJointDef=
pa;a.Dynamics.Joints.b2GearJoint=qa;a.Dynamics.Joints.b2GearJointDef=ra;a.Dynamics.Joints.b2Jacobian=db;a.Dynamics.Joints.b2Joint=sa;a.Dynamics.Joints.b2JointDef=ta;a.Dynamics.Joints.b2JointEdge=eb;a.Dynamics.Joints.b2LineJoint=ua;a.Dynamics.Joints.b2LineJointDef=va;a.Dynamics.Joints.b2MouseJoint=wa;a.Dynamics.Joints.b2MouseJointDef=xa;a.Dynamics.Joints.b2PrismaticJoint=ya;a.Dynamics.Joints.b2PrismaticJointDef=za;a.Dynamics.Joints.b2PulleyJoint=Aa;a.Dynamics.Joints.b2PulleyJointDef=Ba;a.Dynamics.Joints.b2RevoluteJoint=
Ca;a.Dynamics.Joints.b2RevoluteJointDef=Da;a.Dynamics.Joints.b2WeldJoint=Ea;a.Dynamics.Joints.b2WeldJointDef=Fa})();a.postDefs=[];(function(){var b=a.Collision.Shapes.b2CircleShape,d=a.Collision.Shapes.b2PolygonShape,l=a.Collision.Shapes.b2Shape,c=a.Common.b2Settings,u=a.Common.Math.b2Math,h=a.Common.Math.b2Sweep,o=a.Common.Math.b2Transform,e=a.Common.Math.b2Vec2,t=a.Collision.b2AABB,L=a.Collision.b2Bound,H=a.Collision.b2BoundValues,C=a.Collision.b2Collision,J=a.Collision.b2ContactID,x=a.Collision.b2ContactPoint,
O=a.Collision.b2Distance,v=a.Collision.b2DistanceInput,j=a.Collision.b2DistanceOutput,P=a.Collision.b2DistanceProxy,B=a.Collision.b2DynamicTree,D=a.Collision.b2DynamicTreeBroadPhase,G=a.Collision.b2DynamicTreeNode,N=a.Collision.b2DynamicTreePair,E=a.Collision.b2Manifold,S=a.Collision.b2ManifoldPoint,F=a.Collision.b2Point,I=a.Collision.b2RayCastInput,T=a.Collision.b2RayCastOutput,M=a.Collision.b2Segment,m=a.Collision.b2SeparationFunction,q=a.Collision.b2Simplex,A=a.Collision.b2SimplexCache,z=a.Collision.b2SimplexVertex,
K=a.Collision.b2TimeOfImpact,R=a.Collision.b2TOIInput,g=a.Collision.b2WorldManifold,f=a.Collision.ClipVertex,n=a.Collision.Features,w=a.Collision.IBroadPhase;t.b2AABB=function(){this.lowerBound=new e;this.upperBound=new e};t.prototype.IsValid=function(){var f=this.upperBound.y-this.lowerBound.y;return f=(f=this.upperBound.x-this.lowerBound.x>=0&&f>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};t.prototype.GetCenter=function(){return new e((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+
this.upperBound.y)/2)};t.prototype.GetExtents=function(){return new e((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};t.prototype.Contains=function(f){var n;return n=(n=(n=(n=this.lowerBound.x<=f.lowerBound.x)&&this.lowerBound.y<=f.lowerBound.y)&&f.upperBound.x<=this.upperBound.x)&&f.upperBound.y<=this.upperBound.y};t.prototype.RayCast=function(f,n){var a=-Number.MAX_VALUE,g=Number.MAX_VALUE,m=n.p1.x,b=n.p1.y,j=n.p2.x-n.p1.x,w=n.p2.y-n.p1.y,e=Math.abs(w),q=f.normal,
z=0,c=0,d=z=0,d=0;if(Math.abs(j)<Number.MIN_VALUE){if(m<this.lowerBound.x||this.upperBound.x<m)return!1}else{z=1/j;c=(this.lowerBound.x-m)*z;z*=this.upperBound.x-m;d=-1;c>z&&(d=c,c=z,z=d,d=1);if(c>a)q.x=d,q.y=0,a=c;g=Math.min(g,z);if(a>g)return!1}if(e<Number.MIN_VALUE){if(b<this.lowerBound.y||this.upperBound.y<b)return!1}else{z=1/w;c=(this.lowerBound.y-b)*z;z*=this.upperBound.y-b;d=-1;c>z&&(d=c,c=z,z=d,d=1);if(c>a)q.y=d,q.x=0,a=c;g=Math.min(g,z);if(a>g)return!1}f.fraction=a;return!0};t.prototype.TestOverlap=
function(f){var n=f.lowerBound.y-this.upperBound.y,a=this.lowerBound.y-f.upperBound.y;if(f.lowerBound.x-this.upperBound.x>0||n>0)return!1;if(this.lowerBound.x-f.upperBound.x>0||a>0)return!1;return!0};t.Combine=function(f,n){var a=new t;a.Combine(f,n);return a};t.prototype.Combine=function(f,n){this.lowerBound.x=Math.min(f.lowerBound.x,n.lowerBound.x);this.lowerBound.y=Math.min(f.lowerBound.y,n.lowerBound.y);this.upperBound.x=Math.max(f.upperBound.x,n.upperBound.x);this.upperBound.y=Math.max(f.upperBound.y,
n.upperBound.y)};L.b2Bound=function(){};L.prototype.IsLower=function(){return(this.value&1)==0};L.prototype.IsUpper=function(){return(this.value&1)==1};L.prototype.Swap=function(f){var n=this.value,a=this.proxy,g=this.stabbingCount;this.value=f.value;this.proxy=f.proxy;this.stabbingCount=f.stabbingCount;f.value=n;f.proxy=a;f.stabbingCount=g};H.b2BoundValues=function(){};H.prototype.b2BoundValues=function(){this.lowerValues=new k;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new k;this.upperValues[0]=
0;this.upperValues[1]=0};C.b2Collision=function(){};C.ClipSegmentToLine=function(f,n,a,g){g===void 0&&(g=0);var m,b=0;m=n[0];var j=m.v;m=n[1];var w=m.v,e=a.x*j.x+a.y*j.y-g;m=a.x*w.x+a.y*w.y-g;e<=0&&f[b++].Set(n[0]);m<=0&&f[b++].Set(n[1]);if(e*m<0)a=e/(e-m),m=f[b],m=m.v,m.x=j.x+a*(w.x-j.x),m.y=j.y+a*(w.y-j.y),m=f[b],m.id=(e>0?n[0]:n[1]).id,++b;return b};C.EdgeSeparation=function(f,n,a,g,m){a===void 0&&(a=0);parseInt(f.m_vertexCount);var b=f.m_vertices,f=f.m_normals,j=parseInt(g.m_vertexCount),w=g.m_vertices,
e,q;e=n.R;q=f[a];f=e.col1.x*q.x+e.col2.x*q.y;g=e.col1.y*q.x+e.col2.y*q.y;e=m.R;var z=e.col1.x*f+e.col1.y*g;e=e.col2.x*f+e.col2.y*g;for(var c=0,d=Number.MAX_VALUE,A=0;A<j;++A)q=w[A],q=q.x*z+q.y*e,q<d&&(d=q,c=A);q=b[a];e=n.R;a=n.position.x+(e.col1.x*q.x+e.col2.x*q.y);n=n.position.y+(e.col1.y*q.x+e.col2.y*q.y);q=w[c];e=m.R;b=m.position.x+(e.col1.x*q.x+e.col2.x*q.y);m=m.position.y+(e.col1.y*q.x+e.col2.y*q.y);b-=a;m-=n;return b*f+m*g};C.FindMaxSeparation=function(f,n,a,g,m){var b=parseInt(n.m_vertexCount),
e=n.m_normals,j,w;w=m.R;j=g.m_centroid;var q=m.position.x+(w.col1.x*j.x+w.col2.x*j.y),z=m.position.y+(w.col1.y*j.x+w.col2.y*j.y);w=a.R;j=n.m_centroid;q-=a.position.x+(w.col1.x*j.x+w.col2.x*j.y);z-=a.position.y+(w.col1.y*j.x+w.col2.y*j.y);w=q*a.R.col1.x+z*a.R.col1.y;for(var z=q*a.R.col2.x+z*a.R.col2.y,q=0,c=-Number.MAX_VALUE,d=0;d<b;++d)j=e[d],j=j.x*w+j.y*z,j>c&&(c=j,q=d);e=C.EdgeSeparation(n,a,q,g,m);j=parseInt(q-1>=0?q-1:b-1);w=C.EdgeSeparation(n,a,j,g,m);var z=parseInt(q+1<b?q+1:0),c=C.EdgeSeparation(n,
a,z,g,m),A=d=0,l=0;if(w>e&&w>c)l=-1,d=j,A=w;else if(c>e)l=1,d=z,A=c;else return f[0]=q,e;for(;;)if(q=l==-1?d-1>=0?d-1:b-1:d+1<b?d+1:0,e=C.EdgeSeparation(n,a,q,g,m),e>A)d=q,A=e;else break;f[0]=d;return A};C.FindIncidentEdge=function(f,n,a,g,m,b){g===void 0&&(g=0);parseInt(n.m_vertexCount);var e=n.m_normals,j=parseInt(m.m_vertexCount),n=m.m_vertices,m=m.m_normals,w;w=a.R;var a=e[g],e=w.col1.x*a.x+w.col2.x*a.y,q=w.col1.y*a.x+w.col2.y*a.y;w=b.R;a=w.col1.x*e+w.col1.y*q;q=w.col2.x*e+w.col2.y*q;e=a;w=0;
for(var z=Number.MAX_VALUE,c=0;c<j;++c)a=m[c],a=e*a.x+q*a.y,a<z&&(z=a,w=c);m=parseInt(w);e=parseInt(m+1<j?m+1:0);j=f[0];a=n[m];w=b.R;j.v.x=b.position.x+(w.col1.x*a.x+w.col2.x*a.y);j.v.y=b.position.y+(w.col1.y*a.x+w.col2.y*a.y);j.id.features.referenceEdge=g;j.id.features.incidentEdge=m;j.id.features.incidentVertex=0;j=f[1];a=n[e];w=b.R;j.v.x=b.position.x+(w.col1.x*a.x+w.col2.x*a.y);j.v.y=b.position.y+(w.col1.y*a.x+w.col2.y*a.y);j.id.features.referenceEdge=g;j.id.features.incidentEdge=e;j.id.features.incidentVertex=
1};C.MakeClipPointVector=function(){var a=new p(2);a[0]=new f;a[1]=new f;return a};C.CollidePolygons=function(f,a,n,g,m){var w;f.m_pointCount=0;var j=a.m_radius+g.m_radius;C.s_edgeAO[0]=0;var e=C.FindMaxSeparation(C.s_edgeAO,a,n,g,m);w=C.s_edgeAO[0];if(!(e>j)){var b;C.s_edgeBO[0]=0;var q=C.FindMaxSeparation(C.s_edgeBO,g,m,a,n);b=C.s_edgeBO[0];if(!(q>j)){var z=0,d=0;q>0.98*e+0.0010?(e=g,g=a,a=m,z=b,f.m_type=E.e_faceB,d=1):(e=a,a=n,n=m,z=w,f.m_type=E.e_faceA,d=0);w=C.s_incidentEdge;C.FindIncidentEdge(w,
e,a,z,g,n);b=parseInt(e.m_vertexCount);var m=e.m_vertices,e=m[z],A;A=z+1<b?m[parseInt(z+1)]:m[0];z=C.s_localTangent;z.Set(A.x-e.x,A.y-e.y);z.Normalize();m=C.s_localNormal;m.x=z.y;m.y=-z.x;g=C.s_planePoint;g.Set(0.5*(e.x+A.x),0.5*(e.y+A.y));q=C.s_tangent;b=a.R;q.x=b.col1.x*z.x+b.col2.x*z.y;q.y=b.col1.y*z.x+b.col2.y*z.y;var l=C.s_tangent2;l.x=-q.x;l.y=-q.y;z=C.s_normal;z.x=q.y;z.y=-q.x;var t=C.s_v11,B=C.s_v12;t.x=a.position.x+(b.col1.x*e.x+b.col2.x*e.y);t.y=a.position.y+(b.col1.y*e.x+b.col2.y*e.y);
B.x=a.position.x+(b.col1.x*A.x+b.col2.x*A.y);B.y=a.position.y+(b.col1.y*A.x+b.col2.y*A.y);a=z.x*t.x+z.y*t.y;b=q.x*B.x+q.y*B.y+j;A=C.s_clipPoints1;e=C.s_clipPoints2;B=0;B=C.ClipSegmentToLine(A,w,l,-q.x*t.x-q.y*t.y+j);if(!(B<2)&&(B=C.ClipSegmentToLine(e,A,q,b),!(B<2))){f.m_localPlaneNormal.SetV(m);f.m_localPoint.SetV(g);for(g=m=0;g<c.b2_maxManifoldPoints;++g)if(w=e[g],z.x*w.v.x+z.y*w.v.y-a<=j)q=f.m_points[m],b=n.R,l=w.v.x-n.position.x,t=w.v.y-n.position.y,q.m_localPoint.x=l*b.col1.x+t*b.col1.y,q.m_localPoint.y=
l*b.col2.x+t*b.col2.y,q.m_id.Set(w.id),q.m_id.features.flip=d,++m;f.m_pointCount=m}}}};C.CollideCircles=function(f,a,n,g,m){f.m_pointCount=0;var b,e;b=n.R;e=a.m_p;var w=n.position.x+(b.col1.x*e.x+b.col2.x*e.y),n=n.position.y+(b.col1.y*e.x+b.col2.y*e.y);b=m.R;e=g.m_p;w=m.position.x+(b.col1.x*e.x+b.col2.x*e.y)-w;m=m.position.y+(b.col1.y*e.x+b.col2.y*e.y)-n;b=a.m_radius+g.m_radius;if(!(w*w+m*m>b*b))f.m_type=E.e_circles,f.m_localPoint.SetV(a.m_p),f.m_localPlaneNormal.SetZero(),f.m_pointCount=1,f.m_points[0].m_localPoint.SetV(g.m_p),
f.m_points[0].m_id.key=0};C.CollidePolygonAndCircle=function(f,a,n,g,m){var b=f.m_pointCount=0,e=0,w,j;j=m.R;w=g.m_p;var q=m.position.y+(j.col1.y*w.x+j.col2.y*w.y),b=m.position.x+(j.col1.x*w.x+j.col2.x*w.y)-n.position.x,e=q-n.position.y;j=n.R;n=b*j.col1.x+e*j.col1.y;j=b*j.col2.x+e*j.col2.y;for(var z=0,q=-Number.MAX_VALUE,m=a.m_radius+g.m_radius,c=parseInt(a.m_vertexCount),d=a.m_vertices,a=a.m_normals,A=0;A<c;++A){w=d[A];b=n-w.x;e=j-w.y;w=a[A];b=w.x*b+w.y*e;if(b>m)return;b>q&&(q=b,z=A)}b=parseInt(z);
e=parseInt(b+1<c?b+1:0);w=d[b];d=d[e];if(q<Number.MIN_VALUE)f.m_pointCount=1,f.m_type=E.e_faceA,f.m_localPlaneNormal.SetV(a[z]),f.m_localPoint.x=0.5*(w.x+d.x),f.m_localPoint.y=0.5*(w.y+d.y);else if(q=(n-d.x)*(w.x-d.x)+(j-d.y)*(w.y-d.y),(n-w.x)*(d.x-w.x)+(j-w.y)*(d.y-w.y)<=0){if((n-w.x)*(n-w.x)+(j-w.y)*(j-w.y)>m*m)return;f.m_pointCount=1;f.m_type=E.e_faceA;f.m_localPlaneNormal.x=n-w.x;f.m_localPlaneNormal.y=j-w.y;f.m_localPlaneNormal.Normalize();f.m_localPoint.SetV(w)}else if(q<=0){if((n-d.x)*(n-d.x)+
(j-d.y)*(j-d.y)>m*m)return;f.m_pointCount=1;f.m_type=E.e_faceA;f.m_localPlaneNormal.x=n-d.x;f.m_localPlaneNormal.y=j-d.y;f.m_localPlaneNormal.Normalize();f.m_localPoint.SetV(d)}else{z=0.5*(w.x+d.x);w=0.5*(w.y+d.y);q=(n-z)*a[b].x+(j-w)*a[b].y;if(q>m)return;f.m_pointCount=1;f.m_type=E.e_faceA;f.m_localPlaneNormal.x=a[b].x;f.m_localPlaneNormal.y=a[b].y;f.m_localPlaneNormal.Normalize();f.m_localPoint.Set(z,w)}f.m_points[0].m_localPoint.SetV(g.m_p);f.m_points[0].m_id.key=0};C.TestOverlap=function(f,a){var n=
a.lowerBound,g=f.upperBound,m=n.x-g.x,b=n.y-g.y,n=f.lowerBound,g=a.upperBound,w=n.y-g.y;if(m>0||b>0)return!1;if(n.x-g.x>0||w>0)return!1;return!0};a.postDefs.push(function(){a.Collision.b2Collision.s_incidentEdge=C.MakeClipPointVector();a.Collision.b2Collision.s_clipPoints1=C.MakeClipPointVector();a.Collision.b2Collision.s_clipPoints2=C.MakeClipPointVector();a.Collision.b2Collision.s_edgeAO=new k(1);a.Collision.b2Collision.s_edgeBO=new k(1);a.Collision.b2Collision.s_localTangent=new e;a.Collision.b2Collision.s_localNormal=
new e;a.Collision.b2Collision.s_planePoint=new e;a.Collision.b2Collision.s_normal=new e;a.Collision.b2Collision.s_tangent=new e;a.Collision.b2Collision.s_tangent2=new e;a.Collision.b2Collision.s_v11=new e;a.Collision.b2Collision.s_v12=new e;a.Collision.b2Collision.b2CollidePolyTempVec=new e;a.Collision.b2Collision.b2_nullFeature=255});J.b2ContactID=function(){this.features=new n};J.prototype.b2ContactID=function(){this.features._m_id=this};J.prototype.Set=function(f){this.key=f._key};J.prototype.Copy=
function(){var f=new J;f.key=this.key;return f};Object.defineProperty(J.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(J.prototype,"key",{enumerable:!1,configurable:!0,set:function(f){f===void 0&&(f=0);this._key=f;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});x.b2ContactPoint=function(){this.position=
new e;this.velocity=new e;this.normal=new e;this.id=new J};O.b2Distance=function(){};O.Distance=function(f,a,n){++O.b2_gjkCalls;var g=n.proxyA,m=n.proxyB,b=n.transformA,w=n.transformB,j=O.s_simplex;j.ReadCache(a,g,b,m,w);var q=j.m_vertices,z=O.s_saveA,d=O.s_saveB,A=0;j.GetClosestPoint().LengthSquared();for(var l=0,t,B=0;B<20;){A=j.m_count;for(l=0;l<A;l++)z[l]=q[l].indexA,d[l]=q[l].indexB;switch(j.m_count){case 1:break;case 2:j.Solve2();break;case 3:j.Solve3();break;default:c.b2Assert(!1)}if(j.m_count==
3)break;t=j.GetClosestPoint();t.LengthSquared();l=j.GetSearchDirection();if(l.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;t=q[j.m_count];t.indexA=g.GetSupport(u.MulTMV(b.R,l.GetNegative()));t.wA=u.MulX(b,g.GetVertex(t.indexA));t.indexB=m.GetSupport(u.MulTMV(w.R,l));t.wB=u.MulX(w,m.GetVertex(t.indexB));t.w=u.SubtractVV(t.wB,t.wA);++B;++O.b2_gjkIters;for(var K=!1,l=0;l<A;l++)if(t.indexA==z[l]&&t.indexB==d[l]){K=!0;break}if(K)break;++j.m_count}O.b2_gjkMaxIters=u.Max(O.b2_gjkMaxIters,B);j.GetWitnessPoints(f.pointA,
f.pointB);f.distance=u.SubtractVV(f.pointA,f.pointB).Length();f.iterations=B;j.WriteCache(a);if(n.useRadii)a=g.m_radius,m=m.m_radius,f.distance>a+m&&f.distance>Number.MIN_VALUE?(f.distance-=a+m,n=u.SubtractVV(f.pointB,f.pointA),n.Normalize(),f.pointA.x+=a*n.x,f.pointA.y+=a*n.y,f.pointB.x-=m*n.x,f.pointB.y-=m*n.y):(t=new e,t.x=0.5*(f.pointA.x+f.pointB.x),t.y=0.5*(f.pointA.y+f.pointB.y),f.pointA.x=f.pointB.x=t.x,f.pointA.y=f.pointB.y=t.y,f.distance=0)};a.postDefs.push(function(){a.Collision.b2Distance.s_simplex=
new q;a.Collision.b2Distance.s_saveA=new k(3);a.Collision.b2Distance.s_saveB=new k(3)});v.b2DistanceInput=function(){};j.b2DistanceOutput=function(){this.pointA=new e;this.pointB=new e};P.b2DistanceProxy=function(){};P.prototype.Set=function(f){switch(f.GetType()){case l.e_circleShape:f=f instanceof b?f:null;this.m_vertices=new p(1,!0);this.m_vertices[0]=f.m_p;this.m_count=1;this.m_radius=f.m_radius;break;case l.e_polygonShape:f=f instanceof d?f:null;this.m_vertices=f.m_vertices;this.m_count=f.m_vertexCount;
this.m_radius=f.m_radius;break;default:c.b2Assert(!1)}};P.prototype.GetSupport=function(f){for(var a=0,n=this.m_vertices[0].x*f.x+this.m_vertices[0].y*f.y,g=1;g<this.m_count;++g){var m=this.m_vertices[g].x*f.x+this.m_vertices[g].y*f.y;m>n&&(a=g,n=m)}return a};P.prototype.GetSupportVertex=function(f){for(var a=0,n=this.m_vertices[0].x*f.x+this.m_vertices[0].y*f.y,g=1;g<this.m_count;++g){var m=this.m_vertices[g].x*f.x+this.m_vertices[g].y*f.y;m>n&&(a=g,n=m)}return this.m_vertices[a]};P.prototype.GetVertexCount=
function(){return this.m_count};P.prototype.GetVertex=function(f){f===void 0&&(f=0);c.b2Assert(0<=f&&f<this.m_count);return this.m_vertices[f]};B.b2DynamicTree=function(){};B.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};B.prototype.CreateProxy=function(f,a){var n=this.AllocateNode(),g=c.b2_aabbExtension,m=c.b2_aabbExtension;n.aabb.lowerBound.x=f.lowerBound.x-g;n.aabb.lowerBound.y=f.lowerBound.y-m;n.aabb.upperBound.x=f.upperBound.x+g;n.aabb.upperBound.y=
f.upperBound.y+m;n.userData=a;this.InsertLeaf(n);return n};B.prototype.DestroyProxy=function(f){this.RemoveLeaf(f);this.FreeNode(f)};B.prototype.MoveProxy=function(f,a,n){c.b2Assert(f.IsLeaf());if(f.aabb.Contains(a))return!1;this.RemoveLeaf(f);var g=c.b2_aabbExtension+c.b2_aabbMultiplier*(n.x>0?n.x:-n.x),n=c.b2_aabbExtension+c.b2_aabbMultiplier*(n.y>0?n.y:-n.y);f.aabb.lowerBound.x=a.lowerBound.x-g;f.aabb.lowerBound.y=a.lowerBound.y-n;f.aabb.upperBound.x=a.upperBound.x+g;f.aabb.upperBound.y=a.upperBound.y+
n;this.InsertLeaf(f);return!0};B.prototype.Rebalance=function(f){f===void 0&&(f=0);if(this.m_root!=null)for(var a=0;a<f;a++){for(var n=this.m_root,g=0;n.IsLeaf()==!1;)n=this.m_path>>g&1?n.child2:n.child1,g=g+1&31;++this.m_path;this.RemoveLeaf(n);this.InsertLeaf(n)}};B.prototype.GetFatAABB=function(f){return f.aabb};B.prototype.GetUserData=function(f){return f.userData};B.prototype.Query=function(f,n){if(this.m_root!=null){var a=new p,g=0;for(a[g++]=this.m_root;g>0;){var m=a[--g];if(m.aabb.TestOverlap(n))if(m.IsLeaf()){if(!f(m))break}else a[g++]=
m.child1,a[g++]=m.child2}}};B.prototype.RayCast=function(f,a){if(this.m_root!=null){var n=a.p1,g=a.p2,m=u.SubtractVV(n,g);m.Normalize();var m=u.CrossFV(1,m),b=u.AbsV(m),w=a.maxFraction,j=new t,e=0,q=0,e=n.x+w*(g.x-n.x),q=n.y+w*(g.y-n.y);j.lowerBound.x=Math.min(n.x,e);j.lowerBound.y=Math.min(n.y,q);j.upperBound.x=Math.max(n.x,e);j.upperBound.y=Math.max(n.y,q);var z=new p,d=0;for(z[d++]=this.m_root;d>0;)if(w=z[--d],w.aabb.TestOverlap(j)!=!1&&(e=w.aabb.GetCenter(),q=w.aabb.GetExtents(),!(Math.abs(m.x*
(n.x-e.x)+m.y*(n.y-e.y))-b.x*q.x-b.y*q.y>0)))if(w.IsLeaf()){e=new I;e.p1=a.p1;e.p2=a.p2;e.maxFraction=a.maxFraction;w=f(e,w);if(w==0)break;if(w>0)e=n.x+w*(g.x-n.x),q=n.y+w*(g.y-n.y),j.lowerBound.x=Math.min(n.x,e),j.lowerBound.y=Math.min(n.y,q),j.upperBound.x=Math.max(n.x,e),j.upperBound.y=Math.max(n.y,q)}else z[d++]=w.child1,z[d++]=w.child2}};B.prototype.AllocateNode=function(){if(this.m_freeList){var f=this.m_freeList;this.m_freeList=f.parent;f.parent=null;f.child1=null;f.child2=null;return f}return new G};
B.prototype.FreeNode=function(f){f.parent=this.m_freeList;this.m_freeList=f};B.prototype.InsertLeaf=function(f){++this.m_insertionCount;if(this.m_root==null)this.m_root=f,this.m_root.parent=null;else{var n=f.aabb.GetCenter(),a=this.m_root;if(a.IsLeaf()==!1){do var g=a.child1,a=a.child2,a=Math.abs((g.aabb.lowerBound.x+g.aabb.upperBound.x)/2-n.x)+Math.abs((g.aabb.lowerBound.y+g.aabb.upperBound.y)/2-n.y)<Math.abs((a.aabb.lowerBound.x+a.aabb.upperBound.x)/2-n.x)+Math.abs((a.aabb.lowerBound.y+a.aabb.upperBound.y)/
2-n.y)?g:a;while(a.IsLeaf()==!1)}n=a.parent;g=this.AllocateNode();g.parent=n;g.userData=null;g.aabb.Combine(f.aabb,a.aabb);if(n){a.parent.child1==a?n.child1=g:n.child2=g;g.child1=a;g.child2=f;a.parent=g;f.parent=g;do{if(n.aabb.Contains(g.aabb))break;n.aabb.Combine(n.child1.aabb,n.child2.aabb);g=n;n=n.parent}while(n)}else g.child1=a,g.child2=f,a.parent=g,this.m_root=f.parent=g}};B.prototype.RemoveLeaf=function(f){if(f==this.m_root)this.m_root=null;else{var n=f.parent,a=n.parent,f=n.child1==f?n.child2:
n.child1;if(a){a.child1==n?a.child1=f:a.child2=f;f.parent=a;for(this.FreeNode(n);a;){n=a.aabb;a.aabb=t.Combine(a.child1.aabb,a.child2.aabb);if(n.Contains(a.aabb))break;a=a.parent}}else this.m_root=f,f.parent=null,this.FreeNode(n)}};D.b2DynamicTreeBroadPhase=function(){this.m_tree=new B;this.m_moveBuffer=new p;this.m_pairBuffer=new p;this.m_pairCount=0};D.prototype.CreateProxy=function(f,n){var a=this.m_tree.CreateProxy(f,n);++this.m_proxyCount;this.BufferMove(a);return a};D.prototype.DestroyProxy=
function(f){this.UnBufferMove(f);--this.m_proxyCount;this.m_tree.DestroyProxy(f)};D.prototype.MoveProxy=function(f,n,a){this.m_tree.MoveProxy(f,n,a)&&this.BufferMove(f)};D.prototype.TestOverlap=function(f,n){var a=this.m_tree.GetFatAABB(f),g=this.m_tree.GetFatAABB(n);return a.TestOverlap(g)};D.prototype.GetUserData=function(f){return this.m_tree.GetUserData(f)};D.prototype.GetFatAABB=function(f){return this.m_tree.GetFatAABB(f)};D.prototype.GetProxyCount=function(){return this.m_proxyCount};D.prototype.UpdatePairs=
function(f){for(var n=this,a=n.m_pairCount=0,g,a=0;a<n.m_moveBuffer.length;++a){g=n.m_moveBuffer[a];var m=n.m_tree.GetFatAABB(g);n.m_tree.Query(function(f){if(f==g)return!0;n.m_pairCount==n.m_pairBuffer.length&&(n.m_pairBuffer[n.m_pairCount]=new N);var a=n.m_pairBuffer[n.m_pairCount];a.proxyA=f<g?f:g;a.proxyB=f>=g?f:g;++n.m_pairCount;return!0},m)}for(a=n.m_moveBuffer.length=0;a<n.m_pairCount;){var m=n.m_pairBuffer[a],w=n.m_tree.GetUserData(m.proxyA),b=n.m_tree.GetUserData(m.proxyB);f(w,b);for(++a;a<
n.m_pairCount;){w=n.m_pairBuffer[a];if(w.proxyA!=m.proxyA||w.proxyB!=m.proxyB)break;++a}}};D.prototype.Query=function(f,n){this.m_tree.Query(f,n)};D.prototype.RayCast=function(f,n){this.m_tree.RayCast(f,n)};D.prototype.Validate=function(){};D.prototype.Rebalance=function(f){f===void 0&&(f=0);this.m_tree.Rebalance(f)};D.prototype.BufferMove=function(f){this.m_moveBuffer[this.m_moveBuffer.length]=f};D.prototype.UnBufferMove=function(f){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(f)),
1)};D.prototype.ComparePairs=function(){return 0};D.__implements={};D.__implements[w]=!0;G.b2DynamicTreeNode=function(){this.aabb=new t};G.prototype.IsLeaf=function(){return this.child1==null};N.b2DynamicTreePair=function(){};E.b2Manifold=function(){this.m_pointCount=0};E.prototype.b2Manifold=function(){this.m_points=new p(c.b2_maxManifoldPoints);for(var f=0;f<c.b2_maxManifoldPoints;f++)this.m_points[f]=new S;this.m_localPlaneNormal=new e;this.m_localPoint=new e};E.prototype.Reset=function(){for(var f=
0;f<c.b2_maxManifoldPoints;f++)(this.m_points[f]instanceof S?this.m_points[f]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};E.prototype.Set=function(f){this.m_pointCount=f.m_pointCount;for(var n=0;n<c.b2_maxManifoldPoints;n++)(this.m_points[n]instanceof S?this.m_points[n]:null).Set(f.m_points[n]);this.m_localPlaneNormal.SetV(f.m_localPlaneNormal);this.m_localPoint.SetV(f.m_localPoint);this.m_type=f.m_type};E.prototype.Copy=function(){var f=
new E;f.Set(this);return f};a.postDefs.push(function(){a.Collision.b2Manifold.e_circles=1;a.Collision.b2Manifold.e_faceA=2;a.Collision.b2Manifold.e_faceB=4});S.b2ManifoldPoint=function(){this.m_localPoint=new e;this.m_id=new J};S.prototype.b2ManifoldPoint=function(){this.Reset()};S.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};S.prototype.Set=function(f){this.m_localPoint.SetV(f.m_localPoint);this.m_normalImpulse=f.m_normalImpulse;
this.m_tangentImpulse=f.m_tangentImpulse;this.m_id.Set(f.m_id)};F.b2Point=function(){this.p=new e};F.prototype.Support=function(){return this.p};F.prototype.GetFirstVertex=function(){return this.p};I.b2RayCastInput=function(){this.p1=new e;this.p2=new e};I.prototype.b2RayCastInput=function(f,n,a){f===void 0&&(f=null);n===void 0&&(n=null);a===void 0&&(a=1);f&&this.p1.SetV(f);n&&this.p2.SetV(n);this.maxFraction=a};T.b2RayCastOutput=function(){this.normal=new e};M.b2Segment=function(){this.p1=new e;
this.p2=new e};M.prototype.TestSegment=function(f,n,a,g){g===void 0&&(g=0);var m=a.p1,w=a.p2.x-m.x,b=a.p2.y-m.y,a=this.p2.y-this.p1.y,j=-(this.p2.x-this.p1.x),e=100*Number.MIN_VALUE,q=-(w*a+b*j);if(q>e){var z=m.x-this.p1.x,d=m.y-this.p1.y,m=z*a+d*j;if(0<=m&&m<=g*q&&(g=-w*d+b*z,-e*q<=g&&g<=q*(1+e)))return m/=q,g=Math.sqrt(a*a+j*j),a/=g,j/=g,f[0]=m,n.Set(a,j),!0}return!1};M.prototype.Extend=function(f){this.ExtendForward(f);this.ExtendBackward(f)};M.prototype.ExtendForward=function(f){var n=this.p2.x-
this.p1.x,a=this.p2.y-this.p1.y,f=Math.min(n>0?(f.upperBound.x-this.p1.x)/n:n<0?(f.lowerBound.x-this.p1.x)/n:Number.POSITIVE_INFINITY,a>0?(f.upperBound.y-this.p1.y)/a:a<0?(f.lowerBound.y-this.p1.y)/a:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+n*f;this.p2.y=this.p1.y+a*f};M.prototype.ExtendBackward=function(f){var n=-this.p2.x+this.p1.x,a=-this.p2.y+this.p1.y,f=Math.min(n>0?(f.upperBound.x-this.p2.x)/n:n<0?(f.lowerBound.x-this.p2.x)/n:Number.POSITIVE_INFINITY,a>0?(f.upperBound.y-this.p2.y)/a:a<
0?(f.lowerBound.y-this.p2.y)/a:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+n*f;this.p1.y=this.p2.y+a*f};m.b2SeparationFunction=function(){this.m_localPoint=new e;this.m_axis=new e};m.prototype.Initialize=function(f,n,a,g,w){this.m_proxyA=n;this.m_proxyB=g;var b=parseInt(f.count);c.b2Assert(0<b&&b<3);var j,q,z,d,A=d=z=g=n=0,t=0,A=0;b==1?(this.m_type=m.e_points,j=this.m_proxyA.GetVertex(f.indexA[0]),q=this.m_proxyB.GetVertex(f.indexB[0]),b=j,f=a.R,n=a.position.x+(f.col1.x*b.x+f.col2.x*b.y),g=a.position.y+
(f.col1.y*b.x+f.col2.y*b.y),b=q,f=w.R,z=w.position.x+(f.col1.x*b.x+f.col2.x*b.y),d=w.position.y+(f.col1.y*b.x+f.col2.y*b.y),this.m_axis.x=z-n,this.m_axis.y=d-g,this.m_axis.Normalize()):(f.indexB[0]==f.indexB[1]?(this.m_type=m.e_faceA,n=this.m_proxyA.GetVertex(f.indexA[0]),g=this.m_proxyA.GetVertex(f.indexA[1]),q=this.m_proxyB.GetVertex(f.indexB[0]),this.m_localPoint.x=0.5*(n.x+g.x),this.m_localPoint.y=0.5*(n.y+g.y),this.m_axis=u.CrossVF(u.SubtractVV(g,n),1),this.m_axis.Normalize(),b=this.m_axis,f=
a.R,A=f.col1.x*b.x+f.col2.x*b.y,t=f.col1.y*b.x+f.col2.y*b.y,b=this.m_localPoint,f=a.R,n=a.position.x+(f.col1.x*b.x+f.col2.x*b.y),g=a.position.y+(f.col1.y*b.x+f.col2.y*b.y),b=q,f=w.R,z=w.position.x+(f.col1.x*b.x+f.col2.x*b.y),d=w.position.y+(f.col1.y*b.x+f.col2.y*b.y),A=(z-n)*A+(d-g)*t):f.indexA[0]==f.indexA[0]?(this.m_type=m.e_faceB,z=this.m_proxyB.GetVertex(f.indexB[0]),d=this.m_proxyB.GetVertex(f.indexB[1]),j=this.m_proxyA.GetVertex(f.indexA[0]),this.m_localPoint.x=0.5*(z.x+d.x),this.m_localPoint.y=
0.5*(z.y+d.y),this.m_axis=u.CrossVF(u.SubtractVV(d,z),1),this.m_axis.Normalize(),b=this.m_axis,f=w.R,A=f.col1.x*b.x+f.col2.x*b.y,t=f.col1.y*b.x+f.col2.y*b.y,b=this.m_localPoint,f=w.R,z=w.position.x+(f.col1.x*b.x+f.col2.x*b.y),d=w.position.y+(f.col1.y*b.x+f.col2.y*b.y),b=j,f=a.R,n=a.position.x+(f.col1.x*b.x+f.col2.x*b.y),g=a.position.y+(f.col1.y*b.x+f.col2.y*b.y),A=(n-z)*A+(g-d)*t):(n=this.m_proxyA.GetVertex(f.indexA[0]),g=this.m_proxyA.GetVertex(f.indexA[1]),z=this.m_proxyB.GetVertex(f.indexB[0]),
d=this.m_proxyB.GetVertex(f.indexB[1]),u.MulX(a,j),j=u.MulMV(a.R,u.SubtractVV(g,n)),u.MulX(w,q),A=u.MulMV(w.R,u.SubtractVV(d,z)),w=j.x*j.x+j.y*j.y,q=A.x*A.x+A.y*A.y,f=u.SubtractVV(A,j),a=j.x*f.x+j.y*f.y,f=A.x*f.x+A.y*f.y,j=j.x*A.x+j.y*A.y,t=w*q-j*j,A=0,t!=0&&(A=u.Clamp((j*f-a*q)/t,0,1)),(j*A+f)/q<0&&(A=u.Clamp((j-a)/w,0,1)),j=new e,j.x=n.x+A*(g.x-n.x),j.y=n.y+A*(g.y-n.y),q=new e,q.x=z.x+A*(d.x-z.x),q.y=z.y+A*(d.y-z.y),A==0||A==1?(this.m_type=m.e_faceB,this.m_axis=u.CrossVF(u.SubtractVV(d,z),1),this.m_axis.Normalize(),
this.m_localPoint=q):(this.m_type=m.e_faceA,this.m_axis=u.CrossVF(u.SubtractVV(g,n),1),this.m_localPoint=j)),A<0&&this.m_axis.NegativeSelf())};m.prototype.Evaluate=function(f,n){var a,g,b=0;switch(this.m_type){case m.e_points:return a=u.MulTMV(f.R,this.m_axis),g=u.MulTMV(n.R,this.m_axis.GetNegative()),a=this.m_proxyA.GetSupportVertex(a),g=this.m_proxyB.GetSupportVertex(g),a=u.MulX(f,a),g=u.MulX(n,g),b=(g.x-a.x)*this.m_axis.x+(g.y-a.y)*this.m_axis.y;case m.e_faceA:return b=u.MulMV(f.R,this.m_axis),
a=u.MulX(f,this.m_localPoint),g=u.MulTMV(n.R,b.GetNegative()),g=this.m_proxyB.GetSupportVertex(g),g=u.MulX(n,g),b=(g.x-a.x)*b.x+(g.y-a.y)*b.y;case m.e_faceB:return b=u.MulMV(n.R,this.m_axis),g=u.MulX(n,this.m_localPoint),a=u.MulTMV(f.R,b.GetNegative()),a=this.m_proxyA.GetSupportVertex(a),a=u.MulX(f,a),b=(a.x-g.x)*b.x+(a.y-g.y)*b.y;default:return c.b2Assert(!1),0}};a.postDefs.push(function(){a.Collision.b2SeparationFunction.e_points=1;a.Collision.b2SeparationFunction.e_faceA=2;a.Collision.b2SeparationFunction.e_faceB=
4});q.b2Simplex=function(){this.m_v1=new z;this.m_v2=new z;this.m_v3=new z;this.m_vertices=new p(3)};q.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};q.prototype.ReadCache=function(f,n,a,g,m){c.b2Assert(0<=f.count&&f.count<=3);var b,w;this.m_count=f.count;for(var j=this.m_vertices,e=0;e<this.m_count;e++){var q=j[e];q.indexA=f.indexA[e];q.indexB=f.indexB[e];b=n.GetVertex(q.indexA);w=g.GetVertex(q.indexB);q.wA=u.MulX(a,b);q.wB=
u.MulX(m,w);q.w=u.SubtractVV(q.wB,q.wA);q.a=0}if(this.m_count>1&&(f=f.metric,b=this.GetMetric(),b<0.5*f||2*f<b||b<Number.MIN_VALUE))this.m_count=0;if(this.m_count==0)q=j[0],q.indexA=0,q.indexB=0,b=n.GetVertex(0),w=g.GetVertex(0),q.wA=u.MulX(a,b),q.wB=u.MulX(m,w),q.w=u.SubtractVV(q.wB,q.wA),this.m_count=1};q.prototype.WriteCache=function(f){f.metric=this.GetMetric();f.count=a.parseUInt(this.m_count);for(var n=this.m_vertices,g=0;g<this.m_count;g++)f.indexA[g]=a.parseUInt(n[g].indexA),f.indexB[g]=a.parseUInt(n[g].indexB)};
q.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var f=u.SubtractVV(this.m_v2.w,this.m_v1.w);return u.CrossVV(f,this.m_v1.w.GetNegative())>0?u.CrossFV(1,f):u.CrossVF(f,1);default:return c.b2Assert(!1),new e}};q.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return c.b2Assert(!1),new e;case 1:return this.m_v1.w;case 2:return new e(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*
this.m_v2.w.y);default:return c.b2Assert(!1),new e}};q.prototype.GetWitnessPoints=function(f,n){switch(this.m_count){case 0:c.b2Assert(!1);break;case 1:f.SetV(this.m_v1.wA);n.SetV(this.m_v1.wB);break;case 2:f.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;f.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;n.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;n.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:n.x=f.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+
this.m_v3.a*this.m_v3.wA.x;n.y=f.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:c.b2Assert(!1)}};q.prototype.GetMetric=function(){switch(this.m_count){case 0:return c.b2Assert(!1),0;case 1:return 0;case 2:return u.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return u.CrossVV(u.SubtractVV(this.m_v2.w,this.m_v1.w),u.SubtractVV(this.m_v3.w,this.m_v1.w));default:return c.b2Assert(!1),0}};q.prototype.Solve2=function(){var f=this.m_v1.w,n=this.m_v2.w,
a=u.SubtractVV(n,f),f=-(f.x*a.x+f.y*a.y);f<=0?this.m_count=this.m_v1.a=1:(n=n.x*a.x+n.y*a.y,n<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(a=1/(n+f),this.m_v1.a=n*a,this.m_v2.a=f*a,this.m_count=2))};q.prototype.Solve3=function(){var f=this.m_v1.w,n=this.m_v2.w,a=this.m_v3.w,g=u.SubtractVV(n,f),m=u.Dot(f,g),b=u.Dot(n,g),m=-m,w=u.SubtractVV(a,f),j=u.Dot(f,w),e=u.Dot(a,w),j=-j,q=u.SubtractVV(a,n),z=u.Dot(n,q),q=u.Dot(a,q),z=-z,w=u.CrossVV(g,w),g=w*u.CrossVV(n,a),a=w*u.CrossVV(a,f),f=w*u.CrossVV(f,
n);m<=0&&j<=0?this.m_count=this.m_v1.a=1:b>0&&m>0&&f<=0?(e=1/(b+m),this.m_v1.a=b*e,this.m_v2.a=m*e,this.m_count=2):e>0&&j>0&&a<=0?(b=1/(e+j),this.m_v1.a=e*b,this.m_v3.a=j*b,this.m_count=2,this.m_v2.Set(this.m_v3)):b<=0&&z<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):e<=0&&q<=0?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):q>0&&z>0&&g<=0?(b=1/(q+z),this.m_v2.a=q*b,this.m_v3.a=z*b,this.m_count=2,this.m_v1.Set(this.m_v3)):(b=1/(g+a+f),this.m_v1.a=g*b,this.m_v2.a=a*b,this.m_v3.a=f*
b,this.m_count=3)};A.b2SimplexCache=function(){this.indexA=new k(3);this.indexB=new k(3)};z.b2SimplexVertex=function(){};z.prototype.Set=function(f){this.wA.SetV(f.wA);this.wB.SetV(f.wB);this.w.SetV(f.w);this.a=f.a;this.indexA=f.indexA;this.indexB=f.indexB};K.b2TimeOfImpact=function(){};K.TimeOfImpact=function(f){++K.b2_toiCalls;var n=f.proxyA,a=f.proxyB,g=f.sweepA,m=f.sweepB;c.b2Assert(g.t0==m.t0);c.b2Assert(1-g.t0>Number.MIN_VALUE);var b=n.m_radius+a.m_radius,f=f.tolerance,w=0,j=0,e=0;K.s_cache.count=
0;for(K.s_distanceInput.useRadii=!1;;){g.GetTransform(K.s_xfA,w);m.GetTransform(K.s_xfB,w);K.s_distanceInput.proxyA=n;K.s_distanceInput.proxyB=a;K.s_distanceInput.transformA=K.s_xfA;K.s_distanceInput.transformB=K.s_xfB;O.Distance(K.s_distanceOutput,K.s_cache,K.s_distanceInput);if(K.s_distanceOutput.distance<=0){w=1;break}K.s_fcn.Initialize(K.s_cache,n,K.s_xfA,a,K.s_xfB);var q=K.s_fcn.Evaluate(K.s_xfA,K.s_xfB);if(q<=0){w=1;break}j==0&&(e=q>b?u.Max(b-f,0.75*b):u.Max(q-f,0.02*b));if(q-e<0.5*f){if(j==
0){w=1;break}break}var z=w,d=w,A=1;g.GetTransform(K.s_xfA,A);m.GetTransform(K.s_xfB,A);var t=K.s_fcn.Evaluate(K.s_xfA,K.s_xfB);if(t>=e){w=1;break}for(var l=0;;){var B=0,B=l&1?d+(e-q)*(A-d)/(t-q):0.5*(d+A);g.GetTransform(K.s_xfA,B);m.GetTransform(K.s_xfB,B);var R=K.s_fcn.Evaluate(K.s_xfA,K.s_xfB);if(u.Abs(R-e)<0.025*f){z=B;break}R>e?(d=B,q=R):(A=B,t=R);++l;++K.b2_toiRootIters;if(l==50)break}K.b2_toiMaxRootIters=u.Max(K.b2_toiMaxRootIters,l);if(z<(1+100*Number.MIN_VALUE)*w)break;w=z;j++;++K.b2_toiIters;
if(j==1E3)break}K.b2_toiMaxIters=u.Max(K.b2_toiMaxIters,j);return w};a.postDefs.push(function(){a.Collision.b2TimeOfImpact.b2_toiCalls=0;a.Collision.b2TimeOfImpact.b2_toiIters=0;a.Collision.b2TimeOfImpact.b2_toiMaxIters=0;a.Collision.b2TimeOfImpact.b2_toiRootIters=0;a.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;a.Collision.b2TimeOfImpact.s_cache=new A;a.Collision.b2TimeOfImpact.s_distanceInput=new v;a.Collision.b2TimeOfImpact.s_xfA=new o;a.Collision.b2TimeOfImpact.s_xfB=new o;a.Collision.b2TimeOfImpact.s_fcn=
new m;a.Collision.b2TimeOfImpact.s_distanceOutput=new j});R.b2TOIInput=function(){this.proxyA=new P;this.proxyB=new P;this.sweepA=new h;this.sweepB=new h};g.b2WorldManifold=function(){this.m_normal=new e};g.prototype.b2WorldManifold=function(){this.m_points=new p(c.b2_maxManifoldPoints);for(var f=0;f<c.b2_maxManifoldPoints;f++)this.m_points[f]=new e};g.prototype.Initialize=function(f,n,a,g,m){a===void 0&&(a=0);m===void 0&&(m=0);if(f.m_pointCount!=0){var b=0,w,j,e=0,q=0,z=0,d=0,A=0;w=0;switch(f.m_type){case E.e_circles:j=
n.R;w=f.m_localPoint;b=n.position.x+j.col1.x*w.x+j.col2.x*w.y;n=n.position.y+j.col1.y*w.x+j.col2.y*w.y;j=g.R;w=f.m_points[0].m_localPoint;f=g.position.x+j.col1.x*w.x+j.col2.x*w.y;g=g.position.y+j.col1.y*w.x+j.col2.y*w.y;w=f-b;j=g-n;e=w*w+j*j;e>Number.MIN_VALUE*Number.MIN_VALUE?(e=Math.sqrt(e),this.m_normal.x=w/e,this.m_normal.y=j/e):(this.m_normal.x=1,this.m_normal.y=0);w=n+a*this.m_normal.y;g-=m*this.m_normal.y;this.m_points[0].x=0.5*(b+a*this.m_normal.x+(f-m*this.m_normal.x));this.m_points[0].y=
0.5*(w+g);break;case E.e_faceA:j=n.R;w=f.m_localPlaneNormal;e=j.col1.x*w.x+j.col2.x*w.y;q=j.col1.y*w.x+j.col2.y*w.y;j=n.R;w=f.m_localPoint;z=n.position.x+j.col1.x*w.x+j.col2.x*w.y;d=n.position.y+j.col1.y*w.x+j.col2.y*w.y;this.m_normal.x=e;this.m_normal.y=q;for(b=0;b<f.m_pointCount;b++)j=g.R,w=f.m_points[b].m_localPoint,A=g.position.x+j.col1.x*w.x+j.col2.x*w.y,w=g.position.y+j.col1.y*w.x+j.col2.y*w.y,this.m_points[b].x=A+0.5*(a-(A-z)*e-(w-d)*q-m)*e,this.m_points[b].y=w+0.5*(a-(A-z)*e-(w-d)*q-m)*q;
break;case E.e_faceB:j=g.R;w=f.m_localPlaneNormal;e=j.col1.x*w.x+j.col2.x*w.y;q=j.col1.y*w.x+j.col2.y*w.y;j=g.R;w=f.m_localPoint;z=g.position.x+j.col1.x*w.x+j.col2.x*w.y;d=g.position.y+j.col1.y*w.x+j.col2.y*w.y;this.m_normal.x=-e;this.m_normal.y=-q;for(b=0;b<f.m_pointCount;b++)j=n.R,w=f.m_points[b].m_localPoint,A=n.position.x+j.col1.x*w.x+j.col2.x*w.y,w=n.position.y+j.col1.y*w.x+j.col2.y*w.y,this.m_points[b].x=A+0.5*(m-(A-z)*e-(w-d)*q-a)*e,this.m_points[b].y=w+0.5*(m-(A-z)*e-(w-d)*q-a)*q}}};f.ClipVertex=
function(){this.v=new e;this.id=new J};f.prototype.Set=function(f){this.v.SetV(f.v);this.id.Set(f.id)};n.Features=function(){};Object.defineProperty(n.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(n.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(f){f===void 0&&(f=0);this._referenceEdge=f;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(n.prototype,"incidentEdge",
{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(n.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(f){f===void 0&&(f=0);this._incidentEdge=f;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(n.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});Object.defineProperty(n.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(f){f===
void 0&&(f=0);this._incidentVertex=f;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(n.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(n.prototype,"flip",{enumerable:!1,configurable:!0,set:function(f){f===void 0&&(f=0);this._flip=f;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var b=a.Common.b2Settings,d=a.Collision.Shapes.b2CircleShape,c=a.Collision.Shapes.b2EdgeChainDef,
r=a.Collision.Shapes.b2EdgeShape,u=a.Collision.Shapes.b2MassData,h=a.Collision.Shapes.b2PolygonShape,o=a.Collision.Shapes.b2Shape,e=a.Common.Math.b2Mat22,t=a.Common.Math.b2Math,L=a.Common.Math.b2Transform,H=a.Common.Math.b2Vec2,C=a.Collision.b2Distance,J=a.Collision.b2DistanceInput,x=a.Collision.b2DistanceOutput,v=a.Collision.b2DistanceProxy,Q=a.Collision.b2SimplexCache;a.inherit(d,a.Collision.Shapes.b2Shape);d.prototype.__super=a.Collision.Shapes.b2Shape.prototype;d.b2CircleShape=function(){a.Collision.Shapes.b2Shape.b2Shape.apply(this,
arguments);this.m_p=new H};d.prototype.Copy=function(){var a=new d;a.Set(this);return a};d.prototype.Set=function(b){this.__super.Set.call(this,b);a.is(b,d)&&this.m_p.SetV((b instanceof d?b:null).m_p)};d.prototype.TestPoint=function(a,b){var e=a.R,d=a.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),e=a.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),d=b.x-d,e=b.y-e;return d*d+e*e<=this.m_radius*this.m_radius};d.prototype.RayCast=function(a,b,e){var d=e.R,c=b.p1.x-(e.position.x+(d.col1.x*
this.m_p.x+d.col2.x*this.m_p.y)),e=b.p1.y-(e.position.y+(d.col1.y*this.m_p.x+d.col2.y*this.m_p.y)),d=b.p2.x-b.p1.x,t=b.p2.y-b.p1.y,l=c*d+e*t,h=d*d+t*t,r=l*l-h*(c*c+e*e-this.m_radius*this.m_radius);if(r<0||h<Number.MIN_VALUE)return!1;l=-(l+Math.sqrt(r));if(0<=l&&l<=b.maxFraction*h)return l/=h,a.fraction=l,a.normal.x=c+l*d,a.normal.y=e+l*t,a.normal.Normalize(),!0;return!1};d.prototype.ComputeAABB=function(a,b){var e=b.R,d=b.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),e=b.position.y+(e.col1.y*
this.m_p.x+e.col2.y*this.m_p.y);a.lowerBound.Set(d-this.m_radius,e-this.m_radius);a.upperBound.Set(d+this.m_radius,e+this.m_radius)};d.prototype.ComputeMass=function(a,e){e===void 0&&(e=0);a.mass=e*b.b2_pi*this.m_radius*this.m_radius;a.center.SetV(this.m_p);a.I=a.mass*(0.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};d.prototype.ComputeSubmergedArea=function(a,b,e,d){b===void 0&&(b=0);var e=t.MulX(e,this.m_p),c=-(t.Dot(a,e)-b);if(c<-this.m_radius+Number.MIN_VALUE)return 0;
if(c>this.m_radius)return d.SetV(e),Math.PI*this.m_radius*this.m_radius;var b=this.m_radius*this.m_radius,l=c*c,c=b*(Math.asin(c/this.m_radius)+Math.PI/2)+c*Math.sqrt(b-l),b=-2/3*Math.pow(b-l,1.5)/c;d.x=e.x+a.x*b;d.y=e.y+a.y*b;return c};d.prototype.GetLocalPosition=function(){return this.m_p};d.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)};d.prototype.GetRadius=function(){return this.m_radius};d.prototype.SetRadius=function(a){a===void 0&&(a=0);this.m_radius=a};d.prototype.b2CircleShape=
function(a){a===void 0&&(a=0);this.__super.b2Shape.call(this);this.m_type=o.e_circleShape;this.m_radius=a};c.b2EdgeChainDef=function(){};c.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};a.inherit(r,a.Collision.Shapes.b2Shape);r.prototype.__super=a.Collision.Shapes.b2Shape.prototype;r.b2EdgeShape=function(){a.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new H;this.m_v1=new H;this.m_v2=new H;this.m_coreV1=new H;this.m_coreV2=new H;
this.m_normal=new H;this.m_direction=new H;this.m_cornerDir1=new H;this.m_cornerDir2=new H};r.prototype.TestPoint=function(){return!1};r.prototype.RayCast=function(a,b,e){var d,c=b.p2.x-b.p1.x,t=b.p2.y-b.p1.y;d=e.R;var l=e.position.x+(d.col1.x*this.m_v1.x+d.col2.x*this.m_v1.y),h=e.position.y+(d.col1.y*this.m_v1.x+d.col2.y*this.m_v1.y),r=e.position.y+(d.col1.y*this.m_v2.x+d.col2.y*this.m_v2.y)-h,e=-(e.position.x+(d.col1.x*this.m_v2.x+d.col2.x*this.m_v2.y)-l);d=100*Number.MIN_VALUE;var u=-(c*r+t*e);
if(u>d){var l=b.p1.x-l,k=b.p1.y-h,h=l*r+k*e;if(0<=h&&h<=b.maxFraction*u&&(b=-c*k+t*l,-d*u<=b&&b<=u*(1+d)))return h/=u,a.fraction=h,b=Math.sqrt(r*r+e*e),a.normal.x=r/b,a.normal.y=e/b,!0}return!1};r.prototype.ComputeAABB=function(a,b){var e=b.R,d=b.position.x+(e.col1.x*this.m_v1.x+e.col2.x*this.m_v1.y),c=b.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),l=b.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y),e=b.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y);d<l?(a.lowerBound.x=d,
a.upperBound.x=l):(a.lowerBound.x=l,a.upperBound.x=d);c<e?(a.lowerBound.y=c,a.upperBound.y=e):(a.lowerBound.y=e,a.upperBound.y=c)};r.prototype.ComputeMass=function(a){a.mass=0;a.center.SetV(this.m_v1);a.I=0};r.prototype.ComputeSubmergedArea=function(a,b,e,d){b===void 0&&(b=0);var c=new H(a.x*b,a.y*b),l=t.MulX(e,this.m_v1),e=t.MulX(e,this.m_v2),h=t.Dot(a,l)-b,a=t.Dot(a,e)-b;if(h>0)if(a>0)return 0;else l.x=-a/(h-a)*l.x+h/(h-a)*e.x,l.y=-a/(h-a)*l.y+h/(h-a)*e.y;else if(a>0)e.x=-a/(h-a)*l.x+h/(h-a)*e.x,
e.y=-a/(h-a)*l.y+h/(h-a)*e.y;d.x=(c.x+l.x+e.x)/3;d.y=(c.y+l.y+e.y)/3;return 0.5*((l.x-c.x)*(e.y-c.y)-(l.y-c.y)*(e.x-c.x))};r.prototype.GetLength=function(){return this.m_length};r.prototype.GetVertex1=function(){return this.m_v1};r.prototype.GetVertex2=function(){return this.m_v2};r.prototype.GetCoreVertex1=function(){return this.m_coreV1};r.prototype.GetCoreVertex2=function(){return this.m_coreV2};r.prototype.GetNormalVector=function(){return this.m_normal};r.prototype.GetDirectionVector=function(){return this.m_direction};
r.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};r.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};r.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};r.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};r.prototype.GetFirstVertex=function(a){var b=a.R;return new H(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))};r.prototype.GetNextEdge=function(){return this.m_nextEdge};
r.prototype.GetPrevEdge=function(){return this.m_prevEdge};r.prototype.Support=function(a,b,e){b===void 0&&(b=0);e===void 0&&(e=0);var d=a.R,c=a.position.x+(d.col1.x*this.m_coreV1.x+d.col2.x*this.m_coreV1.y),l=a.position.y+(d.col1.y*this.m_coreV1.x+d.col2.y*this.m_coreV1.y),t=a.position.x+(d.col1.x*this.m_coreV2.x+d.col2.x*this.m_coreV2.y),a=a.position.y+(d.col1.y*this.m_coreV2.x+d.col2.y*this.m_coreV2.y);c*b+l*e>t*b+a*e?(this.s_supportVec.x=c,this.s_supportVec.y=l):(this.s_supportVec.x=t,this.s_supportVec.y=
a);return this.s_supportVec};r.prototype.b2EdgeShape=function(a,e){this.__super.b2Shape.call(this);this.m_type=o.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=a;this.m_v2=e;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-b.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);
this.m_coreV2.Set(-b.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};r.prototype.SetPrevEdge=function(a,b,e,d){this.m_prevEdge=a;this.m_coreV1=b;this.m_cornerDir1=e;this.m_cornerConvex1=d};r.prototype.SetNextEdge=function(a,b,e,d){this.m_nextEdge=a;this.m_coreV2=b;this.m_cornerDir2=e;this.m_cornerConvex2=d};u.b2MassData=function(){this.mass=
0;this.center=new H(0,0);this.I=0};a.inherit(h,a.Collision.Shapes.b2Shape);h.prototype.__super=a.Collision.Shapes.b2Shape.prototype;h.b2PolygonShape=function(){a.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};h.prototype.Copy=function(){var a=new h;a.Set(this);return a};h.prototype.Set=function(b){this.__super.Set.call(this,b);if(a.is(b,h)){b=b instanceof h?b:null;this.m_centroid.SetV(b.m_centroid);this.m_vertexCount=b.m_vertexCount;this.Reserve(this.m_vertexCount);for(var e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(b.m_vertices[e]),
this.m_normals[e].SetV(b.m_normals[e])}};h.prototype.SetAsArray=function(a,b){b===void 0&&(b=0);for(var e=new p,d=0,c,d=0;d<a.length;++d)c=a[d],e.push(c);this.SetAsVector(e,b)};h.AsArray=function(a,b){b===void 0&&(b=0);var e=new h;e.SetAsArray(a,b);return e};h.prototype.SetAsVector=function(a,e){e===void 0&&(e=0);if(e==0)e=a.length;b.b2Assert(2<=e);this.m_vertexCount=e;this.Reserve(e);for(var d=0,d=0;d<this.m_vertexCount;d++)this.m_vertices[d].SetV(a[d]);for(d=0;d<this.m_vertexCount;++d){var c=parseInt(d),
l=parseInt(d+1<this.m_vertexCount?d+1:0),c=t.SubtractVV(this.m_vertices[l],this.m_vertices[c]);b.b2Assert(c.LengthSquared()>Number.MIN_VALUE);this.m_normals[d].SetV(t.CrossVF(c,1));this.m_normals[d].Normalize()}this.m_centroid=h.ComputeCentroid(this.m_vertices,this.m_vertexCount)};h.AsVector=function(a,b){b===void 0&&(b=0);var e=new h;e.SetAsVector(a,b);return e};h.prototype.SetAsBox=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-b);
this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};h.AsBox=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);var e=new h;e.SetAsBox(a,b);return e};h.prototype.SetAsOrientedBox=function(a,b,e,d){a===void 0&&(a=0);b===void 0&&(b=0);e===void 0&&(e=null);d===void 0&&(d=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,
-b);this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=e;a=new L;a.position=e;a.R.Set(d);for(e=0;e<this.m_vertexCount;++e)this.m_vertices[e]=t.MulX(a,this.m_vertices[e]),this.m_normals[e]=t.MulMV(a.R,this.m_normals[e])};h.AsOrientedBox=function(a,b,e,d){a===void 0&&(a=0);b===void 0&&(b=0);e===void 0&&(e=null);d===void 0&&(d=0);var c=new h;
c.SetAsOrientedBox(a,b,e,d);return c};h.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(a);this.m_vertices[1].SetV(b);this.m_centroid.x=0.5*(a.x+b.x);this.m_centroid.y=0.5*(a.y+b.y);this.m_normals[0]=t.CrossVF(t.SubtractVV(b,a),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};h.AsEdge=function(a,b){var e=new h;e.SetAsEdge(a,b);return e};h.prototype.TestPoint=function(a,b){var e;e=a.R;
for(var d=b.x-a.position.x,c=b.y-a.position.y,l=d*e.col1.x+c*e.col1.y,t=d*e.col2.x+c*e.col2.y,h=0;h<this.m_vertexCount;++h)if(e=this.m_vertices[h],d=l-e.x,c=t-e.y,e=this.m_normals[h],e.x*d+e.y*c>0)return!1;return!0};h.prototype.RayCast=function(a,b,e){var d=0,c=b.maxFraction,l=0,t=0,h,r,l=b.p1.x-e.position.x,t=b.p1.y-e.position.y;h=e.R;var u=l*h.col1.x+t*h.col1.y,k=l*h.col2.x+t*h.col2.y,l=b.p2.x-e.position.x,t=b.p2.y-e.position.y;h=e.R;b=l*h.col1.x+t*h.col1.y-u;h=l*h.col2.x+t*h.col2.y-k;for(var o=
parseInt(-1),m=0;m<this.m_vertexCount;++m){r=this.m_vertices[m];l=r.x-u;t=r.y-k;r=this.m_normals[m];l=r.x*l+r.y*t;t=r.x*b+r.y*h;if(t==0){if(l<0)return!1}else t<0&&l<d*t?(d=l/t,o=m):t>0&&l<c*t&&(c=l/t);if(c<d-Number.MIN_VALUE)return!1}if(o>=0)return a.fraction=d,h=e.R,r=this.m_normals[o],a.normal.x=h.col1.x*r.x+h.col2.x*r.y,a.normal.y=h.col1.y*r.x+h.col2.y*r.y,!0;return!1};h.prototype.ComputeAABB=function(a,b){for(var e=b.R,d=this.m_vertices[0],c=b.position.x+(e.col1.x*d.x+e.col2.x*d.y),l=b.position.y+
(e.col1.y*d.x+e.col2.y*d.y),t=c,h=l,r=1;r<this.m_vertexCount;++r)var d=this.m_vertices[r],u=b.position.x+(e.col1.x*d.x+e.col2.x*d.y),d=b.position.y+(e.col1.y*d.x+e.col2.y*d.y),c=c<u?c:u,l=l<d?l:d,t=t>u?t:u,h=h>d?h:d;a.lowerBound.x=c-this.m_radius;a.lowerBound.y=l-this.m_radius;a.upperBound.x=t+this.m_radius;a.upperBound.y=h+this.m_radius};h.prototype.ComputeMass=function(a,b){b===void 0&&(b=0);if(this.m_vertexCount==2)a.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=0.5*(this.m_vertices[0].y+
this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var e=0,d=0,c=0,l=0,t=1/3,h=0;h<this.m_vertexCount;++h){var r=this.m_vertices[h],u=h+1<this.m_vertexCount?this.m_vertices[parseInt(h+1)]:this.m_vertices[0],k=r.x-0,o=r.y-0,m=u.x-0,q=u.y-0,A=k*q-o*m,z=0.5*A;c+=z;e+=z*t*(0+r.x+u.x);d+=z*t*(0+r.y+u.y);r=k;l+=A*(t*(0.25*(r*r+m*r+m*m)+(0*r+0*m))+0+(t*(0.25*(o*o+q*o+q*q)+(0*o+0*q))+0))}a.mass=b*c;e*=1/c;d*=1/c;a.center.Set(e,d);a.I=b*l}};h.prototype.ComputeSubmergedArea=function(a,b,e,d){b===void 0&&(b=0);for(var c=
t.MulTMV(e.R,a),l=b-t.Dot(a,e.position),h=new k,r=0,o=parseInt(-1),b=parseInt(-1),p=!1,a=a=0;a<this.m_vertexCount;++a){h[a]=t.Dot(c,this.m_vertices[a])-l;var x=h[a]<-Number.MIN_VALUE;a>0&&(x?p||(o=a-1,r++):p&&(b=a-1,r++));p=x}switch(r){case 0:return p?(a=new u,this.ComputeMass(a,1),d.SetV(t.MulX(e,a.center)),a.mass):0;case 1:o==-1?o=this.m_vertexCount-1:b=this.m_vertexCount-1}a=parseInt((o+1)%this.m_vertexCount);c=parseInt((b+1)%this.m_vertexCount);l=(0-h[o])/(h[a]-h[o]);h=(0-h[b])/(h[c]-h[b]);o=
new H(this.m_vertices[o].x*(1-l)+this.m_vertices[a].x*l,this.m_vertices[o].y*(1-l)+this.m_vertices[a].y*l);b=new H(this.m_vertices[b].x*(1-h)+this.m_vertices[c].x*h,this.m_vertices[b].y*(1-h)+this.m_vertices[c].y*h);h=0;l=new H;for(r=this.m_vertices[a];a!=c;)a=(a+1)%this.m_vertexCount,p=a==c?b:this.m_vertices[a],x=0.5*((r.x-o.x)*(p.y-o.y)-(r.y-o.y)*(p.x-o.x)),h+=x,l.x+=x*(o.x+r.x+p.x)/3,l.y+=x*(o.y+r.y+p.y)/3,r=p;l.Multiply(1/h);d.SetV(t.MulX(e,l));return h};h.prototype.GetVertexCount=function(){return this.m_vertexCount};
h.prototype.GetVertices=function(){return this.m_vertices};h.prototype.GetNormals=function(){return this.m_normals};h.prototype.GetSupport=function(a){for(var b=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var c=this.m_vertices[d].x*a.x+this.m_vertices[d].y*a.y;c>e&&(b=d,e=c)}return b};h.prototype.GetSupportVertex=function(a){for(var b=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,d=1;d<this.m_vertexCount;++d){var c=this.m_vertices[d].x*a.x+this.m_vertices[d].y*
a.y;c>e&&(b=d,e=c)}return this.m_vertices[b]};h.prototype.Validate=function(){return!1};h.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=o.e_polygonShape;this.m_centroid=new H;this.m_vertices=new p;this.m_normals=new p};h.prototype.Reserve=function(a){a===void 0&&(a=0);for(var b=parseInt(this.m_vertices.length);b<a;b++)this.m_vertices[b]=new H,this.m_normals[b]=new H};h.ComputeCentroid=function(a,b){b===void 0&&(b=0);for(var e=new H,d=0,c=1/3,l=0;l<b;++l){var t=a[l],
h=l+1<b?a[parseInt(l+1)]:a[0],r=0.5*((t.x-0)*(h.y-0)-(t.y-0)*(h.x-0));d+=r;e.x+=r*c*(0+t.x+h.x);e.y+=r*c*(0+t.y+h.y)}e.x*=1/d;e.y*=1/d;return e};h.ComputeOBB=function(a,b,e){e===void 0&&(e=0);for(var d=0,c=new p(e+1),d=0;d<e;++d)c[d]=b[d];c[e]=c[0];b=Number.MAX_VALUE;for(d=1;d<=e;++d){var l=c[parseInt(d-1)],t=c[d].x-l.x,h=c[d].y-l.y,r=Math.sqrt(t*t+h*h);t/=r;h/=r;for(var u=-h,o=t,k=r=Number.MAX_VALUE,m=-Number.MAX_VALUE,q=-Number.MAX_VALUE,A=0;A<e;++A){var z=c[A].x-l.x,K=c[A].y-l.y,R=t*z+h*K,z=u*
z+o*K;R<r&&(r=R);z<k&&(k=z);R>m&&(m=R);z>q&&(q=z)}A=(m-r)*(q-k);if(A<0.95*b)b=A,a.R.col1.x=t,a.R.col1.y=h,a.R.col2.x=u,a.R.col2.y=o,t=0.5*(r+m),h=0.5*(k+q),u=a.R,a.center.x=l.x+(u.col1.x*t+u.col2.x*h),a.center.y=l.y+(u.col1.y*t+u.col2.y*h),a.extents.x=0.5*(m-r),a.extents.y=0.5*(q-k)}};a.postDefs.push(function(){a.Collision.Shapes.b2PolygonShape.s_mat=new e});o.b2Shape=function(){};o.prototype.Copy=function(){return null};o.prototype.Set=function(a){this.m_radius=a.m_radius};o.prototype.GetType=function(){return this.m_type};
o.prototype.TestPoint=function(){return!1};o.prototype.RayCast=function(){return!1};o.prototype.ComputeAABB=function(){};o.prototype.ComputeMass=function(){};o.prototype.ComputeSubmergedArea=function(){return 0};o.TestOverlap=function(a,b,e,d){var c=new J;c.proxyA=new v;c.proxyA.Set(a);c.proxyB=new v;c.proxyB.Set(e);c.transformA=b;c.transformB=d;c.useRadii=!0;a=new Q;a.count=0;b=new x;C.Distance(b,a,c);return b.distance<10*Number.MIN_VALUE};o.prototype.b2Shape=function(){this.m_type=o.e_unknownShape;
this.m_radius=b.b2_linearSlop};a.postDefs.push(function(){a.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);a.Collision.Shapes.b2Shape.e_circleShape=0;a.Collision.Shapes.b2Shape.e_polygonShape=1;a.Collision.Shapes.b2Shape.e_edgeShape=2;a.Collision.Shapes.b2Shape.e_shapeTypeCount=3;a.Collision.Shapes.b2Shape.e_hitCollide=1;a.Collision.Shapes.b2Shape.e_missCollide=0;a.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var b=a.Common.b2Color,d=a.Common.b2Settings,c=a.Common.Math.b2Math;
b.b2Color=function(){this._b=this._g=this._r=0};b.prototype.b2Color=function(b,d,h){b===void 0&&(b=0);d===void 0&&(d=0);h===void 0&&(h=0);this._r=a.parseUInt(255*c.Clamp(b,0,1));this._g=a.parseUInt(255*c.Clamp(d,0,1));this._b=a.parseUInt(255*c.Clamp(h,0,1))};b.prototype.Set=function(b,d,h){b===void 0&&(b=0);d===void 0&&(d=0);h===void 0&&(h=0);this._r=a.parseUInt(255*c.Clamp(b,0,1));this._g=a.parseUInt(255*c.Clamp(d,0,1));this._b=a.parseUInt(255*c.Clamp(h,0,1))};Object.defineProperty(b.prototype,"r",
{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._r=a.parseUInt(255*c.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"g",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._g=a.parseUInt(255*c.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"b",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._b=a.parseUInt(255*c.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<
16|this._g<<8|this._b}});d.b2Settings=function(){};d.b2MixFriction=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);return Math.sqrt(a*b)};d.b2MixRestitution=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);return a>b?a:b};d.b2Assert=function(a){if(!a)throw"Assertion Failed";};a.postDefs.push(function(){a.Common.b2Settings.VERSION="2.1alpha";a.Common.b2Settings.USHRT_MAX=65535;a.Common.b2Settings.b2_pi=Math.PI;a.Common.b2Settings.b2_maxManifoldPoints=2;a.Common.b2Settings.b2_aabbExtension=0.1;a.Common.b2Settings.b2_aabbMultiplier=
2;a.Common.b2Settings.b2_polygonRadius=2*d.b2_linearSlop;a.Common.b2Settings.b2_linearSlop=0.0050;a.Common.b2Settings.b2_angularSlop=2/180*d.b2_pi;a.Common.b2Settings.b2_toiSlop=8*d.b2_linearSlop;a.Common.b2Settings.b2_maxTOIContactsPerIsland=32;a.Common.b2Settings.b2_maxTOIJointsPerIsland=32;a.Common.b2Settings.b2_velocityThreshold=1;a.Common.b2Settings.b2_maxLinearCorrection=0.2;a.Common.b2Settings.b2_maxAngularCorrection=8/180*d.b2_pi;a.Common.b2Settings.b2_maxTranslation=10;a.Common.b2Settings.b2_maxTranslationSquared=
d.b2_maxTranslation*d.b2_maxTranslation;a.Common.b2Settings.b2_maxRotation=0.5*d.b2_pi;a.Common.b2Settings.b2_maxRotationSquared=d.b2_maxRotation*d.b2_maxRotation;a.Common.b2Settings.b2_contactBaumgarte=0.2;a.Common.b2Settings.b2_timeToSleep=0.5;a.Common.b2Settings.b2_linearSleepTolerance=0.01;a.Common.b2Settings.b2_angularSleepTolerance=2/180*d.b2_pi})})();(function(){var b=a.Common.Math.b2Mat22,d=a.Common.Math.b2Mat33,c=a.Common.Math.b2Math,r=a.Common.Math.b2Sweep,u=a.Common.Math.b2Transform,h=
a.Common.Math.b2Vec2,o=a.Common.Math.b2Vec3;b.b2Mat22=function(){this.col1=new h;this.col2=new h};b.prototype.b2Mat22=function(){this.SetIdentity()};b.FromAngle=function(a){a===void 0&&(a=0);var d=new b;d.Set(a);return d};b.FromVV=function(a,d){var c=new b;c.SetVV(a,d);return c};b.prototype.Set=function(a){a===void 0&&(a=0);var b=Math.cos(a),a=Math.sin(a);this.col1.x=b;this.col2.x=-a;this.col1.y=a;this.col2.y=b};b.prototype.SetVV=function(a,b){this.col1.SetV(a);this.col2.SetV(b)};b.prototype.Copy=
function(){var a=new b;a.SetM(this);return a};b.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2)};b.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y};b.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};b.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};b.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};b.prototype.GetInverse=
function(a){var b=this.col1.x,d=this.col2.x,c=this.col1.y,l=this.col2.y,h=b*l-d*c;h!=0&&(h=1/h);a.col1.x=h*l;a.col2.x=-h*d;a.col1.y=-h*c;a.col2.y=h*b;return a};b.prototype.Solve=function(a,b,d){b===void 0&&(b=0);d===void 0&&(d=0);var c=this.col1.x,l=this.col2.x,h=this.col1.y,r=this.col2.y,o=c*r-l*h;o!=0&&(o=1/o);a.x=o*(r*b-l*d);a.y=o*(c*d-h*b);return a};b.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};d.b2Mat33=function(){this.col1=new o;this.col2=new o;this.col3=new o};d.prototype.b2Mat33=
function(a,b,d){a===void 0&&(a=null);b===void 0&&(b=null);d===void 0&&(d=null);!a&&!b&&!d?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(d))};d.prototype.SetVVV=function(a,b,d){this.col1.SetV(a);this.col2.SetV(b);this.col3.SetV(d)};d.prototype.Copy=function(){return new d(this.col1,this.col2,this.col3)};d.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2);this.col3.SetV(a.col3)};d.prototype.AddM=function(a){this.col1.x+=
a.col1.x;this.col1.y+=a.col1.y;this.col1.z+=a.col1.z;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y;this.col2.z+=a.col2.z;this.col3.x+=a.col3.x;this.col3.y+=a.col3.y;this.col3.z+=a.col3.z};d.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};d.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=
0};d.prototype.Solve22=function(a,b,d){b===void 0&&(b=0);d===void 0&&(d=0);var c=this.col1.x,l=this.col2.x,h=this.col1.y,r=this.col2.y,o=c*r-l*h;o!=0&&(o=1/o);a.x=o*(r*b-l*d);a.y=o*(c*d-h*b);return a};d.prototype.Solve33=function(a,b,d,c){b===void 0&&(b=0);d===void 0&&(d=0);c===void 0&&(c=0);var l=this.col1.x,h=this.col1.y,r=this.col1.z,o=this.col2.x,u=this.col2.y,j=this.col2.z,k=this.col3.x,p=this.col3.y,y=this.col3.z,v=l*(u*y-j*p)+h*(j*k-o*y)+r*(o*p-u*k);v!=0&&(v=1/v);a.x=v*(b*(u*y-j*p)+d*(j*k-
o*y)+c*(o*p-u*k));a.y=v*(l*(d*y-c*p)+h*(c*k-b*y)+r*(b*p-d*k));a.z=v*(l*(u*c-j*d)+h*(j*b-o*c)+r*(o*d-u*b));return a};c.b2Math=function(){};c.IsValid=function(a){a===void 0&&(a=0);return isFinite(a)};c.Dot=function(a,b){return a.x*b.x+a.y*b.y};c.CrossVV=function(a,b){return a.x*b.y-a.y*b.x};c.CrossVF=function(a,b){b===void 0&&(b=0);return new h(b*a.y,-b*a.x)};c.CrossFV=function(a,b){a===void 0&&(a=0);return new h(-a*b.y,a*b.x)};c.MulMV=function(a,b){return new h(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+
a.col2.y*b.y)};c.MulTMV=function(a,b){return new h(c.Dot(b,a.col1),c.Dot(b,a.col2))};c.MulX=function(a,b){var d=c.MulMV(a.R,b);d.x+=a.position.x;d.y+=a.position.y;return d};c.MulXT=function(a,b){var d=c.SubtractVV(b,a.position),h=d.x*a.R.col1.x+d.y*a.R.col1.y;d.y=d.x*a.R.col2.x+d.y*a.R.col2.y;d.x=h;return d};c.AddVV=function(a,b){return new h(a.x+b.x,a.y+b.y)};c.SubtractVV=function(a,b){return new h(a.x-b.x,a.y-b.y)};c.Distance=function(a,b){var d=a.x-b.x,c=a.y-b.y;return Math.sqrt(d*d+c*c)};c.DistanceSquared=
function(a,b){var d=a.x-b.x,c=a.y-b.y;return d*d+c*c};c.MulFV=function(a,b){a===void 0&&(a=0);return new h(a*b.x,a*b.y)};c.AddMM=function(a,d){return b.FromVV(c.AddVV(a.col1,d.col1),c.AddVV(a.col2,d.col2))};c.MulMM=function(a,d){return b.FromVV(c.MulMV(a,d.col1),c.MulMV(a,d.col2))};c.MulTMM=function(a,d){var r=new h(c.Dot(a.col1,d.col1),c.Dot(a.col2,d.col1)),o=new h(c.Dot(a.col1,d.col2),c.Dot(a.col2,d.col2));return b.FromVV(r,o)};c.Abs=function(a){a===void 0&&(a=0);return a>0?a:-a};c.AbsV=function(a){return new h(c.Abs(a.x),
c.Abs(a.y))};c.AbsM=function(a){return b.FromVV(c.AbsV(a.col1),c.AbsV(a.col2))};c.Min=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);return a<b?a:b};c.MinV=function(a,b){return new h(c.Min(a.x,b.x),c.Min(a.y,b.y))};c.Max=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);return a>b?a:b};c.MaxV=function(a,b){return new h(c.Max(a.x,b.x),c.Max(a.y,b.y))};c.Clamp=function(a,b,d){a===void 0&&(a=0);b===void 0&&(b=0);d===void 0&&(d=0);return a<b?b:a>d?d:a};c.ClampV=function(a,b,d){return c.MaxV(b,c.MinV(a,
d))};c.Swap=function(a,b){var d=a[0];a[0]=b[0];b[0]=d};c.Random=function(){return Math.random()*2-1};c.RandomRange=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);var d=Math.random();return(b-a)*d+a};c.NextPowerOfTwo=function(a){a===void 0&&(a=0);a|=a>>1&2147483647;a|=a>>2&1073741823;a|=a>>4&268435455;a|=a>>8&16777215;a|=a>>16&65535;return a+1};c.IsPowerOfTwo=function(a){a===void 0&&(a=0);return a>0&&(a&a-1)==0};a.postDefs.push(function(){a.Common.Math.b2Math.b2Vec2_zero=new h(0,0);a.Common.Math.b2Math.b2Mat22_identity=
b.FromVV(new h(1,0),new h(0,1));a.Common.Math.b2Math.b2Transform_identity=new u(c.b2Vec2_zero,c.b2Mat22_identity)});r.b2Sweep=function(){this.localCenter=new h;this.c0=new h;this.c=new h};r.prototype.Set=function(a){this.localCenter.SetV(a.localCenter);this.c0.SetV(a.c0);this.c.SetV(a.c);this.a0=a.a0;this.a=a.a;this.t0=a.t0};r.prototype.Copy=function(){var a=new r;a.localCenter.SetV(this.localCenter);a.c0.SetV(this.c0);a.c.SetV(this.c);a.a0=this.a0;a.a=this.a;a.t0=this.t0;return a};r.prototype.GetTransform=
function(a,b){b===void 0&&(b=0);a.position.x=(1-b)*this.c0.x+b*this.c.x;a.position.y=(1-b)*this.c0.y+b*this.c.y;a.R.Set((1-b)*this.a0+b*this.a);var d=a.R;a.position.x-=d.col1.x*this.localCenter.x+d.col2.x*this.localCenter.y;a.position.y-=d.col1.y*this.localCenter.x+d.col2.y*this.localCenter.y};r.prototype.Advance=function(a){a===void 0&&(a=0);if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x;this.c0.y=(1-b)*this.c0.y+b*this.c.y;this.a0=(1-
b)*this.a0+b*this.a;this.t0=a}};u.b2Transform=function(){this.position=new h;this.R=new b};u.prototype.b2Transform=function(a,b){a===void 0&&(a=null);b===void 0&&(b=null);a&&(this.position.SetV(a),this.R.SetM(b))};u.prototype.Initialize=function(a,b){this.position.SetV(a);this.R.SetM(b)};u.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};u.prototype.Set=function(a){this.position.SetV(a.position);this.R.SetM(a.R)};u.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,
this.R.col1.x)};h.b2Vec2=function(){};h.prototype.b2Vec2=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.x=a;this.y=b};h.prototype.SetZero=function(){this.y=this.x=0};h.prototype.Set=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.x=a;this.y=b};h.prototype.SetV=function(a){this.x=a.x;this.y=a.y};h.prototype.GetNegative=function(){return new h(-this.x,-this.y)};h.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};h.Make=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);
return new h(a,b)};h.prototype.Copy=function(){return new h(this.x,this.y)};h.prototype.Add=function(a){this.x+=a.x;this.y+=a.y};h.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y};h.prototype.Multiply=function(a){a===void 0&&(a=0);this.x*=a;this.y*=a};h.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y;this.y=a.col1.y*b+a.col2.y*this.y};h.prototype.MulTM=function(a){var b=c.Dot(this,a.col1);this.y=c.Dot(this,a.col2);this.x=b};h.prototype.CrossVF=function(a){a===void 0&&
(a=0);var b=this.x;this.x=a*this.y;this.y=-a*b};h.prototype.CrossFV=function(a){a===void 0&&(a=0);var b=this.x;this.x=-a*this.y;this.y=a*b};h.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y};h.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y};h.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};h.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};h.prototype.LengthSquared=
function(){return this.x*this.x+this.y*this.y};h.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;this.x*=b;this.y*=b;return a};h.prototype.IsValid=function(){return c.IsValid(this.x)&&c.IsValid(this.y)};o.b2Vec3=function(){};o.prototype.b2Vec3=function(a,b,d){a===void 0&&(a=0);b===void 0&&(b=0);d===void 0&&(d=0);this.x=a;this.y=b;this.z=d};o.prototype.SetZero=function(){this.x=this.y=this.z=0};o.prototype.Set=function(a,b,d){a===
void 0&&(a=0);b===void 0&&(b=0);d===void 0&&(d=0);this.x=a;this.y=b;this.z=d};o.prototype.SetV=function(a){this.x=a.x;this.y=a.y;this.z=a.z};o.prototype.GetNegative=function(){return new o(-this.x,-this.y,-this.z)};o.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};o.prototype.Copy=function(){return new o(this.x,this.y,this.z)};o.prototype.Add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};o.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z};o.prototype.Multiply=
function(a){a===void 0&&(a=0);this.x*=a;this.y*=a;this.z*=a}})();(function(){var b=a.Common.Math.b2Math,d=a.Common.Math.b2Sweep,c=a.Common.Math.b2Transform,r=a.Common.Math.b2Vec2,o=a.Common.b2Color,h=a.Common.b2Settings,y=a.Collision.b2AABB,e=a.Collision.b2ContactPoint,t=a.Collision.b2DynamicTreeBroadPhase,L=a.Collision.b2RayCastInput,H=a.Collision.b2RayCastOutput,C=a.Collision.Shapes.b2CircleShape,J=a.Collision.Shapes.b2EdgeShape,x=a.Collision.Shapes.b2MassData,v=a.Collision.Shapes.b2PolygonShape,
Q=a.Collision.Shapes.b2Shape,j=a.Dynamics.b2Body,P=a.Dynamics.b2BodyDef,B=a.Dynamics.b2ContactFilter,D=a.Dynamics.b2ContactImpulse,G=a.Dynamics.b2ContactListener,N=a.Dynamics.b2ContactManager,E=a.Dynamics.b2DebugDraw,S=a.Dynamics.b2DestructionListener,F=a.Dynamics.b2FilterData,I=a.Dynamics.b2Fixture,T=a.Dynamics.b2FixtureDef,M=a.Dynamics.b2Island,m=a.Dynamics.b2TimeStep,q=a.Dynamics.b2World,A=a.Dynamics.Contacts.b2Contact,z=a.Dynamics.Contacts.b2ContactFactory,K=a.Dynamics.Contacts.b2ContactSolver,
R=a.Dynamics.Joints.b2Joint,g=a.Dynamics.Joints.b2PulleyJoint;j.b2Body=function(){this.m_xf=new c;this.m_sweep=new d;this.m_linearVelocity=new r;this.m_force=new r};j.prototype.connectEdges=function(f,a,g){g===void 0&&(g=0);var m=Math.atan2(a.GetDirectionVector().y,a.GetDirectionVector().x),g=b.MulFV(Math.tan((m-g)*0.5),a.GetDirectionVector()),g=b.SubtractVV(g,a.GetNormalVector()),g=b.MulFV(h.b2_toiSlop,g),g=b.AddVV(g,a.GetVertex1()),d=b.AddVV(f.GetDirectionVector(),a.GetDirectionVector());d.Normalize();
var q=b.Dot(f.GetDirectionVector(),a.GetNormalVector())>0;f.SetNextEdge(a,g,d,q);a.SetPrevEdge(f,g,d,q);return m};j.prototype.CreateFixture=function(f){if(this.m_world.IsLocked()==!0)return null;var a=new I;a.Create(this,this.m_xf,f);this.m_flags&j.e_activeFlag&&a.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);a.m_next=this.m_fixtureList;this.m_fixtureList=a;++this.m_fixtureCount;a.m_body=this;a.m_density>0&&this.ResetMassData();this.m_world.m_flags|=q.e_newFixture;return a};j.prototype.CreateFixture2=
function(f,a){a===void 0&&(a=0);var b=new T;b.shape=f;b.density=a;return this.CreateFixture(b)};j.prototype.DestroyFixture=function(f){if(this.m_world.IsLocked()!=!0){for(var a=this.m_fixtureList,b=null;a!=null;){if(a==f){b?b.m_next=f.m_next:this.m_fixtureList=f.m_next;break}b=a;a=a.m_next}for(a=this.m_contactList;a;){var b=a.contact,a=a.next,g=b.GetFixtureA(),m=b.GetFixtureB();(f==g||f==m)&&this.m_world.m_contactManager.Destroy(b)}this.m_flags&j.e_activeFlag&&f.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);
f.Destroy();f.m_body=null;f.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};j.prototype.SetPositionAndAngle=function(f,a){a===void 0&&(a=0);var b;if(this.m_world.IsLocked()!=!0){this.m_xf.R.Set(a);this.m_xf.position.SetV(f);b=this.m_xf.R;var g=this.m_sweep.localCenter;this.m_sweep.c.x=b.col1.x*g.x+b.col2.x*g.y;this.m_sweep.c.y=b.col1.y*g.x+b.col2.y*g.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=
a;g=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.Synchronize(g,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};j.prototype.SetTransform=function(f){this.SetPositionAndAngle(f.position,f.GetAngle())};j.prototype.GetTransform=function(){return this.m_xf};j.prototype.GetPosition=function(){return this.m_xf.position};j.prototype.SetPosition=function(f){this.SetPositionAndAngle(f,this.GetAngle())};j.prototype.GetAngle=function(){return this.m_sweep.a};
j.prototype.SetAngle=function(f){f===void 0&&(f=0);this.SetPositionAndAngle(this.GetPosition(),f)};j.prototype.GetWorldCenter=function(){return this.m_sweep.c};j.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};j.prototype.SetLinearVelocity=function(f){this.m_type!=j.b2_staticBody&&this.m_linearVelocity.SetV(f)};j.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};j.prototype.SetAngularVelocity=function(f){f===void 0&&(f=0);if(this.m_type!=j.b2_staticBody)this.m_angularVelocity=
f};j.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};j.prototype.GetDefinition=function(){var f=new P;f.type=this.GetType();f.allowSleep=(this.m_flags&j.e_allowSleepFlag)==j.e_allowSleepFlag;f.angle=this.GetAngle();f.angularDamping=this.m_angularDamping;f.angularVelocity=this.m_angularVelocity;f.fixedRotation=(this.m_flags&j.e_fixedRotationFlag)==j.e_fixedRotationFlag;f.bullet=(this.m_flags&j.e_bulletFlag)==j.e_bulletFlag;f.awake=(this.m_flags&j.e_awakeFlag)==j.e_awakeFlag;
f.linearDamping=this.m_linearDamping;f.linearVelocity.SetV(this.GetLinearVelocity());f.position=this.GetPosition();f.userData=this.GetUserData();return f};j.prototype.ApplyForce=function(f,a){this.m_type==j.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_force.x+=f.x,this.m_force.y+=f.y,this.m_torque+=(a.x-this.m_sweep.c.x)*f.y-(a.y-this.m_sweep.c.y)*f.x)};j.prototype.ApplyTorque=function(f){f===void 0&&(f=0);this.m_type==j.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_torque+=
f)};j.prototype.ApplyImpulse=function(f,a){this.m_type==j.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*f.x,this.m_linearVelocity.y+=this.m_invMass*f.y,this.m_angularVelocity+=this.m_invI*((a.x-this.m_sweep.c.x)*f.y-(a.y-this.m_sweep.c.y)*f.x))};j.prototype.Split=function(f){for(var a=this.GetLinearVelocity().Copy(),g=this.GetAngularVelocity(),m=this.GetWorldCenter(),d=this.m_world.CreateBody(this.GetDefinition()),q,c=this.m_fixtureList;c;)if(f(c)){var e=
c.m_next;q?q.m_next=e:this.m_fixtureList=e;this.m_fixtureCount--;c.m_next=d.m_fixtureList;d.m_fixtureList=c;d.m_fixtureCount++;c.m_body=d;c=e}else q=c,c=c.m_next;this.ResetMassData();d.ResetMassData();q=this.GetWorldCenter();f=d.GetWorldCenter();q=b.AddVV(a,b.CrossFV(g,b.SubtractVV(q,m)));a=b.AddVV(a,b.CrossFV(g,b.SubtractVV(f,m)));this.SetLinearVelocity(q);d.SetLinearVelocity(a);this.SetAngularVelocity(g);d.SetAngularVelocity(g);this.SynchronizeFixtures();d.SynchronizeFixtures();return d};j.prototype.Merge=
function(f){var a;for(a=f.m_fixtureList;a;){var b=a.m_next;f.m_fixtureCount--;a.m_next=this.m_fixtureList;this.m_fixtureList=a;this.m_fixtureCount++;a.m_body=m;a=b}g.m_fixtureCount=0;var g=this,m=f;g.GetWorldCenter();m.GetWorldCenter();g.GetLinearVelocity().Copy();m.GetLinearVelocity().Copy();g.GetAngularVelocity();m.GetAngularVelocity();g.ResetMassData();this.SynchronizeFixtures()};j.prototype.GetMass=function(){return this.m_mass};j.prototype.GetInertia=function(){return this.m_I};j.prototype.GetMassData=
function(f){f.mass=this.m_mass;f.I=this.m_I;f.center.SetV(this.m_sweep.localCenter)};j.prototype.SetMassData=function(f){h.b2Assert(this.m_world.IsLocked()==!1);if(this.m_world.IsLocked()!=!0&&this.m_type==j.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=f.mass;if(this.m_mass<=0)this.m_mass=1;this.m_invMass=1/this.m_mass;if(f.I>0&&(this.m_flags&j.e_fixedRotationFlag)==0)this.m_I=f.I-this.m_mass*(f.center.x*f.center.x+f.center.y*f.center.y),this.m_invI=1/this.m_I;var a=this.m_sweep.c.Copy();
this.m_sweep.localCenter.SetV(f.center);this.m_sweep.c0.SetV(b.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-a.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-a.x)}};j.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==j.b2_staticBody||this.m_type==j.b2_kinematicBody)){for(var f=r.Make(0,0),
a=this.m_fixtureList;a;a=a.m_next)if(a.m_density!=0){var g=a.GetMassData();this.m_mass+=g.mass;f.x+=g.center.x*g.mass;f.y+=g.center.y*g.mass;this.m_I+=g.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,f.x*=this.m_invMass,f.y*=this.m_invMass):this.m_invMass=this.m_mass=1;this.m_I>0&&(this.m_flags&j.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(f.x*f.x+f.y*f.y),this.m_I*=this.m_inertiaScale,h.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;a=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(f);
this.m_sweep.c0.SetV(b.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-a.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-a.x)}};j.prototype.GetWorldPoint=function(a){var b=this.m_xf.R,a=new r(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return a};j.prototype.GetWorldVector=function(a){return b.MulMV(this.m_xf.R,a)};j.prototype.GetLocalPoint=
function(a){return b.MulXT(this.m_xf,a)};j.prototype.GetLocalVector=function(a){return b.MulTMV(this.m_xf.R,a)};j.prototype.GetLinearVelocityFromWorldPoint=function(a){return new r(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};j.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R,a=new r(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;
return new r(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};j.prototype.GetLinearDamping=function(){return this.m_linearDamping};j.prototype.SetLinearDamping=function(a){a===void 0&&(a=0);this.m_linearDamping=a};j.prototype.GetAngularDamping=function(){return this.m_angularDamping};j.prototype.SetAngularDamping=function(a){a===void 0&&(a=0);this.m_angularDamping=a};j.prototype.SetType=function(a){a===void 0&&
(a=0);if(this.m_type!=a){this.m_type=a;this.ResetMassData();if(this.m_type==j.b2_staticBody)this.m_linearVelocity.SetZero(),this.m_angularVelocity=0;this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(a=this.m_contactList;a;a=a.next)a.contact.FlagForFiltering()}};j.prototype.GetType=function(){return this.m_type};j.prototype.SetBullet=function(a){a?this.m_flags|=j.e_bulletFlag:this.m_flags&=~j.e_bulletFlag};j.prototype.IsBullet=function(){return(this.m_flags&j.e_bulletFlag)==j.e_bulletFlag};
j.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=j.e_allowSleepFlag:(this.m_flags&=~j.e_allowSleepFlag,this.SetAwake(!0))};j.prototype.SetAwake=function(a){a?(this.m_flags|=j.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~j.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};j.prototype.IsAwake=function(){return(this.m_flags&j.e_awakeFlag)==j.e_awakeFlag};j.prototype.SetFixedRotation=function(a){a?this.m_flags|=
j.e_fixedRotationFlag:this.m_flags&=~j.e_fixedRotationFlag;this.ResetMassData()};j.prototype.IsFixedRotation=function(){return(this.m_flags&j.e_fixedRotationFlag)==j.e_fixedRotationFlag};j.prototype.SetActive=function(a){if(a!=this.IsActive()){var b;if(a){this.m_flags|=j.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.CreateProxy(a,this.m_xf)}else{this.m_flags&=~j.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=
b.m_next)b.DestroyProxy(a);for(a=this.m_contactList;a;)b=a,a=a.next,this.m_world.m_contactManager.Destroy(b.contact);this.m_contactList=null}}};j.prototype.IsActive=function(){return(this.m_flags&j.e_activeFlag)==j.e_activeFlag};j.prototype.IsSleepingAllowed=function(){return(this.m_flags&j.e_allowSleepFlag)==j.e_allowSleepFlag};j.prototype.GetFixtureList=function(){return this.m_fixtureList};j.prototype.GetJointList=function(){return this.m_jointList};j.prototype.GetControllerList=function(){return this.m_controllerList};
j.prototype.GetContactList=function(){return this.m_contactList};j.prototype.GetNext=function(){return this.m_next};j.prototype.GetUserData=function(){return this.m_userData};j.prototype.SetUserData=function(a){this.m_userData=a};j.prototype.GetWorld=function(){return this.m_world};j.prototype.b2Body=function(a,b){this.m_flags=0;a.bullet&&(this.m_flags|=j.e_bulletFlag);a.fixedRotation&&(this.m_flags|=j.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=j.e_allowSleepFlag);a.awake&&(this.m_flags|=j.e_awakeFlag);
a.active&&(this.m_flags|=j.e_activeFlag);this.m_world=b;this.m_xf.position.SetV(a.position);this.m_xf.R.Set(a.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=a.angle;var g=this.m_xf.R,m=this.m_sweep.localCenter;this.m_sweep.c.x=g.col1.x*m.x+g.col2.x*m.y;this.m_sweep.c.y=g.col1.y*m.x+g.col2.y*m.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=
null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(a.linearVelocity);this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=a.type;this.m_invMass=this.m_type==j.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=0;this.m_inertiaScale=a.inertiaScale;this.m_userData=a.userData;this.m_fixtureList=null;this.m_fixtureCount=0};j.prototype.SynchronizeFixtures=
function(){var a=j.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,g=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*g.x+b.col2.x*g.y);a.position.y=this.m_sweep.c0.y-(b.col1.y*g.x+b.col2.y*g.y);g=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.Synchronize(g,a,this.m_xf)};j.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y);
this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)};j.prototype.ShouldCollide=function(a){if(this.m_type!=j.b2_dynamicBody&&a.m_type!=j.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&b.joint.m_collideConnected==!1)return!1;return!0};j.prototype.Advance=function(a){a===void 0&&(a=0);this.m_sweep.Advance(a);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};a.postDefs.push(function(){a.Dynamics.b2Body.s_xf1=new c;
a.Dynamics.b2Body.e_islandFlag=1;a.Dynamics.b2Body.e_awakeFlag=2;a.Dynamics.b2Body.e_allowSleepFlag=4;a.Dynamics.b2Body.e_bulletFlag=8;a.Dynamics.b2Body.e_fixedRotationFlag=16;a.Dynamics.b2Body.e_activeFlag=32;a.Dynamics.b2Body.b2_staticBody=0;a.Dynamics.b2Body.b2_kinematicBody=1;a.Dynamics.b2Body.b2_dynamicBody=2});P.b2BodyDef=function(){this.position=new r;this.linearVelocity=new r};P.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,
0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=j.b2_staticBody;this.active=!0;this.inertiaScale=1};B.b2ContactFilter=function(){};B.prototype.ShouldCollide=function(a,b){var g=a.GetFilterData(),m=b.GetFilterData();if(g.groupIndex==m.groupIndex&&g.groupIndex!=0)return g.groupIndex>0;return(g.maskBits&m.categoryBits)!=0&&(g.categoryBits&m.maskBits)!=0};B.prototype.RayCollide=function(a,b){if(!a)return!0;return this.ShouldCollide(a instanceof
I?a:null,b)};a.postDefs.push(function(){a.Dynamics.b2ContactFilter.b2_defaultFilter=new B});D.b2ContactImpulse=function(){this.normalImpulses=new k(h.b2_maxManifoldPoints);this.tangentImpulses=new k(h.b2_maxManifoldPoints)};G.b2ContactListener=function(){};G.prototype.BeginContact=function(){};G.prototype.EndContact=function(){};G.prototype.PreSolve=function(){};G.prototype.PostSolve=function(){};a.postDefs.push(function(){a.Dynamics.b2ContactListener.b2_defaultListener=new G});N.b2ContactManager=
function(){};N.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=B.b2_defaultFilter;this.m_contactListener=G.b2_defaultListener;this.m_contactFactory=new z(this.m_allocator);this.m_broadPhase=new t};N.prototype.AddPair=function(a,b){var g=a instanceof I?a:null,m=b instanceof I?b:null,d=g.GetBody(),q=m.GetBody();if(d!=q){for(var c=q.GetContactList();c;){if(c.other==d){var e=c.contact.GetFixtureA(),z=c.contact.GetFixtureB();if(e==g&&z==m)return;if(e==
m&&z==g)return}c=c.next}if(q.ShouldCollide(d)!=!1&&this.m_contactFilter.ShouldCollide(g,m)!=!1){c=this.m_contactFactory.Create(g,m);g=c.GetFixtureA();m=c.GetFixtureB();d=g.m_body;q=m.m_body;c.m_prev=null;c.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=c;this.m_world.m_contactList=c;c.m_nodeA.contact=c;c.m_nodeA.other=q;c.m_nodeA.prev=null;c.m_nodeA.next=d.m_contactList;if(d.m_contactList!=null)d.m_contactList.prev=c.m_nodeA;d.m_contactList=
c.m_nodeA;c.m_nodeB.contact=c;c.m_nodeB.other=d;c.m_nodeB.prev=null;c.m_nodeB.next=q.m_contactList;if(q.m_contactList!=null)q.m_contactList.prev=c.m_nodeB;q.m_contactList=c.m_nodeB;++this.m_world.m_contactCount}}};N.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(a.generateCallback(this,this.AddPair))};N.prototype.Destroy=function(a){var b=a.GetFixtureA(),g=a.GetFixtureB(),b=b.GetBody(),g=g.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a);if(a.m_prev)a.m_prev.m_next=
a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_world.m_contactList)this.m_world.m_contactList=a.m_next;if(a.m_nodeA.prev)a.m_nodeA.prev.next=a.m_nodeA.next;if(a.m_nodeA.next)a.m_nodeA.next.prev=a.m_nodeA.prev;if(a.m_nodeA==b.m_contactList)b.m_contactList=a.m_nodeA.next;if(a.m_nodeB.prev)a.m_nodeB.prev.next=a.m_nodeB.next;if(a.m_nodeB.next)a.m_nodeB.next.prev=a.m_nodeB.prev;if(a.m_nodeB==g.m_contactList)g.m_contactList=a.m_nodeB.next;this.m_contactFactory.Destroy(a);--this.m_contactCount};
N.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),g=a.GetFixtureB(),m=b.GetBody(),d=g.GetBody();if(m.IsAwake()==!1&&d.IsAwake()==!1)a=a.GetNext();else{if(a.m_flags&A.e_filterFlag){if(d.ShouldCollide(m)==!1){b=a;a=b.GetNext();this.Destroy(b);continue}if(this.m_contactFilter.ShouldCollide(b,g)==!1){b=a;a=b.GetNext();this.Destroy(b);continue}a.m_flags&=~A.e_filterFlag}this.m_broadPhase.TestOverlap(b.m_proxy,g.m_proxy)==!1?(b=a,a=b.GetNext(),this.Destroy(b)):
(a.Update(this.m_contactListener),a=a.GetNext())}}};a.postDefs.push(function(){a.Dynamics.b2ContactManager.s_evalCP=new e});E.b2DebugDraw=function(){};E.prototype.b2DebugDraw=function(){};E.prototype.SetFlags=function(){};E.prototype.GetFlags=function(){};E.prototype.AppendFlags=function(){};E.prototype.ClearFlags=function(){};E.prototype.SetSprite=function(){};E.prototype.GetSprite=function(){};E.prototype.SetDrawScale=function(){};E.prototype.GetDrawScale=function(){};E.prototype.SetLineThickness=
function(){};E.prototype.GetLineThickness=function(){};E.prototype.SetAlpha=function(){};E.prototype.GetAlpha=function(){};E.prototype.SetFillAlpha=function(){};E.prototype.GetFillAlpha=function(){};E.prototype.SetXFormScale=function(){};E.prototype.GetXFormScale=function(){};E.prototype.DrawPolygon=function(){};E.prototype.DrawSolidPolygon=function(){};E.prototype.DrawCircle=function(){};E.prototype.DrawSolidCircle=function(){};E.prototype.DrawSegment=function(){};E.prototype.DrawTransform=function(){};
a.postDefs.push(function(){a.Dynamics.b2DebugDraw.e_shapeBit=1;a.Dynamics.b2DebugDraw.e_jointBit=2;a.Dynamics.b2DebugDraw.e_aabbBit=4;a.Dynamics.b2DebugDraw.e_pairBit=8;a.Dynamics.b2DebugDraw.e_centerOfMassBit=16;a.Dynamics.b2DebugDraw.e_controllerBit=32});S.b2DestructionListener=function(){};S.prototype.SayGoodbyeJoint=function(){};S.prototype.SayGoodbyeFixture=function(){};F.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};F.prototype.Copy=function(){var a=new F;
a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a};I.b2Fixture=function(){this.m_filter=new F};I.prototype.GetType=function(){return this.m_shape.GetType()};I.prototype.GetShape=function(){return this.m_shape};I.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,this.m_body!=null))for(a=this.m_body.GetContactList();a;){var b=a.contact,g=b.GetFixtureA(),m=b.GetFixtureB();if(g==this||m==this)b.SetSensor(g.IsSensor()||m.IsSensor());
a=a.next}};I.prototype.IsSensor=function(){return this.m_isSensor};I.prototype.SetFilterData=function(a){this.m_filter=a.Copy();if(!this.m_body)for(a=this.m_body.GetContactList();a;){var b=a.contact,g=b.GetFixtureA(),m=b.GetFixtureB();(g==this||m==this)&&b.FlagForFiltering();a=a.next}};I.prototype.GetFilterData=function(){return this.m_filter.Copy()};I.prototype.GetBody=function(){return this.m_body};I.prototype.GetNext=function(){return this.m_next};I.prototype.GetUserData=function(){return this.m_userData};
I.prototype.SetUserData=function(a){this.m_userData=a};I.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)};I.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())};I.prototype.GetMassData=function(a){a===void 0&&(a=null);a==null&&(a=new x);this.m_shape.ComputeMass(a,this.m_density);return a};I.prototype.SetDensity=function(a){a===void 0&&(a=0);this.m_density=a};I.prototype.GetDensity=function(){return this.m_density};
I.prototype.GetFriction=function(){return this.m_friction};I.prototype.SetFriction=function(a){a===void 0&&(a=0);this.m_friction=a};I.prototype.GetRestitution=function(){return this.m_restitution};I.prototype.SetRestitution=function(a){a===void 0&&(a=0);this.m_restitution=a};I.prototype.GetAABB=function(){return this.m_aabb};I.prototype.b2Fixture=function(){this.m_aabb=new y;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};I.prototype.Create=
function(a,b,g){this.m_userData=g.userData;this.m_friction=g.friction;this.m_restitution=g.restitution;this.m_body=a;this.m_next=null;this.m_filter=g.filter.Copy();this.m_isSensor=g.isSensor;this.m_shape=g.shape.Copy();this.m_density=g.density};I.prototype.Destroy=function(){this.m_shape=null};I.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b);this.m_proxy=a.CreateProxy(this.m_aabb,this)};I.prototype.DestroyProxy=function(a){if(this.m_proxy!=null)a.DestroyProxy(this.m_proxy),
this.m_proxy=null};I.prototype.Synchronize=function(a,g,m){if(this.m_proxy){var d=new y,q=new y;this.m_shape.ComputeAABB(d,g);this.m_shape.ComputeAABB(q,m);this.m_aabb.Combine(d,q);g=b.SubtractVV(m.position,g.position);a.MoveProxy(this.m_proxy,this.m_aabb,g)}};T.b2FixtureDef=function(){this.filter=new F};T.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;
this.isSensor=!1};M.b2Island=function(){};M.prototype.b2Island=function(){this.m_bodies=new p;this.m_contacts=new p;this.m_joints=new p};M.prototype.Initialize=function(a,b,g,m,d,q){a===void 0&&(a=0);b===void 0&&(b=0);g===void 0&&(g=0);var c=0;this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=g;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=m;this.m_listener=d;this.m_contactSolver=q;for(c=this.m_bodies.length;c<a;c++)this.m_bodies[c]=null;for(c=this.m_contacts.length;c<
b;c++)this.m_contacts[c]=null;for(c=this.m_joints.length;c<g;c++)this.m_joints[c]=null};M.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};M.prototype.Solve=function(a,g,m){for(var d=0,c=0,q,d=0;d<this.m_bodyCount;++d)c=this.m_bodies[d],c.GetType()==j.b2_dynamicBody&&(c.m_linearVelocity.x+=a.dt*(g.x+c.m_invMass*c.m_force.x),c.m_linearVelocity.y+=a.dt*(g.y+c.m_invMass*c.m_force.y),c.m_angularVelocity+=a.dt*c.m_invI*c.m_torque,c.m_linearVelocity.Multiply(b.Clamp(1-
a.dt*c.m_linearDamping,0,1)),c.m_angularVelocity*=b.Clamp(1-a.dt*c.m_angularDamping,0,1));this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);g=this.m_contactSolver;g.InitVelocityConstraints(a);for(d=0;d<this.m_jointCount;++d)q=this.m_joints[d],q.InitVelocityConstraints(a);for(d=0;d<a.velocityIterations;++d){for(c=0;c<this.m_jointCount;++c)q=this.m_joints[c],q.SolveVelocityConstraints(a);g.SolveVelocityConstraints()}for(d=0;d<this.m_jointCount;++d)q=this.m_joints[d],
q.FinalizeVelocityConstraints();g.FinalizeVelocityConstraints();for(d=0;d<this.m_bodyCount;++d)if(c=this.m_bodies[d],c.GetType()!=j.b2_staticBody){var e=a.dt*c.m_linearVelocity.x,z=a.dt*c.m_linearVelocity.y;e*e+z*z>h.b2_maxTranslationSquared&&(c.m_linearVelocity.Normalize(),c.m_linearVelocity.x*=h.b2_maxTranslation*a.inv_dt,c.m_linearVelocity.y*=h.b2_maxTranslation*a.inv_dt);e=a.dt*c.m_angularVelocity;if(e*e>h.b2_maxRotationSquared)c.m_angularVelocity=c.m_angularVelocity<0?-h.b2_maxRotation*a.inv_dt:
h.b2_maxRotation*a.inv_dt;c.m_sweep.c0.SetV(c.m_sweep.c);c.m_sweep.a0=c.m_sweep.a;c.m_sweep.c.x+=a.dt*c.m_linearVelocity.x;c.m_sweep.c.y+=a.dt*c.m_linearVelocity.y;c.m_sweep.a+=a.dt*c.m_angularVelocity;c.SynchronizeTransform()}for(d=0;d<a.positionIterations;++d){e=g.SolvePositionConstraints(h.b2_contactBaumgarte);z=!0;for(c=0;c<this.m_jointCount;++c)q=this.m_joints[c],q=q.SolvePositionConstraints(h.b2_contactBaumgarte),z=z&&q;if(e&&z)break}this.Report(g.m_constraints);if(m){m=Number.MAX_VALUE;g=h.b2_linearSleepTolerance*
h.b2_linearSleepTolerance;e=h.b2_angularSleepTolerance*h.b2_angularSleepTolerance;for(d=0;d<this.m_bodyCount;++d)if(c=this.m_bodies[d],c.GetType()!=j.b2_staticBody){if((c.m_flags&j.e_allowSleepFlag)==0)m=c.m_sleepTime=0;(c.m_flags&j.e_allowSleepFlag)==0||c.m_angularVelocity*c.m_angularVelocity>e||b.Dot(c.m_linearVelocity,c.m_linearVelocity)>g?m=c.m_sleepTime=0:(c.m_sleepTime+=a.dt,m=b.Min(m,c.m_sleepTime))}if(m>=h.b2_timeToSleep)for(d=0;d<this.m_bodyCount;++d)c=this.m_bodies[d],c.SetAwake(!1)}};M.prototype.SolveTOI=
function(a){var b=0,g=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);for(var m=this.m_contactSolver,b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b){m.SolveVelocityConstraints();for(g=0;g<this.m_jointCount;++g)this.m_joints[g].SolveVelocityConstraints(a)}for(b=0;b<this.m_bodyCount;++b)if(g=this.m_bodies[b],g.GetType()!=j.b2_staticBody){var d=a.dt*g.m_linearVelocity.x,c=a.dt*g.m_linearVelocity.y;d*
d+c*c>h.b2_maxTranslationSquared&&(g.m_linearVelocity.Normalize(),g.m_linearVelocity.x*=h.b2_maxTranslation*a.inv_dt,g.m_linearVelocity.y*=h.b2_maxTranslation*a.inv_dt);d=a.dt*g.m_angularVelocity;if(d*d>h.b2_maxRotationSquared)g.m_angularVelocity=g.m_angularVelocity<0?-h.b2_maxRotation*a.inv_dt:h.b2_maxRotation*a.inv_dt;g.m_sweep.c0.SetV(g.m_sweep.c);g.m_sweep.a0=g.m_sweep.a;g.m_sweep.c.x+=a.dt*g.m_linearVelocity.x;g.m_sweep.c.y+=a.dt*g.m_linearVelocity.y;g.m_sweep.a+=a.dt*g.m_angularVelocity;g.SynchronizeTransform()}for(b=
0;b<a.positionIterations;++b){d=m.SolvePositionConstraints(0.75);c=!0;for(g=0;g<this.m_jointCount;++g)var q=this.m_joints[g].SolvePositionConstraints(h.b2_contactBaumgarte),c=c&&q;if(d&&c)break}this.Report(m.m_constraints)};M.prototype.Report=function(a){if(this.m_listener!=null)for(var b=0;b<this.m_contactCount;++b){for(var g=this.m_contacts[b],m=a[b],d=0;d<m.pointCount;++d)M.s_impulse.normalImpulses[d]=m.points[d].normalImpulse,M.s_impulse.tangentImpulses[d]=m.points[d].tangentImpulse;this.m_listener.PostSolve(g,
M.s_impulse)}};M.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a};M.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a};M.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a};a.postDefs.push(function(){a.Dynamics.b2Island.s_impulse=new D});m.b2TimeStep=function(){};m.prototype.Set=function(a){this.dt=a.dt;this.inv_dt=a.inv_dt;this.positionIterations=a.positionIterations;this.velocityIterations=a.velocityIterations;
this.warmStarting=a.warmStarting};q.b2World=function(){this.s_stack=new p;this.m_contactManager=new N;this.m_contactSolver=new K;this.m_island=new M};q.prototype.b2World=function(a,b){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;q.m_warmStarting=!0;q.m_continuousPhysics=!0;this.m_allowSleep=b;this.m_gravity=a;this.m_inv_dt0=0;this.m_contactManager.m_world=
this;this.m_groundBody=this.CreateBody(new P)};q.prototype.SetDestructionListener=function(a){this.m_destructionListener=a};q.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a};q.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a};q.prototype.SetDebugDraw=function(a){this.m_debugDraw=a};q.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var g=this.m_bodyList;g;g=g.m_next)for(var m=
g.m_fixtureList;m;m=m.m_next)m.m_proxy=a.CreateProxy(b.GetFatAABB(m.m_proxy),m)};q.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};q.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};q.prototype.CreateBody=function(a){if(this.IsLocked()==!0)return null;a=new j(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a};q.prototype.DestroyBody=function(a){if(this.IsLocked()!=
!0){for(var b=a.m_jointList;b;){var g=b,b=b.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(g.joint);this.DestroyJoint(g.joint)}for(b=a.m_controllerList;b;)g=b,b=b.nextController,g.controller.RemoveBody(a);for(b=a.m_contactList;b;)g=b,b=b.next,this.m_contactManager.Destroy(g.contact);a.m_contactList=null;for(b=a.m_fixtureList;b;)g=b,b=b.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(g),g.DestroyProxy(this.m_contactManager.m_broadPhase),
g.Destroy();a.m_fixtureList=null;a.m_fixtureCount=0;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_bodyList)this.m_bodyList=a.m_next;--this.m_bodyCount}};q.prototype.CreateJoint=function(a){var b=R.Create(a,null);b.m_prev=null;if(b.m_next=this.m_jointList)this.m_jointList.m_prev=b;this.m_jointList=b;++this.m_jointCount;b.m_edgeA.joint=b;b.m_edgeA.other=b.m_bodyB;b.m_edgeA.prev=null;if(b.m_edgeA.next=b.m_bodyA.m_jointList)b.m_bodyA.m_jointList.prev=b.m_edgeA;
b.m_bodyA.m_jointList=b.m_edgeA;b.m_edgeB.joint=b;b.m_edgeB.other=b.m_bodyA;b.m_edgeB.prev=null;if(b.m_edgeB.next=b.m_bodyB.m_jointList)b.m_bodyB.m_jointList.prev=b.m_edgeB;b.m_bodyB.m_jointList=b.m_edgeB;var g=a.bodyA,m=a.bodyB;if(a.collideConnected==!1)for(a=m.GetContactList();a;)a.other==g&&a.contact.FlagForFiltering(),a=a.next;return b};q.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_jointList)this.m_jointList=
a.m_next;var g=a.m_bodyA,m=a.m_bodyB;g.SetAwake(!0);m.SetAwake(!0);if(a.m_edgeA.prev)a.m_edgeA.prev.next=a.m_edgeA.next;if(a.m_edgeA.next)a.m_edgeA.next.prev=a.m_edgeA.prev;if(a.m_edgeA==g.m_jointList)g.m_jointList=a.m_edgeA.next;a.m_edgeA.prev=null;a.m_edgeA.next=null;if(a.m_edgeB.prev)a.m_edgeB.prev.next=a.m_edgeB.next;if(a.m_edgeB.next)a.m_edgeB.next.prev=a.m_edgeB.prev;if(a.m_edgeB==m.m_jointList)m.m_jointList=a.m_edgeB.next;a.m_edgeB.prev=null;a.m_edgeB.next=null;R.Destroy(a,null);--this.m_jointCount;
if(b==!1)for(a=m.GetContactList();a;)a.other==g&&a.contact.FlagForFiltering(),a=a.next};q.prototype.AddController=function(a){a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList=a;a.m_world=this;this.m_controllerCount++;return a};q.prototype.RemoveController=function(a){if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(this.m_controllerList==a)this.m_controllerList=a.m_next;this.m_controllerCount--};q.prototype.CreateController=function(a){if(a.m_world!=this)throw Error("Controller can only be a member of one world");
a.m_next=this.m_controllerList;a.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=a;this.m_controllerList=a;++this.m_controllerCount;a.m_world=this;return a};q.prototype.DestroyController=function(a){a.Clear();if(a.m_next)a.m_next.m_prev=a.m_prev;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a==this.m_controllerList)this.m_controllerList=a.m_next;--this.m_controllerCount};q.prototype.SetWarmStarting=function(a){q.m_warmStarting=a};q.prototype.SetContinuousPhysics=function(a){q.m_continuousPhysics=
a};q.prototype.GetBodyCount=function(){return this.m_bodyCount};q.prototype.GetJointCount=function(){return this.m_jointCount};q.prototype.GetContactCount=function(){return this.m_contactCount};q.prototype.SetGravity=function(a){this.m_gravity=a};q.prototype.GetGravity=function(){return this.m_gravity};q.prototype.GetGroundBody=function(){return this.m_groundBody};q.prototype.Step=function(a,b,g){a===void 0&&(a=0);b===void 0&&(b=0);g===void 0&&(g=0);this.m_flags&q.e_newFixture&&(this.m_contactManager.FindNewContacts(),
this.m_flags&=~q.e_newFixture);this.m_flags|=q.e_locked;var m=q.s_timestep2;m.dt=a;m.velocityIterations=b;m.positionIterations=g;m.inv_dt=a>0?1/a:0;m.dtRatio=this.m_inv_dt0*a;m.warmStarting=q.m_warmStarting;this.m_contactManager.Collide();m.dt>0&&this.Solve(m);q.m_continuousPhysics&&m.dt>0&&this.SolveTOI(m);if(m.dt>0)this.m_inv_dt0=m.inv_dt;this.m_flags&=~q.e_locked};q.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0};q.prototype.DrawDebugData=
function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var a=this.m_debugDraw.GetFlags(),b,g,m;new r;new r;new r;var d;new y;new y;d=[new r,new r,new r,new r];var c=new o(0,0,0);if(a&E.e_shapeBit)for(b=this.m_bodyList;b;b=b.m_next){d=b.m_xf;for(g=b.GetFixtureList();g;g=g.m_next)m=g.GetShape(),b.IsActive()==!1?c.Set(0.5,0.5,0.3):b.GetType()==j.b2_staticBody?c.Set(0.5,0.9,0.5):b.GetType()==j.b2_kinematicBody?c.Set(0.5,0.5,0.9):b.IsAwake()==!1?c.Set(0.6,0.6,0.6):c.Set(0.9,0.7,
0.7),this.DrawShape(m,d,c)}if(a&E.e_jointBit)for(b=this.m_jointList;b;b=b.m_next)this.DrawJoint(b);if(a&E.e_controllerBit)for(b=this.m_controllerList;b;b=b.m_next)b.Draw(this.m_debugDraw);if(a&E.e_pairBit){c.Set(0.3,0.9,0.9);for(b=this.m_contactManager.m_contactList;b;b=b.GetNext())m=b.GetFixtureA(),g=b.GetFixtureB(),m=m.GetAABB().GetCenter(),g=g.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(m,g,c)}if(a&E.e_aabbBit){m=this.m_contactManager.m_broadPhase;d=[new r,new r,new r,new r];for(b=this.m_bodyList;b;b=
b.GetNext())if(b.IsActive()!=!1)for(g=b.GetFixtureList();g;g=g.GetNext()){var e=m.GetFatAABB(g.m_proxy);d[0].Set(e.lowerBound.x,e.lowerBound.y);d[1].Set(e.upperBound.x,e.lowerBound.y);d[2].Set(e.upperBound.x,e.upperBound.y);d[3].Set(e.lowerBound.x,e.upperBound.y);this.m_debugDraw.DrawPolygon(d,4,c)}}if(a&E.e_centerOfMassBit)for(b=this.m_bodyList;b;b=b.m_next)d=q.s_xf,d.R=b.m_xf.R,d.position=b.GetWorldCenter(),this.m_debugDraw.DrawTransform(d)}};q.prototype.QueryAABB=function(a,b){var g=this.m_contactManager.m_broadPhase;
g.Query(function(b){return a(g.GetUserData(b))},b)};q.prototype.QueryShape=function(a,b,g){g===void 0&&(g=null);g==null&&(g=new c,g.SetIdentity());var m=this.m_contactManager.m_broadPhase,d=new y;b.ComputeAABB(d,g);m.Query(function(d){d=m.GetUserData(d)instanceof I?m.GetUserData(d):null;if(Q.TestOverlap(b,g,d.GetShape(),d.GetBody().GetTransform()))return a(d);return!0},d)};q.prototype.QueryPoint=function(a,b){var g=this.m_contactManager.m_broadPhase,m=new y;m.lowerBound.Set(b.x-h.b2_linearSlop,b.y-
h.b2_linearSlop);m.upperBound.Set(b.x+h.b2_linearSlop,b.y+h.b2_linearSlop);g.Query(function(m){m=g.GetUserData(m)instanceof I?g.GetUserData(m):null;if(m.TestPoint(b))return a(m);return!0},m)};q.prototype.RayCast=function(a,b,g){var m=this.m_contactManager.m_broadPhase,d=new H,c=new L(b,g);m.RayCast(function(c,q){var e=m.GetUserData(q),e=e instanceof I?e:null;if(e.RayCast(d,c)){var z=d.fraction,j=new r((1-z)*b.x+z*g.x,(1-z)*b.y+z*g.y);return a(e,j,d.normal,z)}return c.maxFraction},c)};q.prototype.RayCastOne=
function(a,b){var g;this.RayCast(function(a,b,f,m){m===void 0&&(m=0);g=a;return m},a,b);return g};q.prototype.RayCastAll=function(a,b){var g=new p;this.RayCast(function(a){g[g.length]=a;return 1},a,b);return g};q.prototype.GetBodyList=function(){return this.m_bodyList};q.prototype.GetJointList=function(){return this.m_jointList};q.prototype.GetContactList=function(){return this.m_contactList};q.prototype.IsLocked=function(){return(this.m_flags&q.e_locked)>0};q.prototype.Solve=function(a){for(var b,
g=this.m_controllerList;g;g=g.m_next)g.Step(a);g=this.m_island;g.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~j.e_islandFlag;for(var m=this.m_contactList;m;m=m.m_next)m.m_flags&=~A.e_islandFlag;for(m=this.m_jointList;m;m=m.m_next)m.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var m=this.s_stack,d=this.m_bodyList;d;d=d.m_next)if(!(d.m_flags&j.e_islandFlag)&&!(d.IsAwake()==
!1||d.IsActive()==!1)&&d.GetType()!=j.b2_staticBody){g.Clear();var c=0;m[c++]=d;for(d.m_flags|=j.e_islandFlag;c>0;)if(b=m[--c],g.AddBody(b),b.IsAwake()==!1&&b.SetAwake(!0),b.GetType()!=j.b2_staticBody){for(var q,e=b.m_contactList;e;e=e.next)if(!(e.contact.m_flags&A.e_islandFlag)&&!(e.contact.IsSensor()==!0||e.contact.IsEnabled()==!1||e.contact.IsTouching()==!1))g.AddContact(e.contact),e.contact.m_flags|=A.e_islandFlag,q=e.other,q.m_flags&j.e_islandFlag||(m[c++]=q,q.m_flags|=j.e_islandFlag);for(b=
b.m_jointList;b;b=b.next)if(b.joint.m_islandFlag!=!0&&(q=b.other,q.IsActive()!=!1))g.AddJoint(b.joint),b.joint.m_islandFlag=!0,q.m_flags&j.e_islandFlag||(m[c++]=q,q.m_flags|=j.e_islandFlag)}g.Solve(a,this.m_gravity,this.m_allowSleep);for(c=0;c<g.m_bodyCount;++c)b=g.m_bodies[c],b.GetType()==j.b2_staticBody&&(b.m_flags&=~j.e_islandFlag)}for(c=0;c<m.length;++c){if(!m[c])break;m[c]=null}for(b=this.m_bodyList;b;b=b.m_next)b.IsAwake()==!1||b.IsActive()==!1||b.GetType()!=j.b2_staticBody&&b.SynchronizeFixtures();
this.m_contactManager.FindNewContacts()};q.prototype.SolveTOI=function(a){var b,g,m,d=this.m_island;d.Initialize(this.m_bodyCount,h.b2_maxTOIContactsPerIsland,h.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var c=q.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~j.e_islandFlag,b.m_sweep.t0=0;for(m=this.m_contactList;m;m=m.m_next)m.m_flags&=~(A.e_toiFlag|A.e_islandFlag);for(m=this.m_jointList;m;m=m.m_next)m.m_islandFlag=!1;for(;;){var e=null,z=1;
for(m=this.m_contactList;m;m=m.m_next)if(!(m.IsSensor()==!0||m.IsEnabled()==!1||m.IsContinuous()==!1)){b=1;if(m.m_flags&A.e_toiFlag)b=m.m_toi;else{b=m.m_fixtureA;g=m.m_fixtureB;b=b.m_body;g=g.m_body;if((b.GetType()!=j.b2_dynamicBody||b.IsAwake()==!1)&&(g.GetType()!=j.b2_dynamicBody||g.IsAwake()==!1))continue;var l=b.m_sweep.t0;if(b.m_sweep.t0<g.m_sweep.t0)l=g.m_sweep.t0,b.m_sweep.Advance(l);else if(g.m_sweep.t0<b.m_sweep.t0)l=b.m_sweep.t0,g.m_sweep.Advance(l);b=m.ComputeTOI(b.m_sweep,g.m_sweep);h.b2Assert(0<=
b&&b<=1);b>0&&b<1&&(b=(1-b)*l+b,b>1&&(b=1));m.m_toi=b;m.m_flags|=A.e_toiFlag}Number.MIN_VALUE<b&&b<z&&(e=m,z=b)}if(e==null||1-100*Number.MIN_VALUE<z)break;b=e.m_fixtureA;g=e.m_fixtureB;b=b.m_body;g=g.m_body;q.s_backupA.Set(b.m_sweep);q.s_backupB.Set(g.m_sweep);b.Advance(z);g.Advance(z);e.Update(this.m_contactManager.m_contactListener);e.m_flags&=~A.e_toiFlag;if(e.IsSensor()==!0||e.IsEnabled()==!1)b.m_sweep.Set(q.s_backupA),g.m_sweep.Set(q.s_backupB),b.SynchronizeTransform(),g.SynchronizeTransform();
else if(e.IsTouching()!=!1){b.GetType()!=j.b2_dynamicBody&&(b=g);d.Clear();e=m=0;c[m+e++]=b;for(b.m_flags|=j.e_islandFlag;e>0;)if(b=c[m++],--e,d.AddBody(b),b.IsAwake()==!1&&b.SetAwake(!0),b.GetType()==j.b2_dynamicBody){for(g=b.m_contactList;g;g=g.next){if(d.m_contactCount==d.m_contactCapacity)break;if(!(g.contact.m_flags&A.e_islandFlag)&&!(g.contact.IsSensor()==!0||g.contact.IsEnabled()==!1||g.contact.IsTouching()==!1))d.AddContact(g.contact),g.contact.m_flags|=A.e_islandFlag,l=g.other,l.m_flags&
j.e_islandFlag||(l.GetType()!=j.b2_staticBody&&(l.Advance(z),l.SetAwake(!0)),c[m+e]=l,++e,l.m_flags|=j.e_islandFlag)}for(b=b.m_jointList;b;b=b.next)if(d.m_jointCount!=d.m_jointCapacity&&b.joint.m_islandFlag!=!0&&(l=b.other,l.IsActive()!=!1))d.AddJoint(b.joint),b.joint.m_islandFlag=!0,l.m_flags&j.e_islandFlag||(l.GetType()!=j.b2_staticBody&&(l.Advance(z),l.SetAwake(!0)),c[m+e]=l,++e,l.m_flags|=j.e_islandFlag)}m=q.s_timestep;m.warmStarting=!1;m.dt=(1-z)*a.dt;m.inv_dt=1/m.dt;m.dtRatio=0;m.velocityIterations=
a.velocityIterations;m.positionIterations=a.positionIterations;d.SolveTOI(m);for(z=z=0;z<d.m_bodyCount;++z)if(b=d.m_bodies[z],b.m_flags&=~j.e_islandFlag,b.IsAwake()!=!1&&b.GetType()==j.b2_dynamicBody){b.SynchronizeFixtures();for(g=b.m_contactList;g;g=g.next)g.contact.m_flags&=~A.e_toiFlag}for(z=0;z<d.m_contactCount;++z)m=d.m_contacts[z],m.m_flags&=~(A.e_toiFlag|A.e_islandFlag);for(z=0;z<d.m_jointCount;++z)m=d.m_joints[z],m.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};q.prototype.DrawJoint=
function(a){var b=a.GetBodyA(),m=a.GetBodyB(),d=b.m_xf.position,c=m.m_xf.position,e=a.GetAnchorA(),z=a.GetAnchorB(),j=q.s_jointColor;switch(a.m_type){case R.e_distanceJoint:this.m_debugDraw.DrawSegment(e,z,j);break;case R.e_pulleyJoint:b=a instanceof g?a:null;a=b.GetGroundAnchorA();b=b.GetGroundAnchorB();this.m_debugDraw.DrawSegment(a,e,j);this.m_debugDraw.DrawSegment(b,z,j);this.m_debugDraw.DrawSegment(a,b,j);break;case R.e_mouseJoint:this.m_debugDraw.DrawSegment(e,z,j);break;default:b!=this.m_groundBody&&
this.m_debugDraw.DrawSegment(d,e,j),this.m_debugDraw.DrawSegment(e,z,j),m!=this.m_groundBody&&this.m_debugDraw.DrawSegment(c,z,j)}};q.prototype.DrawShape=function(a,g,m){switch(a.m_type){case Q.e_circleShape:var d=a instanceof C?a:null;this.m_debugDraw.DrawSolidCircle(b.MulX(g,d.m_p),d.m_radius,g.R.col1,m);break;case Q.e_polygonShape:for(var d=0,d=a instanceof v?a:null,a=parseInt(d.GetVertexCount()),c=d.GetVertices(),q=new p(a),d=0;d<a;++d)q[d]=b.MulX(g,c[d]);this.m_debugDraw.DrawSolidPolygon(q,a,
m);break;case Q.e_edgeShape:d=a instanceof J?a:null,this.m_debugDraw.DrawSegment(b.MulX(g,d.GetVertex1()),b.MulX(g,d.GetVertex2()),m)}};a.postDefs.push(function(){a.Dynamics.b2World.s_timestep2=new m;a.Dynamics.b2World.s_xf=new c;a.Dynamics.b2World.s_backupA=new d;a.Dynamics.b2World.s_backupB=new d;a.Dynamics.b2World.s_timestep=new m;a.Dynamics.b2World.s_queue=new p;a.Dynamics.b2World.s_jointColor=new o(0.5,0.8,0.8);a.Dynamics.b2World.e_newFixture=1;a.Dynamics.b2World.e_locked=2})})();(function(){var b=
a.Collision.Shapes.b2CircleShape,d=a.Collision.Shapes.b2EdgeShape,c=a.Collision.Shapes.b2PolygonShape,r=a.Collision.Shapes.b2Shape,o=a.Dynamics.Contacts.b2CircleContact,h=a.Dynamics.Contacts.b2Contact,y=a.Dynamics.Contacts.b2ContactConstraint,e=a.Dynamics.Contacts.b2ContactConstraintPoint,t=a.Dynamics.Contacts.b2ContactEdge,L=a.Dynamics.Contacts.b2ContactFactory,H=a.Dynamics.Contacts.b2ContactRegister,C=a.Dynamics.Contacts.b2ContactResult,J=a.Dynamics.Contacts.b2ContactSolver,x=a.Dynamics.Contacts.b2EdgeAndCircleContact,
v=a.Dynamics.Contacts.b2NullContact,Q=a.Dynamics.Contacts.b2PolyAndCircleContact,j=a.Dynamics.Contacts.b2PolyAndEdgeContact,P=a.Dynamics.Contacts.b2PolygonContact,B=a.Dynamics.Contacts.b2PositionSolverManifold,D=a.Dynamics.b2Body,G=a.Dynamics.b2TimeStep,N=a.Common.b2Settings,E=a.Common.Math.b2Mat22,S=a.Common.Math.b2Math,F=a.Common.Math.b2Vec2,I=a.Collision.b2Collision,T=a.Collision.b2ContactID,M=a.Collision.b2Manifold,m=a.Collision.b2TimeOfImpact,q=a.Collision.b2TOIInput,A=a.Collision.b2WorldManifold;
a.inherit(o,a.Dynamics.Contacts.b2Contact);o.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;o.b2CircleContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};o.Create=function(){return new o};o.Destroy=function(){};o.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};o.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),m=this.m_fixtureB.GetBody();I.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof b?this.m_fixtureA.GetShape():
null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,m.m_xf)};h.b2Contact=function(){this.m_nodeA=new t;this.m_nodeB=new t;this.m_manifold=new M;this.m_oldManifold=new M};h.prototype.GetManifold=function(){return this.m_manifold};h.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),m=this.m_fixtureB.GetBody(),g=this.m_fixtureA.GetShape(),f=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),g.m_radius,m.GetTransform(),f.m_radius)};
h.prototype.IsTouching=function(){return(this.m_flags&h.e_touchingFlag)==h.e_touchingFlag};h.prototype.IsContinuous=function(){return(this.m_flags&h.e_continuousFlag)==h.e_continuousFlag};h.prototype.SetSensor=function(a){a?this.m_flags|=h.e_sensorFlag:this.m_flags&=~h.e_sensorFlag};h.prototype.IsSensor=function(){return(this.m_flags&h.e_sensorFlag)==h.e_sensorFlag};h.prototype.SetEnabled=function(a){a?this.m_flags|=h.e_enabledFlag:this.m_flags&=~h.e_enabledFlag};h.prototype.IsEnabled=function(){return(this.m_flags&
h.e_enabledFlag)==h.e_enabledFlag};h.prototype.GetNext=function(){return this.m_next};h.prototype.GetFixtureA=function(){return this.m_fixtureA};h.prototype.GetFixtureB=function(){return this.m_fixtureB};h.prototype.FlagForFiltering=function(){this.m_flags|=h.e_filterFlag};h.prototype.b2Contact=function(){};h.prototype.Reset=function(a,b){a===void 0&&(a=null);b===void 0&&(b=null);this.m_flags=h.e_enabledFlag;if(!a||!b)this.m_fixtureB=this.m_fixtureA=null;else{if(a.IsSensor()||b.IsSensor())this.m_flags|=
h.e_sensorFlag;var m=a.GetBody(),g=b.GetBody();if(m.GetType()!=D.b2_dynamicBody||m.IsBullet()||g.GetType()!=D.b2_dynamicBody||g.IsBullet())this.m_flags|=h.e_continuousFlag;this.m_fixtureA=a;this.m_fixtureB=b;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}};h.prototype.Update=function(a){var b=this.m_oldManifold;
this.m_oldManifold=this.m_manifold;this.m_manifold=b;this.m_flags|=h.e_enabledFlag;var m=!1,b=(this.m_flags&h.e_touchingFlag)==h.e_touchingFlag,g=this.m_fixtureA.m_body,f=this.m_fixtureB.m_body,d=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&h.e_sensorFlag)d&&(m=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape(),g=g.GetTransform(),f=f.GetTransform(),m=r.TestOverlap(m,g,d,f)),this.m_manifold.m_pointCount=0;else{g.GetType()!=D.b2_dynamicBody||g.IsBullet()||f.GetType()!=
D.b2_dynamicBody||f.IsBullet()?this.m_flags|=h.e_continuousFlag:this.m_flags&=~h.e_continuousFlag;if(d){this.Evaluate();m=this.m_manifold.m_pointCount>0;for(d=0;d<this.m_manifold.m_pointCount;++d){var c=this.m_manifold.m_points[d];c.m_normalImpulse=0;c.m_tangentImpulse=0;for(var q=c.m_id,e=0;e<this.m_oldManifold.m_pointCount;++e){var j=this.m_oldManifold.m_points[e];if(j.m_id.key==q.key){c.m_normalImpulse=j.m_normalImpulse;c.m_tangentImpulse=j.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=
0;m!=b&&(g.SetAwake(!0),f.SetAwake(!0))}m?this.m_flags|=h.e_touchingFlag:this.m_flags&=~h.e_touchingFlag;b==!1&&m==!0&&a.BeginContact(this);b==!0&&m==!1&&a.EndContact(this);(this.m_flags&h.e_sensorFlag)==0&&a.PreSolve(this,this.m_oldManifold)};h.prototype.Evaluate=function(){};h.prototype.ComputeTOI=function(a,b){h.s_input.proxyA.Set(this.m_fixtureA.GetShape());h.s_input.proxyB.Set(this.m_fixtureB.GetShape());h.s_input.sweepA=a;h.s_input.sweepB=b;h.s_input.tolerance=N.b2_linearSlop;return m.TimeOfImpact(h.s_input)};
a.postDefs.push(function(){a.Dynamics.Contacts.b2Contact.e_sensorFlag=1;a.Dynamics.Contacts.b2Contact.e_continuousFlag=2;a.Dynamics.Contacts.b2Contact.e_islandFlag=4;a.Dynamics.Contacts.b2Contact.e_toiFlag=8;a.Dynamics.Contacts.b2Contact.e_touchingFlag=16;a.Dynamics.Contacts.b2Contact.e_enabledFlag=32;a.Dynamics.Contacts.b2Contact.e_filterFlag=64;a.Dynamics.Contacts.b2Contact.s_input=new q});y.b2ContactConstraint=function(){this.localPlaneNormal=new F;this.localPoint=new F;this.normal=new F;this.normalMass=
new E;this.K=new E};y.prototype.b2ContactConstraint=function(){this.points=new p(N.b2_maxManifoldPoints);for(var a=0;a<N.b2_maxManifoldPoints;a++)this.points[a]=new e};e.b2ContactConstraintPoint=function(){this.localPoint=new F;this.rA=new F;this.rB=new F};t.b2ContactEdge=function(){};L.b2ContactFactory=function(){};L.prototype.b2ContactFactory=function(a){this.m_allocator=a;this.InitializeRegisters()};L.prototype.AddType=function(a,b,m,g){m===void 0&&(m=0);g===void 0&&(g=0);this.m_registers[m][g].createFcn=
a;this.m_registers[m][g].destroyFcn=b;this.m_registers[m][g].primary=!0;if(m!=g)this.m_registers[g][m].createFcn=a,this.m_registers[g][m].destroyFcn=b,this.m_registers[g][m].primary=!1};L.prototype.InitializeRegisters=function(){this.m_registers=new p(r.e_shapeTypeCount);for(var a=0;a<r.e_shapeTypeCount;a++){this.m_registers[a]=new p(r.e_shapeTypeCount);for(var b=0;b<r.e_shapeTypeCount;b++)this.m_registers[a][b]=new H}this.AddType(o.Create,o.Destroy,r.e_circleShape,r.e_circleShape);this.AddType(Q.Create,
Q.Destroy,r.e_polygonShape,r.e_circleShape);this.AddType(P.Create,P.Destroy,r.e_polygonShape,r.e_polygonShape);this.AddType(x.Create,x.Destroy,r.e_edgeShape,r.e_circleShape);this.AddType(j.Create,j.Destroy,r.e_polygonShape,r.e_edgeShape)};L.prototype.Create=function(a,b){var m=parseInt(a.GetType()),g=parseInt(b.GetType()),m=this.m_registers[m][g];if(m.pool)return g=m.pool,m.pool=g.m_next,m.poolCount--,g.Reset(a,b),g;g=m.createFcn;return g!=null?(m.primary?(g=g(this.m_allocator),g.Reset(a,b)):(g=g(this.m_allocator),
g.Reset(b,a)),g):null};L.prototype.Destroy=function(a){a.m_manifold.m_pointCount>0&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=parseInt(a.m_fixtureA.GetType()),m=parseInt(a.m_fixtureB.GetType()),b=this.m_registers[b][m];b.poolCount++;a.m_next=b.pool;b.pool=a;b=b.destroyFcn;b(a,this.m_allocator)};H.b2ContactRegister=function(){};C.b2ContactResult=function(){this.position=new F;this.normal=new F;this.id=new T};J.b2ContactSolver=function(){this.m_step=new G;this.m_constraints=
new p};J.prototype.b2ContactSolver=function(){};J.prototype.Initialize=function(a,b,m,g){m===void 0&&(m=0);var f;this.m_step.Set(a);this.m_allocator=g;a=0;for(this.m_constraintCount=m;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new y;for(a=0;a<m;++a){f=b[a];var g=f.m_fixtureA,d=f.m_fixtureB,c=g.m_shape.m_radius,q=d.m_shape.m_radius,e=g.m_body,j=d.m_body,A=f.GetManifold(),l=N.b2MixFriction(g.GetFriction(),d.GetFriction()),h=N.b2MixRestitution(g.GetRestitution(),
d.GetRestitution()),r=e.m_linearVelocity.x,o=e.m_linearVelocity.y,t=j.m_linearVelocity.x,k=j.m_linearVelocity.y,u=e.m_angularVelocity,p=j.m_angularVelocity;N.b2Assert(A.m_pointCount>0);J.s_worldManifold.Initialize(A,e.m_xf,c,j.m_xf,q);d=J.s_worldManifold.m_normal.x;f=J.s_worldManifold.m_normal.y;g=this.m_constraints[a];g.bodyA=e;g.bodyB=j;g.manifold=A;g.normal.x=d;g.normal.y=f;g.pointCount=A.m_pointCount;g.friction=l;g.restitution=h;g.localPlaneNormal.x=A.m_localPlaneNormal.x;g.localPlaneNormal.y=
A.m_localPlaneNormal.y;g.localPoint.x=A.m_localPoint.x;g.localPoint.y=A.m_localPoint.y;g.radius=c+q;g.type=A.m_type;for(c=0;c<g.pointCount;++c){l=A.m_points[c];q=g.points[c];q.normalImpulse=l.m_normalImpulse;q.tangentImpulse=l.m_tangentImpulse;q.localPoint.SetV(l.m_localPoint);var l=q.rA.x=J.s_worldManifold.m_points[c].x-e.m_sweep.c.x,h=q.rA.y=J.s_worldManifold.m_points[c].y-e.m_sweep.c.y,x=q.rB.x=J.s_worldManifold.m_points[c].x-j.m_sweep.c.x,C=q.rB.y=J.s_worldManifold.m_points[c].y-j.m_sweep.c.y,
B=l*f-h*d,v=x*f-C*d;B*=B;v*=v;q.normalMass=1/(e.m_invMass+j.m_invMass+e.m_invI*B+j.m_invI*v);var L=e.m_mass*e.m_invMass+j.m_mass*j.m_invMass;L+=e.m_mass*e.m_invI*B+j.m_mass*j.m_invI*v;q.equalizedMass=1/L;v=f;L=-d;B=l*L-h*v;v=x*L-C*v;B*=B;v*=v;q.tangentMass=1/(e.m_invMass+j.m_invMass+e.m_invI*B+j.m_invI*v);q.velocityBias=0;l=g.normal.x*(t+-p*C-r- -u*h)+g.normal.y*(k+p*x-o-u*l);l<-N.b2_velocityThreshold&&(q.velocityBias+=-g.restitution*l)}if(g.pointCount==2)k=g.points[0],t=g.points[1],A=e.m_invMass,
e=e.m_invI,r=j.m_invMass,j=j.m_invI,o=k.rA.x*f-k.rA.y*d,k=k.rB.x*f-k.rB.y*d,u=t.rA.x*f-t.rA.y*d,t=t.rB.x*f-t.rB.y*d,d=A+r+e*o*o+j*k*k,f=A+r+e*u*u+j*t*t,j=A+r+e*o*u+j*k*t,d*d<100*(d*f-j*j)?(g.K.col1.Set(d,j),g.K.col2.Set(j,f),g.K.GetInverse(g.normalMass)):g.pointCount=1}};J.prototype.InitVelocityConstraints=function(a){for(var b=0;b<this.m_constraintCount;++b){var m=this.m_constraints[b],g=m.bodyA,f=m.bodyB,d=g.m_invMass,c=g.m_invI,q=f.m_invMass,e=f.m_invI,j=m.normal.x,A=m.normal.y,l=A,h=-j,r=0,o=
0;if(a.warmStarting){o=m.pointCount;for(r=0;r<o;++r){var t=m.points[r];t.normalImpulse*=a.dtRatio;t.tangentImpulse*=a.dtRatio;var k=t.normalImpulse*j+t.tangentImpulse*l,u=t.normalImpulse*A+t.tangentImpulse*h;g.m_angularVelocity-=c*(t.rA.x*u-t.rA.y*k);g.m_linearVelocity.x-=d*k;g.m_linearVelocity.y-=d*u;f.m_angularVelocity+=e*(t.rB.x*u-t.rB.y*k);f.m_linearVelocity.x+=q*k;f.m_linearVelocity.y+=q*u}}else{o=m.pointCount;for(r=0;r<o;++r)g=m.points[r],g.normalImpulse=0,g.tangentImpulse=0}}};J.prototype.SolveVelocityConstraints=
function(){for(var a=0,b,m=0,g=0,f=0,d=g=g=m=m=0,c=m=m=0,q=m=f=0,e=0,j,A=0;A<this.m_constraintCount;++A){var f=this.m_constraints[A],l=f.bodyA,h=f.bodyB,r=l.m_angularVelocity,o=h.m_angularVelocity,t=l.m_linearVelocity,k=h.m_linearVelocity,u=l.m_invMass,p=l.m_invI,x=h.m_invMass,C=h.m_invI,q=f.normal.x,y=e=f.normal.y;j=-q;c=f.friction;for(a=0;a<f.pointCount;a++)b=f.points[a],m=k.x-o*b.rB.y-t.x+r*b.rA.y,g=k.y+o*b.rB.x-t.y-r*b.rA.x,m=m*y+g*j,m=b.tangentMass*-m,g=c*b.normalImpulse,g=S.Clamp(b.tangentImpulse+
m,-g,g),m=g-b.tangentImpulse,d=m*y,m*=j,t.x-=u*d,t.y-=u*m,r-=p*(b.rA.x*m-b.rA.y*d),k.x+=x*d,k.y+=x*m,o+=C*(b.rB.x*m-b.rB.y*d),b.tangentImpulse=g;parseInt(f.pointCount);if(f.pointCount==1)b=f.points[0],m=k.x+-o*b.rB.y-t.x- -r*b.rA.y,g=k.y+o*b.rB.x-t.y-r*b.rA.x,f=m*q+g*e,m=-b.normalMass*(f-b.velocityBias),g=b.normalImpulse+m,g=g>0?g:0,m=g-b.normalImpulse,d=m*q,m*=e,t.x-=u*d,t.y-=u*m,r-=p*(b.rA.x*m-b.rA.y*d),k.x+=x*d,k.y+=x*m,o+=C*(b.rB.x*m-b.rB.y*d),b.normalImpulse=g;else{b=f.points[0];var a=f.points[1],
m=b.normalImpulse,c=a.normalImpulse,B=(k.x-o*b.rB.y-t.x+r*b.rA.y)*q+(k.y+o*b.rB.x-t.y-r*b.rA.x)*e,J=(k.x-o*a.rB.y-t.x+r*a.rA.y)*q+(k.y+o*a.rB.x-t.y-r*a.rA.x)*e,g=B-b.velocityBias,d=J-a.velocityBias;j=f.K;g-=j.col1.x*m+j.col2.x*c;for(d-=j.col1.y*m+j.col2.y*c;;){j=f.normalMass;y=-(j.col1.x*g+j.col2.x*d);j=-(j.col1.y*g+j.col2.y*d);if(y>=0&&j>=0){m=y-m;c=j-c;f=m*q;m*=e;q*=c;e*=c;t.x-=u*(f+q);t.y-=u*(m+e);r-=p*(b.rA.x*m-b.rA.y*f+a.rA.x*e-a.rA.y*q);k.x+=x*(f+q);k.y+=x*(m+e);o+=C*(b.rB.x*m-b.rB.y*f+a.rB.x*
e-a.rB.y*q);b.normalImpulse=y;a.normalImpulse=j;break}y=-b.normalMass*g;j=0;J=f.K.col1.y*y+d;if(y>=0&&J>=0){m=y-m;c=j-c;f=m*q;m*=e;q*=c;e*=c;t.x-=u*(f+q);t.y-=u*(m+e);r-=p*(b.rA.x*m-b.rA.y*f+a.rA.x*e-a.rA.y*q);k.x+=x*(f+q);k.y+=x*(m+e);o+=C*(b.rB.x*m-b.rB.y*f+a.rB.x*e-a.rB.y*q);b.normalImpulse=y;a.normalImpulse=j;break}y=0;j=-a.normalMass*d;B=f.K.col2.x*j+g;if(j>=0&&B>=0){m=y-m;c=j-c;f=m*q;m*=e;q*=c;e*=c;t.x-=u*(f+q);t.y-=u*(m+e);r-=p*(b.rA.x*m-b.rA.y*f+a.rA.x*e-a.rA.y*q);k.x+=x*(f+q);k.y+=x*(m+e);
o+=C*(b.rB.x*m-b.rB.y*f+a.rB.x*e-a.rB.y*q);b.normalImpulse=y;a.normalImpulse=j;break}j=y=0;B=g;J=d;if(B>=0&&J>=0){m=y-m;c=j-c;f=m*q;m*=e;q*=c;e*=c;t.x-=u*(f+q);t.y-=u*(m+e);r-=p*(b.rA.x*m-b.rA.y*f+a.rA.x*e-a.rA.y*q);k.x+=x*(f+q);k.y+=x*(m+e);o+=C*(b.rB.x*m-b.rB.y*f+a.rB.x*e-a.rB.y*q);b.normalImpulse=y;a.normalImpulse=j;break}break}}l.m_angularVelocity=r;h.m_angularVelocity=o}};J.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],
m=b.manifold,g=0;g<b.pointCount;++g){var f=m.m_points[g],d=b.points[g];f.m_normalImpulse=d.normalImpulse;f.m_tangentImpulse=d.tangentImpulse}};J.prototype.SolvePositionConstraints=function(a){a===void 0&&(a=0);for(var b=0,m=0;m<this.m_constraintCount;m++){var g=this.m_constraints[m],f=g.bodyA,d=g.bodyB,c=f.m_mass*f.m_invMass,q=f.m_mass*f.m_invI,e=d.m_mass*d.m_invMass,j=d.m_mass*d.m_invI;J.s_psm.Initialize(g);for(var A=J.s_psm.m_normal,l=0;l<g.pointCount;l++){var h=g.points[l],r=J.s_psm.m_points[l],
o=J.s_psm.m_separations[l],t=r.x-f.m_sweep.c.x,k=r.y-f.m_sweep.c.y,u=r.x-d.m_sweep.c.x,r=r.y-d.m_sweep.c.y,b=b<o?b:o,o=S.Clamp(a*(o+N.b2_linearSlop),-N.b2_maxLinearCorrection,0);o*=-h.equalizedMass;h=o*A.x;o*=A.y;f.m_sweep.c.x-=c*h;f.m_sweep.c.y-=c*o;f.m_sweep.a-=q*(t*o-k*h);f.SynchronizeTransform();d.m_sweep.c.x+=e*h;d.m_sweep.c.y+=e*o;d.m_sweep.a+=j*(u*o-r*h);d.SynchronizeTransform()}}return b>-1.5*N.b2_linearSlop};a.postDefs.push(function(){a.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new A;
a.Dynamics.Contacts.b2ContactSolver.s_psm=new B});a.inherit(x,a.Dynamics.Contacts.b2Contact);x.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;x.b2EdgeAndCircleContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};x.Create=function(){return new x};x.Destroy=function(){};x.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};x.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),m=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,
this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,m.m_xf)};x.prototype.b2CollideEdgeAndCircle=function(){};a.inherit(v,a.Dynamics.Contacts.b2Contact);v.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;v.b2NullContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};v.prototype.Evaluate=function(){};
a.inherit(Q,a.Dynamics.Contacts.b2Contact);Q.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;Q.b2PolyAndCircleContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};Q.Create=function(){return new Q};Q.Destroy=function(){};Q.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b);N.b2Assert(a.GetType()==r.e_polygonShape);N.b2Assert(b.GetType()==r.e_circleShape)};Q.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,m=this.m_fixtureB.m_body;I.CollidePolygonAndCircle(this.m_manifold,
this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,m.m_xf)};a.inherit(j,a.Dynamics.Contacts.b2Contact);j.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;j.b2PolyAndEdgeContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};j.Create=function(){return new j};j.Destroy=function(){};j.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b);N.b2Assert(a.GetType()==
r.e_polygonShape);N.b2Assert(b.GetType()==r.e_edgeShape)};j.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof d?this.m_fixtureB.GetShape():null,b.m_xf)};j.prototype.b2CollidePolyAndEdge=function(){};a.inherit(P,a.Dynamics.Contacts.b2Contact);P.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;P.b2PolygonContact=
function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};P.Create=function(){return new P};P.Destroy=function(){};P.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};P.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();I.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof c?this.m_fixtureB.GetShape():null,b.m_xf)};B.b2PositionSolverManifold=
function(){};B.prototype.b2PositionSolverManifold=function(){this.m_normal=new F;this.m_separations=new k(N.b2_maxManifoldPoints);this.m_points=new p(N.b2_maxManifoldPoints);for(var a=0;a<N.b2_maxManifoldPoints;a++)this.m_points[a]=new F};B.prototype.Initialize=function(a){N.b2Assert(a.pointCount>0);var b=0,m=0,g=0,f,d=0,c=0;switch(a.type){case M.e_circles:f=a.bodyA.m_xf.R;g=a.localPoint;b=a.bodyA.m_xf.position.x+(f.col1.x*g.x+f.col2.x*g.y);m=a.bodyA.m_xf.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=
a.bodyB.m_xf.R;g=a.points[0].localPoint;d=a.bodyB.m_xf.position.x+(f.col1.x*g.x+f.col2.x*g.y);f=a.bodyB.m_xf.position.y+(f.col1.y*g.x+f.col2.y*g.y);var g=d-b,c=f-m,q=g*g+c*c;q>Number.MIN_VALUE*Number.MIN_VALUE?(q=Math.sqrt(q),this.m_normal.x=g/q,this.m_normal.y=c/q):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=0.5*(b+d);this.m_points[0].y=0.5*(m+f);this.m_separations[0]=g*this.m_normal.x+c*this.m_normal.y-a.radius;break;case M.e_faceA:f=a.bodyA.m_xf.R;g=a.localPlaneNormal;this.m_normal.x=
f.col1.x*g.x+f.col2.x*g.y;this.m_normal.y=f.col1.y*g.x+f.col2.y*g.y;f=a.bodyA.m_xf.R;g=a.localPoint;d=a.bodyA.m_xf.position.x+(f.col1.x*g.x+f.col2.x*g.y);c=a.bodyA.m_xf.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=a.bodyB.m_xf.R;for(b=0;b<a.pointCount;++b)g=a.points[b].localPoint,m=a.bodyB.m_xf.position.x+(f.col1.x*g.x+f.col2.x*g.y),g=a.bodyB.m_xf.position.y+(f.col1.y*g.x+f.col2.y*g.y),this.m_separations[b]=(m-d)*this.m_normal.x+(g-c)*this.m_normal.y-a.radius,this.m_points[b].x=m,this.m_points[b].y=g;
break;case M.e_faceB:f=a.bodyB.m_xf.R;g=a.localPlaneNormal;this.m_normal.x=f.col1.x*g.x+f.col2.x*g.y;this.m_normal.y=f.col1.y*g.x+f.col2.y*g.y;f=a.bodyB.m_xf.R;g=a.localPoint;d=a.bodyB.m_xf.position.x+(f.col1.x*g.x+f.col2.x*g.y);c=a.bodyB.m_xf.position.y+(f.col1.y*g.x+f.col2.y*g.y);f=a.bodyA.m_xf.R;for(b=0;b<a.pointCount;++b)g=a.points[b].localPoint,m=a.bodyA.m_xf.position.x+(f.col1.x*g.x+f.col2.x*g.y),g=a.bodyA.m_xf.position.y+(f.col1.y*g.x+f.col2.y*g.y),this.m_separations[b]=(m-d)*this.m_normal.x+
(g-c)*this.m_normal.y-a.radius,this.m_points[b].Set(m,g);this.m_normal.x*=-1;this.m_normal.y*=-1}};a.postDefs.push(function(){a.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new F;a.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new F})})();(function(){var b=a.Common.Math.b2Mat22,d=a.Common.Math.b2Math,c=a.Common.Math.b2Vec2,r=a.Common.b2Color,o=a.Dynamics.Controllers.b2BuoyancyController,h=a.Dynamics.Controllers.b2ConstantAccelController,k=a.Dynamics.Controllers.b2ConstantForceController,
e=a.Dynamics.Controllers.b2Controller,t=a.Dynamics.Controllers.b2ControllerEdge,p=a.Dynamics.Controllers.b2GravityController,v=a.Dynamics.Controllers.b2TensorDampingController;a.inherit(o,a.Dynamics.Controllers.b2Controller);o.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;o.b2BuoyancyController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new c(0,-1);this.density=this.offset=0;this.velocity=new c(0,0);this.linearDrag=2;this.angularDrag=
1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};o.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity)this.gravity=this.GetWorld().GetGravity().Copy();for(var a=this.m_bodyList;a;a=a.nextBody){var b=a.body;if(b.IsAwake()!=!1){for(var d=new c,e=new c,h=0,j=0,r=b.GetFixtureList();r;r=r.GetNext()){var o=new c,t=r.GetShape().ComputeSubmergedArea(this.normal,this.offset,b.GetTransform(),o);h+=t;d.x+=t*o.x;d.y+=t*o.y;var k=0,k=1;j+=t*k;e.x+=t*o.x*k;e.y+=t*o.y*k}d.x/=h;
d.y/=h;e.x/=j;e.y/=j;h<Number.MIN_VALUE||(j=this.gravity.GetNegative(),j.Multiply(this.density*h),b.ApplyForce(j,e),e=b.GetLinearVelocityFromWorldPoint(d),e.Subtract(this.velocity),e.Multiply(-this.linearDrag*h),b.ApplyForce(e,d),b.ApplyTorque(-b.GetInertia()/b.GetMass()*h*b.GetAngularVelocity()*this.angularDrag))}}}};o.prototype.Draw=function(a){var b=new c,d=new c;b.x=this.normal.x*this.offset+this.normal.y*1E3;b.y=this.normal.y*this.offset-this.normal.x*1E3;d.x=this.normal.x*this.offset-this.normal.y*
1E3;d.y=this.normal.y*this.offset+this.normal.x*1E3;var e=new r(0,0,1);a.DrawSegment(b,d,e)};a.inherit(h,a.Dynamics.Controllers.b2Controller);h.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;h.b2ConstantAccelController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new c(0,0)};h.prototype.Step=function(a){for(var a=new c(this.A.x*a.dt,this.A.y*a.dt),b=this.m_bodyList;b;b=b.nextBody){var d=b.body;d.IsAwake()&&d.SetLinearVelocity(new c(d.GetLinearVelocity().x+
a.x,d.GetLinearVelocity().y+a.y))}};a.inherit(k,a.Dynamics.Controllers.b2Controller);k.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;k.b2ConstantForceController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new c(0,0)};k.prototype.Step=function(){for(var a=this.m_bodyList;a;a=a.nextBody){var b=a.body;b.IsAwake()&&b.ApplyForce(this.F,b.GetWorldCenter())}};e.b2Controller=function(){};e.prototype.Step=function(){};e.prototype.Draw=function(){};
e.prototype.AddBody=function(a){var b=new t;b.controller=this;b.body=a;b.nextBody=this.m_bodyList;b.prevBody=null;this.m_bodyList=b;if(b.nextBody)b.nextBody.prevBody=b;this.m_bodyCount++;b.nextController=a.m_controllerList;b.prevController=null;a.m_controllerList=b;if(b.nextController)b.nextController.prevController=b;a.m_controllerCount++};e.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;if(b.prevBody)b.prevBody.nextBody=b.nextBody;if(b.nextBody)b.nextBody.prevBody=
b.prevBody;if(b.nextController)b.nextController.prevController=b.prevController;if(b.prevController)b.prevController.nextController=b.nextController;if(this.m_bodyList==b)this.m_bodyList=b.nextBody;if(a.m_controllerList==b)a.m_controllerList=b.nextController;a.m_controllerCount--;this.m_bodyCount--};e.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};e.prototype.GetNext=function(){return this.m_next};e.prototype.GetWorld=function(){return this.m_world};e.prototype.GetBodyList=
function(){return this.m_bodyList};t.b2ControllerEdge=function(){};a.inherit(p,a.Dynamics.Controllers.b2Controller);p.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;p.b2GravityController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};p.prototype.Step=function(){var a=null,b=null,d=null,e=0,h=null,j=null,r=null,o=0,t=0,k=0,o=null;if(this.invSqr)for(a=this.m_bodyList;a;a=a.nextBody){b=a.body;d=b.GetWorldCenter();e=b.GetMass();
for(h=this.m_bodyList;h!=a;h=h.nextBody)j=h.body,r=j.GetWorldCenter(),o=r.x-d.x,t=r.y-d.y,k=o*o+t*t,k<Number.MIN_VALUE||(o=new c(o,t),o.Multiply(this.G/k/Math.sqrt(k)*e*j.GetMass()),b.IsAwake()&&b.ApplyForce(o,d),o.Multiply(-1),j.IsAwake()&&j.ApplyForce(o,r))}else for(a=this.m_bodyList;a;a=a.nextBody){b=a.body;d=b.GetWorldCenter();e=b.GetMass();for(h=this.m_bodyList;h!=a;h=h.nextBody)j=h.body,r=j.GetWorldCenter(),o=r.x-d.x,t=r.y-d.y,k=o*o+t*t,k<Number.MIN_VALUE||(o=new c(o,t),o.Multiply(this.G/k*
e*j.GetMass()),b.IsAwake()&&b.ApplyForce(o,d),o.Multiply(-1),j.IsAwake()&&j.ApplyForce(o,r))}};a.inherit(v,a.Dynamics.Controllers.b2Controller);v.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;v.b2TensorDampingController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new b;this.maxTimestep=0};v.prototype.SetAxisAligned=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.T.col1.x=-a;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-b;this.maxTimestep=
a>0||b>0?1/Math.max(a,b):0};v.prototype.Step=function(a){a=a.dt;if(!(a<=Number.MIN_VALUE)){if(a>this.maxTimestep&&this.maxTimestep>0)a=this.maxTimestep;for(var b=this.m_bodyList;b;b=b.nextBody){var e=b.body;if(e.IsAwake()){var h=e.GetWorldVector(d.MulMV(this.T,e.GetLocalVector(e.GetLinearVelocity())));e.SetLinearVelocity(new c(e.GetLinearVelocity().x+h.x*a,e.GetLinearVelocity().y+h.y*a))}}}}})();(function(){var b=a.Common.b2Settings,d=a.Common.Math.b2Mat22,c=a.Common.Math.b2Mat33,o=a.Common.Math.b2Math,
k=a.Common.Math.b2Vec2,h=a.Common.Math.b2Vec3,p=a.Dynamics.Joints.b2DistanceJoint,e=a.Dynamics.Joints.b2DistanceJointDef,t=a.Dynamics.Joints.b2FrictionJoint,v=a.Dynamics.Joints.b2FrictionJointDef,H=a.Dynamics.Joints.b2GearJoint,C=a.Dynamics.Joints.b2GearJointDef,J=a.Dynamics.Joints.b2Jacobian,x=a.Dynamics.Joints.b2Joint,O=a.Dynamics.Joints.b2JointDef,Q=a.Dynamics.Joints.b2JointEdge,j=a.Dynamics.Joints.b2LineJoint,P=a.Dynamics.Joints.b2LineJointDef,B=a.Dynamics.Joints.b2MouseJoint,D=a.Dynamics.Joints.b2MouseJointDef,
G=a.Dynamics.Joints.b2PrismaticJoint,N=a.Dynamics.Joints.b2PrismaticJointDef,E=a.Dynamics.Joints.b2PulleyJoint,S=a.Dynamics.Joints.b2PulleyJointDef,F=a.Dynamics.Joints.b2RevoluteJoint,I=a.Dynamics.Joints.b2RevoluteJointDef,T=a.Dynamics.Joints.b2WeldJoint,M=a.Dynamics.Joints.b2WeldJointDef;a.inherit(p,a.Dynamics.Joints.b2Joint);p.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;p.b2DistanceJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new k;this.m_localAnchor2=
new k;this.m_u=new k};p.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};p.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};p.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)};p.prototype.GetReactionTorque=function(){return 0};p.prototype.GetLength=function(){return this.m_length};p.prototype.SetLength=function(a){a===void 0&&(a=0);this.m_length=
a};p.prototype.GetFrequency=function(){return this.m_frequencyHz};p.prototype.SetFrequency=function(a){a===void 0&&(a=0);this.m_frequencyHz=a};p.prototype.GetDampingRatio=function(){return this.m_dampingRatio};p.prototype.SetDampingRatio=function(a){a===void 0&&(a=0);this.m_dampingRatio=a};p.prototype.b2DistanceJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;
this.m_dampingRatio=a.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};p.prototype.InitVelocityConstraints=function(a){var d,c=0,e=this.m_bodyA,j=this.m_bodyB;d=e.m_xf.R;var h=this.m_localAnchor1.x-e.m_sweep.localCenter.x,g=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=d.col1.x*h+d.col2.x*g,g=d.col1.y*h+d.col2.y*g,h=c;d=j.m_xf.R;var f=this.m_localAnchor2.x-j.m_sweep.localCenter.x,n=this.m_localAnchor2.y-j.m_sweep.localCenter.y,c=d.col1.x*f+d.col2.x*n,n=d.col1.y*f+d.col2.y*n,f=c;this.m_u.x=
j.m_sweep.c.x+f-e.m_sweep.c.x-h;this.m_u.y=j.m_sweep.c.y+n-e.m_sweep.c.y-g;c=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);c>b.b2_linearSlop?this.m_u.Multiply(1/c):this.m_u.SetZero();d=h*this.m_u.y-g*this.m_u.x;var o=f*this.m_u.y-n*this.m_u.x;d=e.m_invMass+e.m_invI*d*d+j.m_invMass+j.m_invI*o*o;this.m_mass=d!=0?1/d:0;if(this.m_frequencyHz>0){c-=this.m_length;var o=2*Math.PI*this.m_frequencyHz,l=this.m_mass*o*o;this.m_gamma=a.dt*(2*this.m_mass*this.m_dampingRatio*o+a.dt*l);this.m_gamma=this.m_gamma!=
0?1/this.m_gamma:0;this.m_bias=c*a.dt*l*this.m_gamma;this.m_mass=d+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}a.warmStarting?(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,d=this.m_impulse*this.m_u.y,e.m_linearVelocity.x-=e.m_invMass*a,e.m_linearVelocity.y-=e.m_invMass*d,e.m_angularVelocity-=e.m_invI*(h*d-g*a),j.m_linearVelocity.x+=j.m_invMass*a,j.m_linearVelocity.y+=j.m_invMass*d,j.m_angularVelocity+=j.m_invI*(f*d-n*a)):this.m_impulse=0};p.prototype.SolveVelocityConstraints=
function(){var a,b=this.m_bodyA,d=this.m_bodyB;a=b.m_xf.R;var c=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,j=a.col1.x*c+a.col2.x*e,e=a.col1.y*c+a.col2.y*e,c=j;a=d.m_xf.R;var g=this.m_localAnchor2.x-d.m_sweep.localCenter.x,f=this.m_localAnchor2.y-d.m_sweep.localCenter.y,j=a.col1.x*g+a.col2.x*f,f=a.col1.y*g+a.col2.y*f,g=j,j=-this.m_mass*(this.m_u.x*(d.m_linearVelocity.x+-d.m_angularVelocity*f-(b.m_linearVelocity.x+-b.m_angularVelocity*e))+this.m_u.y*
(d.m_linearVelocity.y+d.m_angularVelocity*g-(b.m_linearVelocity.y+b.m_angularVelocity*c))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=j;a=j*this.m_u.x;j*=this.m_u.y;b.m_linearVelocity.x-=b.m_invMass*a;b.m_linearVelocity.y-=b.m_invMass*j;b.m_angularVelocity-=b.m_invI*(c*j-e*a);d.m_linearVelocity.x+=d.m_invMass*a;d.m_linearVelocity.y+=d.m_invMass*j;d.m_angularVelocity+=d.m_invI*(g*j-f*a)};p.prototype.SolvePositionConstraints=function(){var a;if(this.m_frequencyHz>0)return!0;var d=this.m_bodyA,
c=this.m_bodyB;a=d.m_xf.R;var e=this.m_localAnchor1.x-d.m_sweep.localCenter.x,j=this.m_localAnchor1.y-d.m_sweep.localCenter.y,h=a.col1.x*e+a.col2.x*j,j=a.col1.y*e+a.col2.y*j,e=h;a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,f=this.m_localAnchor2.y-c.m_sweep.localCenter.y,h=a.col1.x*g+a.col2.x*f,f=a.col1.y*g+a.col2.y*f,g=h,h=c.m_sweep.c.x+g-d.m_sweep.c.x-e,n=c.m_sweep.c.y+f-d.m_sweep.c.y-j;a=Math.sqrt(h*h+n*n);h/=a;n/=a;a-=this.m_length;a=o.Clamp(a,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection);
var l=-this.m_mass*a;this.m_u.Set(h,n);h=l*this.m_u.x;n=l*this.m_u.y;d.m_sweep.c.x-=d.m_invMass*h;d.m_sweep.c.y-=d.m_invMass*n;d.m_sweep.a-=d.m_invI*(e*n-j*h);c.m_sweep.c.x+=c.m_invMass*h;c.m_sweep.c.y+=c.m_invMass*n;c.m_sweep.a+=c.m_invI*(g*n-f*h);d.SynchronizeTransform();c.SynchronizeTransform();return o.Abs(a)<b.b2_linearSlop};a.inherit(e,a.Dynamics.Joints.b2JointDef);e.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;e.b2DistanceJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new k;this.localAnchorB=new k};e.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};e.prototype.Initialize=function(a,b,d,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c));a=c.x-d.x;d=c.y-d.y;this.length=Math.sqrt(a*a+d*d);this.dampingRatio=this.frequencyHz=0};a.inherit(t,a.Dynamics.Joints.b2Joint);
t.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;t.b2FrictionJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new k;this.m_localAnchorB=new k;this.m_linearMass=new d;this.m_linearImpulse=new k};t.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};t.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};t.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*this.m_linearImpulse.x,
a*this.m_linearImpulse.y)};t.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);return a*this.m_angularImpulse};t.prototype.SetMaxForce=function(a){a===void 0&&(a=0);this.m_maxForce=a};t.prototype.GetMaxForce=function(){return this.m_maxForce};t.prototype.SetMaxTorque=function(a){a===void 0&&(a=0);this.m_maxTorque=a};t.prototype.GetMaxTorque=function(){return this.m_maxTorque};t.prototype.b2FrictionJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);
this.m_localAnchorB.SetV(a.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque};t.prototype.InitVelocityConstraints=function(a){var b,c=0,e=this.m_bodyA,j=this.m_bodyB;b=e.m_xf.R;var h=this.m_localAnchorA.x-e.m_sweep.localCenter.x,g=this.m_localAnchorA.y-e.m_sweep.localCenter.y,c=b.col1.x*h+b.col2.x*g,g=b.col1.y*h+b.col2.y*g,h=c;b=j.m_xf.R;var f=this.m_localAnchorB.x-j.m_sweep.localCenter.x,
n=this.m_localAnchorB.y-j.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*n,n=b.col1.y*f+b.col2.y*n,f=c;b=e.m_invMass;var c=j.m_invMass,o=e.m_invI,l=j.m_invI,k=new d;k.col1.x=b+c;k.col2.x=0;k.col1.y=0;k.col2.y=b+c;k.col1.x+=o*g*g;k.col2.x+=-o*h*g;k.col1.y+=-o*h*g;k.col2.y+=o*h*h;k.col1.x+=l*n*n;k.col2.x+=-l*f*n;k.col1.y+=-l*f*n;k.col2.y+=l*f*f;k.GetInverse(this.m_linearMass);this.m_angularMass=o+l;if(this.m_angularMass>0)this.m_angularMass=1/this.m_angularMass;a.warmStarting?(this.m_linearImpulse.x*=
a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,e.m_linearVelocity.x-=b*a.x,e.m_linearVelocity.y-=b*a.y,e.m_angularVelocity-=o*(h*a.y-g*a.x+this.m_angularImpulse),j.m_linearVelocity.x+=c*a.x,j.m_linearVelocity.y+=c*a.y,j.m_angularVelocity+=l*(f*a.y-n*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};t.prototype.SolveVelocityConstraints=function(a){var b,d=0,c=this.m_bodyA,e=this.m_bodyB,j=c.m_linearVelocity,g=
c.m_angularVelocity,f=e.m_linearVelocity,n=e.m_angularVelocity,h=c.m_invMass,l=e.m_invMass,t=c.m_invI,p=e.m_invI;b=c.m_xf.R;var x=this.m_localAnchorA.x-c.m_sweep.localCenter.x,y=this.m_localAnchorA.y-c.m_sweep.localCenter.y,d=b.col1.x*x+b.col2.x*y,y=b.col1.y*x+b.col2.y*y,x=d;b=e.m_xf.R;var B=this.m_localAnchorB.x-e.m_sweep.localCenter.x,C=this.m_localAnchorB.y-e.m_sweep.localCenter.y,d=b.col1.x*B+b.col2.x*C,C=b.col1.y*B+b.col2.y*C,B=d;b=0;var d=-this.m_angularMass*(n-g),v=this.m_angularImpulse;b=
a.dt*this.m_maxTorque;this.m_angularImpulse=o.Clamp(this.m_angularImpulse+d,-b,b);d=this.m_angularImpulse-v;g-=t*d;n+=p*d;b=o.MulMV(this.m_linearMass,new k(-(f.x-n*C-j.x+g*y),-(f.y+n*B-j.y-g*x)));d=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(b);b=a.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b));b=o.SubtractVV(this.m_linearImpulse,d);j.x-=h*b.x;j.y-=h*b.y;g-=t*(x*b.y-y*b.x);f.x+=l*b.x;f.y+=l*b.y;n+=p*(B*b.y-
C*b.x);c.m_angularVelocity=g;e.m_angularVelocity=n};t.prototype.SolvePositionConstraints=function(){return!0};a.inherit(v,a.Dynamics.Joints.b2JointDef);v.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;v.b2FrictionJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new k;this.localAnchorB=new k};v.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_frictionJoint;this.maxTorque=this.maxForce=0};v.prototype.Initialize=
function(a,b,d){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d))};a.inherit(H,a.Dynamics.Joints.b2Joint);H.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;H.b2GearJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new k;this.m_groundAnchor2=new k;this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_J=new J};H.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};
H.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};H.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)};H.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);var b=this.m_bodyB.m_xf.R,d=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,c=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*d+b.col2.x*c,c=b.col1.y*d+b.col2.y*c;return a*(this.m_impulse*
this.m_J.angularB-e*this.m_impulse*this.m_J.linearB.y+c*this.m_impulse*this.m_J.linearB.x)};H.prototype.GetRatio=function(){return this.m_ratio};H.prototype.SetRatio=function(a){a===void 0&&(a=0);this.m_ratio=a};H.prototype.b2GearJoint=function(a){this.__super.b2Joint.call(this,a);var b=parseInt(a.joint1.m_type),d=parseInt(a.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var c=0,e=0;this.m_ground1=a.joint1.GetBodyA();this.m_bodyA=a.joint1.GetBodyB();b==x.e_revoluteJoint?
(this.m_revolute1=a.joint1 instanceof F?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),c=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof G?a.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),c=this.m_prismatic1.GetJointTranslation());this.m_ground2=a.joint2.GetBodyA();this.m_bodyB=a.joint2.GetBodyB();d==x.e_revoluteJoint?
(this.m_revolute2=a.joint2 instanceof F?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof G?a.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.GetJointTranslation());this.m_ratio=a.ratio;this.m_constant=c+this.m_ratio*e;this.m_impulse=0};H.prototype.InitVelocityConstraints=
function(a){var b=this.m_ground1,d=this.m_ground2,c=this.m_bodyA,e=this.m_bodyB,j=0,g=0,f=0,n=0,h=f=0,o=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,o+=c.m_invI):(b=b.m_xf.R,g=this.m_prismatic1.m_localXAxis1,j=b.col1.x*g.x+b.col2.x*g.y,g=b.col1.y*g.x+b.col2.y*g.y,b=c.m_xf.R,f=this.m_localAnchor1.x-c.m_sweep.localCenter.x,n=this.m_localAnchor1.y-c.m_sweep.localCenter.y,h=b.col1.x*f+b.col2.x*n,n=b.col1.y*f+b.col2.y*n,f=h*g-n*j,this.m_J.linearA.Set(-j,-g),this.m_J.angularA=-f,o+=c.m_invMass+
c.m_invI*f*f);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,o+=this.m_ratio*this.m_ratio*e.m_invI):(b=d.m_xf.R,g=this.m_prismatic2.m_localXAxis1,j=b.col1.x*g.x+b.col2.x*g.y,g=b.col1.y*g.x+b.col2.y*g.y,b=e.m_xf.R,f=this.m_localAnchor2.x-e.m_sweep.localCenter.x,n=this.m_localAnchor2.y-e.m_sweep.localCenter.y,h=b.col1.x*f+b.col2.x*n,n=b.col1.y*f+b.col2.y*n,f=h*g-n*j,this.m_J.linearB.Set(-this.m_ratio*j,-this.m_ratio*g),this.m_J.angularB=-this.m_ratio*f,o+=this.m_ratio*this.m_ratio*(e.m_invMass+e.m_invI*
f*f));this.m_mass=o>0?1/o:0;a.warmStarting?(c.m_linearVelocity.x+=c.m_invMass*this.m_impulse*this.m_J.linearA.x,c.m_linearVelocity.y+=c.m_invMass*this.m_impulse*this.m_J.linearA.y,c.m_angularVelocity+=c.m_invI*this.m_impulse*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*this.m_impulse*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*this.m_impulse*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};H.prototype.SolveVelocityConstraints=function(){var a=
this.m_bodyA,b=this.m_bodyB,d=-this.m_mass*this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);this.m_impulse+=d;a.m_linearVelocity.x+=a.m_invMass*d*this.m_J.linearA.x;a.m_linearVelocity.y+=a.m_invMass*d*this.m_J.linearA.y;a.m_angularVelocity+=a.m_invI*d*this.m_J.angularA;b.m_linearVelocity.x+=b.m_invMass*d*this.m_J.linearB.x;b.m_linearVelocity.y+=b.m_invMass*d*this.m_J.linearB.y;b.m_angularVelocity+=b.m_invI*d*this.m_J.angularB};H.prototype.SolvePositionConstraints=
function(){var a=this.m_bodyA,d=this.m_bodyB,c=0,e=0,c=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),e=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),c=-this.m_mass*(this.m_constant-(c+this.m_ratio*e));a.m_sweep.c.x+=a.m_invMass*c*this.m_J.linearA.x;a.m_sweep.c.y+=a.m_invMass*c*this.m_J.linearA.y;a.m_sweep.a+=a.m_invI*c*this.m_J.angularA;d.m_sweep.c.x+=d.m_invMass*c*this.m_J.linearB.x;d.m_sweep.c.y+=d.m_invMass*
c*this.m_J.linearB.y;d.m_sweep.a+=d.m_invI*c*this.m_J.angularB;a.SynchronizeTransform();d.SynchronizeTransform();return 0<b.b2_linearSlop};a.inherit(C,a.Dynamics.Joints.b2JointDef);C.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;C.b2GearJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};C.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};J.b2Jacobian=function(){this.linearA=
new k;this.linearB=new k};J.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};J.prototype.Set=function(a,b,d,c){b===void 0&&(b=0);c===void 0&&(c=0);this.linearA.SetV(a);this.angularA=b;this.linearB.SetV(d);this.angularB=c};J.prototype.Compute=function(a,b,d,c){b===void 0&&(b=0);c===void 0&&(c=0);return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*d.x+this.linearB.y*d.y)+this.angularB*c};x.b2Joint=function(){this.m_edgeA=
new Q;this.m_edgeB=new Q;this.m_localCenterA=new k;this.m_localCenterB=new k};x.prototype.GetType=function(){return this.m_type};x.prototype.GetAnchorA=function(){return null};x.prototype.GetAnchorB=function(){return null};x.prototype.GetReactionForce=function(){return null};x.prototype.GetReactionTorque=function(){return 0};x.prototype.GetBodyA=function(){return this.m_bodyA};x.prototype.GetBodyB=function(){return this.m_bodyB};x.prototype.GetNext=function(){return this.m_next};x.prototype.GetUserData=
function(){return this.m_userData};x.prototype.SetUserData=function(a){this.m_userData=a};x.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};x.Create=function(a){var b=null;switch(a.type){case x.e_distanceJoint:b=new p(a instanceof e?a:null);break;case x.e_mouseJoint:b=new B(a instanceof D?a:null);break;case x.e_prismaticJoint:b=new G(a instanceof N?a:null);break;case x.e_revoluteJoint:b=new F(a instanceof I?a:null);break;case x.e_pulleyJoint:b=new E(a instanceof
S?a:null);break;case x.e_gearJoint:b=new H(a instanceof C?a:null);break;case x.e_lineJoint:b=new j(a instanceof P?a:null);break;case x.e_weldJoint:b=new T(a instanceof M?a:null);break;case x.e_frictionJoint:b=new t(a instanceof v?a:null)}return b};x.Destroy=function(){};x.prototype.b2Joint=function(a){b.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=
a.userData};x.prototype.InitVelocityConstraints=function(){};x.prototype.SolveVelocityConstraints=function(){};x.prototype.FinalizeVelocityConstraints=function(){};x.prototype.SolvePositionConstraints=function(){return!1};a.postDefs.push(function(){a.Dynamics.Joints.b2Joint.e_unknownJoint=0;a.Dynamics.Joints.b2Joint.e_revoluteJoint=1;a.Dynamics.Joints.b2Joint.e_prismaticJoint=2;a.Dynamics.Joints.b2Joint.e_distanceJoint=3;a.Dynamics.Joints.b2Joint.e_pulleyJoint=4;a.Dynamics.Joints.b2Joint.e_mouseJoint=
5;a.Dynamics.Joints.b2Joint.e_gearJoint=6;a.Dynamics.Joints.b2Joint.e_lineJoint=7;a.Dynamics.Joints.b2Joint.e_weldJoint=8;a.Dynamics.Joints.b2Joint.e_frictionJoint=9;a.Dynamics.Joints.b2Joint.e_inactiveLimit=0;a.Dynamics.Joints.b2Joint.e_atLowerLimit=1;a.Dynamics.Joints.b2Joint.e_atUpperLimit=2;a.Dynamics.Joints.b2Joint.e_equalLimits=3});O.b2JointDef=function(){};O.prototype.b2JointDef=function(){this.type=x.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};Q.b2JointEdge=
function(){};a.inherit(j,a.Dynamics.Joints.b2Joint);j.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;j.b2LineJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_localXAxis1=new k;this.m_localYAxis1=new k;this.m_axis=new k;this.m_perp=new k;this.m_K=new d;this.m_impulse=new k};j.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};j.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
j.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};j.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);return a*this.m_impulse.y};j.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,d=a.GetWorldPoint(this.m_localAnchor1),c=b.GetWorldPoint(this.m_localAnchor2),b=c.x-d.x,
d=c.y-d.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*d};j.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,d;d=a.m_xf.R;var c=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,j=d.col1.x*c+d.col2.x*e,e=d.col1.y*c+d.col2.y*e,c=j;d=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,f=this.m_localAnchor2.y-b.m_sweep.localCenter.y,j=d.col1.x*g+d.col2.x*f,f=d.col1.y*g+d.col2.y*f,g=j;d=b.m_sweep.c.x+g-(a.m_sweep.c.x+
c);var j=b.m_sweep.c.y+f-(a.m_sweep.c.y+e),n=a.GetWorldVector(this.m_localXAxis1),h=a.m_linearVelocity,o=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return d*-a*n.y+j*a*n.x+(n.x*(o.x+-b*f-h.x- -a*e)+n.y*(o.y+b*g-h.y-a*c))};j.prototype.IsLimitEnabled=function(){return this.m_enableLimit};j.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};j.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};j.prototype.GetUpperLimit=
function(){return this.m_upperTranslation};j.prototype.SetLimits=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};j.prototype.IsMotorEnabled=function(){return this.m_enableMotor};j.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};j.prototype.SetMotorSpeed=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);
this.m_motorSpeed=a};j.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};j.prototype.SetMaxMotorForce=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};j.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};j.prototype.GetMotorForce=function(){return this.m_motorImpulse};j.prototype.b2LineJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);
this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=x.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};j.prototype.InitVelocityConstraints=
function(a){var d=this.m_bodyA,c=this.m_bodyB,e,j=0;this.m_localCenterA.SetV(d.GetLocalCenter());this.m_localCenterB.SetV(c.GetLocalCenter());var h=d.GetTransform();c.GetTransform();e=d.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y,j=e.col1.x*g+e.col2.x*f,f=e.col1.y*g+e.col2.y*f,g=j;e=c.m_xf.R;var n=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y,j=e.col1.x*n+e.col2.x*l,l=e.col1.y*n+e.col2.y*l,n=j;e=
c.m_sweep.c.x+n-d.m_sweep.c.x-g;j=c.m_sweep.c.y+l-d.m_sweep.c.y-f;this.m_invMassA=d.m_invMass;this.m_invMassB=c.m_invMass;this.m_invIA=d.m_invI;this.m_invIB=c.m_invI;this.m_axis.SetV(o.MulMV(h.R,this.m_localXAxis1));this.m_a1=(e+g)*this.m_axis.y-(j+f)*this.m_axis.x;this.m_a2=n*this.m_axis.y-l*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(o.MulMV(h.R,
this.m_localYAxis1));this.m_s1=(e+g)*this.m_perp.y-(j+f)*this.m_perp.x;this.m_s2=n*this.m_perp.y-l*this.m_perp.x;h=this.m_invMassA;g=this.m_invMassB;f=this.m_invIA;n=this.m_invIB;this.m_K.col1.x=h+g+f*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2;this.m_K.col1.y=f*this.m_s1*this.m_a1+n*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=h+g+f*this.m_a1*this.m_a1+n*this.m_a2*this.m_a2;if(this.m_enableLimit)if(e=this.m_axis.x*e+this.m_axis.y*j,o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<
2*b.b2_linearSlop)this.m_limitState=x.e_equalLimits;else if(e<=this.m_lowerTranslation){if(this.m_limitState!=x.e_atLowerLimit)this.m_limitState=x.e_atLowerLimit,this.m_impulse.y=0}else if(e>=this.m_upperTranslation){if(this.m_limitState!=x.e_atUpperLimit)this.m_limitState=x.e_atUpperLimit,this.m_impulse.y=0}else this.m_limitState=x.e_inactiveLimit,this.m_impulse.y=0;else this.m_limitState=x.e_inactiveLimit;if(this.m_enableMotor==!1)this.m_motorImpulse=0;a.warmStarting?(this.m_impulse.x*=a.dtRatio,
this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,e=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,j=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,h=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,d.m_linearVelocity.x-=this.m_invMassA*a,d.m_linearVelocity.y-=this.m_invMassA*e,d.m_angularVelocity-=this.m_invIA*
j,c.m_linearVelocity.x+=this.m_invMassB*a,c.m_linearVelocity.y+=this.m_invMassB*e,c.m_angularVelocity+=this.m_invIB*h):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};j.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,d=this.m_bodyB,c=b.m_linearVelocity,e=b.m_angularVelocity,j=d.m_linearVelocity,g=d.m_angularVelocity,f=0,n=0,h=0,l=0;if(this.m_enableMotor&&this.m_limitState!=x.e_equalLimits)l=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(j.x-c.x)+this.m_axis.y*(j.y-c.y)+this.m_a2*
g-this.m_a1*e)),f=this.m_motorImpulse,n=a.dt*this.m_maxMotorForce,this.m_motorImpulse=o.Clamp(this.m_motorImpulse+l,-n,n),l=this.m_motorImpulse-f,f=l*this.m_axis.x,n=l*this.m_axis.y,h=l*this.m_a1,l*=this.m_a2,c.x-=this.m_invMassA*f,c.y-=this.m_invMassA*n,e-=this.m_invIA*h,j.x+=this.m_invMassB*f,j.y+=this.m_invMassB*n,g+=this.m_invIB*l;n=this.m_perp.x*(j.x-c.x)+this.m_perp.y*(j.y-c.y)+this.m_s2*g-this.m_s1*e;if(this.m_enableLimit&&this.m_limitState!=x.e_inactiveLimit){h=this.m_axis.x*(j.x-c.x)+this.m_axis.y*
(j.y-c.y)+this.m_a2*g-this.m_a1*e;f=this.m_impulse.Copy();a=this.m_K.Solve(new k,-n,-h);this.m_impulse.Add(a);if(this.m_limitState==x.e_atLowerLimit)this.m_impulse.y=o.Max(this.m_impulse.y,0);else if(this.m_limitState==x.e_atUpperLimit)this.m_impulse.y=o.Min(this.m_impulse.y,0);n=-n-(this.m_impulse.y-f.y)*this.m_K.col2.x;h=0;h=this.m_K.col1.x!=0?n/this.m_K.col1.x+f.x:f.x;this.m_impulse.x=h;a.x=this.m_impulse.x-f.x;a.y=this.m_impulse.y-f.y;f=a.x*this.m_perp.x+a.y*this.m_axis.x;n=a.x*this.m_perp.y+
a.y*this.m_axis.y;h=a.x*this.m_s1+a.y*this.m_a1;l=a.x*this.m_s2+a.y*this.m_a2}else a=0,a=this.m_K.col1.x!=0?-n/this.m_K.col1.x:0,this.m_impulse.x+=a,f=a*this.m_perp.x,n=a*this.m_perp.y,h=a*this.m_s1,l=a*this.m_s2;c.x-=this.m_invMassA*f;c.y-=this.m_invMassA*n;e-=this.m_invIA*h;j.x+=this.m_invMassB*f;j.y+=this.m_invMassB*n;g+=this.m_invIB*l;b.m_linearVelocity.SetV(c);b.m_angularVelocity=e;d.m_linearVelocity.SetV(j);d.m_angularVelocity=g};j.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,
c=this.m_bodyB,e=a.m_sweep.c,j=a.m_sweep.a,h=c.m_sweep.c,l=c.m_sweep.a,g,f=0,n=0,w=0,t=0,p=g=0,x=0,n=!1,y=0,B=d.FromAngle(j),w=d.FromAngle(l);g=B;var x=this.m_localAnchor1.x-this.m_localCenterA.x,C=this.m_localAnchor1.y-this.m_localCenterA.y,f=g.col1.x*x+g.col2.x*C,C=g.col1.y*x+g.col2.y*C,x=f;g=w;w=this.m_localAnchor2.x-this.m_localCenterB.x;t=this.m_localAnchor2.y-this.m_localCenterB.y;f=g.col1.x*w+g.col2.x*t;t=g.col1.y*w+g.col2.y*t;w=f;g=h.x+w-e.x-x;f=h.y+t-e.y-C;if(this.m_enableLimit){this.m_axis=
o.MulMV(B,this.m_localXAxis1);this.m_a1=(g+x)*this.m_axis.y-(f+C)*this.m_axis.x;this.m_a2=w*this.m_axis.y-t*this.m_axis.x;var v=this.m_axis.x*g+this.m_axis.y*f;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop?(y=o.Clamp(v,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection),p=o.Abs(v),n=!0):v<=this.m_lowerTranslation?(y=o.Clamp(v-this.m_lowerTranslation+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),p=this.m_lowerTranslation-v,n=!0):v>=this.m_upperTranslation&&(y=o.Clamp(v-this.m_upperTranslation+
b.b2_linearSlop,0,b.b2_maxLinearCorrection),p=v-this.m_upperTranslation,n=!0)}this.m_perp=o.MulMV(B,this.m_localYAxis1);this.m_s1=(g+x)*this.m_perp.y-(f+C)*this.m_perp.x;this.m_s2=w*this.m_perp.y-t*this.m_perp.x;B=new k;C=this.m_perp.x*g+this.m_perp.y*f;p=o.Max(p,o.Abs(C));x=0;n?(n=this.m_invMassA,w=this.m_invMassB,t=this.m_invIA,g=this.m_invIB,this.m_K.col1.x=n+w+t*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.col1.y=t*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,
this.m_K.col2.y=n+w+t*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_K.Solve(B,-C,-y)):(n=this.m_invMassA,w=this.m_invMassB,t=this.m_invIA,g=this.m_invIB,y=n+w+t*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,n=0,B.x=y!=0?-C/y:0,B.y=0);y=B.x*this.m_perp.x+B.y*this.m_axis.x;n=B.x*this.m_perp.y+B.y*this.m_axis.y;C=B.x*this.m_s1+B.y*this.m_a1;B=B.x*this.m_s2+B.y*this.m_a2;e.x-=this.m_invMassA*y;e.y-=this.m_invMassA*n;j-=this.m_invIA*C;h.x+=this.m_invMassB*y;h.y+=this.m_invMassB*n;l+=this.m_invIB*B;a.m_sweep.a=
j;c.m_sweep.a=l;a.SynchronizeTransform();c.SynchronizeTransform();return p<=b.b2_linearSlop&&x<=b.b2_angularSlop};a.inherit(P,a.Dynamics.Joints.b2JointDef);P.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;P.b2LineJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new k;this.localAnchorB=new k;this.localAxisA=new k};P.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=
!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};P.prototype.Initialize=function(a,b,d,c){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=this.bodyA.GetLocalVector(c)};a.inherit(B,a.Dynamics.Joints.b2Joint);B.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;B.b2MouseJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new d;
this.K1=new d;this.K2=new d;this.m_localAnchor=new k;this.m_target=new k;this.m_impulse=new k;this.m_mass=new d;this.m_C=new k};B.prototype.GetAnchorA=function(){return this.m_target};B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};B.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*this.m_impulse.x,a*this.m_impulse.y)};B.prototype.GetReactionTorque=function(){return 0};B.prototype.GetTarget=function(){return this.m_target};B.prototype.SetTarget=
function(a){this.m_bodyB.IsAwake()==!1&&this.m_bodyB.SetAwake(!0);this.m_target=a};B.prototype.GetMaxForce=function(){return this.m_maxForce};B.prototype.SetMaxForce=function(a){a===void 0&&(a=0);this.m_maxForce=a};B.prototype.GetFrequency=function(){return this.m_frequencyHz};B.prototype.SetFrequency=function(a){a===void 0&&(a=0);this.m_frequencyHz=a};B.prototype.GetDampingRatio=function(){return this.m_dampingRatio};B.prototype.SetDampingRatio=function(a){a===void 0&&(a=0);this.m_dampingRatio=a};
B.prototype.b2MouseJoint=function(a){this.__super.b2Joint.call(this,a);this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,d=this.m_target.y-this.m_bodyB.m_xf.position.y,c=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*c.col1.x+d*c.col1.y;this.m_localAnchor.y=b*c.col2.x+d*c.col2.y;this.m_maxForce=a.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_beta=0};B.prototype.InitVelocityConstraints=function(a){var b=
this.m_bodyB,d=b.GetMass(),c=2*Math.PI*this.m_frequencyHz,e=d*c*c;this.m_gamma=a.dt*(2*d*this.m_dampingRatio*c+a.dt*e);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=a.dt*e*this.m_gamma;var e=b.m_xf.R,d=this.m_localAnchor.x-b.m_sweep.localCenter.x,c=this.m_localAnchor.y-b.m_sweep.localCenter.y,j=e.col1.x*d+e.col2.x*c,c=e.col1.y*d+e.col2.y*c,d=j,e=b.m_invMass,j=b.m_invI;this.K1.col1.x=e;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=e;this.K2.col1.x=j*c*c;this.K2.col2.x=-j*d*c;this.K2.col1.y=
-j*d*c;this.K2.col2.y=j*d*d;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=b.m_sweep.c.x+d-this.m_target.x;this.m_C.y=b.m_sweep.c.y+c-this.m_target.y;b.m_angularVelocity*=0.98;this.m_impulse.x*=a.dtRatio;this.m_impulse.y*=a.dtRatio;b.m_linearVelocity.x+=e*this.m_impulse.x;b.m_linearVelocity.y+=e*this.m_impulse.y;b.m_angularVelocity+=j*(d*this.m_impulse.y-c*this.m_impulse.x)};B.prototype.SolveVelocityConstraints=
function(a){var b=this.m_bodyB,d,c=0,e=0;d=b.m_xf.R;var j=this.m_localAnchor.x-b.m_sweep.localCenter.x,g=this.m_localAnchor.y-b.m_sweep.localCenter.y,c=d.col1.x*j+d.col2.x*g,g=d.col1.y*j+d.col2.y*g,j=c,c=b.m_linearVelocity.x+-b.m_angularVelocity*g,f=b.m_linearVelocity.y+b.m_angularVelocity*j;d=this.m_mass;c=c+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;e=f+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;f=-(d.col1.x*c+d.col2.x*e);e=-(d.col1.y*c+d.col2.y*e);d=this.m_impulse.x;c=this.m_impulse.y;
this.m_impulse.x+=f;this.m_impulse.y+=e;a=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length());f=this.m_impulse.x-d;e=this.m_impulse.y-c;b.m_linearVelocity.x+=b.m_invMass*f;b.m_linearVelocity.y+=b.m_invMass*e;b.m_angularVelocity+=b.m_invI*(j*e-g*f)};B.prototype.SolvePositionConstraints=function(){return!0};a.inherit(D,a.Dynamics.Joints.b2JointDef);D.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;D.b2MouseJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.target=new k};D.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};a.inherit(G,a.Dynamics.Joints.b2Joint);G.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;G.b2PrismaticJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_localXAxis1=new k;this.m_localYAxis1=new k;this.m_axis=new k;this.m_perp=new k;
this.m_K=new c;this.m_impulse=new h};G.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};G.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};G.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};G.prototype.GetReactionTorque=function(a){a===
void 0&&(a=0);return a*this.m_impulse.y};G.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,d=a.GetWorldPoint(this.m_localAnchor1),c=b.GetWorldPoint(this.m_localAnchor2),b=c.x-d.x,d=c.y-d.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*d};G.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,d;d=a.m_xf.R;var c=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,j=d.col1.x*c+d.col2.x*e,e=d.col1.y*c+d.col2.y*
e,c=j;d=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,f=this.m_localAnchor2.y-b.m_sweep.localCenter.y,j=d.col1.x*g+d.col2.x*f,f=d.col1.y*g+d.col2.y*f,g=j;d=b.m_sweep.c.x+g-(a.m_sweep.c.x+c);var j=b.m_sweep.c.y+f-(a.m_sweep.c.y+e),n=a.GetWorldVector(this.m_localXAxis1),h=a.m_linearVelocity,l=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return d*-a*n.y+j*a*n.x+(n.x*(l.x+-b*f-h.x- -a*e)+n.y*(l.y+b*g-h.y-a*c))};G.prototype.IsLimitEnabled=function(){return this.m_enableLimit};
G.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};G.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};G.prototype.GetUpperLimit=function(){return this.m_upperTranslation};G.prototype.SetLimits=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};G.prototype.IsMotorEnabled=function(){return this.m_enableMotor};G.prototype.EnableMotor=
function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};G.prototype.SetMotorSpeed=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};G.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};G.prototype.SetMaxMotorForce=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};G.prototype.GetMotorForce=function(){return this.m_motorImpulse};G.prototype.b2PrismaticJoint=
function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;
this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=x.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};G.prototype.InitVelocityConstraints=function(a){var d=this.m_bodyA,c=this.m_bodyB,e,j=0;this.m_localCenterA.SetV(d.GetLocalCenter());this.m_localCenterB.SetV(c.GetLocalCenter());var h=d.GetTransform();c.GetTransform();e=d.m_xf.R;var g=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y,j=e.col1.x*g+e.col2.x*f,f=e.col1.y*
g+e.col2.y*f,g=j;e=c.m_xf.R;var n=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y,j=e.col1.x*n+e.col2.x*l,l=e.col1.y*n+e.col2.y*l,n=j;e=c.m_sweep.c.x+n-d.m_sweep.c.x-g;j=c.m_sweep.c.y+l-d.m_sweep.c.y-f;this.m_invMassA=d.m_invMass;this.m_invMassB=c.m_invMass;this.m_invIA=d.m_invI;this.m_invIB=c.m_invI;this.m_axis.SetV(o.MulMV(h.R,this.m_localXAxis1));this.m_a1=(e+g)*this.m_axis.y-(j+f)*this.m_axis.x;this.m_a2=n*this.m_axis.y-l*this.m_axis.x;this.m_motorMass=
this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass;this.m_perp.SetV(o.MulMV(h.R,this.m_localYAxis1));this.m_s1=(e+g)*this.m_perp.y-(j+f)*this.m_perp.x;this.m_s2=n*this.m_perp.y-l*this.m_perp.x;h=this.m_invMassA;g=this.m_invMassB;f=this.m_invIA;n=this.m_invIB;this.m_K.col1.x=h+g+f*this.m_s1*this.m_s1+n*this.m_s2*this.m_s2;this.m_K.col1.y=f*this.m_s1+n*this.m_s2;this.m_K.col1.z=f*
this.m_s1*this.m_a1+n*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=f+n;this.m_K.col2.z=f*this.m_a1+n*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=h+g+f*this.m_a1*this.m_a1+n*this.m_a2*this.m_a2;if(this.m_enableLimit)if(e=this.m_axis.x*e+this.m_axis.y*j,o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop)this.m_limitState=x.e_equalLimits;else if(e<=this.m_lowerTranslation){if(this.m_limitState!=x.e_atLowerLimit)this.m_limitState=
x.e_atLowerLimit,this.m_impulse.z=0}else if(e>=this.m_upperTranslation){if(this.m_limitState!=x.e_atUpperLimit)this.m_limitState=x.e_atUpperLimit,this.m_impulse.z=0}else this.m_limitState=x.e_inactiveLimit,this.m_impulse.z=0;else this.m_limitState=x.e_inactiveLimit;if(this.m_enableMotor==!1)this.m_motorImpulse=0;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,
e=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,j=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,h=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,d.m_linearVelocity.x-=this.m_invMassA*a,d.m_linearVelocity.y-=this.m_invMassA*e,d.m_angularVelocity-=this.m_invIA*j,c.m_linearVelocity.x+=this.m_invMassB*a,c.m_linearVelocity.y+=this.m_invMassB*e,c.m_angularVelocity+=this.m_invIB*
h):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};G.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,d=this.m_bodyB,c=b.m_linearVelocity,e=b.m_angularVelocity,j=d.m_linearVelocity,g=d.m_angularVelocity,f=0,n=0,l=0,t=0;if(this.m_enableMotor&&this.m_limitState!=x.e_equalLimits)t=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(j.x-c.x)+this.m_axis.y*(j.y-c.y)+this.m_a2*g-this.m_a1*e)),f=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=o.Clamp(this.m_motorImpulse+
t,-a,a),t=this.m_motorImpulse-f,f=t*this.m_axis.x,n=t*this.m_axis.y,l=t*this.m_a1,t*=this.m_a2,c.x-=this.m_invMassA*f,c.y-=this.m_invMassA*n,e-=this.m_invIA*l,j.x+=this.m_invMassB*f,j.y+=this.m_invMassB*n,g+=this.m_invIB*t;l=this.m_perp.x*(j.x-c.x)+this.m_perp.y*(j.y-c.y)+this.m_s2*g-this.m_s1*e;n=g-e;if(this.m_enableLimit&&this.m_limitState!=x.e_inactiveLimit){a=this.m_axis.x*(j.x-c.x)+this.m_axis.y*(j.y-c.y)+this.m_a2*g-this.m_a1*e;f=this.m_impulse.Copy();a=this.m_K.Solve33(new h,-l,-n,-a);this.m_impulse.Add(a);
if(this.m_limitState==x.e_atLowerLimit)this.m_impulse.z=o.Max(this.m_impulse.z,0);else if(this.m_limitState==x.e_atUpperLimit)this.m_impulse.z=o.Min(this.m_impulse.z,0);l=-l-(this.m_impulse.z-f.z)*this.m_K.col3.x;n=-n-(this.m_impulse.z-f.z)*this.m_K.col3.y;n=this.m_K.Solve22(new k,l,n);n.x+=f.x;n.y+=f.y;this.m_impulse.x=n.x;this.m_impulse.y=n.y;a.x=this.m_impulse.x-f.x;a.y=this.m_impulse.y-f.y;a.z=this.m_impulse.z-f.z;f=a.x*this.m_perp.x+a.z*this.m_axis.x;n=a.x*this.m_perp.y+a.z*this.m_axis.y;l=a.x*
this.m_s1+a.y+a.z*this.m_a1;t=a.x*this.m_s2+a.y+a.z*this.m_a2}else a=this.m_K.Solve22(new k,-l,-n),this.m_impulse.x+=a.x,this.m_impulse.y+=a.y,f=a.x*this.m_perp.x,n=a.x*this.m_perp.y,l=a.x*this.m_s1+a.y,t=a.x*this.m_s2+a.y;c.x-=this.m_invMassA*f;c.y-=this.m_invMassA*n;e-=this.m_invIA*l;j.x+=this.m_invMassB*f;j.y+=this.m_invMassB*n;g+=this.m_invIB*t;b.m_linearVelocity.SetV(c);b.m_angularVelocity=e;d.m_linearVelocity.SetV(j);d.m_angularVelocity=g};G.prototype.SolvePositionConstraints=function(){var a=
this.m_bodyA,c=this.m_bodyB,e=a.m_sweep.c,j=a.m_sweep.a,l=c.m_sweep.c,t=c.m_sweep.a,g,f=0,n=0,w=0,p=f=g=0,x=0,n=!1,y=0,B=d.FromAngle(j),C=d.FromAngle(t);g=B;var x=this.m_localAnchor1.x-this.m_localCenterA.x,v=this.m_localAnchor1.y-this.m_localCenterA.y,f=g.col1.x*x+g.col2.x*v,v=g.col1.y*x+g.col2.y*v,x=f;g=C;C=this.m_localAnchor2.x-this.m_localCenterB.x;w=this.m_localAnchor2.y-this.m_localCenterB.y;f=g.col1.x*C+g.col2.x*w;w=g.col1.y*C+g.col2.y*w;C=f;g=l.x+C-e.x-x;f=l.y+w-e.y-v;if(this.m_enableLimit){this.m_axis=
o.MulMV(B,this.m_localXAxis1);this.m_a1=(g+x)*this.m_axis.y-(f+v)*this.m_axis.x;this.m_a2=C*this.m_axis.y-w*this.m_axis.x;var L=this.m_axis.x*g+this.m_axis.y*f;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop?(y=o.Clamp(L,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection),p=o.Abs(L),n=!0):L<=this.m_lowerTranslation?(y=o.Clamp(L-this.m_lowerTranslation+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),p=this.m_lowerTranslation-L,n=!0):L>=this.m_upperTranslation&&(y=o.Clamp(L-this.m_upperTranslation+
b.b2_linearSlop,0,b.b2_maxLinearCorrection),p=L-this.m_upperTranslation,n=!0)}this.m_perp=o.MulMV(B,this.m_localYAxis1);this.m_s1=(g+x)*this.m_perp.y-(f+v)*this.m_perp.x;this.m_s2=C*this.m_perp.y-w*this.m_perp.x;B=new h;v=this.m_perp.x*g+this.m_perp.y*f;C=t-j-this.m_refAngle;p=o.Max(p,o.Abs(v));x=o.Abs(C);n?(n=this.m_invMassA,w=this.m_invMassB,g=this.m_invIA,f=this.m_invIB,this.m_K.col1.x=n+w+g*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=g*this.m_s1+f*this.m_s2,this.m_K.col1.z=g*this.m_s1*
this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=g+f,this.m_K.col2.z=g*this.m_a1+f*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=n+w+g*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_K.Solve33(B,-v,-C,-y)):(n=this.m_invMassA,w=this.m_invMassB,g=this.m_invIA,f=this.m_invIB,y=g*this.m_s1+f*this.m_s2,L=g+f,this.m_K.col1.Set(n+w+g*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,y,0),this.m_K.col2.Set(y,L,0),y=this.m_K.Solve22(new k,
-v,-C),B.x=y.x,B.y=y.y,B.z=0);y=B.x*this.m_perp.x+B.z*this.m_axis.x;n=B.x*this.m_perp.y+B.z*this.m_axis.y;v=B.x*this.m_s1+B.y+B.z*this.m_a1;B=B.x*this.m_s2+B.y+B.z*this.m_a2;e.x-=this.m_invMassA*y;e.y-=this.m_invMassA*n;j-=this.m_invIA*v;l.x+=this.m_invMassB*y;l.y+=this.m_invMassB*n;t+=this.m_invIB*B;a.m_sweep.a=j;c.m_sweep.a=t;a.SynchronizeTransform();c.SynchronizeTransform();return p<=b.b2_linearSlop&&x<=b.b2_angularSlop};a.inherit(N,a.Dynamics.Joints.b2JointDef);N.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;
N.b2PrismaticJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new k;this.localAnchorB=new k;this.localAxisA=new k};N.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};N.prototype.Initialize=function(a,b,d,c){this.bodyA=a;this.bodyB=
b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.localAxisA=this.bodyA.GetLocalVector(c);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};a.inherit(E,a.Dynamics.Joints.b2Joint);E.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;E.b2PulleyJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new k;this.m_groundAnchor2=new k;this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_u1=new k;
this.m_u2=new k};E.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};E.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};E.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)};E.prototype.GetReactionTorque=function(){return 0};E.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor1);return a};E.prototype.GetGroundAnchorB=
function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor2);return a};E.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(b*b+a*a)};E.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+
this.m_groundAnchor2.y);return Math.sqrt(b*b+a*a)};E.prototype.GetRatio=function(){return this.m_ratio};E.prototype.b2PulleyJoint=function(a){this.__super.b2Joint.call(this,a);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y;
this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_ratio=a.ratio;this.m_constant=a.lengthA+this.m_ratio*a.lengthB;this.m_maxLength1=o.Min(a.maxLengthA,this.m_constant-this.m_ratio*E.b2_minPulleyLength);this.m_maxLength2=o.Min(a.maxLengthB,(this.m_constant-E.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};E.prototype.InitVelocityConstraints=function(a){var d=this.m_bodyA,c=this.m_bodyB,e;e=d.m_xf.R;var j=this.m_localAnchor1.x-
d.m_sweep.localCenter.x,h=this.m_localAnchor1.y-d.m_sweep.localCenter.y,g=e.col1.x*j+e.col2.x*h,h=e.col1.y*j+e.col2.y*h,j=g;e=c.m_xf.R;var f=this.m_localAnchor2.x-c.m_sweep.localCenter.x,n=this.m_localAnchor2.y-c.m_sweep.localCenter.y,g=e.col1.x*f+e.col2.x*n,n=e.col1.y*f+e.col2.y*n,f=g;e=c.m_sweep.c.x+f;var g=c.m_sweep.c.y+n,l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(d.m_sweep.c.x+j-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),
d.m_sweep.c.y+h-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(e-l,g-o);e=this.m_u1.Length();g=this.m_u2.Length();e>b.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero();g>b.b2_linearSlop?this.m_u2.Multiply(1/g):this.m_u2.SetZero();this.m_constant-e-this.m_ratio*g>0?(this.m_state=x.e_inactiveLimit,this.m_impulse=0):this.m_state=x.e_atUpperLimit;e<this.m_maxLength1?(this.m_limitState1=x.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=x.e_atUpperLimit;g<this.m_maxLength2?
(this.m_limitState2=x.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=x.e_atUpperLimit;e=j*this.m_u1.y-h*this.m_u1.x;g=f*this.m_u2.y-n*this.m_u2.x;this.m_limitMass1=d.m_invMass+d.m_invI*e*e;this.m_limitMass2=c.m_invMass+c.m_invI*g*g;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;a.warmStarting?(this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=
a.dtRatio,this.m_limitImpulse2*=a.dtRatio,a=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,e=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,g=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,l=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,d.m_linearVelocity.x+=d.m_invMass*a,d.m_linearVelocity.y+=d.m_invMass*e,d.m_angularVelocity+=d.m_invI*(j*e-h*a),c.m_linearVelocity.x+=c.m_invMass*g,c.m_linearVelocity.y+=c.m_invMass*l,c.m_angularVelocity+=c.m_invI*(f*l-n*
g)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};E.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,d;d=a.m_xf.R;var c=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,j=d.col1.x*c+d.col2.x*e,e=d.col1.y*c+d.col2.y*e,c=j;d=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,f=this.m_localAnchor2.y-b.m_sweep.localCenter.y,j=d.col1.x*g+d.col2.x*f,f=d.col1.y*g+d.col2.y*f,g=j,n=j=d=0,h=0;d=h=d=h=n=j=d=0;
if(this.m_state==x.e_atUpperLimit)d=a.m_linearVelocity.x+-a.m_angularVelocity*e,j=a.m_linearVelocity.y+a.m_angularVelocity*c,n=b.m_linearVelocity.x+-b.m_angularVelocity*f,h=b.m_linearVelocity.y+b.m_angularVelocity*g,d=-(this.m_u1.x*d+this.m_u1.y*j)-this.m_ratio*(this.m_u2.x*n+this.m_u2.y*h),h=this.m_pulleyMass*-d,d=this.m_impulse,this.m_impulse=o.Max(0,this.m_impulse+h),h=this.m_impulse-d,d=-h*this.m_u1.x,j=-h*this.m_u1.y,n=-this.m_ratio*h*this.m_u2.x,h=-this.m_ratio*h*this.m_u2.y,a.m_linearVelocity.x+=
a.m_invMass*d,a.m_linearVelocity.y+=a.m_invMass*j,a.m_angularVelocity+=a.m_invI*(c*j-e*d),b.m_linearVelocity.x+=b.m_invMass*n,b.m_linearVelocity.y+=b.m_invMass*h,b.m_angularVelocity+=b.m_invI*(g*h-f*n);if(this.m_limitState1==x.e_atUpperLimit)d=a.m_linearVelocity.x+-a.m_angularVelocity*e,j=a.m_linearVelocity.y+a.m_angularVelocity*c,d=-(this.m_u1.x*d+this.m_u1.y*j),h=-this.m_limitMass1*d,d=this.m_limitImpulse1,this.m_limitImpulse1=o.Max(0,this.m_limitImpulse1+h),h=this.m_limitImpulse1-d,d=-h*this.m_u1.x,
j=-h*this.m_u1.y,a.m_linearVelocity.x+=a.m_invMass*d,a.m_linearVelocity.y+=a.m_invMass*j,a.m_angularVelocity+=a.m_invI*(c*j-e*d);if(this.m_limitState2==x.e_atUpperLimit)n=b.m_linearVelocity.x+-b.m_angularVelocity*f,h=b.m_linearVelocity.y+b.m_angularVelocity*g,d=-(this.m_u2.x*n+this.m_u2.y*h),h=-this.m_limitMass2*d,d=this.m_limitImpulse2,this.m_limitImpulse2=o.Max(0,this.m_limitImpulse2+h),h=this.m_limitImpulse2-d,n=-h*this.m_u2.x,h=-h*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*n,b.m_linearVelocity.y+=
b.m_invMass*h,b.m_angularVelocity+=b.m_invI*(g*h-f*n)};E.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,d=this.m_bodyB,c,e=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,j=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,h=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,g=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,f=0,n=0,l=0,k=0,t=c=0,p=0,u=0,y=t=u=c=t=c=0;if(this.m_state==x.e_atUpperLimit)c=a.m_xf.R,f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,n=this.m_localAnchor1.y-
a.m_sweep.localCenter.y,t=c.col1.x*f+c.col2.x*n,n=c.col1.y*f+c.col2.y*n,f=t,c=d.m_xf.R,l=this.m_localAnchor2.x-d.m_sweep.localCenter.x,k=this.m_localAnchor2.y-d.m_sweep.localCenter.y,t=c.col1.x*l+c.col2.x*k,k=c.col1.y*l+c.col2.y*k,l=t,c=a.m_sweep.c.x+f,t=a.m_sweep.c.y+n,p=d.m_sweep.c.x+l,u=d.m_sweep.c.y+k,this.m_u1.Set(c-e,t-j),this.m_u2.Set(p-h,u-g),c=this.m_u1.Length(),t=this.m_u2.Length(),c>b.b2_linearSlop?this.m_u1.Multiply(1/c):this.m_u1.SetZero(),t>b.b2_linearSlop?this.m_u2.Multiply(1/t):this.m_u2.SetZero(),
c=this.m_constant-c-this.m_ratio*t,y=o.Max(y,-c),c=o.Clamp(c+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),u=-this.m_pulleyMass*c,c=-u*this.m_u1.x,t=-u*this.m_u1.y,p=-this.m_ratio*u*this.m_u2.x,u=-this.m_ratio*u*this.m_u2.y,a.m_sweep.c.x+=a.m_invMass*c,a.m_sweep.c.y+=a.m_invMass*t,a.m_sweep.a+=a.m_invI*(f*t-n*c),d.m_sweep.c.x+=d.m_invMass*p,d.m_sweep.c.y+=d.m_invMass*u,d.m_sweep.a+=d.m_invI*(l*u-k*p),a.SynchronizeTransform(),d.SynchronizeTransform();if(this.m_limitState1==x.e_atUpperLimit)c=a.m_xf.R,
f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,n=this.m_localAnchor1.y-a.m_sweep.localCenter.y,t=c.col1.x*f+c.col2.x*n,n=c.col1.y*f+c.col2.y*n,f=t,c=a.m_sweep.c.x+f,t=a.m_sweep.c.y+n,this.m_u1.Set(c-e,t-j),c=this.m_u1.Length(),c>b.b2_linearSlop?(this.m_u1.x*=1/c,this.m_u1.y*=1/c):this.m_u1.SetZero(),c=this.m_maxLength1-c,y=o.Max(y,-c),c=o.Clamp(c+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),u=-this.m_limitMass1*c,c=-u*this.m_u1.x,t=-u*this.m_u1.y,a.m_sweep.c.x+=a.m_invMass*c,a.m_sweep.c.y+=a.m_invMass*
t,a.m_sweep.a+=a.m_invI*(f*t-n*c),a.SynchronizeTransform();if(this.m_limitState2==x.e_atUpperLimit)c=d.m_xf.R,l=this.m_localAnchor2.x-d.m_sweep.localCenter.x,k=this.m_localAnchor2.y-d.m_sweep.localCenter.y,t=c.col1.x*l+c.col2.x*k,k=c.col1.y*l+c.col2.y*k,l=t,p=d.m_sweep.c.x+l,u=d.m_sweep.c.y+k,this.m_u2.Set(p-h,u-g),t=this.m_u2.Length(),t>b.b2_linearSlop?(this.m_u2.x*=1/t,this.m_u2.y*=1/t):this.m_u2.SetZero(),c=this.m_maxLength2-t,y=o.Max(y,-c),c=o.Clamp(c+b.b2_linearSlop,-b.b2_maxLinearCorrection,
0),u=-this.m_limitMass2*c,p=-u*this.m_u2.x,u=-u*this.m_u2.y,d.m_sweep.c.x+=d.m_invMass*p,d.m_sweep.c.y+=d.m_invMass*u,d.m_sweep.a+=d.m_invI*(l*u-k*p),d.SynchronizeTransform();return y<b.b2_linearSlop};a.postDefs.push(function(){a.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});a.inherit(S,a.Dynamics.Joints.b2JointDef);S.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;S.b2PulleyJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new k;
this.groundAnchorB=new k;this.localAnchorA=new k;this.localAnchorB=new k};S.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};S.prototype.Initialize=function(a,b,d,c,e,j,g){g===void 0&&(g=0);this.bodyA=a;this.bodyB=b;this.groundAnchorA.SetV(d);
this.groundAnchorB.SetV(c);this.localAnchorA=this.bodyA.GetLocalPoint(e);this.localAnchorB=this.bodyB.GetLocalPoint(j);a=e.x-d.x;d=e.y-d.y;this.lengthA=Math.sqrt(a*a+d*d);d=j.x-c.x;c=j.y-c.y;this.lengthB=Math.sqrt(d*d+c*c);this.ratio=g;g=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=g-this.ratio*E.b2_minPulleyLength;this.maxLengthB=(g-E.b2_minPulleyLength)/this.ratio};a.inherit(F,a.Dynamics.Joints.b2Joint);F.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;F.b2RevoluteJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.K=new d;this.K1=new d;this.K2=new d;this.K3=new d;this.impulse3=new h;this.impulse2=new k;this.reduced=new k;this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_impulse=new h;this.m_mass=new c};F.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};F.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};F.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*this.m_impulse.x,a*this.m_impulse.y)};
F.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);return a*this.m_impulse.z};F.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};F.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};F.prototype.IsLimitEnabled=function(){return this.m_enableLimit};F.prototype.EnableLimit=function(a){this.m_enableLimit=a};F.prototype.GetLowerLimit=function(){return this.m_lowerAngle};F.prototype.GetUpperLimit=
function(){return this.m_upperAngle};F.prototype.SetLimits=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.m_lowerAngle=a;this.m_upperAngle=b};F.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};F.prototype.EnableMotor=function(a){this.m_enableMotor=a};F.prototype.SetMotorSpeed=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};F.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};
F.prototype.SetMaxMotorTorque=function(a){a===void 0&&(a=0);this.m_maxMotorTorque=a};F.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};F.prototype.b2RevoluteJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=
a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=x.e_inactiveLimit};F.prototype.InitVelocityConstraints=function(a){var d=this.m_bodyA,c=this.m_bodyB,e,j=0;e=d.m_xf.R;var h=this.m_localAnchor1.x-d.m_sweep.localCenter.x,g=this.m_localAnchor1.y-d.m_sweep.localCenter.y,j=e.col1.x*h+e.col2.x*g,g=e.col1.y*h+e.col2.y*g,h=j;e=c.m_xf.R;var f=this.m_localAnchor2.x-c.m_sweep.localCenter.x,n=this.m_localAnchor2.y-c.m_sweep.localCenter.y,j=e.col1.x*f+e.col2.x*n,
n=e.col1.y*f+e.col2.y*n,f=j;e=d.m_invMass;var j=c.m_invMass,l=d.m_invI,k=c.m_invI;this.m_mass.col1.x=e+j+g*g*l+n*n*k;this.m_mass.col2.x=-g*h*l-n*f*k;this.m_mass.col3.x=-g*l-n*k;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=e+j+h*h*l+f*f*k;this.m_mass.col3.y=h*l+f*k;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=l+k;this.m_motorMass=1/(l+k);if(this.m_enableMotor==!1)this.m_motorImpulse=0;if(this.m_enableLimit){var t=c.m_sweep.a-d.m_sweep.a-
this.m_referenceAngle;if(o.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b.b2_angularSlop)this.m_limitState=x.e_equalLimits;else if(t<=this.m_lowerAngle){if(this.m_limitState!=x.e_atLowerLimit)this.m_impulse.z=0;this.m_limitState=x.e_atLowerLimit}else if(t>=this.m_upperAngle){if(this.m_limitState!=x.e_atUpperLimit)this.m_impulse.z=0;this.m_limitState=x.e_atUpperLimit}else this.m_limitState=x.e_inactiveLimit,this.m_impulse.z=0}else this.m_limitState=x.e_inactiveLimit;a.warmStarting?(this.m_impulse.x*=
a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x,t=this.m_impulse.y,d.m_linearVelocity.x-=e*a,d.m_linearVelocity.y-=e*t,d.m_angularVelocity-=l*(h*t-g*a+this.m_motorImpulse+this.m_impulse.z),c.m_linearVelocity.x+=j*a,c.m_linearVelocity.y+=j*t,c.m_angularVelocity+=k*(f*t-n*a+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};F.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,d=this.m_bodyB,c=0,e=c=0,j=0,g=
0,f=0,n=b.m_linearVelocity,h=b.m_angularVelocity,l=d.m_linearVelocity,k=d.m_angularVelocity,t=b.m_invMass,p=d.m_invMass,u=b.m_invI,y=d.m_invI;if(this.m_enableMotor&&this.m_limitState!=x.e_equalLimits)e=this.m_motorMass*-(k-h-this.m_motorSpeed),j=this.m_motorImpulse,g=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=o.Clamp(this.m_motorImpulse+e,-g,g),e=this.m_motorImpulse-j,h-=u*e,k+=y*e;if(this.m_enableLimit&&this.m_limitState!=x.e_inactiveLimit){var a=b.m_xf.R,e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,
j=this.m_localAnchor1.y-b.m_sweep.localCenter.y,c=a.col1.x*e+a.col2.x*j,j=a.col1.y*e+a.col2.y*j,e=c,a=d.m_xf.R,g=this.m_localAnchor2.x-d.m_sweep.localCenter.x,f=this.m_localAnchor2.y-d.m_sweep.localCenter.y,c=a.col1.x*g+a.col2.x*f,f=a.col1.y*g+a.col2.y*f,g=c,a=l.x+-k*f-n.x- -h*j,B=l.y+k*g-n.y-h*e;this.m_mass.Solve33(this.impulse3,-a,-B,-(k-h));if(this.m_limitState==x.e_equalLimits)this.m_impulse.Add(this.impulse3);else if(this.m_limitState==x.e_atLowerLimit){if(c=this.m_impulse.z+this.impulse3.z,
c<0)this.m_mass.Solve22(this.reduced,-a,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0}else if(this.m_limitState==x.e_atUpperLimit&&(c=this.m_impulse.z+this.impulse3.z,c>0))this.m_mass.Solve22(this.reduced,-a,-B),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,
this.m_impulse.z=0;n.x-=t*this.impulse3.x;n.y-=t*this.impulse3.y;h-=u*(e*this.impulse3.y-j*this.impulse3.x+this.impulse3.z);l.x+=p*this.impulse3.x;l.y+=p*this.impulse3.y;k+=y*(g*this.impulse3.y-f*this.impulse3.x+this.impulse3.z)}else a=b.m_xf.R,e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,j=this.m_localAnchor1.y-b.m_sweep.localCenter.y,c=a.col1.x*e+a.col2.x*j,j=a.col1.y*e+a.col2.y*j,e=c,a=d.m_xf.R,g=this.m_localAnchor2.x-d.m_sweep.localCenter.x,f=this.m_localAnchor2.y-d.m_sweep.localCenter.y,c=
a.col1.x*g+a.col2.x*f,f=a.col1.y*g+a.col2.y*f,g=c,this.m_mass.Solve22(this.impulse2,-(l.x+-k*f-n.x- -h*j),-(l.y+k*g-n.y-h*e)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,n.x-=t*this.impulse2.x,n.y-=t*this.impulse2.y,h-=u*(e*this.impulse2.y-j*this.impulse2.x),l.x+=p*this.impulse2.x,l.y+=p*this.impulse2.y,k+=y*(g*this.impulse2.y-f*this.impulse2.x);b.m_linearVelocity.SetV(n);b.m_angularVelocity=h;d.m_linearVelocity.SetV(l);d.m_angularVelocity=k};F.prototype.SolvePositionConstraints=
function(){var a=0,d,c=this.m_bodyA,e=this.m_bodyB,j=0,h=d=0,g=0,f=0;if(this.m_enableLimit&&this.m_limitState!=x.e_inactiveLimit){var a=e.m_sweep.a-c.m_sweep.a-this.m_referenceAngle,n=0;this.m_limitState==x.e_equalLimits?(a=o.Clamp(a-this.m_lowerAngle,-b.b2_maxAngularCorrection,b.b2_maxAngularCorrection),n=-this.m_motorMass*a,j=o.Abs(a)):this.m_limitState==x.e_atLowerLimit?(a-=this.m_lowerAngle,j=-a,a=o.Clamp(a+b.b2_angularSlop,-b.b2_maxAngularCorrection,0),n=-this.m_motorMass*a):this.m_limitState==
x.e_atUpperLimit&&(a-=this.m_upperAngle,j=a,a=o.Clamp(a-b.b2_angularSlop,0,b.b2_maxAngularCorrection),n=-this.m_motorMass*a);c.m_sweep.a-=c.m_invI*n;e.m_sweep.a+=e.m_invI*n;c.SynchronizeTransform();e.SynchronizeTransform()}d=c.m_xf.R;n=this.m_localAnchor1.x-c.m_sweep.localCenter.x;a=this.m_localAnchor1.y-c.m_sweep.localCenter.y;h=d.col1.x*n+d.col2.x*a;a=d.col1.y*n+d.col2.y*a;n=h;d=e.m_xf.R;var l=this.m_localAnchor2.x-e.m_sweep.localCenter.x,k=this.m_localAnchor2.y-e.m_sweep.localCenter.y,h=d.col1.x*
l+d.col2.x*k,k=d.col1.y*l+d.col2.y*k,l=h,g=e.m_sweep.c.x+l-c.m_sweep.c.x-n,f=e.m_sweep.c.y+k-c.m_sweep.c.y-a,t=g*g+f*f;d=Math.sqrt(t);var h=c.m_invMass,p=e.m_invMass,u=c.m_invI,y=e.m_invI,B=10*b.b2_linearSlop;t>B*B&&(t=1/(h+p),g=t*-g,f=t*-f,c.m_sweep.c.x-=0.5*h*g,c.m_sweep.c.y-=0.5*h*f,e.m_sweep.c.x+=0.5*p*g,e.m_sweep.c.y+=0.5*p*f,g=e.m_sweep.c.x+l-c.m_sweep.c.x-n,f=e.m_sweep.c.y+k-c.m_sweep.c.y-a);this.K1.col1.x=h+p;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=h+p;this.K2.col1.x=u*a*a;this.K2.col2.x=
-u*n*a;this.K2.col1.y=-u*n*a;this.K2.col2.y=u*n*n;this.K3.col1.x=y*k*k;this.K3.col2.x=-y*l*k;this.K3.col1.y=-y*l*k;this.K3.col2.y=y*l*l;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(F.tImpulse,-g,-f);g=F.tImpulse.x;f=F.tImpulse.y;c.m_sweep.c.x-=c.m_invMass*g;c.m_sweep.c.y-=c.m_invMass*f;c.m_sweep.a-=c.m_invI*(n*f-a*g);e.m_sweep.c.x+=e.m_invMass*g;e.m_sweep.c.y+=e.m_invMass*f;e.m_sweep.a+=e.m_invI*(l*f-k*g);c.SynchronizeTransform();e.SynchronizeTransform();return d<=b.b2_linearSlop&&
j<=b.b2_angularSlop};a.postDefs.push(function(){a.Dynamics.Joints.b2RevoluteJoint.tImpulse=new k});a.inherit(I,a.Dynamics.Joints.b2JointDef);I.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;I.b2RevoluteJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new k;this.localAnchorB=new k};I.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);
this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};I.prototype.Initialize=function(a,b,d){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(d);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};a.inherit(T,a.Dynamics.Joints.b2Joint);T.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;T.b2WeldJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_localAnchorA=new k;this.m_localAnchorB=new k;this.m_impulse=new h;this.m_mass=new c};T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};T.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new k(a*this.m_impulse.x,a*this.m_impulse.y)};T.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);return a*this.m_impulse.z};T.prototype.b2WeldJoint=
function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_mass=new c};T.prototype.InitVelocityConstraints=function(a){var b,d=0,c=this.m_bodyA,e=this.m_bodyB;b=c.m_xf.R;var j=this.m_localAnchorA.x-c.m_sweep.localCenter.x,g=this.m_localAnchorA.y-c.m_sweep.localCenter.y,d=b.col1.x*j+b.col2.x*g,g=b.col1.y*j+b.col2.y*g,j=d;b=e.m_xf.R;var f=this.m_localAnchorB.x-
e.m_sweep.localCenter.x,n=this.m_localAnchorB.y-e.m_sweep.localCenter.y,d=b.col1.x*f+b.col2.x*n,n=b.col1.y*f+b.col2.y*n,f=d;b=c.m_invMass;var d=e.m_invMass,h=c.m_invI,l=e.m_invI;this.m_mass.col1.x=b+d+g*g*h+n*n*l;this.m_mass.col2.x=-g*j*h-n*f*l;this.m_mass.col3.x=-g*h-n*l;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+d+j*j*h+f*f*l;this.m_mass.col3.y=j*h+f*l;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=h+l;a.warmStarting?(this.m_impulse.x*=
a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,c.m_linearVelocity.x-=b*this.m_impulse.x,c.m_linearVelocity.y-=b*this.m_impulse.y,c.m_angularVelocity-=h*(j*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=d*this.m_impulse.x,e.m_linearVelocity.y+=d*this.m_impulse.y,e.m_angularVelocity+=l*(f*this.m_impulse.y-n*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};T.prototype.SolveVelocityConstraints=function(){var a,b=0,d=this.m_bodyA,c=this.m_bodyB,
e=d.m_linearVelocity,j=d.m_angularVelocity,g=c.m_linearVelocity,f=c.m_angularVelocity,n=d.m_invMass,l=c.m_invMass,o=d.m_invI,k=c.m_invI;a=d.m_xf.R;var t=this.m_localAnchorA.x-d.m_sweep.localCenter.x,r=this.m_localAnchorA.y-d.m_sweep.localCenter.y,b=a.col1.x*t+a.col2.x*r,r=a.col1.y*t+a.col2.y*r,t=b;a=c.m_xf.R;var p=this.m_localAnchorB.x-c.m_sweep.localCenter.x,u=this.m_localAnchorB.y-c.m_sweep.localCenter.y,b=a.col1.x*p+a.col2.x*u,u=a.col1.y*p+a.col2.y*u,p=b;a=g.x-f*u-e.x+j*r;var b=g.y+f*p-e.y-j*t,
y=f-j,x=new h;this.m_mass.Solve33(x,-a,-b,-y);this.m_impulse.Add(x);e.x-=n*x.x;e.y-=n*x.y;j-=o*(t*x.y-r*x.x+x.z);g.x+=l*x.x;g.y+=l*x.y;f+=k*(p*x.y-u*x.x+x.z);d.m_angularVelocity=j;c.m_angularVelocity=f};T.prototype.SolvePositionConstraints=function(){var a,d=0,c=this.m_bodyA,e=this.m_bodyB;a=c.m_xf.R;var j=this.m_localAnchorA.x-c.m_sweep.localCenter.x,l=this.m_localAnchorA.y-c.m_sweep.localCenter.y,d=a.col1.x*j+a.col2.x*l,l=a.col1.y*j+a.col2.y*l,j=d;a=e.m_xf.R;var g=this.m_localAnchorB.x-e.m_sweep.localCenter.x,
f=this.m_localAnchorB.y-e.m_sweep.localCenter.y,d=a.col1.x*g+a.col2.x*f,f=a.col1.y*g+a.col2.y*f,g=d;a=c.m_invMass;var d=e.m_invMass,n=c.m_invI,k=e.m_invI,t=e.m_sweep.c.x+g-c.m_sweep.c.x-j,p=e.m_sweep.c.y+f-c.m_sweep.c.y-l,u=e.m_sweep.a-c.m_sweep.a-this.m_referenceAngle,y=10*b.b2_linearSlop,x=Math.sqrt(t*t+p*p),B=o.Abs(u);x>y&&(n*=1,k*=1);this.m_mass.col1.x=a+d+l*l*n+f*f*k;this.m_mass.col2.x=-l*j*n-f*g*k;this.m_mass.col3.x=-l*n-f*k;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=a+d+j*j*n+
g*g*k;this.m_mass.col3.y=j*n+g*k;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=n+k;y=new h;this.m_mass.Solve33(y,-t,-p,-u);c.m_sweep.c.x-=a*y.x;c.m_sweep.c.y-=a*y.y;c.m_sweep.a-=n*(j*y.y-l*y.x+y.z);e.m_sweep.c.x+=d*y.x;e.m_sweep.c.y+=d*y.y;e.m_sweep.a+=k*(g*y.y-f*y.x+y.z);c.SynchronizeTransform();e.SynchronizeTransform();return x<=b.b2_linearSlop&&B<=b.b2_angularSlop};a.inherit(M,a.Dynamics.Joints.b2JointDef);M.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;
M.b2WeldJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new k;this.localAnchorB=new k};M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=x.e_weldJoint;this.referenceAngle=0};M.prototype.Initialize=function(a,b,d){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(d));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var b=
a.Dynamics.b2DebugDraw;b.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var a=this;this.m_sprite={graphics:{clear:function(){a.m_ctx.clearRect(0,0,a.m_ctx.canvas.width,a.m_ctx.canvas.height)}}}};b.prototype._color=function(a,b){return"rgba("+((a&16711680)>>16)+","+((a&65280)>>8)+","+(a&255)+","+b+")"};b.prototype.b2DebugDraw=function(){this.m_drawFlags=0};b.prototype.SetFlags=function(a){a===void 0&&(a=0);this.m_drawFlags=a};b.prototype.GetFlags=
function(){return this.m_drawFlags};b.prototype.AppendFlags=function(a){a===void 0&&(a=0);this.m_drawFlags|=a};b.prototype.ClearFlags=function(a){a===void 0&&(a=0);this.m_drawFlags&=~a};b.prototype.SetSprite=function(a){this.m_ctx=a};b.prototype.GetSprite=function(){return this.m_ctx};b.prototype.SetDrawScale=function(a){a===void 0&&(a=0);this.m_drawScale=a};b.prototype.GetDrawScale=function(){return this.m_drawScale};b.prototype.SetLineThickness=function(a){a===void 0&&(a=0);this.m_lineThickness=
a;this.m_ctx.strokeWidth=a};b.prototype.GetLineThickness=function(){return this.m_lineThickness};b.prototype.SetAlpha=function(a){a===void 0&&(a=0);this.m_alpha=a};b.prototype.GetAlpha=function(){return this.m_alpha};b.prototype.SetFillAlpha=function(a){a===void 0&&(a=0);this.m_fillAlpha=a};b.prototype.GetFillAlpha=function(){return this.m_fillAlpha};b.prototype.SetXFormScale=function(a){a===void 0&&(a=0);this.m_xformScale=a};b.prototype.GetXFormScale=function(){return this.m_xformScale};b.prototype.DrawPolygon=
function(a,b,c){if(b){var k=this.m_ctx,h=this.m_drawScale;k.beginPath();k.strokeStyle=this._color(c.color,this.m_alpha);k.moveTo(a[0].x*h,a[0].y*h);for(c=1;c<b;c++)k.lineTo(a[c].x*h,a[c].y*h);k.lineTo(a[0].x*h,a[0].y*h);k.closePath();k.stroke()}};b.prototype.DrawSolidPolygon=function(a,b,c){if(b){var k=this.m_ctx,h=this.m_drawScale;k.beginPath();k.strokeStyle=this._color(c.color,this.m_alpha);k.fillStyle=this._color(c.color,this.m_fillAlpha);k.moveTo(a[0].x*h,a[0].y*h);for(c=1;c<b;c++)k.lineTo(a[c].x*
h,a[c].y*h);k.lineTo(a[0].x*h,a[0].y*h);k.closePath();k.fill();k.stroke()}};b.prototype.DrawCircle=function(a,b,c){if(b){var k=this.m_ctx,h=this.m_drawScale;k.beginPath();k.strokeStyle=this._color(c.color,this.m_alpha);k.arc(a.x*h,a.y*h,b*h,0,Math.PI*2,!0);k.closePath();k.stroke()}};b.prototype.DrawSolidCircle=function(a,b,c,k){if(b){var h=this.m_ctx,o=this.m_drawScale,e=a.x*o,t=a.y*o;h.moveTo(0,0);h.beginPath();h.strokeStyle=this._color(k.color,this.m_alpha);h.fillStyle=this._color(k.color,this.m_fillAlpha);
h.arc(e,t,b*o,0,Math.PI*2,!0);h.moveTo(e,t);h.lineTo((a.x+c.x*b)*o,(a.y+c.y*b)*o);h.closePath();h.fill();h.stroke()}};b.prototype.DrawSegment=function(a,b,c){var k=this.m_ctx,h=this.m_drawScale;k.strokeStyle=this._color(c.color,this.m_alpha);k.beginPath();k.moveTo(a.x*h,a.y*h);k.lineTo(b.x*h,b.y*h);k.closePath();k.stroke()};b.prototype.DrawTransform=function(a){var b=this.m_ctx,c=this.m_drawScale;b.beginPath();b.strokeStyle=this._color(16711680,this.m_alpha);b.moveTo(a.position.x*c,a.position.y*c);
b.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*c,(a.position.y+this.m_xformScale*a.R.col1.y)*c);b.strokeStyle=this._color(65280,this.m_alpha);b.moveTo(a.position.x*c,a.position.y*c);b.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*c,(a.position.y+this.m_xformScale*a.R.col2.y)*c);b.closePath();b.stroke()}})();var o;for(o=0;o<a.postDefs.length;++o)a.postDefs[o]();delete a.postDefs;c.Box2D=a;c.b2AABB=a.Collision.b2AABB;c.b2Vec2=a.Common.Math.b2Vec2;c.b2BodyDef=a.Dynamics.b2BodyDef;c.b2Body=
a.Dynamics.b2Body;c.b2FixtureDef=a.Dynamics.b2FixtureDef;c.b2Fixture=a.Dynamics.b2Fixture;c.b2World=a.Dynamics.b2World;c.b2MassData=a.Collision.Shapes.b2MassData;c.b2PolygonShape=a.Collision.Shapes.b2PolygonShape;c.b2CircleShape=a.Collision.Shapes.b2CircleShape;c.b2DebugDraw=a.Dynamics.b2DebugDraw;c.b2RevoluteJointDef=a.Dynamics.Joints.b2RevoluteJointDef;c.b2PrismaticJointDef=a.Dynamics.Joints.b2PrismaticJointDef;c.b2Transform=a.Common.Math.b2Transform;c.b2WorldManifold=a.Collision.b2WorldManifold}},
[]);
require.define({cars:function(v,c){var a=v("gamejs"),p=v("./box2d"),k=v("./utils");v("./sounds");var o=v("./car_descriptions"),b=k.vec,d=k.arr,l=a.utils.vectors,r=a.utils.math;radians=r.radians;degrees=r.degrees;v("./animation");var u=c.STEER_NONE=0,h=c.STEER_RIGHT=1,y=c.STEER_LEFT=2,e=c.ACC_NONE=0,t=c.ACC_ACCELERATE=1,L=c.ACC_BRAKE=2,H=c.Wheel=function(a){this.x=a.x;this.y=a.y;this.position=[a.x,a.y];this.angle=0;this.car=a.car;this.length=a.length;this.width=a.width;this.revolving=revolving=a.revolving;
this.k_velocity=this.joint=this.body=null;this.world=this.car.world;this.alive=!0;this.respawn_location=null;this.respawn_angle=0;this.powered=a.powered;this.filename=a.filename;this.type="wheel";a=new p.b2BodyDef;a.type=p.b2Body.b2_dynamicBody;a.position=this.car.body.GetWorldPoint(b([this.position[0],this.position[1]]));a.angle=this.car.body.GetAngle();this.body=this.world.CreateBody(a);this.body.SetUserData(this);a=new p.b2FixtureDef;a.density=1;a.isSensor=!0;a.shape=new p.b2PolygonShape;a.shape.SetAsBox(this.width/
2,this.length/2);this.body.CreateFixture(a);this.revolving?(a=new p.b2RevoluteJointDef,a.Initialize(this.car.body,this.body,this.body.GetWorldCenter()),a.enableMotor=!1,a.referenceAngle=0):(a=new p.b2PrismaticJointDef,a.Initialize(this.car.body,this.body,this.body.GetWorldCenter(),b([1,0])),a.enableLimit=!0,a.lowerTranslation=a.upperTranslation=a.referenceAngle=0);this.world.b2world.CreateJoint(a);this.getLocalPosition=function(){return this.position};this.resetAngle=function(){this.body.SetAngle(this.car.body.GetAngle())};
this.setAngle=function(a){this.body.SetAngle(this.car.body.GetAngle()+radians(a))};this.getWorldPosition=function(){return d(this.car.body.GetWorldPoint(b(this.position)))};this.draw=function(a){a.drawCar(this.filename,d(this.car.body.GetWorldPoint(b([this.x,this.y]))),degrees(this.body.GetAngle()))};this.getLocalVelocity=function(){return d(this.car.body.GetLocalVector(this.car.body.GetLinearVelocityFromLocalPoint(b(this.position))))};this.getDirectionVector=function(){return l.rotate(this.getLocalVelocity()[1]>
0?[0,1]:[0,-1],this.body.GetAngle())};this.getSidewaysVector=function(){return d(this.body.GetWorldVector(b([-1,0])))};this.getKillVelocityVector=function(){var a=d(this.body.GetLinearVelocity()),b=this.getDirectionVector(),a=l.dot(a,b);return l.multiply(b,a)};this.killSidewaysVelocity=function(){var a=this.getKillVelocityVector();this.k_velocity=a;this.body.SetLinearVelocity(b(a))};this.die=function(){this.alive=!1;this.body.SetLinearVelocity(b(0,0))};this.respawn=function(){this.alive=!0};this.teleport=
function(a){this.body.SetPosition(b(a))};this.getAngle=function(){return degrees(this.body.GetAngle())};this.getLocalAngle=function(){var a=r.normaliseDegrees(r.degrees(this.body.GetAngle()-this.car.body.GetAngle()));a>180&&(a-=360);return a};return this};c.Car=function(a){this.angle=a.angle?a.angle:0;this.world=a.world;this.position=a.position;this.width=a.width;this.height=a.height;this.filename=a.filename;this.alias=a.alias?a.alias:"";this.type="car";this.car_type=a.type;this.descr=o[this.car_type];
this.health=this.max_health=a.health+a.armor_upgrades*this.descr.armor_upgrade;this.active=this.alive=!0;this.next_checkpoint_no=1;this.time_to_respawn=this.lap=0;this.respawn_position=null;this.respawn_angle=0;this.respawn_time=2E3;this.deaths=this.kills=0;this.hits=[];this.front_weapon=a.front_weapon;this.rear_weapon=a.rear_weapon;this.util=a.util;if(this.front_weapon)this.front_weapon.car=this;if(this.rear_weapon)this.rear_weapon.car=this;if(this.util)this.util.car=this;this.fire_util=this.fire_rear_weapon=
this.fire_front_weapon=!1;this.accelerate=e;this.steer=u;this.max_steer_angle=a.max_steer_angle;this.power=a.power+a.acc_upgrades*this.descr.power_upgrade;this.max_speed=a.max_speed+a.speed_upgrades*this.descr.speed_upgrade;this.turn_msec=a.turn_msec?a.turn_msec:200;this.mod_speed=0;this.local_engine_pos=[0,-(a.height/2)];this.smoke_cd=this.cur_wheel_angle=0;var c=new p.b2BodyDef;c.type=p.b2Body.b2_dynamicBody;c.position=b(a.position[0],a.position[1]);c.angle=radians(a.angle+1.0E-5);c.linearDamping=
0.15;c.angularDamping=0.3;this.body=this.world.CreateBody(c);this.body.SetUserData(this);c=new p.b2FixtureDef;c.density=1;c.friction=0.3;c.restitution=0.4;c.shape=new p.b2PolygonShape;var r=this.width/2,v=this.height/2;c.shape.SetAsArray([b(r,v),b(-r,v),b(-r,-v),b(0,-v-0.5),b(r,-v)]);this.body.CreateFixture(c);this.wheels=[];var Q;a.wheels.forEach(function(a){a.car=this;this.wheels.push(new H(a))},this);this.impact=function(a){a.type=="car"&&this.world.playSound("thud.wav",d(this.body.GetPosition()))};
this.getLocalVelocity=function(){return d(this.body.GetLocalVector(this.body.GetLinearVelocityFromLocalPoint(b([0,0]))))};this.crossFinishLine=function(){this.front_weapon&&this.front_weapon.reload();this.rear_weapon&&this.rear_weapon.reload();this.util&&this.util.reload()};this.updateCheckpoint=function(){var a=this.world.checkpoints[this.next_checkpoint_no],b=this.body.GetPosition();if(b.x>=a.pt1[0]&&b.x<=a.pt2[0]&&b.y>=a.pt1[1]&&b.y<=a.pt2[1])this.next_checkpoint_no==1&&(this.lap++,this.crossFinishLine()),
this.next_checkpoint_no==this.world.max_checkpoint?this.next_checkpoint_no=1:this.next_checkpoint_no++};this.getRacePosition=function(){var a=this.world.objects.car.length,b,c;for(b=0;b<this.world.objects.car.length;b++)c=this.world.objects.car[b],c!==this&&(this.lap>c.lap?a--:this.lap==c.lap&&(this.next_checkpoint_no>c.next_checkpoint_no||this.next_checkpoint_no==1&&c.next_checkpoint_no!=1)?a--:this.lap==c.lap&&this.next_checkpoint_no==c.next_checkpoint_no&&l.distance(d(this.alive?this.body.GetPosition():
this.respawn_location),this.world.checkpoints[this.next_checkpoint_no].center)<l.distance(d(c.alive?c.body.GetPosition():c.respawn_location),this.world.checkpoints[c.next_checkpoint_no].center)&&a--);return a};this.getPoweredWheels=function(){var a=[];this.wheels.forEach(function(b){b.powered&&a.push(b)});return a};this.getRevolvingWheels=function(){var a=[];this.wheels.forEach(function(b){b.revolving&&a.push(b)});return a};this.getDirectionVector=function(){return l.rotate([0,-1],this.front_left_wheel.body.GetAngle())};
this.getBackwardDirectionVector=function(){return l.rotate([0,1],this.back_left_wheel.body.GetAngle())};this.getState=function(){var a={p:d(this.body.GetPosition()),a:degrees(this.body.GetAngle()),lv:d(this.body.GetLinearVelocity()),l:this.lap,nc:this.next_checkpoint_no,ac:this.active,h:this.health,al:this.alive,w:[],wf:this.front_weapon?this.front_weapon.getState():0,wr:this.rear_weapon?this.rear_weapon.getState():0,wu:this.util?this.util.getState():0};this.wheels.forEach(function(b){a.w.push(degrees(b.body.GetAngle()))});
if(!this.alive)a.rl=this.respawn_location;return a};this.interpolate=function(a,b,c){for(var d=[],e=0;e<a.w.length;e++)d[d.length]=k.interpolateInts(a.w[e],b.w[e],c);var b={p:k.interpolatePoints(a.p,b.p,c),a:k.interpolateInts(a.a,b.a,c),w:d},h;for(h in a)b.hasOwnProperty(h)||(b[h]=a[h]);return b};this.setState=function(a){this.health=a.h;this.alive=a.al;this.lap=a.l;this.active=a.ac;this.next_checkpoint_no=a.nc;this.body.SetPositionAndAngle(b(a.p),radians(a.a));this.body.SetLinearVelocity(b(a.lv));
for(var c,e=0;e<this.wheels.length;e++)c=this.wheels[e],c.teleport(d(this.body.GetWorldPoint(b(c.position)))),c.body.SetPositionAndAngle(c.body.GetPosition(),radians(a.w[e]));if(a.rl)this.respawn_location=a.rl;this.front_weapon&&a.wf&&this.front_weapon.setState(a.wf);this.rear_weapon&&a.wr&&this.rear_weapon.setState(a.wr);this.util&&a.wu&&this.util.setState(wu)};this.getSpeedKMH=function(){var a=d(this.body.GetLinearVelocity());return l.len(a)/1E3*3600};this.getAngle=function(){return degrees(this.body.GetAngle())};
this.setSpeed=function(a){var c=d(this.body.GetLinearVelocity()),c=b(l.multiply(l.unit(c),a*1E3/3600));this.body.SetLinearVelocity(c)};this.draw=function(a){if(this.alive&&this.active){this.wheels.forEach(function(b){b.draw(a)});var b=d(this.body.GetPosition());a.drawCar(this.filename,b,this.getAngle());this.alias&&this.world.mode==1&&a.drawText(this.alias,"alias",a.getScreenPoint([b[0]-this.width,b[1]-this.height]))}};this.teleport=function(a,c){c=c?radians(c):this.body.GetAngle();this.body.SetPositionAndAngle(b(a),
c);this.wheels.forEach(function(a){a.teleport(d(this.body.GetWorldPoint(b(a.position))))},this)};this.die=function(){this.alive=!1;this.deaths+=1;this.time_to_respawn=this.respawn_time;this.respawn_location=d(this.body.GetPosition());this.world.spawnAnimation("explosion",d(this.body.GetPosition()));this.world.playSound("explosion.wav",d(this.body.GetPosition()));this.respawn_angle=degrees(this.body.GetAngle());this.teleport([0,0]);this.body.SetLinearVelocity(b(0,0));this.wheels.forEach(function(a){a.die()})};
this.respawn=function(){this.alive=!0;this.wheels.forEach(function(a){a.respawn()});this.teleport(this.respawn_location,this.respawn_angle);this.health=this.max_health};this.kill=function(){this.kills+=1};this.hit=function(a,b){this.hits.push({damage:a,owner:b})};this.processHits=function(){this.hits.forEach(function(a){this.alive&&(this.health-=a.damage,this.health<=0&&(this.die(),a.owner&&a.owner.kill(this)))},this);this.hits=[]};this.update=function(a){this.active&&(this.alive?(this.processHits(),
this.alive&&this.updateAlive(a)):(this.time_to_respawn-=a,this.time_to_respawn<=0&&this.respawn()))};this.updateAlive=function(a){this.updateCheckpoint();var c=this.steer,k=this.accelerate,o=this.getSpeedKMH(),p=(d(this.body.GetLocalVector(this.body.GetLinearVelocity()))[1]>0?0.5*this.max_speed:this.max_speed)+this.mod_speed;this.wheels.forEach(function(a){a.killSidewaysVelocity()});var r=this.max_steer_angle;o<100&&(r+=(40-r)*(1-o/100));var x=this.max_steer_angle/this.turn_msec*a,u=this.getRevolvingWheels();
for(Q=0;Q<u.length;Q++)wheel=u[Q],c==h?(this.cur_wheel_angle=Math.min(Math.max(this.cur_wheel_angle,0)+x,r),wheel.setAngle(this.cur_wheel_angle)):c==y?(this.cur_wheel_angle=Math.max(Math.min(this.cur_wheel_angle,0)-x,-r),wheel.setAngle(this.cur_wheel_angle)):(this.cur_wheel_angle=0,wheel.resetAngle());var c=k==t&&o<p?[0,-1]:k==L?this.getLocalVelocity()[1]<0?[0,1.2]:[0,0.7]:[0,0],v=l.multiply(c,this.power);this.getPoweredWheels().forEach(function(a){var c=a.body.GetWorldCenter();a.body.ApplyForce(a.body.GetWorldVector(b(v)),
c)});this.getSpeedKMH()<4&&k==e&&this.setSpeed(0);this.front_weapon&&(this.front_weapon.update(a),this.fire_front_weapon&&this.front_weapon.fire());this.rear_weapon&&(this.rear_weapon.update(a),this.fire_rear_weapon&&this.rear_weapon.fire());this.util&&(this.util.update(a),this.fire_util&&this.util.fire());this.health<=40?this.smoke_cd<=0?(this.world.spawnAnimation("smoke",d(this.body.GetWorldPoint(b(0,-1.5)))),this.smoke_cd=100):this.smoke_cd-=a:this.smoke_cd=0};return this};c.carEventFromDescription=
function(a,b,c,d,e){return{type:"car",obj_name:c.type,pars:{position:a,angle:b,alias:d,handling_upgrades:c.handling_upgrades?c.handling_upgrades:0,engine_sound:e,acc_upgrades:c.acc_upgrades,speed_upgrades:c.speed_upgrades,armor_upgrades:c.armor_upgrades,front_weapon:c.front_weapon,util:c.util,rear_weapon:c.rear_weapon}}}}},["gamejs","box2d","utils","sounds","car_descriptions","animation"]);
require.define({car_descriptions:function(v,c){c.Bandit={width:1.7,height:3.5,name:"Bandit",filenames:["bandit_yellow.png","bandit_green.png","bandit_blue.png","bandit_red.png"],power:105,max_speed:115,max_steer_angle:17,health:80,power_upgrade:5,speed_upgrade:5,armor_upgrade:10,main_weapon:"Machinegun",wheels:[{x:-0.85,y:-1,width:0.4,length:0.8,revolving:!0,powered:!0,filename:"wheel.png"},{x:0.85,y:-1,width:0.4,length:0.8,revolving:!0,powered:!0,filename:"wheel.png"},{x:-0.85,y:1.1,width:0.4,length:0.8,
revolving:!1,powered:!1,filename:"wheel.png"},{x:0.85,y:1.1,width:0.4,length:0.8,revolving:!1,powered:!1,filename:"wheel.png"}]};c.Racer={width:2,name:"Racer",height:4,filenames:["racer_yellow.png","racer_green.png","racer_blue.png","racer_red.png"],power:90,max_steer_angle:16,max_speed:125,health:100,power_upgrade:5,speed_upgrade:5,armor_upgrade:10,main_weapon:"Machinegun",wheels:[{x:-1,y:-1.2,width:0.4,length:0.8,revolving:!0,powered:!0,filename:"wheel.png"},{x:1,y:-1.2,width:0.4,length:0.8,revolving:!0,
powered:!0,filename:"wheel.png"},{x:-1,y:1.2,width:0.4,length:0.8,revolving:!1,powered:!1,filename:"wheel.png"},{x:1,y:1.2,width:0.4,length:0.8,revolving:!1,powered:!1,filename:"wheel.png"}]};c.Brawler={width:3,height:6,name:"Brawler",filenames:["brawler_yellow.png","brawler_green.png","brawler_blue.png","brawler_red.png"],power:150,max_steer_angle:16,max_speed:120,health:160,power_upgrade:8,speed_upgrade:5,armor_upgrade:10,main_weapon:"MissileLauncher",wheels:[{x:-1.25,y:-2,width:0.6,length:1.2,
revolving:!0,powered:!0,filename:"big_wheel.png"},{x:1.25,y:-2,width:0.6,length:1.2,revolving:!0,powered:!0,filename:"big_wheel.png"},{x:-1.25,y:2.1,width:0.6,length:1.2,revolving:!1,powered:!1,filename:"big_wheel.png"},{x:1.25,y:2.1,width:0.6,length:1.2,revolving:!1,powered:!1,filename:"big_wheel.png"}]}}},[]);
require.define({combatracer:function(v,c){var a=v("gamejs"),p=v("./renderer");v("./utils");v("gamejs/font");v("./levels");var k=v("./resources");v("./weapons");var o=v("./ui"),b=v("./uiscenes"),d=v("./settings"),l=v("./gamescenes"),r=v("./sounds"),u=v("./editor"),h=c.getDefCarDescr=function(){return{type:"Racer",front_weapon:{type:"Machinegun",ammo_upgrades:3,dmg_upgrades:3},util:null,rear_weapon:{type:"MineLauncher",ammo_upgrades:0,dmg_upgrades:0},acc_upgrades:0,speed_upgrades:0,armor_upgrades:0}};
c.getPreloadList=function(){var a=[],b;for(b=0;b<k.cars.length;b++)a[a.length]="images/cars/"+k.cars[b];for(b=0;b<k.tiles.length;b++)a[a.length]="images/tiles/"+k.tiles[b];for(b=0;b<k.props.length;b++)a[a.length]="images/props/"+k.props[b];for(b=0;b<k.animations.length;b++)a[a.length]="images/animations/"+k.animations[b];for(b=0;b<k.statics.length;b++)a[a.length]="images/static/"+k.statics[b];for(b=0;b<k.ui.length;b++)a[a.length]="images/ui/"+k.ui[b];k.decals.forEach(function(b){a.push("images/decals/"+
b)});d.get("SOUND")&&(k.sound_fx.forEach(function(b){a.push("sounds/fx/"+b)}),k.sound_engine.forEach(function(b){a.push("sounds/engine/"+b)}));return a};var y=c.Director=function(b){var c=!1,e=null;this.display=b;this.start=function(a){c=!0;this.replaceScene(a)};this.replaceScene=function(a){e&&e.destroy&&e.destroy();e=a};this.getScene=function(){return e};a.time.fpsCallback(function(d){if(c){if(e.handleEvent){var h=a.event.get(),l;for(l=0;l<h.length;l++)e.handleEvent(h[l])}else a.event.get();e.update&&
e.update(d)}e.draw&&e.draw(b,d)},this,d.get("FPS"));return this},e=c.Communicator=function(b){this.game=b;this.next_transaction_id=1;this.messages=[];this.status="closed";this.queueMessage=function(a,b){this.messages[this.messages.length]=[a,b?b:{}];this.send()};this.send=function(){if(this.status=="open"){for(var a=0;a<this.messages.length;a++){var b={cmd:this.messages[a][0],uid:this.game.player.uid,payload:this.messages[a][1]},b=JSON.stringify(b);this.socket.send(b)}this.messages=[]}else if(this.status==
"closed")this.connect();else throw Error("unknown network status");};this.connect=function(){a.log("Connecting...");this.socket=new WebSocket(d.get("SERVER"));this.status="connecting";var b=this;this.socket.onopen=function(){b.onopen()};this.socket.onmessage=function(a){b.onmessage(a)};this.socket.onclose=function(){b.onclose()};this.socket.onerror=function(){b.onerror()}};this.onopen=function(){a.log("Connection established!");this.status="open";this.send()};this.onmessage=function(a){a=JSON.parse(a.data);
this.game.director.getScene().handleMessage(a.cmd,a.payload)};this.onclose=function(){this.status="closed";console.log(this.error?"socket closed on error ":"socket closed!");this.game.aquainted=!1;this.game.showTitle();this.game.player.uid=null;this.game.title_scene.alert(this.error?"Socket error, connection closed.":"Server closed the connection!");this.error=!1};this.error=!1;this.onerror=function(){this.socket.close();this.error=!0}};c.init=function(){c.game=new t;return c.game};var t=c.Game=function(){this.director=
null;this.cache=p.init();d.get("SOUND")&&r.init();o.init();this.socket=null;this.player={alias:"Guest",uid:null,singleplayer:{balance:1E3,car:h()}};this.communicator=null;this.acquainted=!1;this.getCommunicator=function(){if(!this.communicator)this.communicator=new e(this);return this.communicator};this.start=function(a){this.display=a;this.director=new y(a);this.title_scene=new b.TitleScene(this,this.cache);this.director.start(this.title_scene)};this.showEndGameScene=function(a){this.director.replaceScene(new b.EndRaceScene(this,
this.cache,a))};this.showTitle=function(){this.director.replaceScene(this.title_scene)};this.createLobby=function(){this.director.replaceScene(new b.CreateLobbyScene(this,this.cache))};this.showLobbyList=function(){this.director.replaceScene(new b.JoinLobbyScene(this,this.cache))};this.returnTo=function(){if(this.return_to)if(this.return_to=="editor"){this.return_to="";this.showEditor();return}else if(this.return_to=="singleplayer"){this.return_to="";this.singleplayer();return}this.showTitle()};this.showGameOver=
function(a,c){this.director.replaceScene(new b.GameOverScene(a,c))};this.showEditor=function(){if(!this.editor_scene)this.editor_scene=new u.EditorScene;this.director.replaceScene(this.editor_scene)};this.joinLobby=function(a){this.director.replaceScene(new b.LobbyScene(this,this.cache,a))};this.singleplayer=function(){this.director.replaceScene(new b.SinglePlayerScene(this,this.cache))};this.playMultiplayer=function(a){this.level_scene=new l.MultiplayerLevelScene(this,a,this.cache);this.director.replaceScene(this.level_scene)};
this.playLevel=function(a,c,d,e){this.level_scene=new l.SingleplayerLevelScene(a,c);this.return_to=e;d?this.director.replaceScene(new b.ControlsSplash(this,this.cache,this.level_scene)):this.director.replaceScene(this.level_scene)}}}},["gamejs","renderer","utils","gamejs/font","levels","resources","weapons","ui","uiscenes","settings","gamescenes","sounds","editor"]);
require.define({controllers:function(v,c){var a=v("gamejs"),p=v("gamejs/utils/vectors"),k=v("./utils"),o=k.vec,b=k.arr,p=a.utils.vectors,k=a.utils.math;radians=k.radians;degrees=k.degrees;var d=c.STEER_NONE=0,l=c.STEER_RIGHT=1,r=c.STEER_LEFT=2,u=c.ACC_NONE=0,h=c.ACC_ACCELERATE=1,y=c.ACC_BRAKE=2;c.AIController=function(a,c,k){a.max_steer_angle*=1.1;a.turn_msec=50;this.scene=k;this.car=a;this.world=c;this.cur_wp=1;this.stationary=0;this.update=function(c,k){if(this.car.alive){this.car.accelerate=h;
var t=this.world.ai_waypoints[this.cur_wp],y=this.world.ai_waypoints[this.cur_wp<this.world.max_waypoint?this.cur_wp+1:1],u=this.car.getSpeedKMH(),v=this.scene.player_car.getRacePosition(),j=this.car.getRacePosition();v<j?a.mod_speed<10&&(a.mod_speed+=5*(k/1E3)):v>j&&a.mod_speed>-20&&(a.mod_speed-=5*(k/1E3));if(u<6)if(this.car.alive){if(this.stationary+=k,this.stationary>3E3)this.car.teleport([t.x,t.y]),this.stationary=0}else this.stationary=0;else this.stationary=0;v=b(this.car.body.GetPosition());
u=b(this.car.body.GetLocalPoint(o(t.x,t.y)));t=p.distance(v,[t.x,t.y]);p.distance(v,[y.x,y.y]);y=degrees(p.angle([0,-1],u));if(t<10||u.y>0&&t<35)this.cur_wp<this.world.max_waypoint?this.cur_wp++:this.cur_wp=1;this.car.steer=y>10?u[0]>0?l:r:d;if(this.car.front_weapon&&(this.car.front_weapon.type=="machinegun"||this.car.front_weapon.type=="missilelauncher")){this.car.fire_front_weapon=!1;for(u=0;u<this.world.objects.car.length;u++)if(y=this.world.objects.car[u],y!=this.car&&(t=p.distance(b(this.car.body.GetPosition()),
b(y.body.GetPosition())),y=degrees(p.angle([0,-1],b(this.car.body.GetLocalPoint(y.body.GetPosition())))),t<50&&y<15)){this.car.fire_front_weapon=!0;break}}}};return this};c.MultiplayerController=function(){this.bindings={accelerate:a.event.K_UP,brake:a.event.K_DOWN,steer_left:a.event.K_LEFT,steer_right:a.event.K_RIGHT,fire_front_weapon:a.event.K_x,fire_rear_weapon:a.event.K_c,fire_util:a.event.K_v};this.actions={accelerate:u,steer:d,fire_front_weapon:!1,fire_rear_weapon:!1,fire_util:!1};this.update=
function(a){var b=!1,c,k,o,p;c=a[this.bindings.accelerate]?h:a[this.bindings.brake]?y:u;k=a[this.bindings.steer_right]?l:a[this.bindings.steer_left]?r:d;o=a[this.bindings.fire_front_weapon]?!0:!1;p=a[this.bindings.fire_rear_weapon]?!0:!1;a=a[this.bindings.util]?!0:!1;if(c!==this.actions.accelerate)this.actions.accelerate=c,b=!0;if(k!==this.actions.steer)this.actions.steer=k,b=!0;if(o!==this.actions.fire_front_weapon)this.actions.fire_front_weapon=o,b=!0;if(p!==this.actions.fire_rear_weapon)this.actions.fire_rear_weapon=
p,b=!0;if(a!==this.actions.fire_util)this.actions.fire_util=a,b=!0;return b};return this};c.PlayerCarController=function(b){this.car=b;this.bindings={accelerate:a.event.K_UP,brake:a.event.K_DOWN,steer_left:a.event.K_LEFT,steer_right:a.event.K_RIGHT,fire_front_weapon:a.event.K_x,fire_rear_weapon:a.event.K_c,fire_util:a.event.K_v};this.update=function(a){if(this.car.alive)this.car.accelerate=a[this.bindings.accelerate]?h:a[this.bindings.brake]?y:u,this.car.steer=a[this.bindings.steer_right]?l:a[this.bindings.steer_left]?
r:d,this.car.fire_front_weapon=a[this.bindings.fire_front_weapon]?!0:!1,this.car.fire_rear_weapon=a[this.bindings.fire_rear_weapon]?!0:!1,this.car.fire_util=a[this.bindings.fire_util]?!0:!1};return this}}},["gamejs","gamejs/utils/vectors","utils"]);
require.define({editor:function(v,c){function a(a){return[Math.floor(a[0]/6)*6,Math.floor(a[1]/6)*6]}function p(a){var b=[];a.start_positions.length<6&&b.push("All six starting positions must be placed.");a.ai_waypoints.length<2&&b.push("At least two AI waypoints must be placed.");a.checkpoints.length<2&&b.push("At least two checkpoints must be placed.");a.title||b.push("Level must have a title.");console.log(b);return b}function k(a){function b(a){d[a]==void 0&&(d[a]=g,c.dict[g]=a,g++);return d[a]}
var c=J([2500,2500]);c.size=a.size;c.bgtile=a.bgtile;c.title=a.title;c.dict={};var d={},g=1;a.props.forEach(function(a){c.props.push({p:a.position,f:b(a.original.filename),a:a.angle})});a.decals.forEach(function(a){c.decals.push({p:a.position,f:b(a.original.filename),a:a.angle})});a.ai_waypoints.forEach(function(a){c.ai_waypoints.push({p:a.position,n:a.number})});a.checkpoints.forEach(function(a){c.checkpoints.push({p:a.position,n:a.number})});a.start_positions.forEach(function(a){c.start_positions.push({p:a.position,
n:a.number,a:a.angle})});return c}function o(a,b){for(var c=0;c<b.length;c++)if(b[c].instance_id==a.instance_id){b.splice(c,1);break}}function b(a){a.text="On";a.size=[100,40];b.superConstructor.apply(this,[a]);this.layer=a.layer;this.scene=a.scene;this.is_on=!0;this.onClick(this.onclick,this)}function d(a){a.size=[220,300];d.superConstructor.apply(this,[a]);this.scene=a.scene;this.playbtn=new r.Button({parent:this,text:"Play",size:[180,40],lean:"both",position:[20,20]});this.playbtn.onClick(function(){this.close();
var a=p(this.scene.level);a.length?this.scene.alert(a[0]):u.game.playLevel(k(this.scene.level),!1,!1,"editor")},this);this.testaibtn=new r.Button({parent:this,text:"Test AI",size:[180,40],lean:"both",position:[20,70]});this.testaibtn.onClick(function(){this.close();var a=p(this.scene.level);a.length?this.scene.alert(a[0]):u.game.playLevel(k(this.scene.level),!0,!1,"editor")},this);this.cancelbtn=new r.Button({parent:this,text:"Cancel",size:[180,40],lean:"both",position:[20,120]});this.cancelbtn.onClick(function(){this.close()},
this)}var l=v("./gamejs-gui"),r=v("./ui"),u=v("./combatracer");v("./settings");var h=v("gamejs"),y=v("./renderer"),e=v("./resources"),t=v("./skin"),L=[280,280],H=1,C=["decalinstance","propinstance","checkpointinstance","startpositioninstance","aiwaypointinstance"],J=function(a){return{size:a,title:"New track",bgtile:"sand.png",props:[],decals:[],ai_waypoints:[],checkpoints:[],start_positions:[]}};ToolViewSelectItem=c.ToolViewSelectItem=function(a){a.size=[200,22];this.what=a.what;ToolViewSelectItem.superConstructor.apply(this,
[a]);this.label=new l.Label({position:[0,0],parent:this,font:r.getFont(t.track_selector.item_font),text:a.text});this.center(this.label);this.label.move([this.size[0]-this.label.size[0]-16,this.label.position[1]]);this.selected=!1;this.on(l.EVT_MOUSE_DOWN,this.select,this)};h.utils.objects.extend(ToolViewSelectItem,l.View);ToolViewSelectItem.prototype.select=function(){this.selected=!0;this.refresh();this.despatchEvent({type:"select",what:this.what})};ToolViewSelectItem.prototype.deselect=function(){this.selected=
!1;this.refresh()};ToolViewSelectItem.prototype.paint=function(){this.surface.fill(this.selected?t.track_selector.front_color:this.isHovered()?t.track_selector.item_hover_color:t.track_selector.back_color)};var x=c.ToolView=function(a){x.superConstructor.apply(this,[a]);this.scene=a.scene;this.scw=new l.ScrollableView({parent:this,size:[this.size[0],this.size[1]-20],position:[0,0]});this.scw.setHorizontalScrollbar(new l.HorizontalScrollbar({parent:this,size:[this.size[0],20],position:[0,this.size[1]-
20]}))};h.utils.objects.extend(x,l.View);var O=c.DecalView=function(a){O.superConstructor.apply(this,[a]);this.filename_to_decal={};e.decals.forEach(function(a){var b=new z({filename:a,size:[100,100],position:[0,3],scene:this.scene,parent:this.scw});this.scene.tools.push(b);this.filename_to_decal[a]=b;b.on("select",this.scene.selectTool,this.scene)},this);l.layout.horizontal(this.scw.children,2,2);this.scw.autoSetScrollableArea()};h.utils.objects.extend(O,x);var Q=c.MarkerView=function(a){this.scene=
a.scene;Q.superConstructor.apply(this,[a]);new l.Label({parent:this,font:r.getFont("16_33"),text:"AI Waypoints",position:[20,2]});this.ai_waypoint=new A({parent:this,position:[40,45],size:[40,40],scene:this.scene});this.scene.tools.push(this.ai_waypoint);this.ai_waypoint.on("select",this.scene.selectTool,this.scene);this.ai_waypoint_up=new r.IncrementButton({direction:"up",position:[100,30],size:[40,30],parent:this});this.ai_waypoint_up.onClick(function(){this.setNumber(this.number+1)},this.ai_waypoint);
this.ai_waypoint_down=new r.IncrementButton({direction:"down",position:[100,70],size:[40,30],parent:this});this.ai_waypoint_down.onClick(function(){this.setNumber(this.number-1)},this.ai_waypoint);new l.Label({parent:this,font:r.getFont("16_33"),text:"Checkpoints",position:[150,2]});this.checkpoint=new m({parent:this,position:[170,45],size:[170,40],scene:this.scene});this.scene.tools.push(this.checkpoint);this.checkpoint.on("select",this.scene.selectTool,this.scene);this.checkpoint_up=new r.IncrementButton({direction:"up",
position:[230,30],size:[40,30],parent:this});this.checkpoint_up.onClick(function(){this.setNumber(this.number+1)},this.checkpoint);this.checkpoint_down=new r.IncrementButton({direction:"down",position:[230,70],size:[40,30],parent:this});this.checkpoint_down.onClick(function(){this.setNumber(this.number-1)},this.checkpoint);new l.Label({parent:this,font:r.getFont("16_33"),text:"Start Positions",position:[280,2]});this.start_position=new q({parent:this,position:[300,35],size:[60,60],scene:this.scene});
this.scene.tools.push(this.start_position);this.start_position.on("select",this.scene.selectTool,this.scene);this.start_position_up=new r.IncrementButton({direction:"up",position:[370,30],size:[40,30],parent:this});this.start_position_up.onClick(function(){this.setNumber(this.number+1)},this.start_position);this.start_position_down=new r.IncrementButton({direction:"down",position:[370,70],size:[40,30],parent:this});this.start_position_down.onClick(function(){this.setNumber(this.number-1)},this.start_position)};
h.utils.objects.extend(Q,l.View);var j=c.PropertiesView=function(a){j.superConstructor.apply(this,[a]);this.scene=a.scene;new l.Label({parent:this,font:r.getFont("16_33"),text:"Title",position:[100,2]});this.title=new l.TextInput({parent:this,font:r.getFont("16_33"),text:this.scene.level.title,position:[40,50],size:[180,30]});this.title.on(l.EVT_CHANGE,this.titleChange,this);new l.Label({parent:this,font:r.getFont("16_33"),text:"Width, PX",position:[280,2]});this.widthlbl=new l.Label({parent:this,
font:r.getFont("16_33"),text:String(this.scene.level.size[0]),position:[280,50]});this.width_up_btn=new r.IncrementButton({parent:this,position:[380,20],size:[40,40],direction:"up"});this.width_up_btn.onClick(function(){this.scene.level.size[0]=Math.max(1E3,this.scene.level.size[0]+100);this.scene.resizeLevelView()},this);this.width_down_btn=new r.IncrementButton({parent:this,position:[380,70],size:[40,40],direction:"down"});this.width_down_btn.onClick(function(){this.scene.level.size[0]=Math.max(1E3,
this.scene.level.size[0]-100);this.scene.resizeLevelView()},this);new l.Label({parent:this,font:r.getFont("16_33"),text:"Height, PX",position:[460,2]});this.heightlbl=new l.Label({parent:this,font:r.getFont("16_33"),text:String(this.scene.level.size[1]),position:[460,50]});this.height_up_btn=new r.IncrementButton({parent:this,position:[560,20],size:[40,40],direction:"up"});this.height_up_btn.onClick(function(){this.scene.level.size[1]=Math.max(1E3,this.scene.level.size[1]+100);this.scene.resizeLevelView()},
this);this.height_down_btn=new r.IncrementButton({parent:this,position:[560,70],size:[40,40],direction:"down"});this.height_down_btn.onClick(function(){this.scene.level.size[1]=Math.max(1E3,this.scene.level.size[1]-100);this.scene.resizeLevelView()},this)};h.utils.objects.extend(j,l.View);j.prototype.titleChange=function(a){this.scene.level.title=a.value};var P=c.PropView=function(a){P.superConstructor.apply(this,[a]);this.filename_to_prop={};e.props.forEach(function(a){var b=new K({filename:a,size:[100,
100],position:[0,3],scene:this.scene,parent:this.scw});this.scene.tools.push(b);this.filename_to_prop[a]=b;b.on("select",this.scene.selectTool,this.scene)},this);l.layout.horizontal(this.scw.children,2,2);this.scw.autoSetScrollableArea()};h.utils.objects.extend(P,x);var B=c.LayerView=function(a){B.superConstructor.apply(this,[a]);new l.Label({parent:this.scw,font:r.getFont("16_33"),text:"Decals",position:[10,2]});new b({parent:this.scw,layer:"decals",scene:this.scene,position:[10,50]});new l.Label({parent:this.scw,
font:r.getFont("16_33"),text:"Props",position:[160,2]});new b({parent:this.scw,layer:"props",scene:this.scene,position:[160,50]});new l.Label({parent:this.scw,font:r.getFont("16_33"),text:"AI Waypoints",position:[320,2]});new b({parent:this.scw,layer:"ai_waypoints",scene:this.scene,position:[320,50]});new l.Label({parent:this.scw,font:r.getFont("16_33"),text:"Checkpoints",position:[470,2]});new b({parent:this.scw,layer:"checkpoints",scene:this.scene,position:[470,50]});new l.Label({parent:this.scw,
font:r.getFont("16_33"),text:"Start pos.",position:[620,2]});new b({parent:this.scw,layer:"start_positions",scene:this.scene,position:[620,50]});this.scw.autoSetScrollableArea()};h.utils.objects.extend(B,x);var D=c.BgView=function(a){D.superConstructor.apply(this,[a]);e.tiles.forEach(function(a){new T({filename:a,size:[100,100],position:[0,3],scene:this.scene,parent:this.scw})},this);l.layout.horizontal(this.scw.children,2,2);this.scw.autoSetScrollableArea()};h.utils.objects.extend(D,x);var G=c.Instance=
function(a){G.superConstructor.apply(this,[a]);this.instance_id=H++;this.angle=a.angle;this.original=a.original;this.subtype="instance";this.selected=!1;this.scene=a.scene;this.on(l.EVT_MOUSE_DOWN,this.select,this);this.on("select",this.scene.selectInstance,this.scene)};h.utils.objects.extend(G,l.View);G.prototype.select=function(){if(!this.selected&&!(this.scene.selected&&this.scene.selected.subtype=="tool"))this.selected=!0,this.despatchEvent({type:"select",instance:this}),this.refresh()};G.prototype.move=
function(a){this.selected&&l.View.prototype.move.apply(this,[a])};G.prototype.deselect=function(){this.selected=!1;this.refresh()};G.prototype.paint=function(){this.surface.clear();var a=this.original.getCursorImage(this.angle);this.surface.blit(a,[(this.size[0]-a.getSize()[0])/2,(this.size[1]-a.getSize()[1])/2]);this.selected&&h.draw.rect(this.surface,"#0026FF",new h.Rect([0,0],this.surface.getSize()),6)};var N=function(a){N.superConstructor.apply(this,[a]);l.draggable(this);this.type="checkpointinstance";
this.number=a.number;this.on("select",function(){this.scene.marker_view.checkpoint.setNumber(this.number)},this)};h.utils.objects.extend(N,G);N.prototype.destroy=function(a){a===void 0&&(a=!0);G.prototype.destroy.apply(this,[]);a&&(o(this,this.scene.level.checkpoints),this.scene.level.checkpoints.forEach(function(a){a.number>this.number&&(a.number--,a.refresh())},this))};N.prototype.paint=function(){this.surface.clear();this.surface.blit(this.original.genHugeImage(this.number),[0,0]);this.selected&&
h.draw.rect(this.surface,"#0026FF",new h.Rect([0,0],this.surface.getSize()),6)};var E=function(a){E.superConstructor.apply(this,[a]);l.draggable(this);this.type="startpositioninstance";this.number=a.number;this.on("select",function(){this.scene.marker_view.start_position.setNumber(this.number)},this)};h.utils.objects.extend(E,G);E.prototype.destroy=function(a){a===void 0&&(a=!0);G.prototype.destroy.apply(this,[]);a&&(o(this,this.scene.level.start_positions),this.scene.level.start_positions.forEach(function(a){a.number>
this.number&&(a.number--,a.refresh())},this))};E.prototype.paint=function(){this.surface.clear();this.surface.blit(this.original.genImage(this.number,this.angle),[0,0]);this.selected&&h.draw.rect(this.surface,"#0026FF",new h.Rect([0,0],this.surface.getSize()),6)};var S=function(a){S.superConstructor.apply(this,[a]);l.draggable(this);this.type="aiwaypointinstance";this.number=a.number;this.on("select",function(){this.scene.marker_view.ai_waypoint.setNumber(this.number)},this)};h.utils.objects.extend(S,
G);S.prototype.destroy=function(a){a===void 0&&(a=!0);G.prototype.destroy.apply(this,[]);a&&(o(this,this.scene.level.ai_waypoints),this.scene.level.ai_waypoints.forEach(function(b){b.number==this.number&&(a=!1)},this),a&&this.scene.level.ai_waypoints.forEach(function(a){a.number>this.number&&(a.number--,a.refresh())},this))};S.prototype.paint=function(){this.surface.clear();this.surface.blit(this.original.genImage(this.number),[0,0]);this.selected&&h.draw.rect(this.surface,"#0026FF",new h.Rect([0,
0],this.surface.getSize()),6)};var F=function(a){F.superConstructor.apply(this,[a]);this.type="decalinstance"};h.utils.objects.extend(F,G);F.prototype.destroy=function(){G.prototype.destroy.apply(this,[]);o(this,this.scene.level.decals)};F.prototype.move=function(b){G.prototype.move.apply(this,[a(b)])};var I=function(a){I.superConstructor.apply(this,[a]);l.draggable(this);this.type="propinstance"};h.utils.objects.extend(I,G);I.prototype.destroy=function(){G.prototype.destroy.apply(this,[]);o(this,
this.scene.level.props)};var T=function(a){this.filename=a.filename;a.image=y.cache.getTile(a.filename);T.superConstructor.apply(this,[a]);this.scene=a.scene;this.on(l.EVT_MOUSE_DOWN,this.select,this)};h.utils.objects.extend(T,l.Image);T.prototype.select=function(){this.scene.level.bgtile=this.filename;this.scene.level_view.refresh()};var M=c.Tool=function(a){M.superConstructor.apply(this,[a]);this.selected=!1;this.angle=0;this.rotate_angle=a.rotate_angle;this.on(l.EVT_MOUSE_DOWN,this.select,this);
this.subtype="tool";this.scene=a.scene};h.utils.objects.extend(M,l.Image);M.prototype.select=function(){this.selected=!0;this.despatchEvent({type:"select",tool:this});this.refresh()};M.prototype.rotateLeft=function(){this.angle-=this.rotate_angle;this.angle<0&&(this.angle+=360);this.refresh()};M.prototype.rotateRight=function(){this.angle+=this.rotate_angle;this.angle>=360&&(this.angle-=360);this.refresh()};M.prototype.deselect=function(){this.selected=!1;this.refresh()};M.prototype.paint=function(){l.Image.prototype.paint.apply(this,
[]);this.selected&&h.draw.rect(this.surface,"#0026FF",new h.Rect([0,0],this.surface.getSize()),6)};var m=c.Checkpoint=function(a){a.image=this.genImage(1);a.rotate_angle=0;a.size=[40,40];a.rotate_angle=0;m.superConstructor.apply(this,[a]);this.number=1;this.type="checkpoint"};h.utils.objects.extend(m,M);m.prototype.genImage=function(a){var b=new h.Surface([40,40]),c=r.getFont("editor_checkpoint");h.draw.rect(b,"RGBA(255, 86, 86, 0.2)",new h.Rect([0,0],b.getSize()));c.render(b,String(a),[12,12]);h.draw.rect(b,
"#FF5656",new h.Rect([0,0],b.getSize()),3);return b};m.prototype.genHugeImage=function(a){var b=new h.Surface([280,280]),c=r.getFont("editor_checkpoint");h.draw.rect(b,"RGBA(255, 86, 86, 0.2)",new h.Rect([0,0],b.getSize()));c.render(b,String(a),[130,130]);h.draw.rect(b,"#FF5656",new h.Rect([0,0],b.getSize()),3);return b};m.prototype.getCursorImage=function(){return this.genHugeImage(this.number)};m.prototype.setNumber=function(a){this.number=Math.max(1,a);this.setImage(this.genImage(this.number))};
m.prototype.place=function(a){this.getCursorImage();for(var b,c=0;c<this.scene.level.checkpoints.length;c++)b=this.scene.level.checkpoints[c],b.number==this.number&&b.destroy(!1);this.scene.level.checkpoints.push(new N({parent:this.scene.level_view,size:L,scene:this.scene,angle:0,original:this,number:this.number,position:[a[0]-Math.ceil(L[0]/2),a[1]-Math.ceil(L[0]/2)]}));this.setNumber(this.number+1);this.refresh()};var q=c.StartPosition=function(a){a.image=this.genImage(1);a.rotate_angle=90;q.superConstructor.apply(this,
[a]);this.type="startposition";this.number=1};h.utils.objects.extend(q,M);q.prototype.genImage=function(a,b){var c=new h.Surface([60,60]),d=r.getFont("editor_start_pos"),g=c.getSize()[0],e=c.getSize()[1];h.draw.polygon(c,"#3AFF51",[[10,10],[20,0],[g-20,0],[g-10,10],[g-10,e],[10,e]],3);if(b===void 0)b=this.angle;c=h.transform.rotate(c,b);d.render(c,String(a),[20,20]);return c};q.prototype.getCursorImage=function(){return this.genImage(this.number)};q.prototype.setNumber=function(a){this.number=Math.min(Math.max(1,
a),6);this.setImage(this.genImage(this.number))};q.prototype.place=function(a){this.getCursorImage();for(var b=this.size,c,d=0;d<this.scene.level.start_positions.length;d++)c=this.scene.level.start_positions[d],c.number==this.number&&c.destroy(!1);this.scene.level.start_positions.push(new E({parent:this.scene.level_view,size:b,scene:this.scene,angle:this.angle,original:this,number:this.number,position:[a[0]-Math.ceil(b[0]/2),a[1]-Math.ceil(b[0]/2)]}));this.setNumber(this.number+1);this.refresh()};
var A=c.AIWaypoint=function(a){a.image=this.genImage(1);a.rotate_angle=0;A.superConstructor.apply(this,[a]);l.draggable(this);this.type="aiwaypoint";this.number=1};h.utils.objects.extend(A,M);A.prototype.genImage=function(a){var b=new h.Surface([40,40]);r.getFont("editor_ai_wp").render(b,String(a),[12,12]);h.draw.rect(b,"#0094FF",new h.Rect([0,0],b.getSize()),3);return b};A.prototype.getCursorImage=function(){return this.genImage(this.number)};A.prototype.setNumber=function(a){this.number=Math.max(1,
a);this.setImage(this.genImage(this.number))};A.prototype.place=function(a){for(var b=this.getCursorImage().getSize(),c,d=0;d<this.scene.level.ai_waypoints.length;d++)c=this.scene.level.ai_waypoints[d],c.number>=this.number&&c.number++;this.scene.level.ai_waypoints.push(new S({parent:this.scene.level_view,size:b,scene:this.scene,angle:0,original:this,number:this.number,position:[a[0]-Math.ceil(b[0]/2),a[1]-Math.ceil(b[0]/2)]}));this.setNumber(this.number+1);this.refresh()};var z=c.Decal=function(a){a.image=
y.cache.getDecalSprite(a.filename,0);a.rotate_angle=90;z.superConstructor.apply(this,[a]);this.type="decal";this.filename=a.filename};h.utils.objects.extend(z,M);z.prototype.getCursorImage=function(a){if(a==void 0)a=this.angle;return y.cache.getDecalSprite(this.filename,a)};z.prototype.place=function(b){var c=this.getCursorImage().getSize();this.scene.level.decals.push(new F({parent:this.scene.level_view,size:c,scene:this.scene,angle:this.angle,original:this,position:a([b[0]-Math.ceil(c[0]/2),b[1]-
Math.ceil(c[0]/2)])}))};var K=c.Prop=function(a){a.image=y.cache.getPropSprite(a.filename,0);a.rotate_angle=5;K.superConstructor.apply(this,[a]);this.type="prop";this.filename=a.filename;this.scene=a.scene};h.utils.objects.extend(K,M);K.prototype.getCursorImage=function(a){if(a==void 0)a=this.angle;return y.cache.getPropSprite(this.filename,a)};K.prototype.place=function(a){var b=this.getCursorImage(this.angle).getSize();this.scene.level.props.push(new I({parent:this.scene.level_view,size:b,scene:this.scene,
angle:this.angle,original:this,position:[a[0]-Math.ceil(b[0]/2),a[1]-Math.ceil(b[0]/2)]}))};var R=c.LevelView=function(a){this.scene=a.scene;R.superConstructor.apply(this,[a]);this.mpos=[0,0];this.on(l.EVT_MOUSE_MOTION,function(a){this.mpos=a.pos;this.refresh()},this)};h.utils.objects.extend(R,l.View);R.prototype.paint=function(){for(var a=y.cache.getTile(this.scene.level.bgtile),b=a.getSize(),c=0;c<this.size[0];c+=b[0])for(var d=0;d<this.size[1];d+=b[1])this.surface.blit(a,[c,d])};R.prototype.post_paint=
function(){if(this.isHovered()&&this.scene.selected&&this.scene.selected.subtype=="tool"&&this.scene.selected.getCursorImage){var b=this.scene.selected.getCursorImage(),c=b.getSize(),c=[parseInt(this.mpos[0]-c[0]/2),parseInt(this.mpos[1]-c[1]/2)];this.scene.selected.type=="decal"&&(c=a(c));this.surface.blit(b,c)}};R.prototype.draw=function(){var a=!1;this.children.forEach(function(b){if(b.draw()||this._refresh)a=!0},this);if(this._refresh||a){this.paint();for(var b,c=0;c<C.length;c++)b=C[c],this.children.forEach(function(a){a.type==
b&&a.visible&&this.blitChild(a)},this);this.scene.minimap.image.blit(this.surface,new h.Rect([0,0],this.scene.minimap.image.getSize()),new h.Rect([0,0],this.surface.getSize()));this.scene.minimap.refresh();this.post_paint();this.despatchEvent({type:l.EVT_PAINT,surface:this.surface});a=!0;this._refresh=!1}return a};var g=c.EditorScene=function(){document.getElementById("gjs-canvas").oncontextmenu=new Function("return false");this.gui=new l.GUI(u.game.display);this.gui.on(l.EVT_PAINT,function(){this.surface.clear()},
this.gui);this.alertdialog=new r.Dialog({parent:this.gui,size:[600,150]});this.tools=[];this.minimap=new l.Image({position:[0,0],size:[200,200],parent:this.gui,image:new h.Surface([200,200])});this.saveloadbtn=new r.Button({position:[0,210],size:[190,50],parent:this.gui,text:"Save / Load",lean:"left"});this.saveloadbtn.onClick(function(){this.textarea.value=JSON.stringify(k(this.level));$(this.dialogel).dialog("open")},this);this.playdialog=new d({parent:this.gui,scene:this});this.playbtn=new r.Button({position:[0,
270],size:[190,50],parent:this.gui,text:"Play",lean:"left"});this.playbtn.onClick(function(){this.show()},this.playdialog);this.helpbtn=new r.Button({position:[0,330],size:[190,50],parent:this.gui,text:"Help",lean:"left"});this.helpbtn.onClick(function(){window.open("http://www.banditracer.eu/index.php?page=track-editor-help")},this);this.backbtn=new r.Button({position:[0,390],size:[190,50],parent:this.gui,text:"Back",lean:"left"});this.backbtn.onClick(function(){u.game.showTitle()},this);this.dialog=
new r.Dialog({parent:this.gui,size:[450,150]});this.scw=new l.ScrollableView({parent:this.gui,position:[200,0],size:[this.gui.size[0]-200-20,this.gui.size[1]-150-20]});this.hscrollbar=new l.HorizontalScrollbar({parent:this.gui,position:[200,this.gui.size[1]-150-20],size:[this.gui.size[0]-200-20,20]});this.scw.setHorizontalScrollbar(this.hscrollbar);this.vscrollbar=new l.VerticalScrollbar({parent:this.gui,position:[this.gui.size[0]-20,0],size:[20,this.gui.size[1]-150-20]});this.scw.setVerticalScrollbar(this.vscrollbar);
this.level=J([2500,2500]);this.level_view=new R({parent:this.scw,size:[20,20],scene:this,position:[0,0]});this.decal_view=new O({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.prop_view=new P({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.prop_view.hide();this.marker_view=new Q({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.marker_view.hide();
this.bg_view=new D({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.bg_view.hide();this.layer_view=new B({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.layer_view.hide();this.properties_view=new j({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.properties_view.hide();this.select_decal_view=new ToolViewSelectItem({parent:this.gui,what:"decalView",
position:[0,this.gui.size[1]-150],text:"Decals"});this.select_decal_view.on("select",this.selectView,this);this.select_decal_view.selected=!0;this.select_prop_view=new ToolViewSelectItem({parent:this.gui,what:"propView",position:[0,this.gui.size[1]-150+22],text:"Props"});this.select_prop_view.on("select",this.selectView,this);this.select_marker_view=new ToolViewSelectItem({parent:this.gui,what:"markerView",position:[0,this.gui.size[1]-150+44],text:"Markers"});this.select_marker_view.on("select",this.selectView,
this);this.select_bg_view=new ToolViewSelectItem({parent:this.gui,what:"bgView",position:[0,this.gui.size[1]-150+66],text:"Background"});this.select_bg_view.on("select",this.selectView,this);this.select_properties_view=new ToolViewSelectItem({parent:this.gui,what:"propertiesView",position:[0,this.gui.size[1]-150+88],text:"Properties"});this.select_properties_view.on("select",this.selectView,this);this.select_layer_view=new ToolViewSelectItem({parent:this.gui,what:"layerView",position:[0,this.gui.size[1]-
150+110],text:"Layers"});this.select_layer_view.on("select",this.selectView,this);this.gui.on(l.EVT_MOUSE_WHEEL,this.mouseWheel,this);this.level_view.on(l.EVT_MOUSE_DOWN,this.viewMouseDown,this);this.gui.on(l.EVT_MOUSE_DOWN,this.mouseDown,this);this.level_view.on(l.EVT_KEY_DOWN,this.keyDown,this);this.dialogel=document.getElementById("saveload_dialog");if(!this.dialogel){this.dialogel=document.createElement("div");this.dialogel.id="saveload_dialog";var a=document.createElement("p");a.innerHTML='To save, copy level code below and save it as a text file on your computer or however is convenient. To load, paste level code into textarea below and click "load".';
this.dialogel.appendChild(a);this.textarea=document.createElement("textarea");this.textarea.style.width="400px";this.textarea.style.height="300px";this.dialogel.appendChild(this.textarea);document.body.appendChild(this.dialogel);$(this.dialogel).click(function(a){a.stopPropagation()})}$(this.dialogel).dialog({autoOpen:!1,title:"Save / Load",width:460,buttons:[{text:"New",click:function(){u.game.editor_scene.loadLevel(J([2500,2500]));$(this).dialog("close")}},{text:"Load example",click:function(){u.game.editor_scene.loadExample();
$(this).dialog("close")}},{text:"Load",click:function(){u.game.editor_scene.load();$(this).dialog("close")}},{text:"Close",click:function(){$(this).dialog("close")}}]});$(this.dialogel).scene=this;this.loadLevel(this.level)};g.prototype.selectView=function(a){a.what=="decalView"?this.decal_view.show():(this.decal_view.hide(),this.select_decal_view.deselect());a.what=="propView"?this.prop_view.show():(this.prop_view.hide(),this.select_prop_view.deselect());a.what=="markerView"?this.marker_view.show():
(this.marker_view.hide(),this.select_marker_view.deselect());a.what=="bgView"?this.bg_view.show():(this.bg_view.hide(),this.select_bg_view.deselect());a.what=="propertiesView"?this.properties_view.show():(this.properties_view.hide(),this.select_properties_view.deselect());a.what=="layerView"?this.layer_view.show():(this.layer_view.hide(),this.select_layer_view.deselect())};g.prototype.mouseDown=function(a){if(a.button==2)this.deselectEverything(),this.selected=null};g.prototype.destroyInstance=function(a){a.destroy();
this.deselectEverything(this.instance);if(this.selected.subtype=="instance"&&this.selected.instance_id==a.instance_id)this.selected=null};g.prototype.keyDown=function(a){this.selected&&this.selected.subtype=="instance"&&a.key==46&&this.destroyInstance(this.selected)};g.prototype.viewMouseDown=function(a){a.button==0&&this.selected&&this.selected.place&&this.selected.place(a.pos)};g.prototype.selectTool=function(a){this.deselectEverything(this.selected=a.tool)};g.prototype.deselectEverything=function(a){this.tools.forEach(function(b){(!a||
!(b.type==a.type&&b.filename==a.filename))&&b.deselect()},this);this.level_view.children.forEach(function(b){(!a||b.instance_id!=a.instance_id)&&b.deselect()},this)};g.prototype.selectInstance=function(a){this.deselectEverything(this.selected=a.instance)};g.prototype.mouseWheel=function(a){if(this.selected)if(a.delta<0){if(this.selected.rotateRight)for(var b=0;b<Math.abs(a.delta);b++)this.selected.rotateRight()}else if(a.delta>0&&this.selected.rotateLeft)for(b=0;b<Math.abs(a.delta);b++)this.selected.rotateLeft()};
g.prototype.loadExample=function(){try{this.loadLevel(JSON.parse('{"size":[2100,1100],"title":"Example Raceway","bgtile":"sand.png","props":[{"p":[413,159],"f":1,"a":270},{"p":[687,158],"f":1,"a":270},{"p":[960,157],"f":1,"a":270},{"p":[310,259],"f":2,"a":240},{"p":[283,350],"f":2,"a":180},{"p":[282,442],"f":2,"a":180},{"p":[283,515],"f":2,"a":150},{"p":[360,579],"f":2,"a":105},{"p":[469,596],"f":2,"a":90},{"p":[561,596],"f":2,"a":90},{"p":[654,596],"f":2,"a":90},{"p":[706,561],"f":2,"a":15},{"p":[725,475],"f":2,"a":15},{"p":[768,388],"f":2,"a":225},{"p":[857,355],"f":2,"a":75},{"p":[957,261],"f":1,"a":270},{"p":[1232,352],"f":2,"a":90},{"p":[1321,351],"f":2,"a":90},{"p":[1310,276],"f":2,"a":330},{"p":[1238,278],"f":3,"a":0},{"p":[1272,278],"f":3,"a":0},{"p":[1307,282],"f":3,"a":0},{"p":[1608,587],"f":2,"a":270},{"p":[1704,586],"f":2,"a":270},{"p":[1577,628],"f":2,"a":150},{"p":[1669,686],"f":2,"a":90},{"p":[1729,626],"f":2,"a":45},{"p":[1802,618],"f":3,"a":0},{"p":[1103,-73],"f":1,"a":270},{"p":[832,-74],"f":1,"a":270},{"p":[562,-73],"f":1,"a":270},{"p":[1367,19],"f":2,"a":285},{"p":[1449,49],"f":2,"a":300},{"p":[1516,115],"f":2,"a":330},{"p":[1558,204],"f":2,"a":345},{"p":[1578,304],"f":2,"a":0},{"p":[1610,361],"f":2,"a":270},{"p":[1702,359],"f":2,"a":270},{"p":[1794,359],"f":2,"a":270},{"p":[1877,359],"f":2,"a":285},{"p":[1943,410],"f":2,"a":330},{"p":[1988,498],"f":2,"a":345},{"p":[2006,598],"f":2,"a":0},{"p":[1992,685],"f":2,"a":15},{"p":[1956,767],"f":2,"a":30},{"p":[1901,839],"f":2,"a":45},{"p":[1833,894],"f":2,"a":75},{"p":[1752,921],"f":2,"a":90},{"p":[1660,927],"f":2,"a":90},{"p":[1557,909],"f":2,"a":105},{"p":[1462,870],"f":2,"a":120},{"p":[1389,810],"f":2,"a":135},{"p":[1352,738],"f":2,"a":165},{"p":[1349,655],"f":2,"a":180},{"p":[1380,622],"f":3,"a":0},{"p":[1352,612],"f":3,"a":0},{"p":[1080,493],"f":1,"a":270},{"p":[988,585],"f":2,"a":90},{"p":[953,645],"f":2,"a":0},{"p":[913,717],"f":2,"a":30},{"p":[853,783],"f":2,"a":60},{"p":[781,826],"f":2,"a":90},{"p":[503,739],"f":1,"a":270},{"p":[410,828],"f":2,"a":90},{"p":[320,825],"f":2,"a":90},{"p":[219,802],"f":2,"a":105},{"p":[133,754],"f":2,"a":135},{"p":[75,689],"f":2,"a":150},{"p":[45,613],"f":2,"a":165},{"p":[-42,349],"f":1,"a":0},{"p":[48,257],"f":2,"a":180},{"p":[53,154],"f":2,"a":210},{"p":[106,74],"f":2,"a":225},{"p":[182,24],"f":2,"a":240},{"p":[289,21],"f":2,"a":270},{"p":[383,19],"f":2,"a":270},{"p":[472,18],"f":2,"a":270}],"decals":[{"p":[114,84],"f":4,"a":0},{"p":[426,36],"f":5,"a":0},{"p":[714,36],"f":5,"a":0},{"p":[1002,36],"f":5,"a":0},{"p":[1290,84],"f":4,"a":90},{"p":[1386,396],"f":6,"a":0},{"p":[1410,636],"f":4,"a":270},{"p":[1716,636],"f":4,"a":180},{"p":[1812,420],"f":7,"a":90},{"p":[1668,420],"f":8,"a":90},{"p":[1578,420],"f":8,"a":90},{"p":[1194,420],"f":9,"a":90},{"p":[1002,420],"f":9,"a":90},{"p":[786,420],"f":7,"a":0},{"p":[762,636],"f":7,"a":180},{"p":[474,612],"f":5,"a":0},{"p":[114,540],"f":4,"a":270},{"p":[114,402],"f":8,"a":180},{"p":[114,342],"f":8,"a":180},{"p":[378,660],"f":8,"a":270},{"p":[1446,372],"f":10,"a":90},{"p":[1524,372],"f":10,"a":90},{"p":[1614,450],"f":10,"a":180},{"p":[1614,540],"f":10,"a":180},{"p":[1062,90],"f":11,"a":90},{"p":[1062,168],"f":11,"a":90},{"p":[1014,102],"f":12,"a":90},{"p":[924,210],"f":12,"a":90},{"p":[822,102],"f":12,"a":90},{"p":[720,210],"f":12,"a":90},{"p":[600,102],"f":12,"a":90},{"p":[480,210],"f":12,"a":90}],"ai_waypoints":[{"p":[1362,212],"n":1},{"p":[1492,504],"n":2},{"p":[1559,750],"n":3},{"p":[928,554],"n":6},{"p":[1849,727],"n":4},{"p":[1814,544],"n":5},{"p":[1109,443],"n":6},{"p":[739,675],"n":7},{"p":[343,688],"n":8},{"p":[228,463],"n":9},{"p":[237,277],"n":10},{"p":[444,186],"n":11}],"checkpoints":[{"p":[1107,45],"n":1},{"p":[1377,648],"n":2},{"p":[1763,409],"n":3},{"p":[787,413],"n":4},{"p":[118,577],"n":5},{"p":[167,67],"n":6}],"start_positions":[{"p":[965,95],"n":1,"a":90},{"p":[872,203],"n":2,"a":90},{"p":[771,98],"n":3,"a":90},{"p":[668,206],"n":4,"a":90},{"p":[546,94],"n":5,"a":90},{"p":[426,202],"n":6,"a":90}],"dict":{"1":"9tires.png","2":"3tires.png","3":"tire.png","4":"dideliskampas.png","5":"ilgas.png","6":"kryzius.png","7":"lenktas.png","8":"trumpas.png","9":"paprastas.png","10":"arrow.png","11":"startbar.png","12":"white_bar.png"}}'))}catch(a){alert("failed! "+
a)}};g.prototype.load=function(){try{this.loadLevel(JSON.parse(this.textarea.value))}catch(a){alert("failed! "+a)}};g.prototype.resizeLevelView=function(){var a=this.level.size,b=a[0],c=a[1];this.level_view.resize(a);this.scw.autoSetScrollableArea();this.properties_view.widthlbl.setText(String(b));this.properties_view.heightlbl.setText(String(c));a=Math.max(b,c)/198;b=[parseInt(b/a),parseInt(c/a)];this.minimap.resize(b);this.minimap.image=new h.Surface(b)};g.prototype.loadLevel=function(a){this.level=
J(a.size);this.level.bgtile=a.bgtile;this.level.title=a.title;this.properties_view.title.setText(a.title);this.resizeLevelView();this.level_view.children=[];var b,c,d;a.decals.forEach(function(b){c=this.decal_view.filename_to_decal[a.dict[b.f]];d=new F({parent:this.level_view,size:c.getCursorImage().getSize(),scene:this,angle:b.a,original:c,position:b.p});this.level.decals.push(d)},this);a.props.forEach(function(c){b=this.prop_view.filename_to_prop[a.dict[c.f]];d=new I({parent:this.level_view,size:b.getCursorImage(c.a).getSize(),
scene:this,angle:c.a,original:b,position:c.p});this.level.props.push(d)},this);var g=0,e=0,j=0;a.ai_waypoints.forEach(function(a){d=new S({parent:this.level_view,size:this.marker_view.ai_waypoint.getCursorImage().getSize(),scene:this,angle:0,number:a.n,original:this.marker_view.ai_waypoint,position:a.p});this.level.ai_waypoints.push(d);g=Math.max(g,a.n)},this);this.marker_view.ai_waypoint.setNumber(g+1);a.checkpoints.forEach(function(a){d=new N({parent:this.level_view,size:L,scene:this,angle:0,original:this.marker_view.checkpoint,
number:a.n,position:a.p});this.level.checkpoints.push(d);e=Math.max(e,a.n)},this);this.marker_view.checkpoint.setNumber(e+1);a.start_positions.forEach(function(a){d=new E({parent:this.level_view,size:this.marker_view.start_position.size,scene:this,angle:a.a,original:this.marker_view.start_position,number:a.n,position:a.p});this.level.start_positions.push(d);j=Math.max(j,a.n)},this);this.marker_view.start_position.setNumber(j+1);this.level_view.refresh()};g.prototype.alert=function(){this.dialog.show(text,
button)};g.prototype.clearAlert=function(){this.dialog.close()};g.prototype.handleEvent=function(a){this.gui.despatchEvent(a)};g.prototype.alert=function(a,b){this.alertdialog.show(a,b)};g.prototype.clearAlert=function(){this.alertdialog.close()};g.prototype.update=function(a){if(this.ping&&(this.ms_to_ping-=a,this.ms_to_ping<=0))this.game.getCommunicator().queueMessage("PING"),this.ms_to_ping=1E4;this.gui.update(a)};g.prototype.draw=function(){this.gui.draw()};h.utils.objects.extend(b,r.Button);
b.prototype.onclick=function(){this.is_on?(this.scene.level[this.layer].forEach(function(a){a.hide()}),this.is_on=!1,this.setText("Off")):(this.scene.level[this.layer].forEach(function(a){a.show()}),this.is_on=!0,this.setText("On"))};h.utils.objects.extend(d,l.Dialog)}},["gamejs-gui","ui","combatracer","settings","gamejs","renderer","resources","skin"]);
require.define({"gamejs/display":function(v,c){var a=v("../gamejs").Surface,p=null;c.init=function(){var a=null;o()===null&&(a=document.createElement("canvas"),a.setAttribute("id","gjs-canvas"),document.body.appendChild(a));(a=document.getElementById("gjs-loader"))&&a.parentNode.removeChild(a)};c.setMode=function(a){var c=o();c.width=a[0];c.height=a[1];return k()};c.setCaption=function(a){document.title=a};c._getCanvasOffset=function(){var a=o().getBoundingClientRect();return[a.left,a.top]};var k=
c.getSurface=function(){if(p===null){var b=o();p=new a([b.clientWidth,b.clientHeight]);p._canvas=b}return p},o=function(){var a=null;Array.prototype.slice.call(document.getElementsByTagName("canvas")).every(function(c){if(c.getAttribute("id")=="gjs-canvas")return a=c,!1;return!0});return a}}},["gamejs"]);
require.define({"gamejs/draw":function(v,c){c.line=function(a,c,k,o,b){a=a.context;a.save();a.beginPath();a.strokeStyle=c;a.lineWidth=b||1;a.moveTo(k[0],k[1]);a.lineTo(o[0],o[1]);a.stroke();a.restore()};c.lines=function(a,c,k,o,b){k=k||!1;a=a.context;a.save();a.beginPath();a.strokeStyle=a.fillStyle=c;a.lineWidth=b||1;for(c=0;c<o.length;c++)b=o[c],c===0?a.moveTo(b[0],b[1]):a.lineTo(b[0],b[1]);k&&a.lineTo(o[0][0],o[0][1]);a.stroke();a.restore()};c.circle=function(a,c,k,o,b){if(!o)throw Error("[circle] radius required argument");
if(!k||!(k instanceof Array))throw Error("[circle] pos must be given & array"+k);a=a.context;a.save();a.beginPath();a.strokeStyle=a.fillStyle=c;a.lineWidth=b||1;a.arc(k[0],k[1],o,0,2*Math.PI,!0);b===void 0||b===0?a.fill():a.stroke();a.restore()};c.rect=function(a,c,k,o){a=a.context;a.save();a.strokeStyle=a.fillStyle=c;isNaN(o)||o===0?a.fillRect(k.left,k.top,k.width,k.height):(a.lineWidth=o||1,a.strokeRect(k.left,k.top,k.width,k.height));a.restore()};c.arc=function(a,c,k,o,b,d){a=a.context;a.save();
a.strokeStyle=a.fillStyle=c;a.arc(k.center[0],k.center[1],k.width/2,o*(Math.PI/180),b*(Math.PI/180),!1);isNaN(d)||d===0?a.fill():(a.lineWidth=d||1,a.stroke());a.restore()};c.polygon=function(a,c,k,o){var b=a.context;b.save();b.fillStyle=b.strokeStyle=c;b.beginPath();k.forEach(function(a,c){c==0?b.moveTo(a[0],a[1]):b.lineTo(a[0],a[1])});b.closePath();isNaN(o)||o===0?b.fill():(b.lineWidth=o||1,b.stroke());b.restore()}}},[]);
require.define({"gamejs/event":function(v,c){var a=v("./display"),p=v("../gamejs");c.K_UP=38;c.K_DOWN=40;c.K_RIGHT=39;c.K_LEFT=37;c.K_SPACE=32;c.K_BACKSPACE=8;c.K_TAB=9;c.K_ENTER=13;c.K_SHIFT=16;c.K_CTRL=17;c.K_ALT=18;c.K_ESC=27;c.K_0=48;c.K_1=49;c.K_2=50;c.K_3=51;c.K_4=52;c.K_5=53;c.K_6=54;c.K_7=55;c.K_8=56;c.K_9=57;c.K_a=65;c.K_b=66;c.K_c=67;c.K_d=68;c.K_e=69;c.K_f=70;c.K_g=71;c.K_h=72;c.K_i=73;c.K_j=74;c.K_k=75;c.K_l=76;c.K_m=77;c.K_n=78;c.K_o=79;c.K_p=80;c.K_q=81;c.K_r=82;c.K_s=83;c.K_t=84;c.K_u=
85;c.K_v=86;c.K_w=87;c.K_x=88;c.K_y=89;c.K_z=90;c.K_KP1=97;c.K_KP2=98;c.K_KP3=99;c.K_KP4=100;c.K_KP5=101;c.K_KP6=102;c.K_KP7=103;c.K_KP8=104;c.K_KP9=105;c.QUIT=0;c.KEY_DOWN=1;c.KEY_UP=2;c.MOUSE_MOTION=3;c.MOUSE_UP=4;c.MOUSE_DOWN=5;c.MOUSE_WHEEL=6;var k=[];c.get=function(){return k.splice(0,k.length)};c.poll=function(){return k.pop()};c.post=function(a){k.push(a)};c.Event=function(){this.pos=this.button=this.rel=this.key=this.type=null};c.init=function(){function o(b){var c=a._getCanvasOffset();k.push({type:p.event.MOUSE_WHEEL,
pos:[b.clientX-c[0],b.clientY-c[1]],delta:b.detail||-b.wheelDeltaY/40})}document.addEventListener("mousedown",function(b){var c=a._getCanvasOffset();k.push({type:p.event.MOUSE_DOWN,pos:[b.clientX-c[0],b.clientY-c[1]],button:b.button,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,metaKey:b.metaKey})},!1);document.addEventListener("mouseup",function(b){var c=a._getCanvasOffset();k.push({type:p.event.MOUSE_UP,pos:[b.clientX-c[0],b.clientY-c[1]],button:b.button,shiftKey:b.shiftKey,ctrlKey:b.ctrlKey,metaKey:b.metaKey})},
!1);document.addEventListener("keydown",function(a){var b=a.keyCode||a.which;k.push({type:p.event.KEY_DOWN,key:b,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey});(!a.ctrlKey&&!a.metaKey&&(b>=c.K_LEFT&&b<=c.K_DOWN||b>=c.K_0&&b<=c.K_z||b>=c.K_KP1&&b<=c.K_KP9||b===c.K_SPACE||b===c.K_TAB||b===c.K_ENTER)||b===c.K_ALT||b===c.K_BACKSPACE)&&a.preventDefault()},!1);document.addEventListener("keyup",function(a){k.push({type:p.event.KEY_UP,key:a.keyCode,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey})},
!1);var b=[];document.addEventListener("mousemove",function(c){var l=a._getCanvasOffset(),l=[c.clientX-l[0],c.clientY-l[1]],o=[];b.length&&(o=[b[0]-l[0],b[1]-l[1]]);k.push({type:p.event.MOUSE_MOTION,pos:l,rel:o,buttons:null,timestamp:c.timeStamp});b=l},!1);document.addEventListener("mousewheel",o,!1);document.addEventListener("DOMMouseScroll",o,!1);document.addEventListener("beforeunload",function(){k.push({type:p.event.QUIT})},!1)}}},["gamejs/display","gamejs"]);
require.define({"gamejs/font":function(v,c){var a=v("../gamejs").Surface,p=v("./utils/objects"),k=c.Font=function(c){this.sampleSurface=new a([10,10]);this.sampleSurface.context.font=c;this.sampleSurface.context.textAlign="start";this.sampleSurface.context.textBaseline="bottom";return this};k.prototype.render=function(c,b){var d=this.size(c),d=new a(d),l=d.context;l.save();l.font=this.sampleSurface.context.font;l.textBaseline=this.sampleSurface.context.textBaseline;l.textAlign=this.sampleSurface.context.textAlign;
l.fillStyle=l.strokeStyle=b||"#000000";l.fillText(c,0,d.rect.height,d.rect.width);l.restore();return d};k.prototype.size=function(a){return[this.sampleSurface.context.measureText(a).width,this.fontHeight]};p.accessors(k.prototype,{fontHeight:{get:function(){return this.sampleSurface.context.measureText("M").width*1.5}}})}},["gamejs","gamejs/utils/objects"]);
require.define({"gamejs/http":function(v,c){function a(a){return eval("("+a.responseText+")")}c.Response=function(){this.getResponseHeader=function(){};throw Error("response class not instantiable");};var p=c.ajax=function(a,c,l,k){var l=l||null,o=new XMLHttpRequest;o.open(a,c,!1);k&&o.setRequestHeader("Accept",k);l instanceof Object&&(l=JSON.stringify(l),o.setRequestHeader("Content-Type","application/json"));o.setRequestHeader("X-Requested-With","XMLHttpRequest");o.send(l);return o},k=c.get=function(a){return p("GET",
a)},o=c.post=function(a,c,l){return p("POST",a,c,l)};c.load=function(b){return a(k((window.$g&&$g.ajaxBaseHref||"./")+b))};c.save=function(b,c,l){return a(o((window.$g&&$g.ajaxBaseHref||"./")+b,{payload:c},l))}}},[]);
require.define({"gamejs/image":function(v,c){var a=v("../gamejs"),p={};c.load=function(c){var o;if(typeof c==="string"){if(o=p[c],!o)throw Error('Missing "'+c+'", gamejs.preload() all images before trying to load them.');}else o=c;c=document.createElement("canvas");c.width=o.naturalWidth||o.width;c.height=o.naturalHeight||o.height;c.getContext("2d").drawImage(o,0,0);o.getSize=function(){return[o.naturalWidth,o.naturalHeight]};var b=new a.Surface(o.getSize());b._canvas=c;return b};c.init=function(){};
c.preload=function(c){function o(){l++;l%10===0&&a.log("gamejs.image: preloaded  "+l+" of "+r)}function b(){p[this.gamejsKey]=this;o()}function d(){o();throw Error("Error loading "+this.src);}var l=0,r=0,u;for(u in c)if(!(u.indexOf("png")==-1&&u.indexOf("jpg")==-1&&u.indexOf("gif")==-1)){var h=new Image;h.addEventListener("load",b,!0);h.addEventListener("error",d,!0);h.src=c[u];h.gamejsKey=u;r++}return function(){return r>0?l/r:1}}}},["gamejs"]);
require.define({"gamejs/mask":function(v,c){var a=v("../gamejs"),p=v("./utils/objects");c.fromSurface=function(a,b){for(var b=b&&255-b||255,c=a.getImageData(),l=a.getSize(),r=new k(l),p=0;p<c.length;p+=4){var h=parseInt(p/4/l[0],10),y=parseInt(p/4%l[0],10);c[p+3]>=b&&r.setAt(y,h)}return r};var k=c.Mask=function(a){this.width=a[0];this.height=a[1];this._bits=[];for(a=0;a<this.width;a++){this._bits[a]=[];for(var b=0;b<this.height;b++)this._bits[a][b]=!1}};k.prototype.overlapRect=function(c,b){var d=
this.rect,l=c.rect;b&&l.moveIp(b);if(!l.collideRect(d))return null;var k=Math.max(d.left,l.left),p=Math.max(d.top,l.top);return new a.Rect([k,p],[Math.min(d.right,l.right)-k,Math.min(d.bottom,l.bottom)-p])};k.prototype.overlap=function(a,b){var c=this.overlapRect(a,b);if(c===null)return!1;var l=this.rect,k=a.rect;b&&k.moveIp(b);for(var p=c.top;p<=c.bottom;p++)for(var h=c.left;h<=c.right;h++)if(this.getAt(h-l.left,p-l.top)&&a.getAt(h-k.left,p-k.top))return!0;return!1};k.prototype.overlapArea=function(a,
b){var c=this.overlapRect(a,b);if(c===null)return 0;var l=this.rect,k=a.rect;b&&k.moveIp(b);for(var p=0,h=c.top;h<=c.bottom;h++)for(var y=c.left;y<=c.right;y++)this.getAt(y-l.left,h-l.top)&&a.getAt(y-k.left,h-k.top)&&p++;return p};k.prototype.overlapMask=function(a,b){var c=this.overlapRect(a,b);if(c===null)return 0;var l=this.rect,p=a.rect;b&&p.moveIp(b);for(var u=new k([c.width,c.height]),h=c.top;h<=c.bottom;h++)for(var y=c.left;y<=c.right;y++)this.getAt(y-l.left,h-l.top)&&a.getAt(y-p.left,h-p.top)&&
u.setAt(y,h);return u};k.prototype.setAt=function(a,b){this._bits[a][b]=!0};k.prototype.getAt=function(a,b){a=parseInt(a,10);b=parseInt(b,10);if(a<0||b<0||a>=this.width||b>=this.height)return!1;return this._bits[a][b]};k.prototype.invert=function(){this._bits=this._bits.map(function(a){return a.map(function(a){return!a})})};k.prototype.getSize=function(){return[this.width,this.height]};p.accessors(k.prototype,{rect:{get:function(){return new a.Rect([0,0],[this.width,this.height])}},length:{get:function(){var a=
0;this._bits.forEach(function(b){b.forEach(function(b){b&&a++})});return a}}})}},["gamejs","gamejs/utils/objects"]);
require.define({"gamejs/mixer":function(v,c){function a(a){a instanceof Array||(a=[a]);a.forEach(function(a){p[a.gamejsKey]=a})}v("../gamejs");var p={},k=!1;c.init=function(){var c=Array.prototype.slice.call(document.getElementsByTagName("audio"),0);a(c)};c.preload=function(c){function b(){a(this);p++;p==l&&(k=!1)}function d(){p++;p==l&&(k=!1);throw Error("Error loading "+this.src);}var l=0,p=0,u;for(u in c)if(!(u.indexOf("wav")==-1&&u.indexOf("ogg")==-1&&u.indexOf("webm")==-1)){l++;var h=new Audio;
h.addEventListener("canplay",b,!0);h.addEventListener("error",d,!0);h.src=c[u];h.gamejsKey=u;h.load()}l>0&&(k=!0);return function(){return l>0?p/l:1}};c.isPreloading=function(){return k};c.Sound=function(a){var b;b=typeof a==="string"?p[a]:a;if(!b)throw Error('Missing "'+a+'", gamejs.preload() all audio files before loading');var c=new Audio;c.preload="auto";c.loop=!1;c.src=b.src;this.play=function(){(c.ended||c.paused)&&c.play()};this.stop=function(){c.pause()};this.setVolume=function(a){c.volume=
a};this.getVolume=function(){return c.volume};this.getLength=function(){return c.duration};return this}}},["gamejs"]);
require.define({"gamejs/pathfinding/astar":function(v,c){function a(){var a={};this.store=function(b,c){a[b[0]+"-"+b[1]]=c};this.find=function(b){return a[b[0]+"-"+b[1]]};return this}var p=v("../utils/binaryheap").BinaryHeap;c.findRoute=function(c,b,d,l){function k(a){h.push(a);y.store(a.point,a)}function u(a){var b=y.find(a),d=e.length+c.actualDistance(e.point,a);if(!b||b.length>d)b&&h.remove(b),k({point:a,from:e,length:d})}var h=new p(function(a){if(a.score===void 0)a.score=c.estimatedDistance(a.point,
d)+a.length;return a.score}),y=new a;k({point:b,from:null,length:0});for(var b=Date.now(),e=null;h.size()>0&&(!l||Date.now()-b<l);){e=h.pop();if(d[0]===e.point[0]&&d[1]===e.point[1])return e;c.adjacent(e.point).forEach(u)}return null};var k=c.Map=function(){throw Error("not instantiable, this is an interface");};k.prototype.adjacent=function(){};k.prototype.estimatedDistance=function(){};k.prototype.actualDistance=function(){}}},["gamejs/utils/binaryheap"]);
require.define({"gamejs/sprite":function(v,c){v("../gamejs");var a=v("./utils/arrays"),p=c.Sprite=function(){this._groups=[];this._alive=!0;this.rect=this.image=null;return this};p.prototype.kill=function(){this._alive=!1;this._groups.forEach(function(a){a.remove(this)},this)};p.prototype.remove=function(a){a instanceof Array||(a=[a]);a.forEach(function(a){a.remove(this)},this)};p.prototype.add=function(a){a instanceof Array||(a=[a]);a.forEach(function(a){a.add(this)},this)};p.prototype.draw=function(a){a.blit(this.image,
this.rect)};p.prototype.update=function(){};p.prototype.isDead=function(){return!this._alive};var k=c.Group=function(a){this._sprites=[];(a instanceof p||a instanceof Array&&a.length&&a[0]instanceof p)&&this.add(a);return this};k.prototype.update=function(){var a=arguments;this._sprites.forEach(function(c){c.update.apply(c,a)},this)};k.prototype.add=function(a){a instanceof Array||(a=[a]);a.forEach(function(a){this._sprites.push(a);a._groups.push(this)},this)};k.prototype.remove=function(b){b instanceof
Array||(b=[b]);b.forEach(function(b){a.remove(b,this._sprites);a.remove(this,b._groups)},this)};k.prototype.has=function(a){a instanceof Array||(a=[a]);return a.every(function(a){return this._sprites.indexOf(a)!==-1},this)};k.prototype.sprites=function(){return this._sprites};k.prototype.draw=function(){var a=arguments;this._sprites.forEach(function(c){c.draw.apply(c,a)},this)};k.prototype.clear=function(a,c){this._sprites.forEach(function(k){a.blit(c,k.rect)},this)};k.prototype.empty=function(){this._sprites=
[]};k.prototype.collidePoint=function(){var a=Array.prototype.slice.apply(arguments);return this._sprites.filter(function(c){return c.rect.collidePoint.apply(c.rect,a)},this)};k.prototype.forEach=function(){Array.prototype.forEach.apply(this._sprites,arguments)};k.prototype.some=function(){return Array.prototype.some.apply(this._sprites,arguments)};c.spriteCollide=function(a,c,k,p){var p=p||o,k=k||!1,u=[];c.sprites().forEach(function(c){p(a,c)&&(k&&c.kill(),u.push(c))});return u};c.groupCollide=function(a,
c,k,p,u){var k=k||!1,p=p||!1,h=[],y=u||o;a.sprites().forEach(function(a){c.sprites().forEach(function(b){y(a,b)&&(k&&a.kill(),p&&b.kill(),h.push({a:a,b:b}))})});return h};var o=c.collideRect=function(a,c){return a.rect.collideRect(c.rect)};c.collideMask=function(a,c){if(!a.mask||!c.mask)throw Error("Both sprites must have 'mask' attribute set to an gamejs.mask.Mask");return a.mask.overlap(c.mask,[c.rect.left-a.rect.left,c.rect.top-a.rect.top])};c.collideCircle=function(a,c){return a.rect.center[0]*
a.rect.center[0]+a.rect.center[1]*a.rect.center[1]<=(a.radius*a.radius||(a.rect.width*a.rect.width+a.rect.height*a.rect.height)/4)+(c.radius*c.radius||(c.rect.width*c.rect.width+c.rect.height*c.rect.height)/4)}}},["gamejs","gamejs/utils/arrays"]);
require.define({"gamejs/surfacearray":function(v,c){var a=v("../gamejs"),p=v("./utils/objects").accessors;c.blitArray=function(a,c){a.context.putImageData(c.imageData,0,0)};c.SurfaceArray=function(c){this.set=function(a,c,d){a=a*4+c*o[0]*4;b[a]=d[0];b[a+1]=d[1];b[a+2]=d[2];b[a+3]=d[3]===void 0?255:d[3]};this.get=function(a,c){var d=a*4+c*o[0]*4;return[b[d],b[d+1],b[d+2],b[d+3]]};this.surface=null;p(this,{surface:{get:function(){var b=new a.Surface(o);b.context.putImageData(d,0,0);return b}},imageData:{get:function(){return d}}});
this.getSize=function(){return o};var o=null,b=null,d=null;c instanceof Array?(o=c,d=a.display.getSurface().context.createImageData(o[0],o[1]),b=d.data):(o=c.getSize(),b=d=c.getImageData(0,0,o[0],o[1]));return this}}},["gamejs","gamejs/utils/objects"]);
require.define({"gamejs/time":function(v,c){var a={},p={};c.init=function(){Date.now();setInterval(k,10)};c.fpsCallback=function(c,b,d){d=parseInt(1E3/d,10);a[d]=a[d]||[];p[d]=p[d]||0;a[d].push({rawFn:c,callback:function(a){c.apply(b,[a])}})};c.deleteCallback=function(c,b){var b=parseInt(1E3/b,10),d=a[b];d&&(a[b]=d.filter(function(a){if(a.rawFn!==c)return!0;return!1}))};var k=function(){function c(a){a.callback(k)}var b=Date.now(),d;for(d in p){p[d]||(p[d]=b);var k=b-p[d];d<=k&&(p[d]=b,a[d].forEach(c,
this))}}}},[]);
require.define({"gamejs/transform":function(v,c){var a=v("../gamejs").Surface,p=v("./utils/matrix");v("./utils/math");var k=v("./utils/vectors");c.rotate=function(c,b){var d=c.getSize(),l=b*Math.PI/180,r=d;if(b%90!==0)var r=c.getRect(),r=[[-r.width/2,r.height/2],[r.width/2,r.height/2],[-r.width/2,-r.height/2],[r.width/2,-r.height/2]].map(function(a){return k.rotate(a,l)}),u=r.map(function(a){return a[0]}),h=r.map(function(a){return a[1]}),r=Math.min.apply(Math,u),u=Math.max.apply(Math,u),y=Math.min.apply(Math,
h),h=Math.max.apply(Math,h),r=[u-r,h-y];h=new a(r);u=c._matrix;c._matrix=p.translate(c._matrix,d[0]/2,d[1]/2);c._matrix=p.rotate(c._matrix,l);c._matrix=p.translate(c._matrix,-d[0]/2,-d[1]/2);h.blit(c,[(r[0]-d[0])/2,(r[1]-d[1])/2]);c._matrix=u;return h};c.scale=function(c,b){var d=b[0],k=b[1],r=c.getSize(),r=[r[0]*b[0],r[1]*b[1]],r=new a(r);c._matrix=p.scale(c._matrix,[d,k]);r.blit(c);return r};c.flip=function(c,b,d){var k=c.getSize(),p=new a(k),u=1,h=1,y=0,e=0;b===!0&&(u=-1,y=-k[0]);d===!0&&(h=-1,
e=-k[1]);p.context.save();p.context.scale(u,h);p.context.drawImage(c.canvas,y,e);p.context.restore();return p}}},["gamejs","gamejs/utils/matrix","gamejs/utils/math","gamejs/utils/vectors"]);require.define({"gamejs/utils/arrays":function(v,c){c.remove=function(a,c){return c.splice(c.indexOf(a),1)}}},[]);
require.define({"gamejs/utils/binaryheap":function(v,c){var a=c.BinaryHeap=function(a){this.content=[];this.scoreFunction=a;return this};a.prototype.push=function(a){this.content.push(a);this.sinkDown(this.content.length-1)};a.prototype.pop=function(){var a=this.content[0],c=this.content.pop();this.content.length>0&&(this.content[0]=c,this.bubbleUp(0));return a};a.prototype.remove=function(a){if(!this.content.some(function(c,o){if(c==a){var b=this.content.pop();o!=this.content.length&&(this.content[o]=
b,this.scoreFunction(b)<this.scoreFunction(a)?this.sinkDown(o):this.bubbleUp(o));return!0}return!1},this))throw Error("Node not found.");};a.prototype.size=function(){return this.content.length};a.prototype.sinkDown=function(a){for(var c=this.content[a];a>0;){var o=Math.floor((a+1)/2)-1,b=this.content[o];if(this.scoreFunction(c)<this.scoreFunction(b))this.content[o]=c,this.content[a]=b,a=o;else break}};a.prototype.bubbleUp=function(a){for(var c=this.content.length,o=this.content[a],b=this.scoreFunction(o);;){var d=
(a+1)*2,l=d-1,r=null;if(l<c){var u=this.scoreFunction(this.content[l]);u<b&&(r=l)}if(d<c&&this.scoreFunction(this.content[d])<(r===null?b:u))r=d;if(r!==null)this.content[a]=this.content[r],this.content[r]=o,a=r;else break}}}},[]);
require.define({"gamejs/utils/math":function(v,c){c.normaliseDegrees=function(a){a%=360;a<0&&(a+=360);return a};c.normaliseRadians=function(a){a%=2*Math.PI;a<0&&(a+=2*Math.PI);return a};c.degrees=function(a){return a*(180/Math.PI)};c.radians=function(a){return a*(Math.PI/180)}}},[]);
require.define({"gamejs/utils/matrix":function(v,c){c.identity=function(){return[1,0,0,1,0,0]};c.add=function(a,c){return[a[0]+c[0],a[1]+c[1],a[2]+c[2],a[3]+c[3],a[4]+c[4],a[5]+c[5],a[6]+c[6]]};var a=c.multiply=function(a,c){return[a[0]*c[0]+a[2]*c[1],a[1]*c[0]+a[3]*c[1],a[0]*c[2]+a[2]*c[3],a[1]*c[2]+a[3]*c[3],a[0]*c[4]+a[2]*c[5]+a[4],a[1]*c[4]+a[3]*c[5]+a[5]]};c.translate=function(c,k,o){return a(c,[1,0,0,1,k,o])};c.rotate=function(c,k){var o=Math.sin(k),b=Math.cos(k);return a(c,[b,o,-o,b,0,0])};
c.rotation=function(a){return Math.atan2(a[1],a[0])};c.scale=function(c,k){return a(c,[k[0],0,0,k[1],0,0])}}},[]);
require.define({"gamejs/utils/objects":function(v,c){c.extend=function(a,c){if(a===void 0)throw Error("unknown subClass");if(c===void 0)throw Error("unknown superClass");var b=new Function;b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a;a.superClass=c.prototype;a.superConstructor=c};c.merge=function(){for(var a={},c=arguments.length;c>0;--c){var b=arguments[c-1],d;for(d in b)a[d]=b[d]}return a};var a=c.keys=function(a){if(Object.keys)return Object.keys(a);var c=[],b;for(b in a)Object.prototype.hasOwnProperty.call(a,
b)&&c.push(b);return c},p=c.accessor=function(a,c,b,d){Object.defineProperty!==void 0?Object.defineProperty(a,c,{get:b,set:d}):Object.prototype.__defineGetter__!==void 0&&(a.__defineGetter__(c,b),d&&a.__defineSetter__(c,d))};c.accessors=function(c,o){a(o).forEach(function(a){p(c,a,o[a].get,o[a].set)})}}},[]);
require.define({"gamejs/utils/vectors":function(v,c){var a=v("./math");c.distance=function(a,b){return k(p(a,b))};var p=c.substract=function(a,b){return[a[0]-b[0],a[1]-b[1]]};c.add=function(a,b){return[a[0]+b[0],a[1]+b[1]]};c.multiply=function(a,b){if(typeof b==="number")return[a[0]*b,a[1]*b];return[a[0]*b[0],a[1]*b[1]]};c.divide=function(a,b){if(typeof b==="number")return[a[0]/b,a[1]/b];throw Error("only divide by scalar supported");};var k=c.len=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])};
c.unit=function(a){var b=k(a);if(b)return[a[0]/b,a[1]/b];return[0,0]};c.rotate=function(c,b){b=a.normaliseRadians(b);return[c[0]*Math.cos(b)-c[1]*Math.sin(b),c[0]*Math.sin(b)+c[1]*Math.cos(b)]};c.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};c.angle=function(a,b){var c=k(a),l=k(b);return c&&l?Math.acos((a[0]*b[0]+a[1]*b[1])/(c*l)):0}}},["gamejs/utils/math"]);
require.define({"gamejs-gui":function(v,c){function a(a,b){var c={};for(key in a)c[key]=a[key];if(c.pos&&b)c.pos=[c.pos[0]-b[0],c.pos[1]-b[1]];return c}function p(a,b){return[Math.max(parseInt((a[0]-b[0])/2),0),Math.max(parseInt((a[1]-b[1])/2),0)]}var k=v("gamejs"),o=c.EVT_FOCUS="focus",b=c.EVT_BLUR="blur",d=c.EVT_MOUSE_OVER="mouse_over",l=c.EVT_MOUSE_OUT="mouse_out",r=c.EVT_KEY_DOWN=k.event.KEY_DOWN,u=c.EVT_KEY_UP=k.event.KEY_UP,h=c.EVT_MOUSE_UP=k.event.MOUSE_UP,y=c.EVT_MOUSE_DOWN=k.event.MOUSE_DOWN;
c.EVT_MOUSE_WHEEL=k.event.MOUSE_WHEEL;var e=c.EVT_MOUSE_MOTION=k.event.MOUSE_MOTION,t=c.EVT_BTN_CLICK="btn_click",L=c.EVT_CLOSE="close",H=c.EVT_SCROLL="scroll",C=c.EVT_DRAG="drag",J=c.EVT_MOVE="move",x=c.EVT_RESIZE="resize",O=c.EVT_PAINT="paint",Q=c.EVT_CHANGE="change",j=1,P=c.draggable=function(a){a.grab_pos=null;a.on(y,function(a){this.grab_pos=a.global_pos},a);a.getGUI().on(h,function(){this.grab_pos=null},a);a.getGUI().on(e,function(a){if(this.grab_pos){var b=this.position,c=[this.position[0]+
a.pos[0]-this.grab_pos[0],this.position[1]+a.pos[1]-this.grab_pos[1]];this.grab_pos=a.pos;this.move(c);this.despatchEvent({type:C,old_pos:b,new_pos:this.position})}},a)},B=c.CachedFont=function(a,b){this.space_width=3;this.tab_width=12;this.chars={};this.font=null;typeof a=="string"?(this.color=b?b:"#000",this.font=new k.font.Font(a)):(this.chars=a,this.font=new k.font.Font("14px Verdana"),this.color="#000");this.space_width=parseInt(Math.ceil(this.getCharSurface("m").getSize()[0]/3));this.tab_width=
3*this.space_width};B.prototype.getCharSurface=function(a){if(!this.chars[a]){var b=this.font.render(a,this.color);this.chars[a]=b}return this.chars[a]};B.prototype.getTextSize=function(a){var b=0,c=0,d;if(a){for(var e=0;e<a.length;e++)if(d=a[e],d==" ")b+=this.space_width;else if(d=="\t")b+=this.tab_width;else if(d=this.getCharSurface(d))d=d.getSize(),b+=d[0],c=Math.max(d[1],c);c||(c=this.getCharSurface("m").getSize()[1]);return[b,c]}else return[0,0]};B.prototype.render=function(a,b,c,d){ofst=c[0];
var d=d?d:this.space_width,e,j;for(e=0;e<b.length;e++)j=b[e],j==" "?ofst+=d:j=="\t"?ofst+=this.tab_width:(j=this.getCharSurface(j),r1=[ofst,c[1]],a.blit(j,r1),ofst+=j.getSize()[0])};c.DEFAULT_FONT=new B("12px Verdana","black");var D=c.View=function(a){this.type="view";this.id=j++;if(!a.size)throw"View: size must be specified";this.size=a.size;if(!a.position)a.position=[0,0];this.position=[parseInt(a.position[0]),parseInt(a.position[1])];this.surface=a.surface?a.surface:new k.Surface(this.size);if(a.parent===
void 0)throw"Element's parent not given.";this.parent=a.parent;this.visible=a.visible===void 0?!0:a.visible;this.parent&&this.parent.addChild(this);this.children=[];this._refresh=!0;this.is_focused=this.is_hovered=!1;this.listeners={};return this};D.prototype.isFocused=function(){return this.is_focused};D.prototype.isHovered=function(){return this.is_hovered};D.prototype.getSize=function(){return[this.size[0],this.size[1]]};D.prototype.getPosition=function(){return[this.position[0],this.position[1]]};
D.prototype.isVisible=function(){return this.visible};D.prototype.removeChild=function(a){if(typeof a!="number")a=a.id;for(var b=0;b<this.children.length;b++)if(this.children[b].id==a)return this.children.splice(b,1),this.refresh(),!0;return!1};D.prototype.destroy=function(){this.parent&&this.parent.removeChild(this)};D.prototype.getRect=function(){return new k.Rect(this.position,this.size)};D.prototype.addChild=function(a){this.children.push(a)};D.prototype.draw=function(){if(!this.visible){if(this._refresh)return this._refresh=
!1,!0;return!1}var a=!1;this.children.forEach(function(b){if(b.draw()||this._refresh)a=!0},this);if(this._refresh||a)this.paint(),this.despatchEvent({type:O,surface:this.surface}),this.children.forEach(function(a){a.visible&&this.blitChild(a)},this),a=!0,this._refresh=!1;return a};D.prototype.blitChild=function(a){this.surface.blit(a.surface,a.position)};D.prototype.paint=function(){this.surface.clear()};D.prototype.update=function(){};D.prototype._update=function(a){this.children.forEach(function(b){b._update(a)});
this.update(a)};D.prototype.on=function(a,b,c){this.listeners[a]||(this.listeners[a]=[]);this.listeners[a].push({callback:b,scope:c})};D.prototype.despatchEventToChildren=function(a){this.children.forEach(function(b){b.despatchEvent(a)})};D.prototype.move=function(a){var b=this.position;this.position=a;this.parent.refresh();this.despatchEvent({type:J,old_pos:b,new_pos:a})};D.prototype.moveRelative=function(a){this.move([this.position[0]+a[0],this.position[1]+a[1]])};D.prototype.resize=function(a){var b=
this.size;this.size=a;this.surface=new k.Surface([Math.max(a[0],1),Math.max(a[1],1)]);this.refresh();this.despatchEvent({type:x,old_size:b,new_size:a})};D.prototype.refresh=function(){this._refresh=!0};D.prototype.show=function(){if(!this.visible)this.visible=!0,this.refresh()};D.prototype.hide=function(){if(this.visible)this.despatchEvent({type:b}),this.despatchEvent({type:l}),this.visible=!1,this.refresh()};D.prototype.despatchEvent=function(c){if(this.visible)if(c.type==b){if(this.is_focused)this.is_focused=
!1,this.refresh(),this.handleEvent(c);this.despatchEventToChildren(c)}else if(c.type==l){if(this.is_hovered)this.is_hovered=!1,this.refresh(),this.handleEvent(c);this.despatchEventToChildren(c)}else c.type==d?(this.is_hovered=!0,this.refresh(),this.handleEvent(c)):c.type==o?(this.is_focused=!0,this.refresh(),this.handleEvent(c)):c.type==y?(this.isFocused()||this.despatchEvent({type:o}),this.children.forEach(function(d){d.getRect().collidePoint(c.pos)?d.despatchEvent(a(c,d.position)):d.isFocused()&&
d.despatchEvent({type:b})},this),this.handleEvent(c)):c.type==h?(this.children.forEach(function(b){b.getRect().collidePoint(c.pos)&&b.despatchEvent(a(c,b.position))},this),this.handleEvent(c)):c.type==e?(this.children.forEach(function(b){b.getRect().collidePoint(c.pos)?(b.isHovered()||b.despatchEvent(a({type:d,pos:c.pos},b.position)),b.despatchEvent(a(c,b.position))):b.isHovered()&&b.despatchEvent(a({type:l,pos:c.pos},b.position))},this),this.handleEvent(c)):c.type==u||c.type==r||c.type==u?this.isFocused()&&
(this.children.forEach(function(b){b.isFocused()&&b.despatchEvent(a(c))}),this.handleEvent(c)):this.handleEvent(c)};D.prototype.getGUI=function(){for(var a=this.parent;a!=null&&a.type!="gui";)a=a.parent;return a};D.prototype.center=function(a){a.move(p(this.size,a.size))};D.prototype.handleEvent=function(a){this.listeners[a.type]&&this.listeners[a.type].forEach(function(b){b.scope?b.callback.apply(b.scope,[a,this]):b.callback(a,this)})};var G=c.Label=function(a){this.font=a.font?a.font:c.DEFAULT_FONT;
a.size=[1,1];G.superConstructor.apply(this,[a]);if(!a.text)throw"Label: label text must be provided!";this.setText(a.text);this.type="label"};k.utils.objects.extend(G,D);G.prototype.setText=function(a){this.text=a?a:" ";this.size=this.font.getTextSize(a);this.resize(this.size)};G.prototype.paint=function(){this.surface.clear();this.font.render(this.surface,this.text,[0,0])};var N=c.Button=function(a){N.superConstructor.apply(this,[a]);this.type="button";this.label=this.image=null;this.image=a.image;
this.image_down=a.image_down;this.image_hover=a.image_hover;if(!this.image)this.image=new k.Surface(this.size),this.image.fill("#FFF"),k.draw.rect(this.image,"#808080",new k.Rect([0,0],this.size),1);if(a.text)this.label=new G({parent:this,position:[0,0],text:a.text,font:a.font}),this.center(this.label);this.pressed_down=!1;this.on(y,function(){if(!this.pressed_down)this.pressed_down=!0,this.refresh()},this);this.on(h,function(){if(this.pressed_down)this.pressed_down=!1,this.despatchEvent({type:t}),
this.refresh()},this);this.on(l,function(){if(this.pressed_down)this.pressed_down=!1,this.refresh()},this)};k.utils.objects.extend(N,D);N.prototype.onClick=function(a,b){this.on(t,a,b)};N.prototype.paint=function(){var a;a=this.pressed_down&&this.image_down?this.image_down:this.isHovered()&&this.image_hover?this.image_hover:this.image;this.surface.blit(a,new k.Rect([0,0],this.surface.getSize()),new k.Rect([0,0],a.getSize()))};N.prototype.setText=function(a){this.label&&(this.label.setText(a),this.center(this.label))};
var E=c.Image=function(a){if(!a.image)throw"Image: parameter image is required";if(!a.size)a.size=a.image.getSize();this.image=a.image;E.superConstructor.apply(this,[a]);this.type="image";return this};k.utils.objects.extend(E,D);E.prototype.setImage=function(a){this.image=a;this.refresh()};E.prototype.paint=function(){D.prototype.paint.apply(this,[]);this.surface.blit(this.image,new k.Rect([0,0],this.surface.getSize()),new k.Rect([0,0],this.image.getSize()))};var S=c.FrameHeader=function(a){if(!a.parent)throw"FrameHeader: parent parameter is required";
this.height=a.height||20;a.width=a.parent.size[0];a.size=[a.width,this.height];a.position=[0,0];this.title_font=a.title_font;S.superConstructor.apply(this,[a]);P(this);a.title&&this.setTitle(a.title);if(a.close_btn)a.close_icon?a=a.close_icon:(a=new k.Surface([this.height,this.height]),k.draw.line(a,"#000",[3,3],[this.height-3,this.height-3],3),k.draw.line(a,"#000",[3,this.height-3],[this.height-3,3],3)),a=new E({parent:this,position:[this.size[0]-a.getSize()[0],0],image:a}),a.on(y,function(){this.close();
this.despatchEvent({type:L})},this.parent);this.type="frameheader"};k.utils.objects.extend(S,D);S.prototype.move=function(a){this.parent.move([this.parent.position[0]+a[0]-this.position[0],this.parent.position[1]+a[1]-this.position[1]])};S.prototype.setTitle=function(a){this.title_label?this.title_label.setText(a):this.title_label=new G({parent:this,position:[0,0],font:this.title_font,text:a});var b=this.title_label.font,a=b.getTextSize(a);this.title_label.move([b.space_width,Math.max(parseInt(this.height-
a[1]))],0);P(this)};S.prototype.paint=function(){k.draw.rect(this.surface,"#C0C0C0",new k.Rect([0,0],this.size))};var F=c.Frame=function(a){if(!a.parent)throw"Frame: parent parameter is required";if(a.parent.type!="gui")throw"Frame: parent object must be instance of GUI";var b=a.parent;a.parent=null;F.superConstructor.apply(this,[a]);this.type="frame";this.visible=!1;b.frames.push(this);this.parent=b;this.constrain=a.constrain;return this};k.utils.objects.extend(F,D);F.prototype.paint=function(){k.draw.rect(this.surface,
"#FFF",new k.Rect([0,0],this.size));k.draw.rect(this.surface,"#404040",new k.Rect([0,0],this.size),1)};F.prototype.show=function(){D.prototype.show.apply(this,[]);this.parent.moveFrameToTop(this)};F.prototype.close=function(){D.prototype.hide.apply(this,[]);this.despatchEvent({type:L})};F.prototype.move=function(a){this.constrain&&(a[0]<0&&(a[0]=0),a[0]>this.parent.size[0]-this.size[0]&&(a[0]=this.parent.size[0]-this.size[0]),a[1]<0&&(a[1]=0),a[1]>this.parent.size[1]-this.size[1]&&(a[1]=this.parent.size[1]-
this.size[1]));D.prototype.move.apply(this,[a])};F.prototype.destroy=function(){this.visible&&this.close();this.parent&&this.parent.removeFrame(this)};var I=c.DraggableView=function(a){I.superConstructor.apply(this,[a]);P(this);this.min_x=a.min_x;this.max_x=a.max_x;this.min_y=a.min_y;this.max_y=a.max_y;this.type="draggableview"};k.utils.objects.extend(I,D);I.prototype.move=function(a){var b=a[0];if(this.min_x||this.min_x==0)b=Math.max(b,this.min_x);if(this.max_x||this.max_x==0)b=Math.min(b,this.max_x);
a=a[1];if(this.min_y||this.min_y==0)a=Math.max(a,this.min_y);if(this.max_y||this.max_y==0)a=Math.min(a,this.max_y);D.prototype.move.apply(this,[[b,a]])};var T=c.Scroller=function(a){T.superConstructor.apply(this,[a]);this.img=null;if(a.image)this.img=new E({parent:this,position:[0,0],size:this.size,image:a.image})};k.utils.objects.extend(T,I);T.prototype.resize=function(a){I.prototype.resize.apply(this,[a]);this.img&&this.img.resize(a)};var M=c.HorizontalScrollbar=function(a){M.superConstructor.apply(this,
[a]);this.type="horizontalscrollbar";var b=a.left_btn_image;if(!b){var b=new k.Surface([this.size[1],this.size[1]]),c=[[0,this.size[1]/2],[this.size[1],0],[this.size[1],this.size[1]]];k.draw.polygon(b,"#C0C0C0",c)}this.left_btn=new N({parent:this,position:[0,0],size:[this.size[1],this.size[1]],image:b});this.left_btn.onClick(this.scrollLeft,this);b=a.right_btn_image;b||(b=new k.Surface([this.size[1],this.size[1]]),c=[[0,0],[this.size[1],this.size[1]/2],[0,this.size[1]]],k.draw.polygon(b,"#C0C0C0",
c));this.right_btn=new N({parent:this,position:[this.size[0]-this.size[1],0],size:[this.size[1],this.size[1]],image:b});this.right_btn.onClick(this.scrollRight,this);this.sts=this.size[0]-this.right_btn.size[0]-this.left_btn.size[0];a=a.scroller_image;a||(a=new k.Surface([this.size[1],this.size[1]]),c=a.getSize(),k.draw.rect(a,"#C0C0C0",new k.Rect([0,0],[c[0],c[1]])));c=[Math.max(parseInt((this.size[0]-2*this.size[1])/2),a.getSize()[0]),this.size[1]];this.scroller=new this.scroller_class({parent:this,
position:[this.size[1],0],image:a,size:c,min_x:this.size[1],max_x:this.size[0]-this.right_btn.size[0]-c[0],min_y:0,max_y:0});this.scroll_pos=0;this.max_scroll_pos=this.sts-this.scroller.size[0];this.scroller.on(C,function(a){this.setScrollPX(a.new_pos[0]-this.size[1])},this)};k.utils.objects.extend(M,D);M.prototype.scroller_class=T;M.prototype.setScrollerSize=function(a){a=Math.min(Math.max(a,0.1),1);this.scroller.resize([this.sts*a,this.scroller.size[1]]);this.max_scroll_pos=this.sts-this.scroller.size[0];
this.scroller.max_x=this.size[0]-this.left_btn.size[0]-this.scroller.size[0];this.refresh()};M.prototype.setScrollPX=function(a){this.scroller.move([a+this.left_btn.size[0],0]);this.scroll_pos=a=this.scroller.position[0]-this.left_btn.size[0];var b=0;this.max_scroll_pos>0&&(b=a/this.max_scroll_pos);this.despatchEvent({type:H,scroll_px:a,scroll:b});this.refresh()};M.prototype.setScroll=function(a){this.setScrollPX(parseInt(this.max_scroll_pos*a))};M.prototype.scrollLeft=function(){this.setScrollPX(Math.max(0,
this.scroll_pos-this.max_scroll_pos*0.1))};M.prototype.scrollRight=function(){this.setScrollPX(Math.min(this.max_scroll_pos,this.scroll_pos+this.max_scroll_pos*0.1))};var m=c.VerticalScrollbar=function(a){m.superConstructor.apply(this,[a]);this.type="verticalscrollbar";var b=a.top_btn_image;if(!b){var b=new k.Surface([this.size[0],this.size[0]]),c=[[this.size[0]/2,0],[0,this.size[0]],[this.size[0],this.size[0]]];k.draw.polygon(b,"#C0C0C0",c)}this.top_btn=new N({parent:this,position:[0,0],size:[this.size[0],
this.size[0]],image:b});this.top_btn.onClick(this.scrollUp,this);b=a.bot_btn_image;b||(b=new k.Surface([this.size[0],this.size[0]]),c=[[0,0],[this.size[0],0],[this.size[0]/2,this.size[0]]],k.draw.polygon(b,"#C0C0C0",c));this.bot_btn=new N({parent:this,position:[0,this.size[1]-this.size[0]],size:[this.size[0],this.size[0]],image:b});this.bot_btn.onClick(this.scrollDown,this);this.sts=this.size[1]-this.bot_btn.size[1]-this.top_btn.size[1];a=a.scroller_image;a||(a=new k.Surface([this.size[0],this.size[0]]),
c=a.getSize(),k.draw.rect(a,"#C0C0C0",new k.Rect([0,0],[c[0],c[1]])));c=[this.size[0],Math.max(parseInt((this.size[1]-2*this.size[0])/2),a.getSize()[1])];this.scroller=new this.scroller_class({parent:this,position:[0,this.size[0]],image:a,size:c,min_x:0,max_x:0,min_y:this.size[0],max_y:this.size[1]-this.bot_btn.size[1]-c[1]});this.scroll_pos=0;this.max_scroll_pos=this.sts-this.scroller.size[1];this.scroller.on(C,function(a){this.setScrollPX(a.new_pos[1]-this.size[0])},this)};k.utils.objects.extend(m,
D);m.prototype.scroller_class=T;m.prototype.setScrollerSize=function(a){a=Math.min(Math.max(a,0.1),1);this.scroller.resize([this.scroller.size[0],this.sts*a]);this.max_scroll_pos=this.sts-this.scroller.size[1];this.scroller.max_y=this.size[1]-this.bot_btn.size[1]-this.scroller.size[1];this.refresh()};m.prototype.setScrollPX=function(a){this.scroller.move([0,a+this.top_btn.size[1]]);this.scroll_pos=a=this.scroller.position[1]-this.top_btn.size[1];var b=0;this.max_scroll_pos>0&&(b=a/this.max_scroll_pos);
this.despatchEvent({type:H,scroll_px:a,scroll:b});this.refresh()};m.prototype.setScroll=function(a){this.setScrollPX(parseInt(this.max_scroll_pos*a))};m.prototype.scrollUp=function(){this.setScrollPX(Math.max(0,this.scroll_pos-this.max_scroll_pos*0.1))};m.prototype.scrollDown=function(){this.setScrollPX(Math.min(this.max_scroll_pos,this.scroll_pos+this.max_scroll_pos*0.1))};var q=c.ScrollableView=function(a){q.superConstructor.apply(this,[a]);this.type="scrollableview";this.max_scroll_y=this.max_scroll_x=
this.scroll_y=this.scroll_x=0;this.scrollable_area=[0,0];this.setScrollableArea(this.size);this.horizontal_scrollbar=this.vertical_scrollbar=null};k.utils.objects.extend(q,D);q.prototype.setVerticalScrollbar=function(a){this.vertical_scrollbar=a;a.on(H,function(a){this.setScrollY(Math.ceil(a.scroll*this.max_scroll_y))},this)};q.prototype.setHorizontalScrollbar=function(a){this.horizontal_scrollbar=a;a.on(H,function(a){this.setScrollX(Math.ceil(a.scroll*this.max_scroll_x))},this)};q.prototype.setScrollableArea=
function(a){this.scrollable_area=a;this.max_scroll_y=Math.max(a[1]-this.size[1],0);this.max_scroll_x=Math.max(a[0]-this.size[0],0);if(this.vertical_scrollbar){var b=Math.max(Math.min(1,this.size[1]/a[1]),0.1);this.vertical_scrollbar.setScrollerSize(b)}this.horizontal_scrollbar&&(b=Math.max(Math.min(1,this.size[0]/a[0]),0.1),this.horizontal_scrollbar.setScrollerSize(b))};q.prototype.autoSetScrollableArea=function(){scrollable_area=[0,0];this.children.forEach(function(a){scrollable_area[0]=Math.max(scrollable_area[0],
a.position[0]+a.size[0]+20);scrollable_area[1]=Math.max(scrollable_area[1],a.position[1]+a.size[1]+20)},this);this.setScrollableArea(scrollable_area)};q.prototype.addChild=function(a){D.prototype.addChild.apply(this,[a]);this.refresh()};q.prototype.blitChild=function(a){this.surface.blit(a.surface,[a.position[0]-this.scroll_x,a.position[1]-this.scroll_y])};q.prototype.despatchEvent=function(b){if(b.pos)b=a(b),b.pos=[b.pos[0]+this.scroll_x,b.pos[1]+this.scroll_y];D.prototype.despatchEvent.apply(this,
[b])};q.prototype.scrollX=function(a){this.setScrollX(this.scroll_x+a);this.refresh()};q.prototype.scrollY=function(a){this.setScrollY(this.scroll_y+a);this.refresh()};q.prototype.setScrollX=function(a){this.scroll_x=Math.min(Math.max(a,0),this.max_scroll_x);this.refresh()};q.prototype.setScrollY=function(a){this.scroll_y=Math.min(Math.max(a,0),this.max_scroll_y);this.refresh()};var A=c.TextInput=function(a){A.superConstructor.apply(this,[a]);this.font=a.font?a.font:c.DEFAULT_FONT;this.text=a.text?
a.text:"";this.blip=!1;this.pos=0;this.ms=500;this.scw=new q({parent:this,position:[0,0],size:a.scw_size||this.size});this.center(this.scw);this.label=new G({parent:this.scw,position:[0,0],font:this.font,text:this.text});this.scw.center(this.label);this.label.move([3,this.label.position[1]]);this.bliplabel=new G({parent:this.scw,position:[0,0],font:this.font,visible:!1,text:"|"});this.on(r,this.onKeyDown,this);this.on(o,this.blipon,this);this.on(b,function(){this.blip=!1},this);this.setPos(this.text.length)};
k.utils.objects.extend(A,D);A.prototype.blipon=function(){this.blip=!0;this.ms=500;this.refresh()};A.prototype.update=function(a){if(this.isFocused()){this.ms-=a;if(this.ms<0)this.ms=500,this.blip=!this.blip;this.blip?this.bliplabel.show():this.bliplabel.hide()}else this.bliplabel.hide()};A.prototype.paint=function(){this.surface.fill("#FFF");k.draw.rect(this.surface,"#COCOCO",new k.Rect([0,0],this.size),1)};A.prototype.setText=function(a){this.setPos(this.text.length);this._setText(a)};A.prototype.setPos=
function(a){this.pos=Math.min(Math.max(a,0),this.text.length);a=0;a=this.font.getTextSize(this.text.substr(0,this.pos))[0];a=Math.max(a-this.scw.size[0]+this.font.getTextSize("s")[0]);this.scw.setScrollX(a);this.bliplabel.move([Math.max(this.font.getTextSize(this.text.substr(0,this.pos))[0]+this.label.position[0]-2,0),this.label.position[1]])};A.prototype._setText=function(a){this.text=a;this.label.setText(a);this.scw.autoSetScrollableArea();this.refresh();this.despatchEvent({type:Q,value:a})};A.prototype.onKeyDown=
function(a){var b=a.key;b==8&&this.text&&(this.pos==this.text.length?this._setText(this.text.substr(0,this.text.length-1)):this._setText(this.text.substr(0,this.pos-1)+this.text.substr(this.pos,this.text.length)),this.blipon(),this.setPos(this.pos-1));if(b>=48&&b<=90||b==32){var c=String.fromCharCode(b),c=a.shiftKey?c.toUpperCase():c.toLowerCase();this.pos==this.text.length?this._setText(this.text+c):this._setText(this.text.substr(0,this.pos)+c+this.text.substr(this.pos,this.text.length));this.setPos(this.pos+
1);this.blipon()}b==37&&(this.setPos(this.pos-1),this.blipon());b==39&&(this.setPos(this.pos+1),this.blipon())};var z=c.Dialog=function(a){a.position=p(a.parent.size,a.size);z.superConstructor.apply(this,[a])};k.utils.objects.extend(z,F);z.prototype.show=function(){this.getGUI().lockFrame(this);F.prototype.show.apply(this,[])};z.prototype.close=function(){this.getGUI().unlockFrame();F.prototype.close.apply(this,[])};var K=c.Text=function(a){a.size=[a.width,1];K.superConstructor.apply(this,[a]);this.width=
a.width;this.font=a.font?a.font:c.DEFAULT_FONT;this.setText(a.text);this.justify=a.justify};k.utils.objects.extend(K,D);K.prototype.setText=function(a){this.text=a;this.lines=[];a=a.split(/\r\n|\r|\n/);a.push(" ");var b,c,d,e,j,h="",l=0,k=0,m="";for(c=0;c<a.length;c++){b=a[c];b+=" ";for(d=0;d<b.length;d++){e=b[d];if(e==" "||e=="\t"){if(h){j=this.font.getTextSize(h)[0];if(k+j>this.size[0]&&m!=""&&(this.lines.push({t:m,e:!1}),l+=this.font.getTextSize(m)[1],m="",k=0,h[0]==" "||h[0]=="\t"))h=h.substr(1,
h.length);m+=h;k+=j}h=""}h+=e}m&&(this.lines.push({t:m,e:!0}),l+=this.font.getTextSize(m)[1],m="",k=0)}this.resize([this.width,l]);this.refresh()};K.prototype.paint=function(){D.prototype.paint.apply(this,[]);var a=0;this.lines.forEach(function(b){var c=this.font.getTextSize(b.t),d=0;if(this.justify&&!b.e){for(var e=d=0;e<b.t.length;e++)b.t[e]==" "&&d++;d=Math.floor((this.size[0]-c[0])/d)}this.font.render(this.surface,b.t,[0,a],this.font.space_width+d);a+=c[1]},this)};var R=c.GUI=function(a){R.superConstructor.apply(this,
[{position:[0,0],parent:null,size:a.getSize(),surface:a}]);this.type="gui";this.locked_frame=null;this.frames=[]};k.utils.objects.extend(R,D);R.prototype.draw=function(a){a&&this.refresh();var b=D.prototype.draw.apply(this,[]);this.frames.forEach(function(a){if(a.visible&&(a.draw()||b))this.locked_frame&&this.locked_frame.id==a.id&&(this.refresh(),this.blur_bg()),this.surface.blit(a.surface,a.position)},this)};R.prototype.paint=function(){};R.prototype.blur_bg=function(){k.draw.rect(this.surface,
"rgba(192,192, 192, 0.5)",new k.Rect([0,0],this.size),0)};R.prototype.removeFrame=function(a){if(typeof a!="number")a=a.id;for(var b=0;b<this.frames.length;b++)if(this.frames[b].id==a)return this.frames.splice(b,1),this.refresh(),!0;return!1};R.prototype.moveFrameToTop=function(a){for(var c=0;c<this.frames.length;c++){var d=this.frames[c];if(d.id==a.id){if(c==this.frames.length-1)break;this.despatchEvent({type:b});this.frames.splice(c,1);this.frames.push(d);this.refresh();a.despatchEvent({type:o});
break}}};R.prototype.update=function(a){this.children.forEach(function(b){b._update(a)});this.frames.forEach(function(b){b._update(a)})};R.prototype.lockFrame=function(a){this.locked_frame=a;this.refresh()};R.prototype.unlockFrame=function(){this.locked_frame=null;this.refresh()};R.prototype.despatchEvent=function(c){if(c.pos)c.global_pos=c.pos;var d,j;if(c.type==y||c.type==e||c.type==h){var k=!1,m=null,t=null,o=null;for(d=this.frames.length-1;d>=0;d--)if(j=this.frames[d],!(this.locked_frame&&this.locked_frame.id!=
j.id))if(j.visible&&j.getRect().collidePoint(c.pos)){j.despatchEvent(a(c,j.position));c.type==y?m=d:c.type==e&&(t=d);k=!0;j.isFocused()&&(o=d);break}else c.type==y&&j.isFocused()&&j.despatchEvent({type:b});if(m!=null){D.prototype.despatchEvent.apply(this,[{type:b}]);for(d=0;d<this.frames.length;d++)d!=m&&this.frames[d].despatchEvent({type:b})}if(t!=null){D.prototype.despatchEvent.apply(this,[{type:l}]);for(d=0;d<this.frames.length;d++)d!=t&&this.frames[d].despatchEvent({type:l})}!k&&!this.locked_frame?
D.prototype.despatchEvent.apply(this,[c]):D.prototype.handleEvent.apply(this,[c]);o!=null&&this.moveFrameToTop(this.frames[o])}else(c.type==b||c.type==l||c.type==r||c.type==u)&&this.frames.forEach(function(b){b.visible&&(!this.locked_frame||this.locked_frame.id==b.id)&&b.despatchEvent(a(c,b.position))}),this.locked_frame?D.prototype.handleEvent.apply(this,[c]):D.prototype.despatchEvent.apply(this,[c])};c.layout={vertical:function(a,b,c){b=b||0;c=c||0;a.forEach(function(a){a.move([a.position[0],b]);
b+=a.size[1]+c})},horizontal:function(a,b,c){b=b||0;c=c||0;a.forEach(function(a){a.move([b,a.position[1]]);b+=a.size[0]+c})}}}},["gamejs"]);
require.define({gamejs:function(v,c){function a(){var a=0,b=0,c=0,d=0;if(arguments.length===2)arguments[0]instanceof Array&&arguments[1]instanceof Array?(a=arguments[0][0],b=arguments[0][1],c=arguments[1][0],d=arguments[1][1]):(a=arguments[0],b=arguments[1]);else if(arguments.length===1&&arguments[0]instanceof Array)a=arguments[0][0],b=arguments[0][1],c=arguments[0][2],d=arguments[0][3];else if(arguments.length===1&&arguments[0]instanceof l)a=arguments[0].left,b=arguments[0].top,c=arguments[0].width,
d=arguments[0].height;else if(arguments.length===4)a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3];else throw Error("not a valid rectangle specification");return{left:a||0,top:b||0,width:c||0,height:d||0}}var p=v("./gamejs/utils/matrix"),k=v("./gamejs/utils/objects"),o=["info","warn","error","fatal"],b=2;c.setLogLevel=function(a){if(typeof a==="string"&&o.indexOf(a))b=o.indexOf(a);else if(typeof a==="number")b=a;else throw Error("invalid logLevel ",a," Must be one of: ",o);return b};var d=
c.log=function(){var a=Array.prototype.slice.apply(arguments,[0]);a.unshift(Date.now());window.console!==void 0&&console.log.apply&&console.log.apply(console,a)};c.info=function(){b<=o.indexOf("info")&&d.apply(this,arguments)};c.warn=function(){b<=o.indexOf("warn")&&d.apply(this,arguments)};c.error=function(){b<=o.indexOf("error")&&d.apply(this,arguments)};c.fatal=function(){b<=o.indexOf("fatal")&&d.apply(this,arguments)};var l=c.Rect=function(){var b=a.apply(this,arguments);this.left=b.left;this.top=
b.top;this.width=b.width;this.height=b.height;return this};k.accessors(l.prototype,{bottom:{get:function(){return this.top+this.height},set:function(a){this.top=a-this.height}},right:{get:function(){return this.left+this.width},set:function(a){this.left=a-this.width}},center:{get:function(){return[this.left+this.width/2,this.top+this.height/2]},set:function(){var b=a.apply(this,arguments);this.left=b.left-this.width/2;this.top=b.top-this.height/2}}});l.prototype.move=function(){var b=a.apply(this,
arguments);return new l(this.left+b.left,this.top+b.top,this.width,this.height)};l.prototype.moveIp=function(){var b=a.apply(this,arguments);this.left+=b.left;this.top+=b.top};l.prototype.clip=function(a){if(!this.collideRect(a))return new l(0,0,0,0);var b,c,d,h;if(this.left>=a.left&&this.left<a.right)b=this.left;else if(a.left>=this.left&&a.left<this.right)b=a.left;this.right>a.left&&this.right<=a.right?d=this.right-b:a.right>this.left&&a.right<=this.right&&(d=a.right-b);if(this.top>=a.top&&this.top<
a.bottom)c=this.top;else if(a.top>=this.top&&a.top<this.bottom)c=a.top;this.bottom>a.top&&this.bottom<=a.bottom?h=this.bottom-c:a.bottom>this.top&&a.bottom<=this.bottom&&(h=a.bottom-c);return new l(b,c,d,h)};l.prototype.union=function(a){var b,c;b=Math.min(this.left,a.left);c=Math.min(this.top,a.top);return new l(b,c,Math.max(this.right,a.right)-b,Math.max(this.bottom,a.bottom)-c)};l.prototype.collidePoint=function(){var b=a.apply(this,arguments);return this.left<=b.left&&b.left<=this.right&&this.top<=
b.top&&b.top<=this.bottom};l.prototype.collideRect=function(a){return!(this.left>a.right||this.right<a.left||this.top>a.bottom||this.bottom<a.top)};l.prototype.collideLine=function(a,b){var c=a[0],d=a[1],h=b[0],k=b[1],l=!0,o=!0,p=!0;[[this.left,this.top],[this.left,this.bottom],[this.right,this.top],[this.right,this.bottom]].map(function(a){return(k-d)*a[0]+(c-h)*a[1]+(h*d-c*k)}).forEach(function(a){a>0?o=!1:a<0?l=!1:a===0&&(p=!1)},this);if((l||o)&&p)return!1;return!(c>this.right&&h>this.right||c<
this.left&&h<this.left||d<this.top&&k<this.top||d>this.bottom&&k>this.bottom)};l.prototype.toString=function(){return["[",this.left,",",this.top,"] [",this.width,",",this.height,"]"].join("")};l.prototype.clone=function(){return new l(this)};var r=c.Surface=function(){var b=a.apply(this,arguments),c=b.left,d=b.top;if(arguments.length==1&&arguments[0]instanceof l)c=b.width,d=b.height;this._matrix=p.identity();this._canvas=document.createElement("canvas");this._canvas.width=c;this._canvas.height=d;
this._blitAlpha=1;return this};r.prototype.blit=function(a,b,c){if(b instanceof l){var b=b.clone(),d=a.getSize();if(!b.width)b.width=d[0];if(!b.height)b.height=d[1]}else b=b&&b instanceof Array&&b.length==2?new l(b,a.getSize()):new l([0,0],a.getSize());c=c instanceof l?c:c&&c instanceof Array&&c.length==2?new l(c,a.getSize()):new l([0,0],a.getSize());if(isNaN(b.left)||isNaN(b.top)||isNaN(b.width)||isNaN(b.height))throw Error("[blit] bad parameters, destination is "+b);this.context.save();d=p.translate(p.identity(),
b.left,b.top);d=p.multiply(d,a._matrix);this.context.transform(d[0],d[1],d[2],d[3],d[4],d[5]);srcRect=a.getRect();this.context.globalAlpha=a._blitAlpha;this.context.drawImage(a.canvas,c.left,c.top,c.width,c.height,0,0,b.width,b.height);this.context.restore()};r.prototype.getSize=function(){return[this.canvas.width,this.canvas.height]};r.prototype.getRect=function(){return new l([0,0],this.getSize())};r.prototype.fill=function(a){this.context.save();this.context.fillStyle=a||"#000000";this.context.fillRect(0,
0,this.canvas.width,this.canvas.height);this.context.restore()};r.prototype.clear=function(){var a=this.getSize();this.context.clearRect(0,0,a[0],a[1])};k.accessors(r.prototype,{rect:{get:function(){return this.getRect()}},context:{get:function(){return this._canvas.getContext("2d")}},canvas:{get:function(){return this._canvas}}});r.prototype.clone=function(){var a=new r(this.getRect());a.blit(this);return a};r.prototype.getAlpha=function(){return 1-this._blitAlpha};r.prototype.setAlpha=function(a){if(!isNaN(a)&&
!(a<0||a>1))return this._blitAlpha=1-a,1-this._blitAlpha};r.prototype.getImageData=function(){var a=this.getSize();return this.context.getImageData(0,0,a[0],a[1]).data};c.display=v("./gamejs/display");c.draw=v("./gamejs/draw");c.event=v("./gamejs/event");c.font=v("./gamejs/font");c.http=v("./gamejs/http");c.image=v("./gamejs/image");c.mask=v("./gamejs/mask");c.mixer=v("./gamejs/mixer");c.sprite=v("./gamejs/sprite");c.surfacearray=v("./gamejs/surfacearray");c.time=v("./gamejs/time");c.transform=v("./gamejs/transform");
c.utils={arrays:v("./gamejs/utils/arrays"),objects:v("./gamejs/utils/objects"),matrix:v("./gamejs/utils/matrix"),vectors:v("./gamejs/utils/vectors"),math:v("./gamejs/utils/math")};c.pathfinding={astar:v("./gamejs/pathfinding/astar")};var u=c,h={};c.ready=function(a){function b(){if(!document.body)return window.setTimeout(b,50);k=u.image.preload(h);try{d=u.mixer.preload(h)}catch(a){u.debug("Error loading audio files ",a)}window.setTimeout(c,50)}function c(){if(k()<1||d()<1)return window.setTimeout(c,
100);u.display.init();u.image.init();u.mixer.init();u.event.init();a()}var d=null,k=null;u.time.init();window.setTimeout(b,13);return function(){if(k)return 0.5*k()+0.5*d();return 0.1}};c.preload=function(a){var b=window.$g&&$g.resourceBaseHref||".";b.slice(-1)=="/"&&(b=b.slice(0,b.length-1));a.forEach(function(a){h[a]=(window.$g&&$g.resourceBaseHref||".")+("/"+a).replace(/\/+/g,"/")},this)}}},["gamejs/utils/matrix","gamejs/utils/objects","gamejs/display","gamejs/draw","gamejs/event","gamejs/font",
"gamejs/http","gamejs/image","gamejs/mask","gamejs/mixer","gamejs/sprite","gamejs/surfacearray","gamejs/time","gamejs/transform","gamejs/utils/arrays","gamejs/utils/vectors","gamejs/utils/math","gamejs/pathfinding/astar"]);
require.define({gamescenes:function(v,c){function a(b){b.size=[220,200];a.superConstructor.apply(this,[b]);this.scene=b.scene;this.quitbtn=new u.Button({parent:this,text:"Quit",size:[180,40],lean:"both",position:[20,20]});this.quitbtn.onClick(function(){this.close();this.scene.game.showGameOver(this.scene.genScoreTable())},this);this.continuebtn=new u.Button({parent:this,text:"Continue",size:[180,40],lean:"both",position:[20,70]});this.continuebtn.onClick(function(){this.close();this.scene.paused=
!1},this)}var p=v("gamejs"),k=v("./utils"),o=v("./sounds"),b=v("./combatracer"),d=v("./cars"),l=v("./bots");v("./box2d");var r=v("./gamejs-gui"),u=v("./ui"),h=p.utils.math;radians=h.radians;degrees=h.degrees;var y=v("./world"),e=v("./renderer"),t=v("./settings"),L=v("./controllers");v("./car_descriptions");var h=c.LevelScene=function(a){this.game=b.game;this.level=a;this.cache=e.cache;this.paused=this.started=!1;this.time_to_start=3E3;this.controllers=[];this.keys_down={};this.started=!1;this.max_laps=
3;this.gui=new r.GUI(this.game.display);this.background=k.renderLevelBackground(a,!0);this.world=y.buildWorld(a,y.MODE_STANDALONE);this.renderer=new e.RaceRenderer(t.get("SCREEN_WIDTH"),t.get("SCREEN_HEIGHT"),this.world,this.background,this.cache);this.handleEvent=function(a){if(a.type===p.event.KEY_DOWN){this.keys_down[a.key]=!0;if(a.key===p.event.K_SPACE)this.paused=!this.paused;if(a.key===p.event.K_ESC&&this.dialog)this.dialog.visible?(this.paused=!1,this.dialog.hide()):(this.paused=!0,this.dialog.show())}else a.type===
p.event.KEY_UP&&(this.keys_down[a.key]=!1);this.gui.despatchEvent(a)};this.updateZoom=function(){this.keys_down[p.event.K_p]?this.renderer.increaseZoom():this.keys_down[p.event.K_l]&&this.renderer.decreaseZoom()};this.destroy=function(){t.get("SOUND")&&o.engine.stop()}},H=c.MultiplayerLevelScene=function(a,b,c){H.superConstructor.apply(this,[a,b,c]);this.game=a;this.processed_events={};this.world.mode=y.MODE_CLIENT;this.last_known_event_no=this.last_event_no=0;this.queued_updates=[];this.time_to_start=
3E3;this.player_car=null;this.delta=this.time=this.upds_stacked=0;this.last_t=null;this.deltas=[];this.delta_q=0;this.states={};this.queued_events={};this.extradelay=50;this.last_upd_time=0;this.carid=null;this.bfs=0;this.send_update=!0;this.time_since_last_update_sent=0;this.state=1;this.controllers[this.controllers.length]=this.controller=new L.MultiplayerController;this.setState=function(a){var b=0,c=0,d;for(d in this.states){if(d==a){b=d;c=0;break}if(d<a&&d>b)b=d;else if(d>a&&(d<c||c===0))c=d}if(b||
c){d=this.states[b];var e=c?this.states[c]:null,h=0;b&&c&&(h=(a-b)/(c-b));var k,l;for(l in d)if(k=this.world.getObjectById(l))e&&e[l]&&k.interpolate?(c=k.interpolate(d[l],e[l],h),this.last_upd_time=a):(this.bfs++,c=d[l],this.last_upd_time=b),k.setState(c)}else console.log("no known state!")};this.update=function(a){this.time+=a;this.handleWorldUpdate();this.paused=!1;this.updateZoom(a);if(this.time_to_start<0)this.started=!0;var b=this.time+this.delta-10;this.processEvents(b);if(this.started){this.setState(b);
if(b>this.last_upd_time)this.world.b2world.Step((b-this.last_upd_time)/1E3,10,8),this.world.b2world.ClearForces(),this.last_upd_time=b;this.controllers.forEach(function(b){if(b.update(this.keys_down,a))this.send_update=!0},this);this.world.update(a)}this.time_since_last_update_sent+=a;if(this.time_since_last_update_sent>1E3&&!this.send_update)this.send_update=!0;this.sendInfo()};this.sendInfo=function(){if(this.send_update)this.game.getCommunicator().queueMessage("GAME_UPDATE",{actions:this.controller.actions,
eventno:this.last_known_event_no}),this.send_update=!1,this.time_since_last_update_sent=0};this.processEvents=function(a){for(;this.queued_events[this.last_event_no+1]&&this.queued_events[this.last_event_no+1].t<=a;){var b=this.queued_events[this.last_event_no+1];this.world.handleEvent(b.type,b.descr);this.last_event_no=b.no;delete this.queued_events[b.no];if(!this.player_car&&this.carid&&(obj=this.world.getObjectById(this.carid)))this.player_car=obj,this.renderer.follow(obj),this.game.getCommunicator().queueMessage("GAME_READY",
{})}};this.handleWorldUpdate=function(){this.queued_updates.forEach(function(a){this.time_to_start=a.tts;this.state=a.st;a.events.forEach(function(b){if(b.no>this.last_event_no&&!this.queued_events[b.no])b.t=a.t,this.queued_events[b.no]=b,this.last_known_event_no=b.no},this);this.carid=a.carid;this.states[a.t]=a.states;this.last_t=a.t;this.upds_stacked=0},this);for(var a in this.states)a<this.time+this.delta-300&&a!=this.last_t&&delete this.states[a];if(this.queued_updates.length)a=this.time-this.queued_updates[0].t,
this.deltas.push(a),dlen=this.deltas.length,this.delta_q+=a,dlen>60&&(this.delta_q-=this.deltas.shift(),dlen=60),this.delta=parseInt(this.delta_q/dlen);this.queued_updates=[]};this.draw=function(a,b){this.renderer.render(a);t.get("SOUND")&&(this.renderer.follow_object&&this.renderer.follow_object.type=="car"&&o.engine.play_by_speed(this.renderer.follow_object.getSpeedKMH(),this.renderer.follow_object.max_speed),o.engine.update(b));this.state==2&&this.renderer.follow_object.active==!1&&this.world.objects.car.some(function(a){if(a.active)return this.renderer.follow_object=
a,!0;return!1},this);this.renderer.renderHUD(a,{car:this.player_car,max_laps:this.max_laps,time_to_start:this.time_to_start,paused:this.paused,delta:this.delta,msDuration:b,bfs:this.bfs,message:this.state==2?"Finished!":""})};this.handleMessage=function(a,b){a=="GAME_UPDATE"?this.queued_updates[this.queued_updates.length]=b:a=="GAME_OVER"?this.game.showGameOver(b.table):a=="CRITICAL_ERR"&&(this.returnToTitle(),this.game.title_scene.alert(b.text))}};p.utils.objects.extend(H,h);var C=c.SingleplayerLevelScene=
function(c,e){C.superConstructor.apply(this,[c]);this.dialog=new a({parent:this.gui,scene:this});this.test_ai=e;var h=d.carEventFromDescription([this.world.start_positions[1].x,this.world.start_positions[1].y],this.world.start_positions[1].angle,b.game.player.singleplayer.car,b.game.player.alias,!0);this.player_car=this.world.event("create",h);this.test_ai?this.controllers.push(new L.AIController(this.player_car,this.world,this)):this.controllers.push(new L.PlayerCarController(this.player_car));if(!this.test_ai)for(i=
1;i<4;i++)this.world.start_positions[i+1]&&(h=l.generateBotCarDescr(),h=d.carEventFromDescription([this.world.start_positions[i+1].x,this.world.start_positions[i+1].y],this.world.start_positions[i+1].angle,h,l.names[i],!1),h=this.world.event("create",h),this.controllers.push(new L.AIController(h,this.world,this)));this.renderer.follow(this.player_car);this.update=function(a){this.updateZoom(a);if(this.time_to_start>-1E3&&(this.time_to_start-=a,this.time_to_start<0))this.started=!0;!this.paused&&this.started&&
(this.controllers.forEach(function(b){b.update(this.keys_down,a)},this),this.world.update(a),this.world.b2world.Step(a/1E3,10,8),this.world.b2world.ClearForces());this.player_car.lap>this.max_laps&&this.game.showGameOver(this.genScoreTable(),this.player_car.getRacePosition()==1,"singleplayer")};this.draw=function(a,b){this.renderer.render(a);t.get("SOUND")&&(this.renderer.follow_object&&this.renderer.follow_object.type=="car"&&o.engine.play_by_speed(this.renderer.follow_object.getSpeedKMH(),this.renderer.follow_object.max_speed),
o.engine.update(b));this.renderer.renderHUD(a,{car:this.player_car,max_laps:this.max_laps,msDuration:b,time_to_start:this.time_to_start,paused:this.paused});this.dialog.visible&&this.gui.draw(!0)};this.genScoreTable=function(){var a=this.world.objects.car.map(function(a,b){return{place:a.getRacePosition(),id:b,player:a.alias,kills:a.kills,deaths:a.deaths}});a.sort(function(a,b){if(a.place>b.place)return 1;else if(a.place<b.place)return-1;return 0});return a};this.handleMessage=function(){}};p.utils.objects.extend(C,
h);p.utils.objects.extend(a,r.Dialog)}},["gamejs","utils","sounds","combatracer","cars","bots","box2d","gamejs-gui","ui","world","renderer","settings","controllers","car_descriptions"]);
require.define({json:function(v,c){var a;if(!a)c.JSON=a={};(function(){function p(a){return a<10?"0"+a:a}function k(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=u[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function o(a,b){var c,d,p,u,v=l,x,O=b[a];O&&typeof O==="object"&&typeof O.toJSON==="function"&&(O=O.toJSON(a));typeof h==="function"&&(O=h.call(b,a,O));switch(typeof O){case "string":return k(O);case "number":return isFinite(O)?
String(O):"null";case "boolean":case "null":return String(O);case "object":if(!O)return"null";l+=r;x=[];if(Object.prototype.toString.apply(O)==="[object Array]"){u=O.length;for(c=0;c<u;c+=1)x[c]=o(c,O)||"null";p=x.length===0?"[]":l?"[\n"+l+x.join(",\n"+l)+"\n"+v+"]":"["+x.join(",")+"]";l=v;return p}if(h&&typeof h==="object"){u=h.length;for(c=0;c<u;c+=1)d=h[c],typeof d==="string"&&(p=o(d,O))&&x.push(k(d)+(l?": ":":")+p)}else for(d in O)Object.prototype.hasOwnProperty.call(O,d)&&(p=o(d,O))&&x.push(k(d)+
(l?": ":":")+p);p=x.length===0?"{}":l?"{\n"+l+x.join(",\n"+l)+"\n"+v+"}":"{"+x.join(",")+"}";l=v;return p}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+p(this.getUTCMonth()+1)+"-"+p(this.getUTCDate())+"T"+p(this.getUTCHours())+":"+p(this.getUTCMinutes())+":"+p(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,r,u={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},h;if(typeof a.stringify!=="function")c.stringify=a.stringify=function(a,b,c){var d;r=l="";if(typeof c==="number")for(d=0;d<c;d+=1)r+=" ";else typeof c==="string"&&(r=c);if((h=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return o("",
{"":a})};if(typeof a.parse!=="function")c.parse=a.parse=function(a,c){function d(a,b){var h,k,l=a[b];if(l&&typeof l==="object")for(h in l)Object.prototype.hasOwnProperty.call(l,h)&&(k=d(l,h),k!==void 0?l[h]=k:delete l[h]);return c.call(a,b,l)}var h,a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return h=eval("("+a+")"),typeof c==="function"?d({"":h},""):h;console.log(a);throw new SyntaxError("JSON.parse");}})()}},[]);require.define({levels:function(v,c){var a=v("resources"),p=v("gamejs");c.init=function(){for(var k="",o=0;o<a.levels.length;o++)k=a.levels[o],c[k]=p.http.load("./levels/"+k+".json")}}},["resources","gamejs"]);
require.define({main:function(v){var c=v("gamejs"),a=v("./combatracer"),p=v("./settings"),k=v("./skin"),o=v("./levels");c.display.setCaption("Bandit Racer");var b;b=new Image;b.addEventListener("load",function(){function d(){var a=h.getSize();c.draw.rect(h,k.ui_background,new c.Rect([0,0],a));a=[a[0]/2-v[0]/2,a[1]/2-v[1]/2-100];h.blit(r,a);if(u){var b=u(),b=Math.min(Math.max(b-0.5,0)*2,1);c.draw.rect(h,"black",new c.Rect([a[0]-100,a[1]+260],[v[0]+200,40]),2);c.draw.rect(h,"black",new c.Rect([a[0]-
100,a[1]+260],[(v[0]+200)*b,40]),0)}}var l=document.createElement("canvas");l.width=b.naturalWidth||b.width;l.height=b.naturalHeight||b.height;l.getContext("2d").drawImage(b,0,0);b.getSize=function(){return[b.naturalWidth,b.naturalHeight]};var r=new c.Surface(b.getSize());r._canvas=l;var u,h=l=null,v=r.getSize();p.init();h=c.display.setMode([p.get("SCREEN_WIDTH"),p.get("SCREEN_HEIGHT")]);c.time.fpsCallback(d,this,50);c.preload(a.getPreloadList());o.init();u=c.ready(function(){var b=new a.init;c.time.deleteCallback(d,
50);b.start(h)})},!0);b.src=(window.$g&&$g.resourceBaseHref||".")+"/images/ui/logo.png"}},["gamejs","combatracer","settings","skin","levels"]);
require.define({particles:function(v,c){var a=v("gamejs"),p=v("./box2d"),k=v("./utils"),o=c.Particle=function(b,c,l,o,u,h){this.position=o;this.world=b;this.color=c;this.life=l;this.direction=u;this.height=this.width=0.2;b=new p.b2BodyDef;b.position=k.listToVector(this.position);b.angle=0;b.linearDamping=0;b.angularDamping=0;this.body=this.world.CreateBody(b);b=new p.b2PolygonDef;b.SetAsBox(this.width/2,this.height/2);b.density=1;b.friction=0.3;b.restitution=1;this.type="particle";this.body.CreateShape(b);
this.body.SetMassFromShapes();this.body.SetUserData({obj:this,type:"projectile"});this.world.addParticle(this);console.log("boo");this.update=function(a){this.life-=a;this.life<=0&&this.world.destroy(this)};this.draw=function(b){a.draw.line(b,this.color,b.getScreenPoint(this.body.GetWorldPoint(new p.b2Vec2(0,-0.1))),b.getScreenPoint(this.body.GetWorldPoint(new p.b2Vec2(0,0.1))),2)};this.setSpeed=function(a){this.body.SetLinearVelocity({x:this.direction[0]*(a*1E3/3600),y:this.direction[1]*(a*1E3/3600)})};
this.setSpeed(h);return this};c.burst=function(a){if(!a.color)a.color="#FF6A00";if(!a.count)a.count=10;if(!a.life)a.life=500;var c,l=80/a.count;for(c=0;c<a.count;c++)new o(a.world,a.color,a.life,a.position,k.rotateVector(a.direction,-40+l*(c+1)),100)}}},["gamejs","box2d","utils"]);
require.define({props:function(v,c){var a=v("gamejs"),p=v("./utils"),k=v("./box2d"),o=p.vec,b=a.utils.math;c.rotarrays={};c.BoxProp=function(a){this.size=a.size;this.width=this.size[0];this.height=this.size[1];this.angle=a.angle?a.angle:0;this.world=a.world;this.position=a.position;this.filename=a.filename;this.type="prop";this.getAngle=function(){return p.degrees(this.body.GetAngle())};this.getState=function(){return null};this.setState=function(){};var c=new k.b2BodyDef;c.position=o(this.position);
c.angle=b.radians(a.angle);c.fixedRotation=!0;this.body=this.world.CreateBody(c);this.body.SetUserData(this);a=new k.b2FixtureDef;a.shape=new k.b2PolygonShape;a.shape.SetAsBox(this.width/2,this.height/2);a.restitution=0.4;this.body.CreateFixture(a);this.getAngle=function(){return this.angle};this.draw=null;return this}}},["gamejs","utils","box2d"]);
require.define({renderer:function(v,c){var a=v("gamejs"),p=v("./utils").arr,k=a.utils.math;radians=k.radians;degrees=k.degrees;var o=v("./resources"),b=v("./skin"),d=v("./settings");a.font.Font.prototype.size=function(a){return[this.sampleSurface.context.measureText(a).width*3,this.fontHeight]};a.font.Font.prototype.render=function(b,c){var d=this.size(b),h=new a.Surface(d),k=h.context;k.save();k.font=this.sampleSurface.context.font;k.textBaseline=this.sampleSurface.context.textBaseline;k.textAlign=
this.sampleSurface.context.textAlign;k.fillStyle=k.strokeStyle=c||"#000000";k.fillText(b,d[0]/2,h.rect.height,h.rect.width);k.restore();for(var k=0,l=d[0],o,p=new a.surfacearray.SurfaceArray(h),r=!1,k=0;k<p.getSize()[0];k++){for(o=0;o<p.getSize()[1];o++)if(p.get(k,o)[3]!=0){r=!0;break}if(r)break}r=!1;for(l=p.getSize()[0]-1;l>=0;l--){for(o=0;o<p.getSize()[1];o++)if(p.get(l,o)[3]!=0){r=!0;break}if(r)break}d=Math.floor(d[1]);o=new a.Surface([l-k,d]);o.blit(h,new a.Rect([0,0],o.getSize()),new a.Rect([k,
0],[l-k,d]));return o};var l=c.sprite2rotarray=function(b,c){var d={orig:b,0:b,step:c},h=b.getSize(),k;if(h[0]!=h[1]){var l=Math.max(h[0],h[1]);k=new a.Surface(l,l);k.blit(b,[(l-h[0])/2,(l-h[1])/2]);d[0]=k}else k=b,d[0]=b;for(h=c;h<360;h+=c)d[h]=a.transform.rotate(k,h);return d},r=c.ImageCache=function(){this.cars={};this.props={};this.decals={};this.tiles={};this.animations={};this.fonts={};this.ui={};this.alphabet='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890.,:/!?"|()';this["static"]=
{};o.tiles.forEach(function(b){this.tiles[b]=a.image.load("images/tiles/"+b)},this);o.cars.forEach(function(b){this.cars[b]=l(a.image.load("images/cars/"+b),2)},this);o.props.forEach(function(b){this.props[b]=l(a.image.load("images/props/"+b),5)},this);o.decals.forEach(function(b){this.decals[b]=l(a.image.load("images/decals/"+b),90)},this);o.animations.forEach(function(b){this.animations[b]=a.image.load("images/animations/"+b)},this);o.ui.forEach(function(b){this.ui[b]=a.image.load("images/ui/"+
b)},this);o.statics.forEach(function(b){this["static"][b]=a.image.load("images/static/"+b)},this);this.initFont=function(b,c,d){this.fonts[b]={};for(var c=new a.font.Font(c),h,k=0;k<this.alphabet.length;k++)h=this.alphabet[k],this.fonts[b][h]=c.render(h,d)};this.getDecalSprite=function(a,b){return this.getSpriteFromRotarray(this.decals[a],b)};this.getPropSprite=function(a,b){return this.getSpriteFromRotarray(this.props[a],b)};this.getCarSprite=function(a,b){return this.getSpriteFromRotarray(this.cars[a],
b)};this.getTile=function(a){return this.tiles[a]};this.getLetter=function(a,b){return this.fonts[a][b]};this.getTextSize=function(a,b){var c=0,d=0,h;if(a){for(var k=0;k<a.length;k++)if(h=a[k],h==" ")c+=8;else if(h=this.getLetter(b,h))d=h.getSize(),c+=d[0],d=d[1];return[c,d]}else return[0,0]};this.getAnimationFrameCount=function(a){a=this.animations[a].getSize();return a[0]/a[1]};this.getAnimationSheet=function(a){return this.animations[a]};this.getUIImage=function(a){return this.ui[a]};this.getStaticSprite=
function(a){return this["static"][a]};this.getSpriteFromRotarray=function(a,b){b%a.step!=0&&(b=k.normaliseDegrees(parseInt(b/a.step)*a.step));return a[b]};this.initFont("hud",b.fonts.hud[0],b.fonts.hud[1]);return this};c.cache=null;c.init=function(){c.cache=new r;return c.cache};var u=c.Renderer=function(b,c,d){this.width=b;this.height=c;this.cache=d;this.surface=null;this.textLength=function(a,b){for(var c,d=0,e=0;e<a.length;e++)c=a[e],c==" "?d+=8:(s=this.cache.getLetter(b,c),d+=s.getSize()[0]);
return d};this.fillBackground=function(b){a.draw.rect(this.surface,b,new a.Rect([0,0],this.surface.getSize()))};this.drawRect=function(b,c,d,e){a.draw.rect(this.surface,b,new a.Rect(c,d),e||e===0?e:1)};this.drawLine=function(b,c,d,e){a.draw.line(this.surface,b,c,d,e||e===0?e:1)};this.drawText=function(b,c,d,e,h){ofst=d[0];var e=e?e:1,k,j;for(k=0;k<b.length;k++)j=b[k],j==" "?ofst+=8/e:(j=this.cache.getLetter(c,j),e==1?r1=[ofst,d[1]-10]:(size=j.getSize(),r1=new a.Rect([ofst,d[1]],[parseInt(size[0]/
e),parseInt(size[1]/e)])),(h?h:this.surface).blit(j,r1),ofst+=j.getSize()[0]/e)};return this},h=c.UIRenderer=function(a,b,c){h.superConstructor.apply(this,[a,b,c]);this.cache=c;this.surface=null;this.setSurface=function(a){this.surface=a};this.drawUIImage=function(a,b){this.surface.blit(this.cache.getUIImage(a),b)}};a.utils.objects.extend(h,u);var y=c.RaceRenderer=function(b,c,h,k,l,o){y.superConstructor.apply(this,[b,c,l]);this.display_width=b;this.display_height=c;this.world=h;this.size=[this.width,
this.height];this.follow_object=o;this.offset_y=this.offset_x=0;this.background=k;this.surface=null;this.st=new a.Surface(this.display_width*2,this.display_height*2);this.display=null;this.zoom=1;this.r1=new a.Rect([0,0],[this.display_width,this.display_height]);this.r2=new a.Rect([0,0],[this.width,this.height]);this.follow=function(a){this.follow_object=a};this.updateOffset=function(){if(this.follow_object){var a=this.follow_object.alive?p(this.follow_object.body.GetPosition()):this.follow_object.respawn_location;
this.offset_x=Math.min(Math.max(0,a[0]*h.phys_scale-parseInt(this.width/2)),h.width_px-this.width);this.offset_y=Math.min(Math.max(0,a[1]*h.phys_scale-parseInt(this.height/2)),h.height_px-this.height)}return!1};this.getScreenPoint=function(a){a=p(a);return[a[0]*this.world.phys_scale-this.offset_x,a[1]*this.world.phys_scale-this.offset_y]};this.drawBackground=function(){this.surface.blit(this.background,new a.Rect([0,0],[this.width,this.height]),new a.Rect([this.offset_x,this.offset_y],[this.width,
this.height]))};this.setZoom=function(b){var c=parseInt(this.display_width/b),d=parseInt(this.display_height/b);if(c<=this.world.width_px&&d<=this.world.height_px)this.zoom=b,this.width=parseInt(this.display_width/b),this.height=parseInt(this.display_height/b),this.r2=new a.Rect([0,0],[this.width,this.height]),this.st=new a.Surface(this.width,this.height)};this.increaseZoom=function(){this.zoom<1&&this.setZoom(this.zoom+0.01)};this.decreaseZoom=function(){this.zoom>0.5&&this.setZoom(this.zoom-0.01)};
this.render=function(a){this.surface=this.zoom==1?a:this.st;this.updateOffset();this.drawBackground();this.world.draw(this);this.zoom!=1&&a.blit(this.surface,this.r1,this.r2)};this.drawLine=function(b,c,d){a.draw.line(this.surface,b,this.getScreenPoint(c),this.getScreenPoint(d),2)};this.drawProp=function(a,b,c){a=this.cache.getPropSprite(a,c?c:0);c=a.getSize()[0]/2;b=this.getScreenPoint(b);this.surface.blit(a,[b[0]-c,b[1]-c])};this.drawDecal=function(a,b,c){a=this.cache.getDecalSprite(a,c?c:0);c=
a.getSize()[0]/2;b=this.getScreenPoint(b);this.surface.blit(a,[b[0]-c,b[1]-c])};this.drawCar=function(a,b,c){a=this.cache.getCarSprite(a,c?c:0);c=a.getSize()[0]/2;b=this.getScreenPoint(b);this.surface.blit(a,[b[0]-c,b[1]-c])};this.drawStatic=function(a,b){var c=this.cache.getStaticSprite(a),d=c.getSize(),b=this.getScreenPoint(b);this.surface.blit(c,[b[0]-d[0]/2,b[1]-d[1]/2])};this.drawAnimation=function(b,c,d){var b=this.cache.getAnimationSheet(b),e=b.getSize()[1],c=this.getScreenPoint(c);this.surface.blit(b,
new a.Rect([c[0]-e/2,c[1]-e/2],[e,e]),new a.Rect([d*e,0],[e,e]))};this.renderHUD=function(a,b){this.surface=a;this.drawText("FPS: "+parseInt(1E3/b.msDuration),"hud",[10,10]);var c=a.getSize(),e=b.car;e&&(this.drawText("POS: "+e.getRacePosition()+"/"+this.world.objects.car.length,"hud",[c[0]/2-140,10]),this.drawText("LAP: "+e.lap+"/"+b.max_laps,"hud",[c[0]/2+20,10]),this.drawText("SPEED: "+parseInt(e.getSpeedKMH()),"hud",[10,a.getSize()[1]-40]),e.front_weapon&&this.drawText("AMMO: "+parseInt(e.front_weapon.ammo),
"hud",[250,a.getSize()[1]-40]),e.rear_weapon&&this.drawText("MINES: "+parseInt(e.rear_weapon.ammo),"hud",[450,a.getSize()[1]-40]));d.get("DEBUG")&&(b.delta&&this.drawText("D: "+Math.abs(b.delta),"hud",[10,80]),b.bfs&&this.drawText("BFS: "+b.bfs,"hud",[10,140]));b.paused?this.drawText("PAUSED","hud",[c[0]/2-100,c[1]/2],0.75):b.message?this.drawText(b.message,"hud",[c[0]/2-100,c[1]/2],0.75):(e=b.time_to_start)&&(e>3E3?this.drawText("WAITING FOR OTHERS","hud",[c[0]/2-150,c[1]/2]):e>2E3?this.drawText("GET READY 3...",
"hud",[c[0]/2-150,c[1]/2],0.75):e>1E3?this.drawText("GET READY 2...","hud",[c[0]/2-150,c[1]/2],0.75):e>0?this.drawText("GET READY 1...","hud",[c[0]/2-150,c[1]/2],0.75):e>-1E3&&this.drawText("GO!!!","hud",[c[0]/2-150,c[1]/2],0.75))};return this};a.utils.objects.extend(y,u)}},["gamejs","utils","resources","skin","settings"]);
require.define({resources:function(v,c){c.props=["9tires.png","3tires.png","tire.png"];c.cars=["bandit_blue.png","bandit_green.png","bandit_red.png","bandit_yellow.png","big_wheel.png","brawler_blue.png","brawler_green.png","brawler_red.png","brawler_yellow.png","bullet.png","missile.png","racer_blue.png","racer_green.png","racer_red.png","racer_yellow.png","wheel.png"];c.tiles=["sand.png","grass.png","snow.png"];c.animations=["explosion.png","explosion_small.png","smoke.png"];c.ui=["controls.png",
"garage.png","guncar.png","logo.png"];c.statics=["mine.png"];c.levels=["snowpeakcircuit","drycircuit","deathvalley","spiralraceway"];c.decals=["arrow.png","dideliskampas.png","ilgas.png","issisakojimas.png","kryzius.png","lenktas.png","paprastas.png","siauras.png","siaurasiplatu.png","siaurejantis1.png","siaurejantis2.png","sonaslenktas1.png","sonaslenktas2.png","startbar.png","susikerta.png","trumpas.png","white_bar.png"];c.sound_fx=["bullet_impact_metal.wav","bullet_impact_soft.wav","button_click.wav",
"explosion.wav","machinegun_shot.wav","missile_launch.wav","thud.wav"];c.sound_engine=[]}},[]);require.define({"settings-example":function(v,c){var a=c.settings={SCREEN_WIDTH:800,SCREEN_HEIGHT:600,LOGIC_FPS:60,RENDER_FPS:60,TILE_SCALE:50,PHYS_SCALE:10,SERVER:"ws://www.banditracer.eu:8000",DEBUG:!0,SOUND:!0};c.get=function(c){return a[c]};c.init=function(){for(var c in a)window.hasOwnProperty(c)&&(a[c]=window[c])};c.set=function(c,k){a[c]=k}}},[]);
require.define({settings:function(v,c){var a=c.settings={SCREEN_WIDTH:1300,SCREEN_HEIGHT:800,FPS:60,PHYS_SCALE:10,SERVER:"ws://www.banditracer.eu:8001",DEBUG:!0,SOUND:!1};c.get=function(c){return a[c]};c.init=function(){for(var c in a)window.hasOwnProperty(c)&&(a[c]=window[c])};c.set=function(c,k){a[c]=k}}},[]);
require.define({skin:function(v,c){c.ui_header_background="#FFF";c.ui_background="#E6E6E6";c.alias_background="#333333";c.alert_box_border="black";c.alert_box_background="#E6E6E6";c.fonts={hud:["30px maass","red"],header:["40px maass","#351A15"],"default":["20px maass","#351A15"],small_header:["16px maass","white"],small:["14px maass","black"],alias:["24px maass","#333333"],"16_33":["16px maass","#333333"],alias_label:["40px maass","#FFFFFF"],button:["25px maass","#000"],loading:["40px maass","#351A15"],
"40_black":["40px maass","#000"],"13_grayish":["13px maass","#383736"],sp_btn:["34px maass","#FFF"],header_black:["56px maass","#333333"],header_brown:["56px maass","#A67C52"],editor_ai_wp:["19px maass","#0094FF"],editor_checkpoint:["19px maass","#FF5656"],editor_start_pos:["19px maass","#3AFF51"]};c.single_player_scene={background_color:"#C7B299"};c.dialog={font:"default"};c.sp_car_display={bg_color:"#998675",font1:"13_grayish",font2:"sp_btn"};c.garage_btn={bg_color:"#CCCCCC",bg_color_hover:"#B3B3B3",
label_bg:"#E6E6E6",font:"alias"};c.track_selector={back_color:"#E6E6E6",front_color:"#CCCCCC",item_hover_color:"#D8D8D8",item_font:"16_33"};c.title_button={fill:"#CCCCCC",fill_hover:"#B3B3B3",font:"40_black"};c.sp_button={fill:"#333333",fill_hover:"#000",font:"sp_btn"};c.button={border:"#282828",font:"button",fill:"#CCCCCC",hover_fill:"#B3B3B3",selected_fill:"#FF6A00"};c.trackdisplay={font:"16_33"};c.label={font:"default"};c.textbox={font:"default",border:"#282828",background:"#FFEFAA"};c.table={header_font:"small_header",
data_font:"small",border:"#C6A500",header_fill:"#333333",hover_fill:"#FFBE00",body_fill:"#CCCCCC",selected_fill:"#FF6A00"};c.trackinfodisplay={header_font:"default",outline_color:"#808080"}}},[]);
require.define({sounds:function(v,c){function a(a,b){this.audios=[];this.next=0;for(var c,d=0;d<b;d++)c=new k.mixer.Sound("sounds/fx/"+a),c.setVolume(0.2),this.audios.push(c);this.play=function(){this.audios[this.next].play();this.next++;if(this.next==this.audios.length)this.next=0};return this}function p(){this.audios={};this.playing=null;this.t=0;this.third_launched=this.second_launched=!1;this.play=function(){};this.play_by_speed=function(a,b){a<5?this.play(0):this.play(Math.min(parseInt(Math.ceil(a*
10/(b*2))),5))};this.stop=function(){};this.update=function(a){if(this.playing!==null)this.t<=0?(this.playing.seek(0),this.t=300):this.t-=a}}var k=v("gamejs"),o=v("./resources"),b=v("./settings"),d={};c.engine=null;c.play=function(a,c){if(b.get("SOUND"))if(a.position&&c){var k=c.getScreenPoint(a.position);k[0]>=0&&k[1]>=0&&k[0]<=c.width&&k[1]<=c.height&&d[a.filename].play()}else d[a.filename].play()};c.init=function(){o.sound_fx.forEach(function(b){d[b]=new a(b,5)});c.engine=new p}}},["gamejs","resources",
"settings"]);
require.define({ui:function(v,c){var a=v("gamejs"),p=v("./gamejs-gui"),k=v("./skin"),o=v("./renderer"),b=v("./settings"),d=v("./combatracer"),l=v("./car_descriptions"),r=v("./levels"),u=v("./utils"),h=v("./sounds");c.fonts={};c.init=function(){for(var a in k.fonts)c.fonts[a]=new p.CachedFont(k.fonts[a][0],k.fonts[a][1])};var y=c.getFont=function(a){return c.fonts[a]},e=function(a){this.background_color=a.background_color||k.ui_background;this.header_height=a.header_height||110;e.superConstructor.apply(this,[a])};
a.utils.objects.extend(e,p.View);e.prototype.paint=function(){a.draw.rect(this.surface,k.ui_header_background,new a.Rect([0,0],[this.surface.getSize()[0],this.header_height]));a.draw.rect(this.surface,this.background_color,new a.Rect([0,this.header_height],[this.surface.getSize()[0],this.surface.getSize()[1]-this.header_height]))};(c.UIScene=function(){var a=this.cache=a=o.cache,c=this.game=d.game;c.display.fill("#FFF");this.gui=new p.GUI(c.display);this.gui.on(p.EVT_PAINT,function(){this.surface.clear()},
this.gui);this.container=new e({position:[0,0],size:[800,600],parent:this.gui});this.gui.center(this.container);this.br_title=new t({position:[60,11],parent:this.container});this.guncar=new p.Image({position:[32,66],parent:this.container,image:a.getUIImage("guncar.png")});this.ping=!1;this.ms_to_ping=1E4;this.dialog=new J({parent:this.gui,size:[450,150]});this.alert=function(a,b){this.dialog.show(a,b)};this.clearAlert=function(){this.dialog.close()};this.handleEvent=function(a){this.gui.despatchEvent(a)};
this.returnToTitle=function(){this.game.showTitle()};this.handleMessageDefault=function(a,b){a==="ERR"?this.alert(b.text):a==="CRITICAL_ERR"?(this.returnToTitle(),this.game.title_scene.alert(b.text)):a==="HELLO"||a==="PONG"||this.alert("Unknown server message:"+a)};this.renderer=new o.UIRenderer(b.get("SCREEN_WIDTH"),b.get("SCREEN_HEIGHT"),this.cache);this.update=function(a){if(this.ping&&(this.ms_to_ping-=a,this.ms_to_ping<=0))this.game.getCommunicator().queueMessage("PING"),this.ms_to_ping=1E4;
this.gui.update(a)};this.draw=function(){this.gui.draw()};return this}).prototype.handleMessage=function(a,b){console.log("uiscene",a,b);this.handleMessageDefault(a,b)};var t=c.BRTitle=function(a){a.text="Bandit Racer";a.font=y("header_black");t.superConstructor.apply(this,[a])};a.utils.objects.extend(t,p.Label);t.prototype.paint=function(){var a=y("header_brown"),b=y("header_black"),c=0;b.render(this.surface,"B",[0,0],null,-3);c+=b.getTextSize("B")[0]-3;a.render(this.surface,"andit ",[c,0],null,
-3);c+=a.getTextSize("andit ")[0]-3;b.render(this.surface,"R",[c,0],null,-3);c+=b.getTextSize("R")[0]-3;a.render(this.surface,"acer",[c,0],null,-3)};var L=c.NameInput=function(a){a.size=[200,40];a.font=y("alias");a.scw_size=[190,40];L.superConstructor.apply(this,[a])};a.utils.objects.extend(L,p.TextInput);L.prototype.paint=function(){this.surface.clear();a.draw.polygon(this.surface,"#FFF",[[10,0],[this.size[0],0],[this.size[0]-10,this.size[1]],[0,this.size[1]]])};var H=c.TitleButton=function(a){a.font=
a.font||y(k.title_button.font);H.superConstructor.apply(this,[a]);this.onClick(function(){h.play({filename:"button_click.wav"})})};a.utils.objects.extend(H,p.Button);H.prototype.paint=function(){var b=this.isHovered()?k.title_button.fill_hover:k.title_button.fill;this.surface.clear();a.draw.polygon(this.surface,b,[[40,0],[this.size[0],0],[this.size[0],this.size[1]],[0,this.size[1]]])};var C=c.Button=function(a){a.font=a.font||y(k.button.font);this.fill=a.fill||k.button.fill;this.hover_fill=a.hover_fill||
k.button.hover_fill;this.lean=a.lean||"right";C.superConstructor.apply(this,[a]);this.onClick(function(){h.play({filename:"button_click.wav"})})};a.utils.objects.extend(C,p.Button);C.prototype.paint=function(){var b=this.isHovered()?this.hover_fill:this.fill;this.surface.clear();this.lean=="right"?a.draw.polygon(this.surface,b,[[10,0],[this.size[0],0],[this.size[0],this.size[1]],[0,this.size[1]]]):this.lean=="both"?a.draw.polygon(this.surface,b,[[10,0],[this.size[0],0],[this.size[0]-10,this.size[1]],
[0,this.size[1]]]):a.draw.polygon(this.surface,b,[[0,0],[this.size[0]-10,0],[this.size[0],this.size[1]],[0,this.size[1]]])};var J=c.Dialog=function(a){J.superConstructor.apply(this,[a]);this.label=new p.Label({position:[0,0],parent:this,font:y(k.dialog.font),text:"b"});this.btn=new C({position:[0,0],size:[150,50],parent:this,lean:"both",text:"Ok"});this.center(this.btn);this.btn.move([this.btn.position[0],this.btn.position[1]+30]);this.btn.onClick(function(){this.close()},this)};a.utils.objects.extend(J,
p.Dialog);J.prototype.show=function(a,b){b==void 0&&(b=!0);this.label.setText(a);this.center(this.label);this.label.move([this.label.position[0],this.label.position[1]-30]);b?this.btn.show():this.btn.hide();p.Dialog.prototype.show.apply(this,[])};var x=c.GoToGarage=function(a){a.size=[210,180];x.superConstructor.apply(this,[a]);this.img=new p.Image({position:[0,0],parent:this,image:o.cache.getUIImage("garage.png")});this.center(this.img);this.img.move([this.img.position[0],7]);this.lbl=new p.Label({position:[0,
0],parent:this,font:y(k.garage_btn.font),text:"Garage"});this.center(this.lbl);this.lbl.move([this.lbl.position[0],this.size[1]-this.lbl.size[1]-17])};a.utils.objects.extend(x,p.View);x.prototype.paint=function(){this.surface.fill(k.garage_btn.label_bg);a.draw.rect(this.surface,this.isHovered()?k.garage_btn.bg_color_hover:k.garage_btn.bg_color,new a.Rect([0,0],[this.size[0],126]))};var O=c.CarDisplay=function(a){a.size=[210,65];O.superConstructor.apply(this,[a]);this.gameinfo=a.gameinfo;new p.Label({parent:this,
position:[10,6],font:y(k.sp_car_display.font1),text:"Current Car:"});this.carlbl=new p.Label({parent:this,position:[20,17],font:y(k.sp_car_display.font2),text:l[this.gameinfo.car.type].name});this.upbtn=new P({parent:this,position:[170,10],size:[30,20],direction:"up"});this.cararray=["Racer","Brawler","Bandit"];this.upbtn.onClick(function(){var a=this.cararray.indexOf(this.gameinfo.car.type)+1;a==3&&(a=0);this.setCar(this.cararray[a])},this);this.downbtn=new P({parent:this,position:[170,35],size:[30,
20],direction:"down"});this.setCar=function(a){this.gameinfo.car.type=a;this.carlbl.setText(l[this.gameinfo.car.type].name);this.gameinfo.car.front_weapon.type=a=="Brawler"?"MissileLauncher":"Machinegun"};this.downbtn.onClick(function(){var a=this.cararray.indexOf(this.gameinfo.car.type)-1;a==-1&&(a=2);this.setCar(this.cararray[a])},this)};a.utils.objects.extend(O,p.View);O.prototype.paint=function(){a.draw.polygon(this.surface,k.sp_car_display.bg_color,[[0,0],[this.size[0],0],[this.size[0],this.size[1]-
20],[this.size[0]-20,this.size[1]],[0,this.size[1]]])};TrackSelectorItem=c.TrackSelectorItem=function(a){a.size=[226,22];this.track=a.track;this.track_obj=r[this.track];TrackSelectorItem.superConstructor.apply(this,[a]);this.label=new p.Label({position:[0,0],parent:this,font:y(k.track_selector.item_font),text:this.track_obj.title});this.center(this.label);this.label.move([this.size[0]-this.label.size[0]-16,this.label.position[1]]);this.selected=!1;this.on(p.EVT_MOUSE_DOWN,this.select,this)};a.utils.objects.extend(TrackSelectorItem,
p.View);TrackSelectorItem.prototype.select=function(){this.selected=!0;this.refresh();this.despatchEvent({type:"track_select",track:this.track})};TrackSelectorItem.prototype.deselect=function(){this.selected=!1;this.refresh()};TrackSelectorItem.prototype.paint=function(){this.surface.fill(this.selected?k.track_selector.front_color:this.isHovered()?k.track_selector.item_hover_color:k.track_selector.back_color)};TrackSelector=c.TrackSelector=function(b){b.size=[536,320];TrackSelector.superConstructor.apply(this,
[b]);this.track=null;this.tbg1=new p.View({position:[0,0],size:[226,261],parent:this});this.tbg1.on(p.EVT_PAINT,function(){a.draw.polygon(this.surface,k.track_selector.back_color,[[0,0],[this.size[0],0],[this.size[0],this.size[1]],[20,this.size[1]],[0,this.size[1]-20]])},this.tbg1);this.tbg2=new p.View({position:[226,0],size:[310,320],parent:this});this.tbg2.on(p.EVT_PAINT,function(){this.surface.fill(k.track_selector.front_color)},this.tbg2);this.trackdisplay=new Q({parent:this.tbg2,position:[0,
0]});for(var c in r)r[c].title&&(b=new TrackSelectorItem({parent:this.tbg1,track:c,position:[0,0]}),b.on("track_select",this.select,this));p.layout.vertical(this.tbg1.children,16)};a.utils.objects.extend(TrackSelector,p.View);TrackSelector.prototype.select=function(a){this.track=a.track;this.tbg1.children.forEach(function(a){a.track!=this.track&&a.deselect()},this);this.trackdisplay.setTrack(this.track)};var Q=c.TrackDisplay=function(a){this.lbl=this.img=this.track=null;a.size=[310,320];Q.superConstructor.apply(this,
[a]);a.track&&this.setTrack(a.track);this.lbl2=new p.Label({parent:this,position:[0,0],font:y(k.trackdisplay.font),text:"Select a track!"});this.center(this.lbl2)};a.utils.objects.extend(Q,p.View);Q.prototype.setTrack=function(b){if(this.track=b){this.lbl2.hide();var c=u.renderLevelBackground(r[b],!1),d=c.getSize(),e=d[0]>d[1]?d[0]/280:d[1]/280,d=[parseInt(d[0]/e),parseInt(d[1]/e)];s=new a.Surface(d[0],d[1]);s.blit(c,new a.Rect([0,0],d),new a.Rect([0,0],c.getSize()));this.img?(this.img.resize(s.getSize()),
this.img.setImage(s)):this.img=new p.Image({parent:this,position:[15,10],image:s});this.lbl?this.lbl.setText(r[b].title):this.lbl=new p.Label({parent:this,position:[0,0],text:r[b].title,font:y(k.trackdisplay.font)});this.center(this.lbl);this.lbl.move([this.lbl.position[0],this.size[1]-this.lbl.size[1]-5])}};var j=c.Table=function(a){j.superConstructor.apply(this,[a]);this.columns=a.columns;this.data=a.data;this.header=new p.View({parent:this,size:[this.size[0],30],position:[0,0]});this.header.on(p.EVT_PAINT,
function(){this.surface.fill(k.table.header_fill)},this.header);var b=0;this.columns.forEach(function(a){new p.Label({parent:this.header,position:[b+20,3],font:y(k.table.header_font),text:a.label});b+=a.width},this);this.body=new p.View({parent:this,size:[this.size[0],this.size[1]-30],position:[0,30]});this.body.on(p.EVT_PAINT,function(){this.surface.fill(k.table.body_fill)},this.body);this.data&&this.setData(this.data)};a.utils.objects.extend(j,p.View);j.prototype.setData=function(a){this.body.children=
[];var b=0,c;a.forEach(function(a){c=0;var d=new p.View({parent:this.body,size:[this.size[0],30],position:[0,b]});this.columns.forEach(function(b){new p.Label({parent:d,position:[c+20,3],font:y(k.table.header_font),text:String(a[b.key]),font:y(k.table.data_font)});c+=b.width},this);b+=30},this)};var P=c.IncrementButton=function(b){var c=new a.Surface(b.size),d=new a.Surface(b.size),e=b.direction=="up"?[[parseInt(b.size[0]/2),0],b.size,[0,b.size[1]]]:b.direction=="down"?[[0,0],[b.size[0],0],[parseInt(b.size[0]/
2),b.size[1]]]:b.direction=="left"?[[0,parseInt(b.size[1]/2)],[b.size[0],0],b.size]:[[0,0],[b.size[0],parseInt(b.size[1]/2)],[0,b.size[1]]];a.draw.polygon(c,k.title_button.fill,e);a.draw.polygon(d,k.title_button.fill_hover,e);b.image=c;b.image_hover=d;b.image_down=!1;P.superConstructor.apply(this,[b]);this.onClick(function(){h.play({filename:"button_click.wav"})})};a.utils.objects.extend(P,p.Button)}},["gamejs","gamejs-gui","skin","renderer","settings","combatracer","car_descriptions","levels","utils",
"sounds"]);
require.define({uiscenes:function(v,c){var a=v("gamejs"),p=v("./ui");v("./utils");var k=v("./levels");v("./car_descriptions");var o=v("./gamejs-gui"),b=v("./skin"),d=v("./combatracer"),l=c.GameOverScene=function(a,b){l.superConstructor.apply(this,[]);this.titlelbl=new o.Label({parent:this.container,position:[210,40],text:"Race Over",font:p.getFont("header_black")});this.label=new o.Label({parent:this.container,position:[30,120],text:b?"You win! Well done.":"You lose! Better luck next time.",font:p.getFont("header")});
new p.Table({parent:this.container,size:[460,300],position:[30,200],columns:[{key:"place",label:"Place",width:80},{key:"player",label:"Player",width:200},{key:"kills",label:"Kills",width:80},{key:"deaths",label:"Deaths",width:80}],data:a});(new p.Button({parent:this.container,position:[650,500],size:[150,50],lean:"right",text:"Continue..."})).onClick(function(){this.game.returnTo()},this)};a.utils.objects.extend(l,p.UIScene);var r=c.TitleScene=function(c,d){r.superConstructor.apply(this,[c,d]);this.container.on(o.EVT_PAINT,
function(){a.draw.polygon(this.surface,b.alias_background,[[0,110],[420,110],[390,180],[0,180]])},this.container);new o.Image({position:[40,260],parent:this.container,image:this.cache.getUIImage("logo.png")});new o.Label({position:[50,115],parent:this.container,font:p.getFont("alias_label"),text:"name:"});this.nameinput=new p.NameInput({position:[178,129],size:[200,40],text:"Guest",parent:this.container});this.nameinput.on(o.EVT_CHANGE,function(a){this.game.player.alias=a.value},this);this.btn_single=
new p.TitleButton({position:[440,210],size:[360,65],text:"Single player",parent:this.container});this.btn_single.onClick(this.singleplayer,this);this.btn_editor=new p.TitleButton({position:[440,300],size:[360,65],text:"Track Editor",parent:this.container});this.btn_editor.onClick(this.editTrack,this)};a.utils.objects.extend(r,p.UIScene);r.prototype.editTrack=function(){this.game.showEditor()};r.prototype.handleMessage=function(a,b){a=="HELLO"?(this.game.player.uid=b.uid,this.game.acquainted=!0,this.clearAlert(),
this.game.showLobbyList()):this.handleMessageDefault(a,b)};r.prototype.joinLobby=function(){var a=this.game.player.alias;a?(this.alert("Connecting. Please wait...",!1),this.game.getCommunicator().queueMessage("HI",{alias:a})):this.alert("You must enter your name first!")};r.prototype.singleplayer=function(){this.game.singleplayer()};var u=c.SinglePlayerScene=function(a,c){u.superConstructor.apply(this,[a,c]);this.container.header_height=130;this.container.background_color=b.single_player_scene.background_color;
this.container.refresh();this.titlelbl=new o.Label({parent:this.container,position:[210,40],text:"Single Player",font:p.getFont("header_black")});this.backbtn=new p.Button({size:[130,50],parent:this.container,position:[0,520],lean:"left",fill:b.sp_button.fill,font:p.getFont(b.sp_button.font),hover_fill:b.sp_button.fill_hover,text:"BACK"});this.backbtn.onClick(this.back,this);this.racebtn=new p.Button({size:[130,50],parent:this.container,position:[this.container.size[0]-130,520],lean:"right",fill:b.sp_button.fill,
font:p.getFont(b.sp_button.font),hover_fill:b.sp_button.fill_hover,text:"RACE!"});this.racebtn.onClick(this.race,this);this.gotogarage=new p.GoToGarage({position:[14,160],parent:this.container});this.gotogarage.on(o.EVT_MOUSE_DOWN,function(){this.alert("Coming soon!",!0)},this);this.car_display=new p.CarDisplay({position:[14,356],gameinfo:d.game.player.singleplayer,parent:this.container});this.track_selector=new p.TrackSelector({position:[254,160],parent:this.container})};a.utils.objects.extend(u,
p.UIScene);u.prototype.back=function(){this.game.showTitle()};u.prototype.race=function(){this.track_selector.track?this.game.playLevel(k[this.track_selector.track],!1,!0,"singleplayer"):this.alert("You must select a track first!",!0)};var h=c.ControlsSplash=function(a,c,d){h.superConstructor.apply(this,[a,c]);this.container.destroy();this.next_scene=d;this.gui.on(o.EVT_PAINT,function(){this.surface.fill(b.ui_background)},this.gui);a=new o.Image({position:[0,0],image:c.getUIImage("controls.png"),
parent:this.gui});this.gui.center(a);a.move([a.position[0],a.position[1]-50]);c=new o.Label({position:[0,0],parent:this.gui,text:"Press any key or click to continue...",font:p.getFont("header")});this.gui.center(c);c.move([c.position[0],a.position[1]+a.size[1]+30]);this.gui.despatchEvent({type:o.EVT_FOCUS});this.gui.on(o.EVT_MOUSE_DOWN,this.next,this);this.gui.on(o.EVT_KEY_DOWN,this.next,this)};a.utils.objects.extend(h,p.UIScene);h.prototype.next=function(){this.game.director.replaceScene(this.next_scene)}}},
["gamejs","ui","utils","levels","car_descriptions","gamejs-gui","skin","combatracer"]);
require.define({utils:function(v,c){var a=v("gamejs"),p=a.utils.math,k=v("./box2d");v("./settings");var o=v("./renderer");c.renderLevelBackground=function(b,c){var k=o.cache,r=b.size[0],u=b.size[1],h=new a.Surface([r,u]),v,e,t=k.getTile(b.bgtile),L=t.getSize();for(e=0;e<u;e+=L[1])for(v=0;v<r;v+=L[0])h.blit(t,[v,e]);var H;b.decals.forEach(function(a){H=p.normaliseDegrees(a.a);h.blit(k.getDecalSprite(b.dict[a.f],H),a.p)},this);(c||c==void 0)&&b.props.forEach(function(a){H=p.normaliseDegrees(a.a);h.blit(k.getPropSprite(b.dict[a.f],
H),a.p)},this);return h};c.interpolatePoints=function(a,c,k){return[a[0]+(c[0]>a[0]?1:-1)*Math.abs(c[0]-a[0])*k,a[1]+(c[1]>a[1]?1:-1)*Math.abs(c[1]-a[1])*k]};c.interpolateInts=function(a,c,k){return a+(c>a?1:-1)*Math.abs(c-a)*k};c.copy=function(a,c){for(var k in a)c[k]=a[k];return c};c.vec=function(){if(!arguments.length||!arguments[0].hasOwnProperty("x"))if(arguments.length==1)return new k.b2Vec2(arguments[0][0],arguments[0][1]);else if(arguments.length==2)return new k.b2Vec2(arguments[0],arguments[1]);
else throw"kablooie";else return arguments[0]};c.vectorToList=c.arr=function(a){if(a.hasOwnProperty("x"))return[a.x,a.y];return a};c.removeObjFromList=function(a,c){for(var k=0;k<c.length;k++)if(c[k]==a){c.splice(k,1);break}}}},["gamejs","box2d","settings","renderer"]);
require.define({weapons:function(v,c){var a=v("gamejs"),p=v("./box2d"),k=v("./utils");v("./sounds");var o=k.vec,b=k.arr,d=a.utils.vectors,l=a.utils.math;radians=l.radians;degrees=l.degrees;v("./animation");l=c.Projectile=function(a){this.weapon=a.weapon;this.speed=a.speed;this.damage=a.damage;this.position=a.position;this.angle=a.angle;this.width=a.width;this.height=a.height;this.speed=a.speed;this.damage=a.damage;this.car=a.car;this.world=this.car.world;this.type="projectile";this.spent=!1;a=new p.b2BodyDef;
a.position=o(this.position);a.type=p.b2Body.b2_dynamicBody;a.angle=radians(this.angle);a.linearDamping=0;a.angularDamping=0;a.bullet=!0;a.fixedRotation=!0;this.body=this.world.CreateBody(a);this.body.SetUserData(this);a=new p.b2FixtureDef;a.shape=new p.b2PolygonShape;a.shape.SetAsBox(this.width/2,this.height/2);a.restitution=1;a.density=1.0E-5;a.friction=0;this.body.CreateFixture(a);this.getState=function(){return{p:b(this.body.GetPosition()),a:degrees(this.body.GetAngle()),lv:b(this.body.GetLinearVelocity())}};
this.interpolate=function(a,b,c){return{p:k.interpolatePoints(a.p,b.p,c),a:k.interpolateInts(a.a,b.a,c),lv:a.lv}};this.setState=function(a){this.body.SetPositionAndAngle(o(a.p),radians(a.a));this.body.SetLinearVelocity(o(a.lv))};this.getSpeedKMH=function(){var a=b(this.body.GetLinearVelocity());return d.len(a)/1E3*3600};this.setSpeed=function(a){var c=this.getSpeedKMH()<1?b(this.car.body.GetWorldVector(o(0,-1))):b(this.body.GetWorldVector(o(0,-1))),c=d.multiply(c,a*1E3/3600);this.body.SetLinearVelocity(o(c))};
this.impact=function(a){if((a.type=="car"||a.type=="prop")&&!this.spent){this.car.world.event("destroy",this.id);a.type=="car"&&a.hit(this.damage,this.car);if(this.onimpact)this.onimpact(a);this.spent=!0}};this.setSpeed(this.speed);this.draw=function(){console.log("draw not implemented for projectile")};this.update=function(){};return this};c.Mine=function(a){this.position=a.position;this.car=a.car;this.height=this.width=2;this.type="mine";this.damage=a.damage;this.world=this.car.world;a=new p.b2BodyDef;
a.position=o(this.position);a.angle=0;a.fixedRotation=!0;a.linearDamping=0;a.angularDamping=0;this.body=this.world.CreateBody(a);this.body.SetUserData(this);a=new p.b2FixtureDef;a.shape=new p.b2PolygonShape;a.shape.SetAsBox(this.width/2,this.height/2);a.isSensor=!0;this.body.CreateFixture(a);this.getState=function(){return null};this.setState=function(){};this.impact=function(a){a.type=="car"&&(this.car.world.objects.car.forEach(function(c){if(c==a||d.distance(this.position,b(c.body.GetPosition()))<=
8)if(c.hit(this.damage,this.car),this.onimpact)this.onimpact()},this),this.car.world.destroyObj(this.id),this.car.world.spawnAnimation("explosion",this.position),this.car.world.playSound("explosion.wav",this.position))};this.draw=function(a){a.drawStatic("mine.png",this.position)};this.destroy=function(){this.car.world.event("destroy",this.id)};return this};var r=c.Missile=function(a){a.width=0.5;a.height=2.5;this.tts=50;r.superConstructor.apply(this,[a]);this.car.world.playSound("missile_launch.wav",
this.position);this.destroy=function(){this.car.world.event("destroy",this.id)};this.onimpact=function(){var a=b(this.body.GetPosition());this.car.world.spawnAnimation("explosion",a);this.car.world.playSound("explosion.wav",a)};this.draw=function(a){this.spent||a.drawCar("missile.png",b(this.body.GetPosition()),degrees(this.body.GetAngle()))};this.update=function(a){this.tts-=a;if(this.tts<0)this.car.world.spawnAnimation("smoke",b(this.body.GetWorldPoint(o([0,1.25])))),this.tts=50};return this};a.utils.objects.extend(r,
l);var u=c.Bullet=function(a){a.width=0.3;a.height=0.8;u.superConstructor.apply(this,[a]);this.color="#FFD800";this.car.world.playSound("machinegun_shot.wav",this.position);this.onimpact=function(a){var c=b(this.body.GetPosition());this.car.world.spawnAnimation("small_explosion",c);a.type=="car"?this.car.world.playSound("bullet_impact_metal.wav",c):a.type=="prop"&&this.car.world.playSound("bullet_impact_soft.wav",c)};this.draw=function(a){this.spent||a.drawCar("bullet.png",b(this.body.GetPosition()),
degrees(this.body.GetAngle()))};this.destroy=function(){this.car.world.destroyObj(this.id)};return this};a.utils.objects.extend(u,l);var l=c.Weapon=function(a){this.car=a.car;this.ammo_capacity=a.ammo_capacity+a.ammo_upgrades*a.ammo_upgrade;this.fire_rate=a.fire_rate;this.ammo=this.cooldown=0;this.damage=a.damage+a.dmg_upgrades*a.dmg_upgrade;this.speed=a.speed;this.projectile=a.projectile;this.update=function(a){this.cooldown>0&&(this.cooldown-=a)};this.reload=function(){this.ammo=this.ammo_capacity};
this.getState=function(){return{a:this.ammo}};this.setState=function(a){this.ammo=a.a};this.fire=function(){if(this.ammo&&this.cooldown<=0)this.car.world.event("create",{type:"weapon",obj_name:this.projectile,pars:{position:this.getFirePos(),damage:this.damage,speed:this.speed,angle:this.car.getAngle(),car:this.car.id}}),this.ammo--,this.cooldown=this.fire_rate,this.ofst_x*=-1};this.getFirePos=function(){var a=b(this.car.body.GetWorldPoint(o(0,-(this.car.height/2+3))));console.log(a);return a};return this},
h=c.Machinegun=function(a){this.type="machinegun";h.superConstructor.apply(this,[a]);this.ofst_x=-0.5;this.getFirePos=function(){this.ofst_x*=-1;return b(this.car.body.GetWorldPoint(o(this.ofst_x,-(this.car.height/2+0.8))))};return this};a.utils.objects.extend(h,l);var y=c.MineLauncher=function(a){this.type="minelauncher";y.superConstructor.apply(this,[a]);this.getFirePos=function(){return b(this.car.body.GetWorldPoint(o(0,this.car.height/2+3)))};return this};a.utils.objects.extend(y,l);var e=c.MissileLauncher=
function(a){this.type="missilelauncher";y.superConstructor.apply(this,[a]);this.getFirePos=function(){return b(this.car.body.GetWorldPoint(o(0,-(this.car.height/2+3))))};return this};a.utils.objects.extend(e,l)}},["gamejs","box2d","utils","sounds","animation"]);
require.define({weapon_descriptions:function(v,c){c.Machinegun={damage:5,type:"front_weapon",launcher:"Machinegun",projectile:"Bullet",speed:500,fire_rate:100,ammo_capacity:50,dmg_upgrade:1,ammo_upgrade:10};c.MissileLauncher={damage:25,speed:400,type:"front_weapon",launcher:"MissileLauncher",projectile:"Missile",fire_rate:300,ammo_capacity:10,ammo_upgrade:2,dmg_upgrade:5};c.MineLauncher={damage:40,type:"rear_weapon",launcher:"MineLauncher",projectile:"Mine",fire_rate:500,ammo_capacity:4,ammo_upgrade:2,
dmg_upgrade:10}}},[]);
require.define({world:function(v,c){var a=v("./box2d"),p=v("./utils"),k=p.vec,o=p.arr,b=v("./weapon_descriptions"),d=v("./car_descriptions"),l=v("./cars");v("./particles");var r=v("./weapons"),u=v("./animation"),h=v("./props"),y=v("./settings"),a=v("./box2d"),e=v("gamejs"),t=v("./sounds"),L=v("./renderer"),H=e.utils.vectors,C=e.utils.math;radians=C.radians;degrees=C.degrees;var J=c.ContactListener=function(b){this.world=b;this.BeginContact=function(b){var c=b.GetFixtureA().GetBody(),d=b.GetFixtureB().GetBody(),
c=c.GetUserData(),d=d.GetUserData();if(c&&d){var e=new a.b2WorldManifold;b.GetWorldManifold(e);e=o(e.m_normal);c.impact&&c.impact(d,b,e);d.impact&&d.impact(c,b,H.rotate(e,radians(180)))}};this.EndContact=function(){};this.PreSolve=function(){};this.PostSolve=function(){};return this},x=c.MODE_CLIENT=1,O=c.MODE_SERVER=2,Q=c.MODE_STANDALONE=3,j={animation:!0},P=c.World=function(c,e,o,v,C,H,F,I){this.next_object_id=1;this.mode=I?I:Q;this.start_positions=F;this.background_zoom=this.background=null;this.phys_scale=
y.get("PHYS_SCALE");this.width_px=o;this.height_px=v;this.width=c;this.height=e;this.size=[this.width,this.height];this.b2world=new a.b2World(k(0,0),!1);this.ai_waypoints=C;this.max_waypoint=0;for(var L in C)this.max_waypoint=Math.max(this.max_waypoint,L);this.checkpoints=H;this.max_checkpoint=0;for(L in H)this.max_checkpoint=Math.max(this.max_checkpoint,L);this.pending_particle_bursts=[];this.objects={};this.object_by_id={};this.destroy_queue=[];this.sound_queue=[];this.b2world.SetContactListener(new J(this));
this.next_event_no=1;this.events={};this.destroy=function(a){this.destroy_queue[this.destroy_queue.length]=this.object_by_id[a]};this.destroyQueued=function(){this.destroy_queue.forEach(function(a){p.removeObjFromList(a,this.objects[a.type]);delete this.object_by_id[a.id];a.body&&this.b2world.DestroyBody(a.body)},this);this.destroy_queue=[]};this.addObject=function(a){a.id=this.next_object_id++;this.objects[a.type]?this.objects[a.type][this.objects[a.type].length]=a:this.objects[a.type]=[a];this.object_by_id[a.id]=
a};this.recordEvent=function(a,b){if(!(a=="create"&&b.type=="prop")){var c=this.next_event_no++;this.events[c]={type:a,no:c,descr:b}}};this.event=function(a,b){this.mode==O&&this.recordEvent(a,b);if(this.mode==Q||this.mode==O)return this.handleEvent(a,b);return null};this.destroyObj=function(a){this.event("destroy",a)};this.spawnAnimation=function(a,b){this.event("create",{type:"animation",obj_name:a,pars:{position:b}})};this.playSound=function(a,b){this.event("create",{type:"sound",obj_name:a,pars:{position:b}})};
this.handleEvent=function(a,b){if(a=="create")return this.create(b);else if(a=="destroy")return this.destroy(b);return null};this.create=function(a){var c=null,e=a.type;if(e=="car"){c=d[a.obj_name];e={world:this};p.copy(a.pars,e);p.copy(c,e);delete e.filenames;var j=this.objects.car?this.objects.car.length:0;e.filename=j>=c.filenames.length?c.filenames[0]:c.filenames[j];e.type=a.obj_name;var c=new l.Car(e),k;for(k in{front_weapon:1,rear_weapon:1,util:1})a.pars[k]&&(e={car:c},p.copy(a.pars[k],e),p.copy(b[e.type],
e),c[k]=new r[e.launcher](e))}else e=="prop"?(e={world:this},e=p.copy(a.pars,e),c=new h.BoxProp(e)):e=="weapon"?(e={world:this},p.copy(a.pars,e),(k=this.getObjectById(a.pars.car))?(e.car=k,c=new r[a.obj_name](e)):console.log("CAR NOT FOUND:"+a.pars.car)):e=="animation"?(e={world:this,position:a.pars.position},p.copy(u.animations[a.obj_name],e),c=new u.Animation(e)):e=="sound"&&y.get("SOUND")&&this.sound_queue.push({filename:a.obj_name,position:a.pars.position});c&&this.addObject(c);return c};this.getObjectById=
function(a){return this.object_by_id[a]};this.updList=function(a,b){var c;for(c=0;c<b.length;c++)b[c].update&&b[c].update(a)};this.drawList=function(a,b){b.forEach(function(b){b.draw&&b.draw(a)})};this.update=function(a){for(var b in this.objects)(this.mode!=x||j[b])&&this.updList(a,this.objects[b]);this.destroyQueued()};this.draw=function(a){for(var b in this.objects)this.drawList(a,this.objects[b]);this.sound_queue.forEach(function(b){t.play(b,a)});this.sound_queue=[]};this.CreateBody=function(a){return this.b2world.CreateBody(a)};
this.addParticleBurst=function(a){this.pending_particle_bursts[this.pending_particle_bursts.length]=a};return this};c.buildWorld=function(a,b){var c=y.get("PHYS_SCALE"),d=a.dict,e={};a.start_positions.forEach(function(a){e[a.n]={x:(a.p[0]+30)/c,y:(a.p[1]+30)/c,angle:a.a}});var h={};a.ai_waypoints.forEach(function(a){h[a.n]={x:(a.p[0]+20)/c,y:(a.p[1]+20)/c}});var j={},k,l;a.checkpoints.forEach(function(a){k=[a.p[0]/c,a.p[1]/c];l=[(a.p[0]+280)/c,(a.p[1]+280)/c];j[a.n]={pt1:k,pt2:l,width:l[0]-k[0],height:l[1]-
k[1],center:[(k[0]+l[0])/2,(k[1]+l[1])/2]}});var o=new P(a.width/c,a.height/c,a.size[0],a.size[1],h,j,e,b),m,p,r,t,u;a.props.forEach(function(a){m=C.normaliseDegrees(a.a);p=L.cache.getPropSprite(d[a.f],m);r=p.getSize();p=L.cache.props[d[a.f]].orig;t=p.getSize();u=[t[0]/c,t[1]/c];o.event("create",{type:"prop",pars:{filename:d[a.f],position:[(a.p[0]+r[0]/2)/c,(a.p[1]+r[1]/2)/c],angle:m,size:u}})});return o}}},["box2d","utils","weapon_descriptions","car_descriptions","cars","particles","weapons","animation",
"props","settings","gamejs","sounds","renderer"]);
