(function(o){var g=function(){throw"Synchronous require() is not supported.";};g.unit={};var p="",j,k,q,r=2E4,m,C=document.getElementsByTagName("head")[0],l=Object.prototype.hasOwnProperty;if(function(){for(var a in{hasOwnProperty:!0})return a}()=="hasOwnProperty")var s=function(a,b,d){for(var c in a)l.call(a,c)&&b.call(d,c)};else var y=["isPrototypeOf","hasOwnProperty","toLocaleString","toString","valueOf"],s=function(a,b,d){for(var c in a)l.call(a,c)&&b.call(d,c);for(var e=y.length;e--;)c=y[e],
l.call(a,c)&&b.call(d,c)};var D=function(a,b){for(var d=0;d<a.length;)b.call(null,a[d],d)===!0?a.splice(d,1):d++},z=function(a,b){var d=a.split("/"),b=b||"";b.length&&b.charAt(b.length-1)!="/"&&(b+="/");var c=b.split("/");c.pop();for(var e;e=d.shift();)e!="."&&(e==".."&&c.length&&c[c.length-1]!=".."?c.pop():c.push(e));return c.join("/")},n=g.unit.resolveModuleId=function(a,b){return a.charAt(0)!="."?a:z(a,b)},t=function(a){return a.charAt(0)!="."?p+a+".js":this._resolveModuleId(a,p)+".js"},i=function(a){if(!l.call(j,
a))return null;return j[a]},E=function(a,b){k.push([a.slice(0),b])},B=function(a,b,d){for(var c=[],e=a.length;e--;){var h=n(a[e],d);i(h);u(h)||c.push(h)}c.length?(E(c,function(){b(v(d))}),A(c)):setTimeout(function(){b(v(d))},0)},v=function(a){var b=function(b){var c=n(b,a);if(b=i(c)){if(b.error)throw"Error loading module";}else throw"Module not loaded";if(!b.exports){b.exports={};for(var c=c.substring(0,c.lastIndexOf("/")+1),e=b.injects,h=[],f=0,w=e.length;f<w;f++)e[f]=="require"?h.push(v(c)):e[f]==
"exports"?h.push(b.exports):e[f]=="module"&&h.push(b.module);b.factory.apply(null,h)}return b.exports};b.ensure=function(b,c){B(b,c,a)};if(m!=null)b.main=i(m).module;return b},A=function(a){for(var b=a.length;b--;){var d=a[b];i(d)==null&&(j[d]={},q(d))}},u=function(a){var b={},d=function(a){if(b[a]==!0)return!0;b[a]=!0;a=i(a);if(!a||!a.defined)return!1;else{for(var a=a.deps||[],e=a.length;e--;)if(!d(a[e]))return!1;return!0}};return d(a)},x=function(){for(var a=0;a<k.length;){for(var b=k[a][0],d=k[a][1],
c=0;c<b.length;)u(b[c])?b.splice(c,1):c++;b.length?a++:(k.splice(a,1),d!=null&&setTimeout(d,0))}};q=function(a){var b,d=function(){var b=i(a);if(!b.defined)b.defined=b.error=!0,x()},c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e=t(a);c.open("GET",e,!0);c.onreadystatechange=function(){if(c.readyState===4)if(clearTimeout(b),c.status==200||c.status===0){for(var h=c.responseText,f=F(h),w=a.substring(0,a.lastIndexOf("/")+1),i={},k=f.length;k--;)f[k]=n(f[k],w);try{i[a]=
o("({fn: function(require, exports, module) {\r\n"+h+"\r\n}})").fn}catch(j){throw j instanceof SyntaxError&&(h="Syntax Error: ",j.lineNumber?h+="line "+(j.lineNumber-581):console.log("GameJs tip: use Firefox to see line numbers in Syntax Errors."),h+=" in file "+e,console.log(h)),j;}g.define(i,f)}else d()};b=setTimeout(d,r);c.send(null)};var F=g.unit.determineShallowDependencies=function(a){for(var b={},d,c=/(?:^|[^\w\$_.])require\s*\(\s*("[^"\\]*(?:\\.[^"\\]*)*"|'[^'\\]*(?:\\.[^'\\]*)*')\s*\)/g;d=
c.exec(a);)d=eval(d[1]),l.call(b,d)||(b[d]=!0);for(c=/(?:^|[^\w\$_.])require.ensure\s*\(\s*(\[("[^"\\]*(?:\\.[^"\\]*)*"|'[^'\\]*(?:\\.[^'\\]*)*'|\s*|,)*\])/g;d=c.exec(a);)for(var e=eval(d[1]),h=e.length;h--;)d=e[h],delete b[d];var f=[];s(b,function(a){f.push(a)});return f},G=function(a){var b=document.createElement("script");b.type="text/javascript";b.src=t(a);var d=!!b.addEventListener,c,e=function(){f(!1)},h=function(){(d||b.readyState=="complete"||b.readyState=="loaded")&&f(i(a).defined)},f=function(f){clearTimeout(c);
d?(b.removeEventListener("load",h,!1),b.removeEventListener("error",e,!1)):b.detachEvent("onreadystatechange",h);if(!f&&(f=i(a),!f.defined))f.defined=f.error=!0,x()};d?(b.addEventListener("load",h,!1),b.addEventListener("error",e,!1)):b.attachEvent("onreadystatechange",h);c=setTimeout(e,r);C.appendChild(b)},H=function(a,b,d){var c={modules:[]},e=["require","exports","module"];typeof a=="object"?(c.deps=b||[],s(a,function(b){var d={id:b};typeof a[b]=="function"?(d.factory=a[b],d.injects=e):(d.factory=
a[b].factory,d.injects=a[b].injects||e);c.modules.push(d)})):(c.deps=b.slice(0),D(c.deps,function(a){a:{for(var b=e.length;b--;)if(e[b]==a){a=b;break a}a=-1}return a>=0}),c.modules.push({id:a,factory:d,injects:b}));return c};g.setModuleRoot=function(a){if(!/^http(s?):\/\//.test(a))var b=window.location.href,b=b.substr(0,b.lastIndexOf("/")+1),a=z(a,b);a.length&&a.charAt(a.length-1)!="/"&&(a+="/");p=a};g.setTimeoutLength=function(a){r=a};g.useScriptTags=function(){q=G};g.def=g.define=function(){for(var a=
H.apply(null,arguments),b=[],d=[],c=a.deps,e=a.modules.length;e--;){var h=a.modules[e],f=h.id,g=i(f);g||(g=j[f]={});g.module={id:f,uri:t(f)};g.defined=!0;g.deps=c.slice(0);g.injects=h.injects;g.factory=h.factory;d.push(g)}for(e=c.length;e--;)f=c[e],g=i(f),(!g||!u(f))&&b.push(f);b.length&&setTimeout(function(){A(b)},0);x()};g.isKnown=function(a){return i(a)!=null};g.isDefined=function(a){a=i(a);return!(!a||!a.defined)};g.ensure=function(a,b){B(a,b,"")};g.run=function(a,b){a=m=n(a,"");g.ensure([a],
function(d){d(a);b!=null&&b()})};g.reset=function(){m=null;j={};k=[];g.define({system:function(){}})};g.reset();window.require=g})(function(o){with(window)return eval(o)});
require.define({"gamejs-gui":function(q,b){function a(f,m){var a={};for(key in f)a[key]=f[key];if(a.pos&&m)a.pos=[a.pos[0]-m[0],a.pos[1]-m[1]];return a}function l(f,m){return[Math.max(parseInt((f[0]-m[0])/2),0),Math.max(parseInt((f[1]-m[1])/2),0)]}var o=q("gamejs"),t=b.EVT_FOCUS="focus",c=b.EVT_BLUR="blur",e=b.EVT_MOUSE_OVER="mouse_over",d=b.EVT_MOUSE_OUT="mouse_out",h=b.EVT_KEY_DOWN=o.event.KEY_DOWN,n=b.EVT_KEY_UP=o.event.KEY_UP,k=b.EVT_MOUSE_UP=o.event.MOUSE_UP,M=b.EVT_MOUSE_DOWN=o.event.MOUSE_DOWN;
b.EVT_MOUSE_WHEEL=o.event.MOUSE_WHEEL;var g=b.EVT_MOUSE_MOTION=o.event.MOUSE_MOTION,y=b.EVT_BTN_CLICK="btn_click",R=b.EVT_CLOSE="close",L=b.EVT_SCROLL="scroll",C=b.EVT_DRAG="drag",G=b.EVT_MOVE="move",v=b.EVT_RESIZE="resize",F=b.EVT_PAINT="paint",S=b.EVT_AFTER_PAINT="after_paint",j=b.EVT_CHANGE="change",z=1,B=b.draggable=function(f){f.grab_pos=null;f.on(M,function(f){this.grab_pos=f.global_pos},f);f.getGUI().on(k,function(){this.grab_pos=null},f);f.getGUI().on(g,function(f){if(this.grab_pos){var a=
this.position,N=[this.position[0]+f.pos[0]-this.grab_pos[0],this.position[1]+f.pos[1]-this.grab_pos[1]];this.grab_pos=f.pos;this.move(N);this.despatchEvent({type:C,old_pos:a,new_pos:this.position})}},f)},Q=b.CachedFont=function(f,m){this.space_width=3;this.tab_width=12;this.chars={};this.font=null;typeof f=="string"?(this.color=m?m:"#000",this.font=new o.font.Font(f)):(this.chars=f,this.font=new o.font.Font("14px Verdana"),this.color="#000");this.space_width=parseInt(Math.ceil(this.getCharSurface("m").getSize()[0]/
3));this.tab_width=3*this.space_width};Q.prototype.getCharSurface=function(f){if(!this.chars[f]){var m=this.font.render(f,this.color);this.chars[f]=m}return this.chars[f]};Q.prototype.getTextSize=function(f){var m=0,a=0,N;if(f){for(var r=0;r<f.length;r++)if(N=f[r],N==" ")m+=this.space_width;else if(N=="\t")m+=this.tab_width;else if(N=this.getCharSurface(N))N=N.getSize(),m+=N[0],a=Math.max(N[1],a);a||(a=this.getCharSurface("m").getSize()[1]);return[m,a]}else return[0,0]};Q.prototype.render=function(f,
m,a,N){ofst=a[0];var N=N?N:this.space_width,r,c;for(r=0;r<m.length;r++)c=m[r],c==" "?ofst+=N:c=="\t"?ofst+=this.tab_width:(c=this.getCharSurface(c),r1=[ofst,a[1]],f.blit(c,r1),ofst+=c.getSize()[0])};b.DEFAULT_FONT=new Q("12px Verdana","black");var u=b.View=function(f){this.type="view";this.id=z++;if(!f.size)throw"View: size must be specified";this.size=f.size;if(!f.position)f.position=[0,0];this.position=[parseInt(f.position[0]),parseInt(f.position[1])];this.surface=f.surface?f.surface:new o.Surface(this.size);
if(f.parent===void 0)throw"Element's parent not given.";this.parent=f.parent;this.visible=f.visible===void 0?!0:f.visible;this.parent&&this.parent.addChild(this);this.children=[];this._refresh=!0;this.is_focused=this.is_hovered=!1;this.listeners={};return this};u.prototype.isFocused=function(){return this.is_focused};u.prototype.isHovered=function(){return this.is_hovered};u.prototype.getSize=function(){return[this.size[0],this.size[1]]};u.prototype.getPosition=function(){return[this.position[0],
this.position[1]]};u.prototype.isVisible=function(){return this.visible};u.prototype.removeChild=function(f){if(typeof f!="number")f=f.id;for(var m=0;m<this.children.length;m++)if(this.children[m].id==f)return this.children.splice(m,1),this.refresh(),!0;return!1};u.prototype.destroy=function(){this.parent&&this.parent.removeChild(this)};u.prototype.getRect=function(){return new o.Rect(this.position,this.size)};u.prototype.rightAlign=function(f){this.move([f-this.getSize()[0],this.getPosition()[1]])};
u.prototype.addChild=function(f){this.children.push(f)};u.prototype.draw=function(){if(!this.visible){if(this._refresh)return this._refresh=!1,!0;return!1}var f=!1;this.children.forEach(function(m){if(m.draw()||this._refresh)f=!0},this);if(this._refresh||f)this.paint(),this.despatchEvent({type:F,surface:this.surface}),this.children.forEach(function(f){f.visible&&this.blitChild(f)},this),this.despatchEvent({type:S,surface:this.surface}),f=!0,this._refresh=!1;return f};u.prototype.blitChild=function(f){this.surface.blit(f.surface,
f.position)};u.prototype.paint=function(){this.surface.clear()};u.prototype.update=function(){};u.prototype._update=function(f){this.children.forEach(function(m){m._update(f)});this.update(f)};u.prototype.on=function(f,m,a){this.listeners[f]||(this.listeners[f]=[]);this.listeners[f].push({callback:m,scope:a})};u.prototype.despatchEventToChildren=function(f){this.children.forEach(function(m){m.despatchEvent(f)})};u.prototype.move=function(f){var m=this.position;this.position=f;this.parent.refresh();
this.despatchEvent({type:G,old_pos:m,new_pos:f})};u.prototype.moveRelative=function(f){this.move([this.position[0]+f[0],this.position[1]+f[1]])};u.prototype.resize=function(f){var m=this.size;this.size=f;this.surface=new o.Surface([Math.max(f[0],1),Math.max(f[1],1)]);this.refresh();this.despatchEvent({type:v,old_size:m,new_size:f})};u.prototype.refresh=function(){this._refresh=!0};u.prototype.show=function(){if(!this.visible)this.visible=!0,this.refresh()};u.prototype.hide=function(){if(this.visible)this.despatchEvent({type:c}),
this.despatchEvent({type:d}),this.visible=!1,this.refresh()};u.prototype.despatchEvent=function(f){if(this.visible)if(f.type==c){if(this.is_focused)this.is_focused=!1,this.refresh(),this.handleEvent(f);this.despatchEventToChildren(f)}else if(f.type==d){if(this.is_hovered)this.is_hovered=!1,this.refresh(),this.handleEvent(f);this.despatchEventToChildren(f)}else f.type==e?(this.is_hovered=!0,this.refresh(),this.handleEvent(f)):f.type==t?(this.is_focused=!0,this.refresh(),this.handleEvent(f)):f.type==
M?(this.isFocused()||this.despatchEvent({type:t}),this.children.forEach(function(m){m.getRect().collidePoint(f.pos)?m.despatchEvent(a(f,m.position)):m.isFocused()&&m.despatchEvent({type:c})},this),this.handleEvent(f)):f.type==k?(this.children.forEach(function(m){m.getRect().collidePoint(f.pos)&&m.despatchEvent(a(f,m.position))},this),this.handleEvent(f)):f.type==g?(this.children.forEach(function(m){m.getRect().collidePoint(f.pos)?(m.isHovered()||m.despatchEvent(a({type:e,pos:f.pos},m.position)),m.despatchEvent(a(f,
m.position))):m.isHovered()&&m.despatchEvent(a({type:d,pos:f.pos},m.position))},this),this.handleEvent(f)):f.type==n||f.type==h||f.type==n?this.isFocused()&&(this.children.forEach(function(m){m.isFocused()&&m.despatchEvent(a(f))}),this.handleEvent(f)):this.handleEvent(f)};u.prototype.getGUI=function(){for(var f=this.parent;f!=null&&f.type!="gui";)f=f.parent;return f};u.prototype.center=function(f){f.move(l(this.size,f.size))};u.prototype.handleEvent=function(f){this.listeners[f.type]&&this.listeners[f.type].forEach(function(m){m.scope?
m.callback.apply(m.scope,[f,this]):m.callback(f,this)})};var K=b.Label=function(f){this.font=f.font?f.font:b.DEFAULT_FONT;f.size=[1,1];K.superConstructor.apply(this,[f]);if(!f.text)throw"Label: label text must be provided!";this.setText(String(f.text));this.type="label"};o.utils.objects.extend(K,u);K.prototype.setText=function(f){this.text=String(f)?String(f):" ";this.size=this.font.getTextSize(f);this.resize(this.size)};K.prototype.paint=function(){this.surface.clear();this.font.render(this.surface,
this.text,[0,0])};var D=b.Button=function(f){D.superConstructor.apply(this,[f]);this.type="button";this.label=this.image=null;this.image=f.image;this.image_down=f.image_down;this.image_hover=f.image_hover;if(!this.image)this.image=new o.Surface(this.size),this.image.fill("#FFF"),o.draw.rect(this.image,"#808080",new o.Rect([0,0],this.size),1);if(f.text)this.label=new K({parent:this,position:[0,0],text:f.text,font:f.font}),this.center(this.label);this.pressed_down=!1;this.on(M,function(){if(!this.pressed_down)this.pressed_down=
!0,this.refresh()},this);this.on(k,function(){if(this.pressed_down)this.pressed_down=!1,this.despatchEvent({type:y}),this.refresh()},this);this.on(d,function(){if(this.pressed_down)this.pressed_down=!1,this.refresh()},this)};o.utils.objects.extend(D,u);D.prototype.onClick=function(f,m){this.on(y,f,m)};D.prototype.paint=function(){var f;f=this.pressed_down&&this.image_down?this.image_down:this.isHovered()&&this.image_hover?this.image_hover:this.image;this.surface.blit(f,new o.Rect([0,0],this.surface.getSize()),
new o.Rect([0,0],f.getSize()))};D.prototype.setText=function(f){this.label&&(this.label.setText(f),this.center(this.label))};var T=b.Image=function(f){if(!f.image)throw"Image: parameter image is required";if(!f.size)f.size=f.image.getSize();this.image=f.image;T.superConstructor.apply(this,[f]);this.type="image";return this};o.utils.objects.extend(T,u);T.prototype.setImage=function(f){this.image=f;this.refresh()};T.prototype.paint=function(){u.prototype.paint.apply(this,[]);this.surface.blit(this.image,
new o.Rect([0,0],this.surface.getSize()),new o.Rect([0,0],this.image.getSize()))};var I=b.FrameHeader=function(f){if(!f.parent)throw"FrameHeader: parent parameter is required";this.height=f.height||20;f.width=f.parent.size[0];f.size=[f.width,this.height];f.position=[0,0];this.title_font=f.title_font;I.superConstructor.apply(this,[f]);B(this);f.title&&this.setTitle(f.title);if(f.close_btn)f.close_icon?f=f.close_icon:(f=new o.Surface([this.height,this.height]),o.draw.line(f,"#000",[3,3],[this.height-
3,this.height-3],3),o.draw.line(f,"#000",[3,this.height-3],[this.height-3,3],3)),f=new T({parent:this,position:[this.size[0]-f.getSize()[0],0],image:f}),f.on(M,function(){this.close();this.despatchEvent({type:R})},this.parent);this.type="frameheader"};o.utils.objects.extend(I,u);I.prototype.move=function(f){this.parent.move([this.parent.position[0]+f[0]-this.position[0],this.parent.position[1]+f[1]-this.position[1]])};I.prototype.setTitle=function(f){this.title_label?this.title_label.setText(f):this.title_label=
new K({parent:this,position:[0,0],font:this.title_font,text:f});var m=this.title_label.font,f=m.getTextSize(f);this.title_label.move([m.space_width,Math.max(parseInt(this.height-f[1]))],0);B(this)};I.prototype.paint=function(){o.draw.rect(this.surface,"#C0C0C0",new o.Rect([0,0],this.size))};var J=b.Frame=function(f){if(!f.parent)throw"Frame: parent parameter is required";if(f.parent.type!="gui")throw"Frame: parent object must be instance of GUI";var m=f.parent;f.parent=null;J.superConstructor.apply(this,
[f]);this.type="frame";this.visible=!1;m.frames.push(this);this.parent=m;this.constrain=f.constrain;return this};o.utils.objects.extend(J,u);J.prototype.paint=function(){o.draw.rect(this.surface,"#FFF",new o.Rect([0,0],this.size));o.draw.rect(this.surface,"#404040",new o.Rect([0,0],this.size),1)};J.prototype.show=function(){u.prototype.show.apply(this,[]);this.parent.moveFrameToTop(this)};J.prototype.close=function(){u.prototype.hide.apply(this,[]);this.despatchEvent({type:R})};J.prototype.move=function(f){this.constrain&&
(f[0]<0&&(f[0]=0),f[0]>this.parent.size[0]-this.size[0]&&(f[0]=this.parent.size[0]-this.size[0]),f[1]<0&&(f[1]=0),f[1]>this.parent.size[1]-this.size[1]&&(f[1]=this.parent.size[1]-this.size[1]));u.prototype.move.apply(this,[f])};J.prototype.destroy=function(){this.visible&&this.close();this.parent&&this.parent.removeFrame(this)};var U=b.DraggableView=function(f){U.superConstructor.apply(this,[f]);B(this);this.min_x=f.min_x;this.max_x=f.max_x;this.min_y=f.min_y;this.max_y=f.max_y;this.type="draggableview"};
o.utils.objects.extend(U,u);U.prototype.move=function(f){var m=f[0];if(this.min_x||this.min_x==0)m=Math.max(m,this.min_x);if(this.max_x||this.max_x==0)m=Math.min(m,this.max_x);f=f[1];if(this.min_y||this.min_y==0)f=Math.max(f,this.min_y);if(this.max_y||this.max_y==0)f=Math.min(f,this.max_y);u.prototype.move.apply(this,[[m,f]])};var P=b.Scroller=function(f){P.superConstructor.apply(this,[f]);this.img=null;if(f.image)this.img=new T({parent:this,position:[0,0],size:this.size,image:f.image})};o.utils.objects.extend(P,
U);P.prototype.resize=function(f){U.prototype.resize.apply(this,[f]);this.img&&this.img.resize(f)};var r=b.HorizontalScrollbar=function(f){r.superConstructor.apply(this,[f]);this.type="horizontalscrollbar";var m=f.left_btn_image;if(!m){var m=new o.Surface([this.size[1],this.size[1]]),a=[[0,this.size[1]/2],[this.size[1],0],[this.size[1],this.size[1]]];o.draw.polygon(m,"#C0C0C0",a)}this.left_btn=new D({parent:this,position:[0,0],size:[this.size[1],this.size[1]],image:m});this.left_btn.onClick(this.scrollLeft,
this);m=f.right_btn_image;m||(m=new o.Surface([this.size[1],this.size[1]]),a=[[0,0],[this.size[1],this.size[1]/2],[0,this.size[1]]],o.draw.polygon(m,"#C0C0C0",a));this.right_btn=new D({parent:this,position:[this.size[0]-this.size[1],0],size:[this.size[1],this.size[1]],image:m});this.right_btn.onClick(this.scrollRight,this);this.sts=this.size[0]-this.right_btn.size[0]-this.left_btn.size[0];f=f.scroller_image;f||(f=new o.Surface([this.size[1],this.size[1]]),a=f.getSize(),o.draw.rect(f,"#C0C0C0",new o.Rect([0,
0],[a[0],a[1]])));a=[Math.max(parseInt((this.size[0]-2*this.size[1])/2),f.getSize()[0]),this.size[1]];this.scroller=new this.scroller_class({parent:this,position:[this.size[1],0],image:f,size:a,min_x:this.size[1],max_x:this.size[0]-this.right_btn.size[0]-a[0],min_y:0,max_y:0});this.scroll_pos=0;this.max_scroll_pos=this.sts-this.scroller.size[0];this.scroller.on(C,function(f){this.setScrollPX(f.new_pos[0]-this.size[1])},this)};o.utils.objects.extend(r,u);r.prototype.scroller_class=P;r.prototype.setScrollerSize=
function(f){f=Math.min(Math.max(f,0.1),1);this.scroller.resize([this.sts*f,this.scroller.size[1]]);this.max_scroll_pos=this.sts-this.scroller.size[0];this.scroller.max_x=this.size[0]-this.left_btn.size[0]-this.scroller.size[0];this.refresh()};r.prototype.setScrollPX=function(f){this.scroller.move([f+this.left_btn.size[0],0]);this.scroll_pos=f=this.scroller.position[0]-this.left_btn.size[0];var m=0;this.max_scroll_pos>0&&(m=f/this.max_scroll_pos);this.despatchEvent({type:L,scroll_px:f,scroll:m});this.refresh()};
r.prototype.setScroll=function(f){this.setScrollPX(parseInt(this.max_scroll_pos*f))};r.prototype.scrollLeft=function(){this.setScrollPX(Math.max(0,this.scroll_pos-this.max_scroll_pos*0.1))};r.prototype.scrollRight=function(){this.setScrollPX(Math.min(this.max_scroll_pos,this.scroll_pos+this.max_scroll_pos*0.1))};var p=b.VerticalScrollbar=function(f){p.superConstructor.apply(this,[f]);this.type="verticalscrollbar";var m=f.top_btn_image;if(!m){var m=new o.Surface([this.size[0],this.size[0]]),a=[[this.size[0]/
2,0],[0,this.size[0]],[this.size[0],this.size[0]]];o.draw.polygon(m,"#C0C0C0",a)}this.top_btn=new D({parent:this,position:[0,0],size:[this.size[0],this.size[0]],image:m});this.top_btn.onClick(this.scrollUp,this);m=f.bot_btn_image;m||(m=new o.Surface([this.size[0],this.size[0]]),a=[[0,0],[this.size[0],0],[this.size[0]/2,this.size[0]]],o.draw.polygon(m,"#C0C0C0",a));this.bot_btn=new D({parent:this,position:[0,this.size[1]-this.size[0]],size:[this.size[0],this.size[0]],image:m});this.bot_btn.onClick(this.scrollDown,
this);this.sts=this.size[1]-this.bot_btn.size[1]-this.top_btn.size[1];f=f.scroller_image;f||(f=new o.Surface([this.size[0],this.size[0]]),a=f.getSize(),o.draw.rect(f,"#C0C0C0",new o.Rect([0,0],[a[0],a[1]])));a=[this.size[0],Math.max(parseInt((this.size[1]-2*this.size[0])/2),f.getSize()[1])];this.scroller=new this.scroller_class({parent:this,position:[0,this.size[0]],image:f,size:a,min_x:0,max_x:0,min_y:this.size[0],max_y:this.size[1]-this.bot_btn.size[1]-a[1]});this.scroll_pos=0;this.max_scroll_pos=
this.sts-this.scroller.size[1];this.scroller.on(C,function(f){this.setScrollPX(f.new_pos[1]-this.size[0])},this)};o.utils.objects.extend(p,u);p.prototype.scroller_class=P;p.prototype.setScrollerSize=function(f){f=Math.min(Math.max(f,0.1),1);this.scroller.resize([this.scroller.size[0],this.sts*f]);this.max_scroll_pos=this.sts-this.scroller.size[1];this.scroller.max_y=this.size[1]-this.bot_btn.size[1]-this.scroller.size[1];this.refresh()};p.prototype.setScrollPX=function(f){this.scroller.move([0,f+
this.top_btn.size[1]]);this.scroll_pos=f=this.scroller.position[1]-this.top_btn.size[1];var a=0;this.max_scroll_pos>0&&(a=f/this.max_scroll_pos);this.despatchEvent({type:L,scroll_px:f,scroll:a});this.refresh()};p.prototype.setScroll=function(f){this.setScrollPX(parseInt(this.max_scroll_pos*f))};p.prototype.scrollUp=function(){this.setScrollPX(Math.max(0,this.scroll_pos-this.max_scroll_pos*0.1))};p.prototype.scrollDown=function(){this.setScrollPX(Math.min(this.max_scroll_pos,this.scroll_pos+this.max_scroll_pos*
0.1))};var A=b.ScrollableView=function(f){A.superConstructor.apply(this,[f]);this.type="scrollableview";this.max_scroll_y=this.max_scroll_x=this.scroll_y=this.scroll_x=0;this.scrollable_area=[0,0];this.setScrollableArea(this.size);this.horizontal_scrollbar=this.vertical_scrollbar=null};o.utils.objects.extend(A,u);A.prototype.setVerticalScrollbar=function(f){this.vertical_scrollbar=f;f.on(L,function(f){this.setScrollY(Math.ceil(f.scroll*this.max_scroll_y))},this)};A.prototype.setHorizontalScrollbar=
function(f){this.horizontal_scrollbar=f;f.on(L,function(f){this.setScrollX(Math.ceil(f.scroll*this.max_scroll_x))},this)};A.prototype.setScrollableArea=function(f){this.scrollable_area=f;this.max_scroll_y=Math.max(f[1]-this.size[1],0);this.max_scroll_x=Math.max(f[0]-this.size[0],0);if(this.vertical_scrollbar){var a=Math.max(Math.min(1,this.size[1]/f[1]),0.1);this.vertical_scrollbar.setScrollerSize(a)}this.horizontal_scrollbar&&(a=Math.max(Math.min(1,this.size[0]/f[0]),0.1),this.horizontal_scrollbar.setScrollerSize(a))};
A.prototype.autoSetScrollableArea=function(){scrollable_area=[0,0];this.children.forEach(function(f){scrollable_area[0]=Math.max(scrollable_area[0],f.position[0]+f.size[0]+20);scrollable_area[1]=Math.max(scrollable_area[1],f.position[1]+f.size[1]+20)},this);this.setScrollableArea(scrollable_area)};A.prototype.addChild=function(f){u.prototype.addChild.apply(this,[f]);this.refresh()};A.prototype.blitChild=function(f){this.surface.blit(f.surface,[f.position[0]-this.scroll_x,f.position[1]-this.scroll_y])};
A.prototype.despatchEvent=function(f){if(f.pos)f=a(f),f.pos=[f.pos[0]+this.scroll_x,f.pos[1]+this.scroll_y];u.prototype.despatchEvent.apply(this,[f])};A.prototype.scrollX=function(f){this.setScrollX(this.scroll_x+f);this.refresh()};A.prototype.scrollY=function(f){this.setScrollY(this.scroll_y+f);this.refresh()};A.prototype.setScrollX=function(f){this.scroll_x=Math.min(Math.max(f,0),this.max_scroll_x);this.refresh()};A.prototype.setScrollY=function(f){this.scroll_y=Math.min(Math.max(f,0),this.max_scroll_y);
this.refresh()};var w=b.TextInput=function(f){w.superConstructor.apply(this,[f]);this.font=f.font?f.font:b.DEFAULT_FONT;this.text=f.text?f.text:"";this.blip=!1;this.pos=0;this.ms=500;this.scw=new A({parent:this,position:[0,0],size:f.scw_size||this.size});this.center(this.scw);this.label=new K({parent:this.scw,position:[0,0],font:this.font,text:this.text});this.scw.center(this.label);this.label.move([3,this.label.position[1]]);this.bliplabel=new K({parent:this.scw,position:[0,0],font:this.font,visible:!1,
text:"|"});this.on(h,this.onKeyDown,this);this.on(t,this.blipon,this);this.on(c,function(){this.blip=!1},this);this.setPos(this.text.length)};o.utils.objects.extend(w,u);w.prototype.blipon=function(){this.blip=!0;this.ms=500;this.refresh()};w.prototype.update=function(f){if(this.isFocused()){this.ms-=f;if(this.ms<0)this.ms=500,this.blip=!this.blip;this.blip?this.bliplabel.show():this.bliplabel.hide()}else this.bliplabel.hide()};w.prototype.paint=function(){this.surface.fill("#FFF");o.draw.rect(this.surface,
"#COCOCO",new o.Rect([0,0],this.size),1)};w.prototype.setText=function(f){this.setPos(this.text.length);this._setText(f)};w.prototype.setPos=function(f){this.pos=Math.min(Math.max(f,0),this.text.length);f=0;f=this.font.getTextSize(this.text.substr(0,this.pos))[0];f=Math.max(f-this.scw.size[0]+this.font.getTextSize("s")[0]);this.scw.setScrollX(f);this.bliplabel.move([Math.max(this.font.getTextSize(this.text.substr(0,this.pos))[0]+this.label.position[0]-2,0),this.label.position[1]])};w.prototype._setText=
function(f){this.text=f;this.label.setText(f);this.scw.autoSetScrollableArea();this.refresh();this.despatchEvent({type:j,value:f})};w.prototype.onKeyDown=function(f){var a=f.key;a==8&&this.text&&(this.pos==this.text.length?this._setText(this.text.substr(0,this.text.length-1)):this._setText(this.text.substr(0,this.pos-1)+this.text.substr(this.pos,this.text.length)),this.blipon(),this.setPos(this.pos-1));if(a>=48&&a<=90||a==32){var r=String.fromCharCode(a),r=f.shiftKey?r.toUpperCase():r.toLowerCase();
this.pos==this.text.length?this._setText(this.text+r):this._setText(this.text.substr(0,this.pos)+r+this.text.substr(this.pos,this.text.length));this.setPos(this.pos+1);this.blipon()}a==37&&(this.setPos(this.pos-1),this.blipon());a==39&&(this.setPos(this.pos+1),this.blipon())};var O=b.Dialog=function(f){f.position=l(f.parent.size,f.size);O.superConstructor.apply(this,[f])};o.utils.objects.extend(O,J);O.prototype.show=function(){this.getGUI().lockFrame(this);J.prototype.show.apply(this,[])};O.prototype.close=
function(){this.getGUI().unlockFrame();J.prototype.close.apply(this,[])};var V=b.Text=function(f){f.size=[f.width,1];V.superConstructor.apply(this,[f]);this.width=f.width;this.font=f.font?f.font:b.DEFAULT_FONT;this.setText(f.text);this.justify=f.justify};o.utils.objects.extend(V,u);V.prototype.setText=function(f){this.text=f;this.lines=[];f=f.split(/\r\n|\r|\n/);f.push(" ");var a,r,N,c,p,j="",e=0,d=0,g="";for(r=0;r<f.length;r++){a=f[r];a+=" ";for(N=0;N<a.length;N++){c=a[N];if(c==" "||c=="\t"){if(j){p=
this.font.getTextSize(j)[0];if(d+p>this.size[0]&&g!=""&&(this.lines.push({t:g,e:!1}),e+=this.font.getTextSize(g)[1],g="",d=0,j[0]==" "||j[0]=="\t"))j=j.substr(1,j.length);g+=j;d+=p}j=""}j+=c}g&&(this.lines.push({t:g,e:!0}),e+=this.font.getTextSize(g)[1],g="",d=0)}this.resize([this.width,e]);this.refresh()};V.prototype.paint=function(){u.prototype.paint.apply(this,[]);var f=0;this.lines.forEach(function(a){var r=this.font.getTextSize(a.t),N=0;if(this.justify&&!a.e){for(var c=N=0;c<a.t.length;c++)a.t[c]==
" "&&N++;N=Math.floor((this.size[0]-r[0])/N)}this.font.render(this.surface,a.t,[0,f],this.font.space_width+N);f+=r[1]},this)};var H=b.GUI=function(f){H.superConstructor.apply(this,[{position:[0,0],parent:null,size:f.getSize(),surface:f}]);this.type="gui";this.locked_frame=null;this.frames=[]};o.utils.objects.extend(H,u);H.prototype.draw=function(f){f&&this.refresh();var a=u.prototype.draw.apply(this,[]);this.frames.forEach(function(f){if(f.visible&&(f.draw()||a))this.locked_frame&&this.locked_frame.id==
f.id&&(this.refresh(),this.blur_bg()),this.surface.blit(f.surface,f.position)},this)};H.prototype.paint=function(){};H.prototype.blur_bg=function(){o.draw.rect(this.surface,"rgba(192,192, 192, 0.5)",new o.Rect([0,0],this.size),0)};H.prototype.removeFrame=function(f){if(typeof f!="number")f=f.id;for(var a=0;a<this.frames.length;a++)if(this.frames[a].id==f)return this.frames.splice(a,1),this.refresh(),!0;return!1};H.prototype.moveFrameToTop=function(f){for(var a=0;a<this.frames.length;a++){var r=this.frames[a];
if(r.id==f.id){if(a==this.frames.length-1)break;this.despatchEvent({type:c});this.frames.splice(a,1);this.frames.push(r);this.refresh();f.despatchEvent({type:t});break}}};H.prototype.update=function(f){this.children.forEach(function(a){a._update(f)});this.frames.forEach(function(a){a._update(f)})};H.prototype.lockFrame=function(f){this.locked_frame=f;this.refresh()};H.prototype.unlockFrame=function(){this.locked_frame=null;this.refresh()};H.prototype.despatchEvent=function(f){if(f.pos)f.global_pos=
f.pos;var m,r;if(f.type==M||f.type==g||f.type==k){var N=!1,W=null,j=null,p=null;for(m=this.frames.length-1;m>=0;m--)if(r=this.frames[m],!(this.locked_frame&&this.locked_frame.id!=r.id))if(r.visible&&r.getRect().collidePoint(f.pos)){r.despatchEvent(a(f,r.position));f.type==M?W=m:f.type==g&&(j=m);N=!0;r.isFocused()&&(p=m);break}else f.type==M&&r.isFocused()&&r.despatchEvent({type:c});if(W!=null){u.prototype.despatchEvent.apply(this,[{type:c}]);for(m=0;m<this.frames.length;m++)m!=W&&this.frames[m].despatchEvent({type:c})}if(j!=
null){u.prototype.despatchEvent.apply(this,[{type:d}]);for(m=0;m<this.frames.length;m++)m!=j&&this.frames[m].despatchEvent({type:d})}!N&&!this.locked_frame?u.prototype.despatchEvent.apply(this,[f]):u.prototype.handleEvent.apply(this,[f]);p!=null&&this.moveFrameToTop(this.frames[p])}else(f.type==c||f.type==d||f.type==h||f.type==n)&&this.frames.forEach(function(m){m.visible&&(!this.locked_frame||this.locked_frame.id==m.id)&&m.despatchEvent(a(f,m.position))}),this.locked_frame?u.prototype.handleEvent.apply(this,
[f]):u.prototype.despatchEvent.apply(this,[f])};b.layout={vertical:function(f,a,r){a=a||0;r=r||0;f.forEach(function(f){f.move([f.position[0],a]);a+=f.size[1]+r})},horizontal:function(f,a,r){a=a||0;r=r||0;f.forEach(function(f){f.move([a,f.position[1]]);a+=f.size[0]+r})}}}},["gamejs"]);
require.define({world:function(q,b){var a=q("./box2d"),l=q("./utils"),o=l.vec,t=l.arr,c=q("./weapon_descriptions");q("./combatracer");var e=q("./car_descriptions"),d=q("./cars");q("./particles");var h=q("./weapons"),n=q("./animation"),k=q("./props"),M=q("./settings"),a=q("./box2d"),g=q("gamejs"),y=q("./sounds"),R=q("./renderer"),L=q("./buffs"),C=g.utils.vectors,G=g.utils.math;radians=G.radians;degrees=G.degrees;var v=b.ContactListener=function(c){this.world=c;this.BeginContact=function(c){var j=c.GetFixtureA().GetBody(),
e=c.GetFixtureB().GetBody(),j=j.GetUserData(),e=e.GetUserData();if(j&&e){var g=new a.b2WorldManifold;c.GetWorldManifold(g);g=t(g.m_normal);j.impact&&j.impact(e,c,g);e.impact&&e.impact(j,c,C.rotate(g,radians(180)))}};this.EndContact=function(){};this.PreSolve=function(){};this.PostSolve=function(){};return this},F=b.MODE_CLIENT=1,S=b.MODE_SERVER=2,j=b.MODE_STANDALONE=3,z={animation:!0},B=b.World=function(g,b,B,t,T,G,C,R){this.next_object_id=1;this.mode=R?R:j;this.start_positions=C;this.background_zoom=
this.background=null;this.phys_scale=M.get("PHYS_SCALE");this.width_px=B;this.height_px=t;this.width=g;this.height=b;this.size=[this.width,this.height];this.b2world=new a.b2World(o(0,0),!1);this.ai_waypoints=T;this.max_waypoint=0;for(var q in T)this.max_waypoint=Math.max(this.max_waypoint,q);this.checkpoints=G;this.max_checkpoint=0;for(q in G)this.max_checkpoint=Math.max(this.max_checkpoint,q);this.pending_particle_bursts=[];this.objects={};this.object_by_id={};this.destroy_queue=[];this.sound_queue=
[];this.b2world.SetContactListener(new v(this));this.next_event_no=1;this.events={};this.destroy=function(a){this.destroy_queue.push(this.object_by_id[a])};this.destroyQueued=function(){this.destroy_queue.forEach(function(a){l.removeObjFromList(a,this.objects[a.type]);delete this.object_by_id[a.id];a.destroy&&a.destroy();a.body&&this.b2world.DestroyBody(a.body)},this);this.destroy_queue=[]};this.addObject=function(a){a.id=this.next_object_id++;this.objects[a.type]?this.objects[a.type][this.objects[a.type].length]=
a:this.objects[a.type]=[a];this.object_by_id[a.id]=a};this.recordEvent=function(a,c){if(!(a=="create"&&c.type=="prop")){var j=this.next_event_no++;this.events[j]={type:a,no:j,descr:c}}};this.event=function(a,c){this.mode==S&&this.recordEvent(a,c);if(this.mode==j||this.mode==S)return this.handleEvent(a,c);return null};this.destroyObj=function(a){this.event("destroy",a)};this.spawnAnimation=function(a,c,j){c={position:c};if(j)c.follow_obj=j.id;this.event("create",{type:"animation",obj_name:a,pars:c})};
this.createBuff=function(a,c,j){j.car=c.id;this.event("create",{type:"buff",obj_name:a,pars:j})};this.playSound=function(a,c){this.event("create",{type:"sound",obj_name:a,pars:{position:c}})};this.handleEvent=function(a,c){if(a=="create")return this.create(c);else if(a=="destroy")return this.destroy(c);return null};this.create=function(a){var j=null,g=a.type;if(g=="car"){j=e[a.obj_name];g={world:this};l.copy(a.pars,g);l.copy(j,g);delete g.filenames;var w=this.objects.car?this.objects.car.length:0;
g.filename=w>=j.filenames.length?j.filenames[0]:j.filenames[w];g.type=a.obj_name;var j=new d.Car(g),b;for(b in{front_weapon:1,rear_weapon:1,util:1})a.pars[b]&&(g={car:j,weapon_id:a.pars[b].type},l.copy(a.pars[b],g),l.copy(c[g.type],g),j[b]=new h[g.launcher](g))}else if(g=="prop")g={world:this},g=l.copy(a.pars,g),j=new k.BoxProp(g);else if(g=="weapon")g={world:this,weapon_id:a.obj_name},l.copy(a.pars,g),(b=this.getObjectById(a.pars.car))?(g.car=b,j=new h[a.obj_name](g)):console.log("CAR NOT FOUND:"+
a.pars.car);else if(g=="animation"){g={world:this,position:a.pars.position};if(a.pars.follow_obj)g.follow_obj=this.getObjectById(a.pars.follow_obj);l.copy(n.animations[a.obj_name],g);j=new n.AnimationObject(g)}else if(g=="sound")M.get("SOUND")&&this.sound_queue.push({filename:a.obj_name,position:a.pars.position});else if(g=="buff")g={},l.copy(a.pars,g),g.car=this.getObjectById(a.pars.car),j=new L[a.obj_name](g);j&&this.addObject(j);return j};this.getObjectById=function(a){return this.object_by_id[a]};
this.updList=function(a,c){var j;for(j=0;j<c.length;j++)c[j].update&&c[j].update(a)};this.drawList=function(a,c){c.forEach(function(c){c.draw&&c.draw(a)})};this.update=function(a){for(var c in this.objects)(this.mode!=F||z[c])&&this.updList(a,this.objects[c]);this.destroyQueued()};this.draw=function(a){for(var c in this.objects)this.drawList(a,this.objects[c]);this.sound_queue.forEach(function(c){y.play(c,a)});this.sound_queue=[]};this.CreateBody=function(a){return this.b2world.CreateBody(a)};this.addParticleBurst=
function(a){this.pending_particle_bursts[this.pending_particle_bursts.length]=a};return this};b.buildWorld=function(a,c){var j=M.get("PHYS_SCALE"),g=a.dict,e={};a.start_positions.forEach(function(a){e[a.n]={x:(a.p[0]+30)/j,y:(a.p[1]+30)/j,angle:a.a}});var d={};a.ai_waypoints.forEach(function(a){d[a.n]={x:(a.p[0]+20)/j,y:(a.p[1]+20)/j}});var b={},h,z;a.checkpoints.forEach(function(a){h=[a.p[0]/j,a.p[1]/j];z=[(a.p[0]+280)/j,(a.p[1]+280)/j];b[a.n]={pt1:h,pt2:z,width:z[0]-h[0],height:z[1]-h[1],center:[(h[0]+
z[0])/2,(h[1]+z[1])/2]}});var r=new B(a.width/j,a.height/j,a.size[0],a.size[1],d,b,e,c),p,A,w,y,k;a.props.forEach(function(a){p=G.normaliseDegrees(a.a);A=R.cache.getPropSprite(g[a.f],p);w=A.getSize();A=R.cache.props[g[a.f]].orig;y=A.getSize();k=[y[0]/j,y[1]/j];r.event("create",{type:"prop",pars:{filename:g[a.f],position:[(a.p[0]+w[0]/2)/j,(a.p[1]+w[1]/2)/j],angle:p,size:k}})});return r}}},["box2d","utils","weapon_descriptions","combatracer","car_descriptions","cars","particles","weapons","animation",
"props","settings","gamejs","sounds","renderer","buffs"]);
require.define({combatracer:function(q,b){var a=q("gamejs"),l=q("./renderer"),o=q("./utils");q("gamejs/font");q("./levels");var t=q("./resources");q("./weapons");var c=q("./ui"),e=q("./uiscenes"),d=q("./settings"),h=q("./gamescenes"),n=q("./sounds"),k=q("./editor"),M=q("./garage"),g=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/d.get("FPS"))}}(),
y=b.getDefCarDescr=function(a){return{type:a?a:"Sandbug",front_weapon:{type:"Machinegun",ammo_upgrades:0,damage_upgrades:0},util:null,rear_weapon:{type:"MineLauncher",ammo_upgrades:0,damage_upgrades:0},acc_upgrades:0,speed_upgrades:0,armor_upgrades:0}};b.getPreloadList=function(){var a=[],c;for(c=0;c<t.cars.length;c++)a[a.length]="images/cars/"+t.cars[c];for(c=0;c<t.tiles.length;c++)a[a.length]="images/tiles/"+t.tiles[c];for(c=0;c<t.props.length;c++)a[a.length]="images/props/"+t.props[c];for(c=0;c<
t.animations.length;c++)a[a.length]="images/animations/"+t.animations[c];for(c=0;c<t.statics.length;c++)a[a.length]="images/static/"+t.statics[c];for(c=0;c<t.ui.length;c++)a[a.length]="images/ui/"+t.ui[c];t.decals.forEach(function(c){a.push("images/decals/"+c)});d.get("SOUND")&&(t.sound_fx.forEach(function(c){a.push("sounds/fx/"+c)}),t.sound_engine.forEach(function(c){a.push("sounds/engine/"+c)}));return a};var R=b.Director=function(c){function e(h){h=h||(new Date).getTime();msDuration=h-j;j=h;if(b){h=
msDuration;if(d){if(b.handleEvent){var y=a.event.get(),k;for(k=0;k<y.length;k++)b.handleEvent(y[k])}else a.event.get();b.update&&b.update(h)}b.draw&&b.draw(c,msDuration)}g(e,c._canvas)}var d=!1,b=null;this.display=c;var j;this.start=function(a){d=!0;this.replaceScene(a)};this.replaceScene=function(a){b&&b.destroy&&b.destroy();b=a};this.getScene=function(){return b};e(0);return this},L=b.Communicator=function(c){this.game=c;this.next_transaction_id=1;this.messages=[];this.status="closed";this.queueMessage=
function(a,c){this.messages[this.messages.length]=[a,c?c:{}];this.send()};this.send=function(){if(this.status=="open"){for(var a=0;a<this.messages.length;a++){var c={cmd:this.messages[a][0],uid:this.game.player.uid,payload:this.messages[a][1]},c=JSON.stringify(c);this.socket.send(c)}this.messages=[]}else if(this.status=="closed")this.connect();else throw Error("unknown network status");};this.connect=function(){a.log("Connecting...");this.socket=new WebSocket(d.get("SERVER"));this.status="connecting";
var c=this;this.socket.onopen=function(){c.onopen()};this.socket.onmessage=function(a){c.onmessage(a)};this.socket.onclose=function(){c.onclose()};this.socket.onerror=function(){c.onerror()}};this.onopen=function(){a.log("Connection established!");this.status="open";this.send()};this.onmessage=function(a){a=JSON.parse(a.data);this.game.director.getScene().handleMessage(a.cmd,a.payload)};this.onclose=function(){this.status="closed";console.log(this.error?"socket closed on error ":"socket closed!");
this.game.aquainted=!1;this.game.showTitle();this.game.player.uid=null;this.game.title_scene.alert(this.error?"Socket error, connection closed.":"Server closed the connection!");this.error=!1};this.error=!1;this.onerror=function(){this.socket.close();this.error=!0}};b.init=function(){b.game=new C;return b.game};var C=b.Game=function(){this.director=null;this.cache=l.init();d.get("SOUND")&&n.init();c.init();this.socket=null;this.tried_loading=!1;this.player={alias:"Player",uid:null,singleplayer:{balance:d.get("STARTING_BALANCE"),
difficulty:2,car:y(),league:d.get("STARTING_LEAGUE"),completed_tracks:[]}};this.communicator=null;this.acquainted=!1;this.getCommunicator=function(){if(!this.communicator)this.communicator=new L(this);return this.communicator};this.start=function(a){this.display=a;this.director=new R(a);this.title_scene=new e.TitleScene(this,this.cache);this.director.start(this.title_scene)};this.showEndGameScene=function(a){this.director.replaceScene(new e.EndRaceScene(this,this.cache,a))};this.showTitle=function(){this.director.replaceScene(this.title_scene)};
this.showCongratulations=function(){this.director.replaceScene(new e.CongratulationsScene)};this.createLobby=function(){this.director.replaceScene(new e.CreateLobbyScene(this,this.cache))};this.showLobbyList=function(){this.director.replaceScene(new e.JoinLobbyScene(this,this.cache))};this.returnTo=function(){if(this.return_to)if(this.return_to=="editor"){this.return_to="";this.showEditor();return}else if(this.return_to=="singleplayer"){this.return_to="";this.singleplayer();return}this.showTitle()};
this.showSPGameOver=function(a,c,g){this.director.replaceScene(new e.SPGameOverScene(a,c,g))};this.showEditor=function(){if(!this.editor_scene)this.editor_scene=new k.EditorScene;this.director.replaceScene(this.editor_scene)};this.joinLobby=function(a){this.director.replaceScene(new e.LobbyScene(this,this.cache,a))};this.singleplayer=function(){this.director.replaceScene(new e.SinglePlayerScene(this,this.cache))};this.showGarage=function(a){this.director.replaceScene(new M.GarageScene(a))};this.showCarDealer=
function(a){this.director.replaceScene(new M.BuyCarScene(a))};this.showSPGarage=function(){this.director.replaceScene(new M.GarageScene(this.player.singleplayer))};this.playMultiplayer=function(a){this.level_scene=new h.MultiplayerLevelScene(this,a,this.cache);this.director.replaceScene(this.level_scene)};this.playLevel=function(a,c,g){this.level_scene=new h.SingleplayerLevelScene(a,c);this.return_to=g;this.director.replaceScene(new e.ControlsSplash(this,this.cache,this.level_scene))};this.cacheCarSprites=
function(a){this.cache.cacheCarSprite("wheel.png");this.cache.cacheCarSprite("big_wheel.png");a.controllers.forEach(function(a){a=a.car;this.cache.cacheCarSprite(a.filename);[a.front_weapon,a.rear_weapon,a.util].forEach(function(a){a&&a.pars.preload&&a.pars.preload.forEach(function(a){this.cache.cacheCarSprite(a)},this)},this)},this)};this.haveSave=function(){if(o.supports_html5_storage()&&localStorage.getItem("banditracer_save"))return!0;return!1};this.load=function(){if(o.supports_html5_storage()&&
localStorage.getItem("banditracer_save")){var a=JSON.parse(localStorage.getItem("banditracer_save"));this.player.alias=a.alias;this.player.singleplayer=a.singleplayer;if(!this.player.singleplayer.difficulty)this.player.singleplayer.difficulty=2;return!0}return!1};this.save=function(){if(o.supports_html5_storage()){var a=JSON.stringify({alias:this.player.alias,singleplayer:this.player.singleplayer});localStorage.setItem("banditracer_save",a);return!0}return!1}}}},["gamejs","renderer","utils","gamejs/font",
"levels","resources","weapons","ui","uiscenes","settings","gamescenes","sounds","editor","garage"]);
require.define({renderer:function(q,b){var a=q("gamejs"),l=q("./utils").arr,o=a.utils.math;radians=o.radians;degrees=o.degrees;var t=q("./resources"),c=q("./skin"),e=q("./settings"),d=q("./weapon_descriptions");a.font.Font.prototype.size=function(a){return[this.sampleSurface.context.measureText(a).width*4,this.fontHeight]};a.font.Font.prototype.render=function(c,g){var e=this.size(c),d=new a.Surface(e),b=d.context;b.save();b.font=this.sampleSurface.context.font;b.textBaseline=this.sampleSurface.context.textBaseline;
b.textAlign=this.sampleSurface.context.textAlign;b.fillStyle=b.strokeStyle=g||"#000000";b.fillText(c,e[0]/2,d.rect.height,d.rect.width);b.restore();for(var b=0,h=e[0],k,l=new a.surfacearray.SurfaceArray(d),j=!1,b=0;b<l.getSize()[0];b++){for(k=0;k<l.getSize()[1];k++)if(l.get(b,k)[3]!=0){j=!0;break}if(j)break}j=!1;for(h=l.getSize()[0]-1;h>=0;h--){for(k=0;k<l.getSize()[1];k++)if(l.get(h,k)[3]!=0){j=!0;break}if(j)break}e=Math.floor(e[1]);k=new a.Surface([h-b,e]);k.blit(d,new a.Rect([0,0],k.getSize()),
new a.Rect([b,0],[h-b,e]));return k};var h=b.sprite2rotarray=function(c,g){var e={orig:c,0:c,step:g},d=c.getSize(),b;if(d[0]!=d[1]){var h=Math.max(d[0],d[1]);b=new a.Surface(h,h);b.blit(c,[(h-d[0])/2,(h-d[1])/2]);e[0]=b}else b=c,e[0]=c;for(d=g;d<360;d+=g)e[d]=a.transform.rotate(b,d);return e},n=b.ImageCache=function(){this.cars={};this.props={};this.decals={};this.tiles={};this.animations={};this.fonts={};this.ui={};this.alphabet='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890.,:/!?"|()';
this["static"]={};t.tiles.forEach(function(c){this.tiles[c]=a.image.load("images/tiles/"+c)},this);t.props.forEach(function(c){this.props[c]=h(a.image.load("images/props/"+c),5)},this);t.decals.forEach(function(c){this.decals[c]=h(a.image.load("images/decals/"+c),90)},this);t.animations.forEach(function(c){this.animations[c]=a.image.load("images/animations/"+c)},this);t.ui.forEach(function(c){this.ui[c]=a.image.load("images/ui/"+c)},this);t.statics.forEach(function(c){this["static"][c]=a.image.load("images/static/"+
c)},this);this.initFont=function(c,g,e){this.fonts[c]={};for(var g=new a.font.Font(g),d,b=0;b<this.alphabet.length;b++)d=this.alphabet[b],this.fonts[c][d]=g.render(d,e)};this.getDecalSprite=function(a,c){return this.getSpriteFromRotarray(this.decals[a],c)};this.getPropSprite=function(a,c){return this.getSpriteFromRotarray(this.props[a],c)};this.cacheCarSprite=function(c){this.cars[c]||(this.cars[c]=h(a.image.load("images/cars/"+c),2))};this.getCarSprite=function(a,c){this.cars[a]||this.cacheCarSprite(a);
return this.getSpriteFromRotarray(this.cars[a],c)};this.getTile=function(a){return this.tiles[a]};this.getLetter=function(a,c){return this.fonts[a][c]};this.getTextSize=function(a,c){var g=0,e=0,d;if(a){for(var b=0;b<a.length;b++)if(d=a[b],d==" ")g+=8;else if(d=this.getLetter(c,d))e=d.getSize(),g+=e[0],e=e[1];return[g,e]}else return[0,0]};this.getAnimationFrameCount=function(a){a=this.animations[a].getSize();return a[0]/a[1]};this.getAnimationSheet=function(a){return this.animations[a]};this.getUIImage=
function(a){return this.ui[a]};this.getStaticSprite=function(a){return this["static"][a]};this.getSpriteFromRotarray=function(a,c){c%a.step!=0&&(c=o.normaliseDegrees(parseInt(c/a.step)*a.step));return a[c]};this.initFont("hud",c.fonts.hud[0],c.fonts.hud[1]);return this};b.cache=null;b.init=function(){b.cache=new n;return b.cache};var k=b.Renderer=function(c,g,e){this.width=c;this.height=g;this.cache=e;this.surface=null;this.textLength=function(a,c){for(var g,e=0,d=0;d<a.length;d++)g=a[d],g==" "?e+=
8:(s=this.cache.getLetter(c,g),e+=s.getSize()[0]);return e};this.fillBackground=function(c){a.draw.rect(this.surface,c,new a.Rect([0,0],this.surface.getSize()))};this.drawRect=function(c,g,e,d){a.draw.rect(this.surface,c,new a.Rect(g,e),d||d===0?d:1)};this.drawLine=function(c,g,e,d){a.draw.line(this.surface,c,g,e,d||d===0?d:1)};this.drawText=function(c,g,e,d,b){ofst=e[0];var d=d?d:1,j,h;for(j=0;j<c.length;j++)h=c[j],h==" "?ofst+=8/d:(h=this.cache.getLetter(g,h),d==1?r1=[ofst,e[1]-10]:(size=h.getSize(),
r1=new a.Rect([ofst,e[1]],[parseInt(size[0]/d),parseInt(size[1]/d)])),(b?b:this.surface).blit(h,r1),ofst+=h.getSize()[0]/d)};return this},M=b.UIRenderer=function(a,c,g){M.superConstructor.apply(this,[a,c,g]);this.cache=g;this.surface=null;this.setSurface=function(a){this.surface=a};this.drawUIImage=function(a,c){this.surface.blit(this.cache.getUIImage(a),c)}};a.utils.objects.extend(M,k);var g=b.RaceRenderer=function(c,b,h,k,n,t){g.superConstructor.apply(this,[c,b,n]);this.display_width=c;this.display_height=
b;this.world=h;this.size=[this.width,this.height];this.follow_object=t;this.offset_y=this.offset_x=0;this.background=k;this.surface=null;this.st=new a.Surface(this.display_width*2,this.display_height*2);this.display=null;this.zoom=1;this.r1=new a.Rect([0,0],[this.display_width,this.display_height]);this.r2=new a.Rect([0,0],[this.width,this.height]);this.follow=function(a){this.follow_object=a};this.updateOffset=function(){if(this.follow_object){var a=this.follow_object.alive?l(this.follow_object.body.GetPosition()):
this.follow_object.respawn_location;this.offset_x=Math.min(Math.max(0,a[0]*h.phys_scale-parseInt(this.width/2)),h.width_px-this.width);this.offset_y=Math.min(Math.max(0,a[1]*h.phys_scale-parseInt(this.height/2)),h.height_px-this.height)}return!1};this.getScreenPoint=function(a){a=l(a);return[a[0]*this.world.phys_scale-this.offset_x,a[1]*this.world.phys_scale-this.offset_y]};this.drawBackground=function(){this.surface.blit(this.background,new a.Rect([0,0],[this.width,this.height]),new a.Rect([this.offset_x,
this.offset_y],[this.width,this.height]))};this.setZoom=function(c){var g=parseInt(this.display_width/c),j=parseInt(this.display_height/c);if(g<=this.world.width_px&&j<=this.world.height_px)this.zoom=c,this.width=parseInt(this.display_width/c),this.height=parseInt(this.display_height/c),this.r2=new a.Rect([0,0],[this.width,this.height]),this.st=new a.Surface(this.width,this.height)};this.increaseZoom=function(){this.zoom<1&&this.setZoom(this.zoom+0.01)};this.decreaseZoom=function(){this.zoom>0.5&&
this.setZoom(this.zoom-0.01)};this.render=function(a){this.surface=this.zoom==1?a:this.st;this.updateOffset();this.drawBackground();this.world.draw(this);this.zoom!=1&&a.blit(this.surface,this.r1,this.r2)};this.drawLine=function(c,g,j){a.draw.line(this.surface,c,this.getScreenPoint(g),this.getScreenPoint(j),2)};this.drawProp=function(a,c,j){a=this.cache.getPropSprite(a,j?j:0);j=a.getSize()[0]/2;c=this.getScreenPoint(c);this.surface.blit(a,[c[0]-j,c[1]-j])};this.drawDecal=function(a,c,j){a=this.cache.getDecalSprite(a,
j?j:0);j=a.getSize()[0]/2;c=this.getScreenPoint(c);this.surface.blit(a,[c[0]-j,c[1]-j])};this.drawCar=function(a,c,j){a=this.cache.getCarSprite(a,j?j:0);j=a.getSize()[0]/2;c=this.getScreenPoint(c);this.surface.blit(a,[c[0]-j,c[1]-j])};this.drawStatic=function(a,c){var j=this.cache.getStaticSprite(a),g=j.getSize(),c=this.getScreenPoint(c);this.surface.blit(j,[c[0]-g[0]/2,c[1]-g[1]/2])};this.drawAnimation=function(c,g,j,e){var c=this.cache.getAnimationSheet(c),d=c.getSize()[1],e=e?e:d,g=this.getScreenPoint(g);
this.surface.blit(c,new a.Rect([g[0]-e/2,g[1]-e/2],[e,e]),new a.Rect([j*d,0],[d,d]))};this.renderHUD=function(a,c){this.surface=a;this.drawText("FPS: "+parseInt(1E3/c.msDuration),"hud",[10,10]);var g=a.getSize(),b=c.car;if(b){this.drawText("POS: "+b.getRacePosition()+"/"+this.world.objects.car.length,"hud",[g[0]/2-140,10]);this.drawText("LAP: "+b.lap+"/"+c.max_laps,"hud",[g[0]/2+20,10]);this.drawText("SPEED: "+parseInt(b.getSpeedKMH()),"hud",[10,a.getSize()[1]-40]);var h=250,k=a.getSize()[1]-40;["front_weapon",
"util","rear_weapon"].forEach(function(a){b[a]&&(this.surface.blit(this.cache.getStaticSprite(d[b[a].weapon_id].icon),[h,k-15]),h+=50,this.drawText(String(parseInt(b[a].ammo)),"hud",[h,k]),h+=60)},this)}e.get("DEBUG")&&(c.delta&&this.drawText("D: "+Math.abs(c.delta),"hud",[10,80]),c.bfs&&this.drawText("BFS: "+c.bfs,"hud",[10,140]));if(c.paused)this.drawText("PAUSED","hud",[g[0]/2-100,g[1]/2],0.75);else if(c.message)this.drawText(c.message,"hud",[g[0]/2-100,g[1]/2],0.75);else{var l=c.time_to_start;
l&&(l>3E3?this.drawText("WAITING FOR OTHERS","hud",[g[0]/2-150,g[1]/2]):l>2E3?this.drawText("GET READY 3...","hud",[g[0]/2-150,g[1]/2],0.75):l>1E3?this.drawText("GET READY 2...","hud",[g[0]/2-150,g[1]/2],0.75):l>0?this.drawText("GET READY 1...","hud",[g[0]/2-150,g[1]/2],0.75):l>-1E3&&this.drawText("GO!!!","hud",[g[0]/2-150,g[1]/2],0.75))}};return this};a.utils.objects.extend(g,k)}},["gamejs","utils","resources","skin","settings","weapon_descriptions"]);
require.define({resources:function(q,b){b.props=["9tires.png","3tires.png","tire.png"];b.cars=["bandit_blue.png","bandit_green.png","bandit_red.png","bandit_yellow.png","big_wheel.png","brawler_blue.png","brawler_green.png","brawler_red.png","brawler_yellow.png","bullet.png","missile.png","racer_blue.png","racer_green.png","racer_red.png","racer_yellow.png","wheel.png","sandbug_blue.png","sandbug_green.png","sandbug_red.png","sandbug_yellow.png","missile_homing.png","samaritan_blue.png","samaritan_green.png",
"samaritan_red.png","samaritan_yellow.png","plasma_projectile.png"];b.tiles=["sand.png","grass.png","snow.png"];b.animations=["explosion.png","explosion_small.png","sw.png","smoke.png","heal.png","fire64.png"];b.ui=["controls.png","garage.png","guncar.png","logo.png","key_bg.png"];b.statics=["mine.png","samaritan_big.png","brawler_big.png","racer_big.png","bandit_big.png","icon_machinegun.png","icon_mine.png","icon_missiles.png","ico_damage.png","ico_ammo.png","0stars.png","1stars.png","2stars.png",
"3stars.png","4stars.png","5stars.png","sandbug_big.png","icon_fix.png","icon_sw.png","icon_missiles_homing.png","ico_nos.png","ico_oil.png","oil_spill.png","icon_plasma.png","icon_flame.png"];b.levels=["snowpeakcircuit","drycircuit","deathvalley","spiralraceway","greenring","frogfoot","2_icemanloops","2_vultureplains","2_queersands","1_bloodbathlane"];b.decals=[,"dideliskampas.png","ilgas.png","trumpas.png","issisakojimas.png","kryzius.png","lenktas.png","paprastas.png","siauras.png","siaurasiplatu.png",
"siaurejantis1.png","siaurejantis2.png","sonaslenktas1.png","sonaslenktas2.png","startbar.png","susikerta.png","uglyduckling.png","white_bar.png","arrow2.png","arrow3.png","arrow4.png","arrow5.png","arrow.png"];b.sound_fx=["bullet_impact_metal.wav","bullet_impact_soft.wav","button_click.wav","explosion.wav","machinegun_shot.wav","missile_launch.wav","thud.wav","shockwave.wav","repair.wav"];b.sound_engine=[]}},[]);
require.define({skin:function(q,b){b.ui_header_background="#FFF";b.ui_background="#E6E6E6";b.alias_background="#333333";b.alert_box_border="black";b.alert_box_background="#E6E6E6";b.fonts={hud:["30px maass","red"],header:["40px maass","#351A15"],"default":["20px maass","#351A15"],small_header:["16px maass","white"],small:["14px maass","black"],alias:["23px maass","#333333"],"16_33":["16px maass","#333333"],"13_1a":["13px maass","#1A1A1A"],"13_green":["13px maass","#00BC12"],alias_label:["40px maass",
"#FFFFFF"],button:["25px maass","#000"],button2:["30px maass","#333333"],button2_hover:["30px maass","#F2F2F2"],loading:["40px maass","#351A15"],"40_black":["40px maass","#000"],"13_grayish":["13px maass","#383736"],"25_66":["25px maass","#666666"],sp_btn:["34px maass","#FFF"],header_black:["56px maass","#333333"],header_brown:["56px maass","#A67C52"],editor_ai_wp:["19px maass","#0094FF"],editor_checkpoint:["19px maass","#FF5656"],editor_start_pos:["19px maass","#3AFF51"],g_white_title:["16px maass",
"#F2F2F2"]};b.single_player_scene={background_color:"#C7B299"};b.dialog={font:"default"};b.sp_car_display={bg_color:"#998675",font1:"13_grayish",font2:"sp_btn"};b.garage_btn={bg_color:"#CCCCCC",bg_color_hover:"#B3B3B3",label_bg:"#E6E6E6",font:"alias"};b.track_selector={back_color:"#E6E6E6",front_color:"#CCCCCC",item_hover_color:"#D8D8D8",item_font:"16_33"};b.title_button={fill:"#CCCCCC",fill_hover:"#B3B3B3",font:"40_black"};b.sp_button={fill:"#333333",fill_hover:"#000",font:"sp_btn"};b.button={border:"#282828",
font:"button",fill:"#CCCCCC",hover_fill:"#B3B3B3",selected_fill:"#FF6A00"};b.garage={background_color:"#666666",back_button:{fill:"#E6E6E6",hover_fill:"#000",font:"button2",hover_font:"button2_hover"},balance_background:"#E6E6E6",car_title_background:"#333333",car_background:"#CCCCCC",car_title_font:"g_white_title",balance_font:"alias",weapon_info_title_background:"#F5F5F5",weapon_info_background:"#B3B3B3",weapon_label_font:"16_33",weapon_info_text_font:"13_1a",tuning_title_background:"#4D4D4D",tuning_background:"#1A1A1A",
store_background:"#F2F2F2",store_border:"#CCCCCC",selected_shop_item_bg:"#B3B3B3",slot_border:"rgba(204, 204, 204, 0.5)",slot_bg:"rgba(204, 204, 204, 0.8)",slot_bg_selected:"#777777",slot_path:"#CCCCCC",white_button:{bg:"#F2F2F2",bg_hover:"#1A1A1A",font:"16_33",hover_font:"g_white_title"}};b.trackdisplay={font:"16_33"};b.label={font:"default"};b.textbox={font:"default",border:"#282828",background:"#FFEFAA"};b.table={header_font:"small_header",data_font:"small",border:"#C6A500",header_fill:"#333333",
hover_fill:"#FFBE00",body_fill:"#CCCCCC",selected_fill:"#FF6A00"};b.trackinfodisplay={header_font:"default",outline_color:"#808080"}}},[]);
require.define({utils:function(q,b){var a=q("gamejs"),l=a.utils.math,o=q("./box2d");q("./settings");var t=q("./renderer");b.renderLevelBackground=function(c,e){var d=t.cache,b=c.size[0],n=c.size[1],k=new a.Surface([b,n]),o,g,y=d.getTile(c.bgtile),q=y.getSize();for(g=0;g<n;g+=q[1])for(o=0;o<b;o+=q[0])k.blit(y,[o,g]);var L;c.decals.forEach(function(a){L=l.normaliseDegrees(a.a);k.blit(d.getDecalSprite(c.dict[a.f],L),a.p)},this);(e||e==void 0)&&c.props.forEach(function(a){L=l.normaliseDegrees(a.a);k.blit(d.getPropSprite(c.dict[a.f],
L),a.p)},this);return k};b.interpolatePoints=function(a,e,d){return[a[0]+(e[0]>a[0]?1:-1)*Math.abs(e[0]-a[0])*d,a[1]+(e[1]>a[1]?1:-1)*Math.abs(e[1]-a[1])*d]};b.interpolateInts=function(a,e,d){return a+(e>a?1:-1)*Math.abs(e-a)*d};b.copy=function(a,e){for(var d in a)e[d]=a[d];return e};b.vec=function(){if(!arguments.length||!arguments[0].hasOwnProperty("x"))if(arguments.length==1)return new o.b2Vec2(arguments[0][0],arguments[0][1]);else if(arguments.length==2)return new o.b2Vec2(arguments[0],arguments[1]);
else throw"kablooie";else return arguments[0]};b.vectorToList=b.arr=function(a){if(a.hasOwnProperty("x"))return[a.x,a.y];return a};b.removeObjFromList=function(a,e){for(var d=0;d<e.length;d++)if(e[d]==a){e.splice(d,1);break}};b.resizeSurfaceToHeight=function(c,e){var d=c.getSize(),b=d[1]/e,d=[parseInt(d[0]/b),parseInt(d[1]/b)],d=new a.Surface(d[0],d[1]);d.blit(c,new a.Rect([0,0],d.getSize()),new a.Rect([0,0],c.getSize()));return d};b.inArray=function(a,e){for(var d=0;d<a.length;d++)if(a[d]==e)return!0;
return!1};b.supports_html5_storage=function(){try{return"localStorage"in window&&window.localStorage!==null}catch(a){return!1}}}},["gamejs","box2d","settings","renderer"]);
require.define({uiscenes:function(q,b){var a=q("gamejs"),l=q("./ui");q("./utils");var o=q("./levels");q("./car_descriptions");var t=q("./gamejs-gui"),c=q("./skin"),e=q("./combatracer");q("./renderer");var d=q("./leagues"),h=q("./sounds"),n=b.CongratulationsScene=function(){n.superConstructor.apply(this,[]);this.titlelbl=new t.Label({parent:this.container,position:[210,40],text:"Congratulations",font:l.getFont("header_black")});this.label=new t.Label({parent:this.container,position:[30,120],text:"You won the game!",
font:l.getFont("header")});this.text=new t.Text({parent:this.container,position:[30,180],font:l.getFont("16_33"),width:500,text:"There are no more leagues yet, which means you win!\nCheck back soon for more cars, weapons and tracks. Follow BanditRacer on twitter!"})};a.utils.objects.extend(n,l.UIScene);var k=b.SPGameOverScene=function(a,c,g){k.superConstructor.apply(this,[]);var b=c==1;this.titlelbl=new t.Label({parent:this.container,position:[210,40],text:"Race Over",font:l.getFont("header_black")});
this.label=new t.Label({parent:this.container,position:[30,120],text:b?"You win! Well done.":"You lose! Better luck next time.",font:l.getFont("header")});new l.Table({parent:this.container,size:[460,300],position:[30,200],columns:[{key:"place",label:"Place",width:80},{key:"player",label:"Player",width:200},{key:"kills",label:"Kills",width:80},{key:"deaths",label:"Deaths",width:80}],data:a});a=d[e.game.player.singleplayer.league];if(e.game.return_to!="editor"){var h=0;new t.Label({position:[510,200],
parent:this.container,font:l.getFont("button2"),text:"Reward"});c>0&&c<4&&(h=a["reward_"+c]);c>0&&(c=c==1?"1st place:":c==2?"2nd place:":c==3?"3d place:":"4th place:",new t.Label({position:[510,240],font:l.getFont("alias"),parent:this.container,text:c}),c=new t.Label({position:[510,240],font:l.getFont("alias"),parent:this.container,text:String(h)+"\u20ac"}),c.rightAlign(730));new t.Label({position:[510,270],font:l.getFont("alias"),parent:this.container,text:"Kills:"});c=new t.Label({position:[510,
270],font:l.getFont("alias"),parent:this.container,text:String(g.player_car.kills*100)+"\u20ac"});c.rightAlign(730);h+=g.player_car.kills*100;new t.Label({position:[510,300],font:l.getFont("alias"),parent:this.container,text:"TOTAL:"});c=new t.Label({position:[510,300],font:l.getFont("alias"),parent:this.container,text:String(h)+"\u20ac"});c.rightAlign(730);e.game.player.singleplayer.balance+=h}this.update=function(a){(new l.UIScene).update.apply(this,[a]);this.congratulate&&this.game.showCongratulations()};
if(b&&(e.game.player.singleplayer.completed_tracks.push(g.level.id),e.game.player.singleplayer.completed_tracks.length>=a.tracks.length))if(d[e.game.player.singleplayer.league+1])e.game.player.singleplayer.league++,e.game.player.singleplayer.completed_tracks=[],this.alert("You have advanced to "+d[e.game.player.singleplayer.league].name+"!");else{this.congratulate=!0;return}e.game.return_to!="editor"&&e.game.save()&&new t.Text({position:[30,510],font:l.getFont("13_green"),parent:this.container,width:460,
text:"Game saved to HTML5 storage. You will be able to load it next time you play Bandit Racer on this browser."});(new l.Button({parent:this.container,position:[650,500],size:[150,50],lean:"right",text:"Continue..."})).onClick(function(){this.game.returnTo()},this)};a.utils.objects.extend(k,l.UIScene);var M=b.TitleScene=function(g,d){M.superConstructor.apply(this,[g,d]);this.container.on(t.EVT_PAINT,function(){a.draw.polygon(this.surface,c.alias_background,[[0,110],[420,110],[390,180],[0,180]])},
this.container);new t.Image({position:[40,260],parent:this.container,image:this.cache.getUIImage("logo.png")});new t.Label({position:[50,115],parent:this.container,font:l.getFont("alias_label"),text:"name:"});this.nameinput=new l.NameInput({position:[178,129],size:[200,40],text:this.game.player.alias,parent:this.container});this.nameinput.on(t.EVT_CHANGE,function(a){this.game.player.alias=a.value},this);this.btn_single=new l.TitleButton({position:[440,210],size:[360,65],text:"Single player",parent:this.container});
this.btn_single.onClick(this.singleplayer,this);this.btn_editor=new l.TitleButton({position:[440,300],size:[360,65],text:"Track Editor",parent:this.container});this.btn_editor.onClick(this.editTrack,this);if(!this.game.tried_loading){if(this.game.haveSave())this.yes_no_dialog=new l.YesNoDialog({parent:this.gui,size:[550,150],text:"Saved game found. Do you want to load?"}),this.yes_no_dialog.yes.onClick(function(){this.yes_no_dialog.close();this.game.load()&&this.nameinput.setText(e.game.player.alias)},
this),this.yes_no_dialog.no.onClick(function(){this.yes_no_dialog.close()},this),this.yes_no_dialog.show();this.game.tried_loading=!0}};a.utils.objects.extend(M,l.UIScene);M.prototype.editTrack=function(){this.game.showEditor()};M.prototype.handleMessage=function(a,c){a=="HELLO"?(this.game.player.uid=c.uid,this.game.acquainted=!0,this.clearAlert(),this.game.showLobbyList()):this.handleMessageDefault(a,c)};M.prototype.joinLobby=function(){var a=this.game.player.alias;a?(this.alert("Connecting. Please wait...",
!1),this.game.getCommunicator().queueMessage("HI",{alias:a})):this.alert("You must enter your name first!")};M.prototype.singleplayer=function(){this.game.singleplayer()};var g=b.SinglePlayerScene=function(){g.superConstructor.apply(this,[]);this.container.header_height=130;this.container.background_color=c.single_player_scene.background_color;this.container.refresh();this.titlelbl=new t.Label({parent:this.container,position:[210,40],text:"Single Player",font:l.getFont("header_black")});this.backbtn=
new l.Button({size:[130,50],parent:this.container,position:[0,520],lean:"left",fill:c.sp_button.fill,font:l.getFont(c.sp_button.font),hover_fill:c.sp_button.fill_hover,text:"BACK"});this.backbtn.onClick(this.back,this);this.racebtn=new l.Button({size:[130,50],parent:this.container,position:[this.container.size[0]-130,520],lean:"right",fill:c.sp_button.fill,font:l.getFont(c.sp_button.font),hover_fill:c.sp_button.fill_hover,text:"RACE!"});this.racebtn.onClick(this.race,this);this.gotogarage=new l.GoToGarage({position:[14,
160],parent:this.container});this.gotogarage.on(t.EVT_MOUSE_DOWN,function(){this.game.return_to="singleplayer";h.play({filename:"button_click.wav"});this.game.showSPGarage()},this);this.car_display=new l.CarDisplay({position:[14,356],gameinfo:e.game.player.singleplayer,parent:this.container});this.track_selector=new l.TrackSelector({position:[254,160],parent:this.container});this.diff_selector=new l.DifficultySelect({position:[14,431],parent:this.container,size:[210,65]})};a.utils.objects.extend(g,
l.UIScene);g.prototype.back=function(){this.game.showTitle()};g.prototype.race=function(){this.track_selector.track?this.game.playLevel(o[this.track_selector.track],!1,"singleplayer"):this.alert("You must select a track first!",!0)};var y=b.LoadingScene=function(a,c,g){y.superConstructor.apply(this,[a,c]);this.container.destroy();this.gui.center(new t.Label({position:[0,0],parent:this.gui,text:"Loading, please wait...",font:l.getFont("25_66")}));this.next_scene=g};a.utils.objects.extend(y,l.UIScene);
var R=b.ControlsSplash=function(a,g,e){R.superConstructor.apply(this,[a,g]);this.container.destroy();this.next_scene=e;this.gui.on(t.EVT_PAINT,function(){this.surface.fill(c.ui_background)},this.gui);a=new t.Image({position:[0,0],image:g.getUIImage("controls.png"),parent:this.gui});this.gui.center(a);g=a.getPosition()[1]-120;x=a.getPosition()[0];a.move([x,g]);x-=60;g+=a.getSize()[1]+10;new l.KeyExplanation({position:[x,g],key:"x",parent:this.gui,text:"Fire front weapon"});g+=62;new l.KeyExplanation({position:[x,
g],key:"c",parent:this.gui,text:"Use utility"});g+=62;new l.KeyExplanation({position:[x,g],key:"v",parent:this.gui,text:"Fire rear weapon"});g+=62;new l.KeyExplanation({position:[x,g],key:"ESC",parent:this.gui,text:"Menu"});g+=62;this.lbl=new t.Label({position:[x-30,g],parent:this.gui,text:"Loading. Please wait...",font:l.getFont("25_66")});this.first=this.loaded=!1;this.update=function(a){l.UIScene().update.apply(this,[a]);if(this.first){if(!this.loaded)this.game.cacheCarSprites(this.next_scene),
this.lbl.setText("Press any key or click to continue..."),this.gui.despatchEvent({type:t.EVT_FOCUS}),this.gui.on(t.EVT_MOUSE_DOWN,this.next,this),this.gui.on(t.EVT_KEY_DOWN,this.next,this),this.loaded=!0}else this.first=!0}};a.utils.objects.extend(R,l.UIScene);R.prototype.next=function(){this.game.director.replaceScene(this.next_scene)}}},["gamejs","ui","utils","levels","car_descriptions","gamejs-gui","skin","combatracer","renderer","leagues","sounds"]);
require.define({animation:function(q,b){var a=q("./utils");q("gamejs");var l=b.Animation=function(a){this.filename=a.filename;this.age=0;this.duration=a.duration;this.type="animation";this.expand_from=a.expand_from;this.expand_to=a.expand_to;this.finished=!1;this.repeat=a.repeat?!0:!1;this.onFinish=function(){};this.restart=function(){this.expand_to=this.expand_from=this.age=0};this.update=function(a){this.age+=a;if(this.age>this.duration)this.onFinish(),this.repeat?this.restart():this.finished=!0};
this.draw=function(a,c){var e=a.cache.getAnimationFrameCount(this.filename),d=null;this.expand_from&&this.expand_to&&(d=this.expand_from+parseInt((this.expand_to-this.expand_from)*(this.age/this.duration)));a.drawAnimation(this.filename,c,Math.min(parseInt(this.age/(this.duration/e)),e-1),d)};return this};b.AnimationObject=function(b){this.anim=new l(b);this.position=a.arr(b.position);this.world=b.world;this.duration=b.duration;this.type="animation_object";this.follow_obj=b.follow_obj;this.getState=
function(){return null};this.interpolate=function(){};this.setState=function(){};this.update=function(a){this.anim.update(a);this.anim.finished&&this.world.destroyObj(this.id)};this.draw=function(b){var c=this.follow_obj?a.arr(this.follow_obj.body.GetPosition()):this.position;this.anim.draw(b,c)};return this};b.animations={small_explosion:{filename:"explosion_small.png",duration:500},smoke:{filename:"smoke.png",duration:300},explosion:{filename:"explosion.png",duration:1E3},shockwave:{filename:"sw.png",
duration:200,expand_from:40,expand_to:200},heal:{filename:"heal.png",duration:500},fire:{filename:"fire64.png",duration:500}}}},["utils","gamejs"]);
require.define({leagues:function(q,b){b[0]={name:"Begginer League",tracks:["drycircuit","snowpeakcircuit","greenring","frogfoot","1_bloodbathlane"],bots:["Bob","CatLady","Dominator"],reward_1:1E3,reward_2:600,reward_3:300};b[1]={name:"Veteran League",tracks:["spiralraceway","deathvalley","2_icemanloops","2_vultureplains","2_queersands"],bots:["HotShot","TheDude","Ratman"],reward_1:2E3,reward_2:1E3,reward_3:500}}},[]);
require.define({weapon_descriptions:function(q,b){b.Machinegun={damage:5,preload:["bullet.png"],type:"front_weapon",launcher:"Machinegun",projectile:"Bullet",speed:500,fire_rate:100,ammo_capacity:50,damage_upgrade:1,damage_upgrade_price:500,ammo_upgrade:10,ammo_upgrade_price:500,name:"Machineguns",icon:"icon_machinegun.png",price:700,description:"Your basic car accessory: two front mounted high caliber machineguns"};b.MissileLauncher={damage:25,preload:["missile.png"],speed:400,type:"front_weapon",
launcher:"MissileLauncher",projectile:"Missile",fire_rate:300,ammo_capacity:10,ammo_upgrade:2,ammo_upgrade_price:700,damage_upgrade:5,damage_upgrade_price:700,name:"Missiles",icon:"icon_missiles.png",price:1E3,description:"Torpedo missiles with high yield warheads, for when you really don't like the guy in front of you"};b.RepairKit={damage:30,type:"util",launcher:"RepairKit",projectile:null,fire_rate:500,ammo_capacity:2,ammo_upgrade:1,ammo_upgrade_price:500,damage_upgrade:10,damage_upgrade_price:700,
name:"Repair Kit",icon:"icon_fix.png",price:1E3,description:"Repair your car on the go with a automatic repair kit"};b.NOS={damage:15,type:"util",fire_rate:2E3,duration:2E3,ammo_capacity:2,ammo_upgrade:1,ammo_upgrade_price:1500,damage_upgrade:4,damage_upgrade_price:1E3,launcher:"NOS",name:"Boost",price:2E3,icon:"ico_nos.png",description:"Increases top speed and acceleration for a shot time"};b.Shockwave={damage:10,type:"util",fire_rate:1500,ammo_capacity:3,ammo_upgrade:1,ammo_upgrade_price:1300,damage_upgrade:5,
damage_upgrade_price:800,launcher:"ShockwaveGenerator",name:"Shockwave",price:1500,icon:"icon_sw.png",description:"Generates a shockwave that slams nearby cars away from your car"};b.HomingMissiles={damage:18,speed:400,preload:["missile_homing.png"],type:"front_weapon",launcher:"MissileLauncher",projectile:"HomingMissile",fire_rate:300,ammo_capacity:10,ammo_upgrade:2,ammo_upgrade_price:700,damage_upgrade:4,damage_upgrade_price:800,name:"Homing Missiles",price:1300,icon:"icon_missiles_homing.png",
description:"Heat seeking missiles, a blind drivers favourite weapon"};b.MineLauncher={damage:30,type:"rear_weapon",launcher:"MineLauncher",projectile:"Mine",fire_rate:500,ammo_capacity:4,ammo_upgrade:1,ammo_upgrade_price:600,damage_upgrade:8,damage_upgrade_price:500,name:"Mines",icon:"icon_mine.png",price:800,description:"Discourage tailgating with anti-vehicle mines"};b.Oil={damage:0,type:"rear_weapon",fire_rate:500,duration:1E3,ammo_capacity:2,ammo_upgrade:1,ammo_upgrade_price:2E3,damage_upgrade:null,
damage_upgrade_price:null,name:"Oil",icon:"ico_oil.png",price:2E3,launcher:"Oil",projectile:"OilPuddle",description:"Leave slippery puddles of finest grade oil"};b.Napalm={damage:10,type:"rear_weapon",launcher:"MineLauncher",projectile:"NapalmFlame",fire_rate:80,ammo_capacity:20,ammo_upgrade:5,ammo_upgrade_price:1E3,damage_upgrade:2,damage_upgrade_price:1E3,name:"Napalm",icon:"icon_flame.png",price:2500,description:"Burn your opponents to a crisp"};b.PlasmaCannon={damage:12,speed:500,preload:["plasma_projectile.png"],
type:"front_weapon",launcher:"PlasmaCannon",projectile:"PlasmaProjectile",fire_rate:200,ammo_capacity:24,damage_upgrade:3,damage_upgrade_price:1500,ammo_upgrade:6,ammo_upgrade_price:1500,name:"Plasma Cannon",icon:"icon_plasma.png",price:3E3,description:"Fires super heated blobs of pure plasma that will burn through anything"}}},[]);
require.define({props:function(q,b){var a=q("gamejs"),l=q("./utils"),o=q("./box2d"),t=l.vec,c=a.utils.math;b.rotarrays={};b.BoxProp=function(a){this.size=a.size;this.width=this.size[0];this.height=this.size[1];this.angle=a.angle?a.angle:0;this.world=a.world;this.position=a.position;this.filename=a.filename;this.type="prop";this.getAngle=function(){return l.degrees(this.body.GetAngle())};this.getState=function(){return null};this.setState=function(){};var d=new o.b2BodyDef;d.position=t(this.position);
d.angle=c.radians(a.angle);d.fixedRotation=!0;this.body=this.world.CreateBody(d);this.body.SetUserData(this);a=new o.b2FixtureDef;a.shape=new o.b2PolygonShape;a.shape.SetAsBox(this.width/2,this.height/2);a.restitution=0.4;this.body.CreateFixture(a);this.getAngle=function(){return this.angle};this.draw=null;return this}}},["gamejs","utils","box2d"]);
require.define({"gamejs/display":function(q,b){var a=q("../gamejs").Surface,l=null;b.init=function(){var a=null;t()===null&&(a=document.createElement("canvas"),a.setAttribute("id","gjs-canvas"),document.body.appendChild(a));(a=document.getElementById("gjs-loader"))&&a.parentNode.removeChild(a)};b.setMode=function(a){var e=t();e.width=a[0];e.height=a[1];return o()};b.setCaption=function(a){document.title=a};b._getCanvasOffset=function(){var a=t().getBoundingClientRect();return[a.left,a.top]};var o=
b.getSurface=function(){if(l===null){var c=t();l=new a([c.clientWidth,c.clientHeight]);l._canvas=c}return l},t=function(){var a=null;Array.prototype.slice.call(document.getElementsByTagName("canvas")).every(function(e){if(e.getAttribute("id")=="gjs-canvas")return a=e,!1;return!0});return a}}},["gamejs"]);
require.define({"gamejs/time":function(q,b){var a={},l={};b.init=function(){Date.now();setInterval(o,10)};b.fpsCallback=function(b,c,e){e=parseInt(1E3/e,10);a[e]=a[e]||[];l[e]=l[e]||0;a[e].push({rawFn:b,callback:function(a){b.apply(c,[a])}})};b.deleteCallback=function(b,c){var c=parseInt(1E3/c,10),e=a[c];e&&(a[c]=e.filter(function(a){if(a.rawFn!==b)return!0;return!1}))};var o=function(){function b(a){a.callback(d)}var c=Date.now(),e;for(e in l){l[e]||(l[e]=c);var d=c-l[e];e<=d&&(l[e]=c,a[e].forEach(b,
this))}}}},[]);
require.define({"gamejs/utils/binaryheap":function(q,b){var a=b.BinaryHeap=function(a){this.content=[];this.scoreFunction=a;return this};a.prototype.push=function(a){this.content.push(a);this.sinkDown(this.content.length-1)};a.prototype.pop=function(){var a=this.content[0],b=this.content.pop();this.content.length>0&&(this.content[0]=b,this.bubbleUp(0));return a};a.prototype.remove=function(a){if(!this.content.some(function(b,t){if(b==a){var c=this.content.pop();t!=this.content.length&&(this.content[t]=
c,this.scoreFunction(c)<this.scoreFunction(a)?this.sinkDown(t):this.bubbleUp(t));return!0}return!1},this))throw Error("Node not found.");};a.prototype.size=function(){return this.content.length};a.prototype.sinkDown=function(a){for(var b=this.content[a];a>0;){var t=Math.floor((a+1)/2)-1,c=this.content[t];if(this.scoreFunction(b)<this.scoreFunction(c))this.content[t]=b,this.content[a]=c,a=t;else break}};a.prototype.bubbleUp=function(a){for(var b=this.content.length,t=this.content[a],c=this.scoreFunction(t);;){var e=
(a+1)*2,d=e-1,h=null;if(d<b){var n=this.scoreFunction(this.content[d]);n<c&&(h=d)}if(e<b&&this.scoreFunction(this.content[e])<(h===null?c:n))h=e;if(h!==null)this.content[a]=this.content[h],this.content[h]=t,a=h;else break}}}},[]);
require.define({"gamejs/utils/vectors":function(q,b){var a=q("./math");b.distance=function(a,c){return o(l(a,c))};var l=b.substract=function(a,c){return[a[0]-c[0],a[1]-c[1]]};b.add=function(a,c){return[a[0]+c[0],a[1]+c[1]]};b.multiply=function(a,c){if(typeof c==="number")return[a[0]*c,a[1]*c];return[a[0]*c[0],a[1]*c[1]]};b.divide=function(a,c){if(typeof c==="number")return[a[0]/c,a[1]/c];throw Error("only divide by scalar supported");};var o=b.len=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])};
b.unit=function(a){var c=o(a);if(c)return[a[0]/c,a[1]/c];return[0,0]};b.rotate=function(b,c){c=a.normaliseRadians(c);return[b[0]*Math.cos(c)-b[1]*Math.sin(c),b[0]*Math.sin(c)+b[1]*Math.cos(c)]};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]};b.angle=function(a,c){var e=o(a),d=o(c);return e&&d?Math.acos((a[0]*c[0]+a[1]*c[1])/(e*d)):0}}},["gamejs/utils/math"]);
require.define({"gamejs/utils/matrix":function(q,b){b.identity=function(){return[1,0,0,1,0,0]};b.add=function(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3],a[4]+b[4],a[5]+b[5],a[6]+b[6]]};var a=b.multiply=function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]};b.translate=function(b,o,t){return a(b,[1,0,0,1,o,t])};b.rotate=function(b,o){var t=Math.sin(o),c=Math.cos(o);return a(b,[c,t,-t,c,0,0])};
b.rotation=function(a){return Math.atan2(a[1],a[0])};b.scale=function(b,o){return a(b,[o[0],0,0,o[1],0,0])}}},[]);
require.define({"gamejs/utils/objects":function(q,b){b.extend=function(a,b){if(a===void 0)throw Error("unknown subClass");if(b===void 0)throw Error("unknown superClass");var c=new Function;c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.superClass=b.prototype;a.superConstructor=b};b.merge=function(){for(var a={},b=arguments.length;b>0;--b){var c=arguments[b-1],e;for(e in c)a[e]=c[e]}return a};var a=b.keys=function(a){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)Object.prototype.hasOwnProperty.call(a,
c)&&b.push(c);return b},l=b.accessor=function(a,b,c,e){Object.defineProperty!==void 0?Object.defineProperty(a,b,{get:c,set:e}):Object.prototype.__defineGetter__!==void 0&&(a.__defineGetter__(b,c),e&&a.__defineSetter__(b,e))};b.accessors=function(b,t){a(t).forEach(function(a){l(b,a,t[a].get,t[a].set)})}}},[]);require.define({"gamejs/utils/arrays":function(q,b){b.remove=function(a,b){return b.splice(b.indexOf(a),1)}}},[]);
require.define({"gamejs/utils/math":function(q,b){b.normaliseDegrees=function(a){a%=360;a<0&&(a+=360);return a};b.normaliseRadians=function(a){a%=2*Math.PI;a<0&&(a+=2*Math.PI);return a};b.degrees=function(a){return a*(180/Math.PI)};b.radians=function(a){return a*(Math.PI/180)}}},[]);
require.define({"gamejs/event":function(q,b){var a=q("./display"),l=q("../gamejs");b.K_UP=38;b.K_DOWN=40;b.K_RIGHT=39;b.K_LEFT=37;b.K_SPACE=32;b.K_BACKSPACE=8;b.K_TAB=9;b.K_ENTER=13;b.K_SHIFT=16;b.K_CTRL=17;b.K_ALT=18;b.K_ESC=27;b.K_0=48;b.K_1=49;b.K_2=50;b.K_3=51;b.K_4=52;b.K_5=53;b.K_6=54;b.K_7=55;b.K_8=56;b.K_9=57;b.K_a=65;b.K_b=66;b.K_c=67;b.K_d=68;b.K_e=69;b.K_f=70;b.K_g=71;b.K_h=72;b.K_i=73;b.K_j=74;b.K_k=75;b.K_l=76;b.K_m=77;b.K_n=78;b.K_o=79;b.K_p=80;b.K_q=81;b.K_r=82;b.K_s=83;b.K_t=84;b.K_u=
85;b.K_v=86;b.K_w=87;b.K_x=88;b.K_y=89;b.K_z=90;b.K_KP1=97;b.K_KP2=98;b.K_KP3=99;b.K_KP4=100;b.K_KP5=101;b.K_KP6=102;b.K_KP7=103;b.K_KP8=104;b.K_KP9=105;b.QUIT=0;b.KEY_DOWN=1;b.KEY_UP=2;b.MOUSE_MOTION=3;b.MOUSE_UP=4;b.MOUSE_DOWN=5;b.MOUSE_WHEEL=6;var o=[];b.get=function(){return o.splice(0,o.length)};b.poll=function(){return o.pop()};b.post=function(a){o.push(a)};b.Event=function(){this.pos=this.button=this.rel=this.key=this.type=null};b.init=function(){function t(c){var b=a._getCanvasOffset();o.push({type:l.event.MOUSE_WHEEL,
pos:[c.clientX-b[0],c.clientY-b[1]],delta:c.detail||-c.wheelDeltaY/40})}document.addEventListener("mousedown",function(c){var b=a._getCanvasOffset();o.push({type:l.event.MOUSE_DOWN,pos:[c.clientX-b[0],c.clientY-b[1]],button:c.button,shiftKey:c.shiftKey,ctrlKey:c.ctrlKey,metaKey:c.metaKey})},!1);document.addEventListener("mouseup",function(c){var b=a._getCanvasOffset();o.push({type:l.event.MOUSE_UP,pos:[c.clientX-b[0],c.clientY-b[1]],button:c.button,shiftKey:c.shiftKey,ctrlKey:c.ctrlKey,metaKey:c.metaKey})},
!1);document.addEventListener("keydown",function(a){var c=a.keyCode||a.which;o.push({type:l.event.KEY_DOWN,key:c,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey});(!a.ctrlKey&&!a.metaKey&&(c>=b.K_LEFT&&c<=b.K_DOWN||c>=b.K_0&&c<=b.K_z||c>=b.K_KP1&&c<=b.K_KP9||c===b.K_SPACE||c===b.K_TAB||c===b.K_ENTER)||c===b.K_ALT||c===b.K_BACKSPACE)&&a.preventDefault()},!1);document.addEventListener("keyup",function(a){o.push({type:l.event.KEY_UP,key:a.keyCode,shiftKey:a.shiftKey,ctrlKey:a.ctrlKey,metaKey:a.metaKey})},
!1);var c=[];document.addEventListener("mousemove",function(b){var d=a._getCanvasOffset(),d=[b.clientX-d[0],b.clientY-d[1]],h=[];c.length&&(h=[c[0]-d[0],c[1]-d[1]]);o.push({type:l.event.MOUSE_MOTION,pos:d,rel:h,buttons:null,timestamp:b.timeStamp});c=d},!1);document.addEventListener("mousewheel",t,!1);document.addEventListener("DOMMouseScroll",t,!1);document.addEventListener("beforeunload",function(){o.push({type:l.event.QUIT})},!1)}}},["gamejs/display","gamejs"]);
require.define({"gamejs/font":function(q,b){var a=q("../gamejs").Surface,l=q("./utils/objects"),o=b.Font=function(b){this.sampleSurface=new a([10,10]);this.sampleSurface.context.font=b;this.sampleSurface.context.textAlign="start";this.sampleSurface.context.textBaseline="bottom";return this};o.prototype.render=function(b,c){var e=this.size(b),e=new a(e),d=e.context;d.save();d.font=this.sampleSurface.context.font;d.textBaseline=this.sampleSurface.context.textBaseline;d.textAlign=this.sampleSurface.context.textAlign;
d.fillStyle=d.strokeStyle=c||"#000000";d.fillText(b,0,e.rect.height,e.rect.width);d.restore();return e};o.prototype.size=function(a){return[this.sampleSurface.context.measureText(a).width,this.fontHeight]};l.accessors(o.prototype,{fontHeight:{get:function(){return this.sampleSurface.context.measureText("M").width*1.5}}})}},["gamejs","gamejs/utils/objects"]);
require.define({"gamejs/transform":function(q,b){var a=q("../gamejs").Surface,l=q("./utils/matrix");q("./utils/math");var o=q("./utils/vectors");b.rotate=function(b,c){var e=b.getSize(),d=c*Math.PI/180,h=e;if(c%180!==0)var h=b.getRect(),h=[[-h.width/2,h.height/2],[h.width/2,h.height/2],[-h.width/2,-h.height/2],[h.width/2,-h.height/2]].map(function(a){return o.rotate(a,d)}),n=h.map(function(a){return a[0]}),k=h.map(function(a){return a[1]}),h=Math.min.apply(Math,n),n=Math.max.apply(Math,n),M=Math.min.apply(Math,
k),k=Math.max.apply(Math,k),h=[n-h,k-M];k=new a(h);n=b._matrix;b._matrix=l.translate(b._matrix,e[0]/2,e[1]/2);b._matrix=l.rotate(b._matrix,d);b._matrix=l.translate(b._matrix,-e[0]/2,-e[1]/2);k.blit(b,[(h[0]-e[0])/2,(h[1]-e[1])/2]);b._matrix=n;return k};b.scale=function(b,c){var e=c[0],d=c[1],h=b.getSize(),h=[h[0]*c[0],h[1]*c[1]],h=new a(h);b._matrix=l.scale(b._matrix,[e,d]);h.blit(b);return h};b.flip=function(b,c,e){var d=b.getSize(),h=new a(d),n=1,k=1,l=0,g=0;c===!0&&(n=-1,l=-d[0]);e===!0&&(k=-1,
g=-d[1]);h.context.save();h.context.scale(n,k);h.context.drawImage(b.canvas,l,g);h.context.restore();return h}}},["gamejs","gamejs/utils/matrix","gamejs/utils/math","gamejs/utils/vectors"]);
require.define({"gamejs/sprite":function(q,b){q("../gamejs");var a=q("./utils/arrays"),l=b.Sprite=function(){this._groups=[];this._alive=!0;this.rect=this.image=null;return this};l.prototype.kill=function(){this._alive=!1;this._groups.forEach(function(a){a.remove(this)},this)};l.prototype.remove=function(a){a instanceof Array||(a=[a]);a.forEach(function(a){a.remove(this)},this)};l.prototype.add=function(a){a instanceof Array||(a=[a]);a.forEach(function(a){a.add(this)},this)};l.prototype.draw=function(a){a.blit(this.image,
this.rect)};l.prototype.update=function(){};l.prototype.isDead=function(){return!this._alive};var o=b.Group=function(a){this._sprites=[];(a instanceof l||a instanceof Array&&a.length&&a[0]instanceof l)&&this.add(a);return this};o.prototype.update=function(){var a=arguments;this._sprites.forEach(function(b){b.update.apply(b,a)},this)};o.prototype.add=function(a){a instanceof Array||(a=[a]);a.forEach(function(a){this._sprites.push(a);a._groups.push(this)},this)};o.prototype.remove=function(c){c instanceof
Array||(c=[c]);c.forEach(function(c){a.remove(c,this._sprites);a.remove(this,c._groups)},this)};o.prototype.has=function(a){a instanceof Array||(a=[a]);return a.every(function(a){return this._sprites.indexOf(a)!==-1},this)};o.prototype.sprites=function(){return this._sprites};o.prototype.draw=function(){var a=arguments;this._sprites.forEach(function(b){b.draw.apply(b,a)},this)};o.prototype.clear=function(a,b){this._sprites.forEach(function(d){a.blit(b,d.rect)},this)};o.prototype.empty=function(){this._sprites=
[]};o.prototype.collidePoint=function(){var a=Array.prototype.slice.apply(arguments);return this._sprites.filter(function(b){return b.rect.collidePoint.apply(b.rect,a)},this)};o.prototype.forEach=function(){Array.prototype.forEach.apply(this._sprites,arguments)};o.prototype.some=function(){return Array.prototype.some.apply(this._sprites,arguments)};b.spriteCollide=function(a,b,d,h){var h=h||t,d=d||!1,n=[];b.sprites().forEach(function(b){h(a,b)&&(d&&b.kill(),n.push(b))});return n};b.groupCollide=function(a,
b,d,h,n){var d=d||!1,h=h||!1,k=[],l=n||t;a.sprites().forEach(function(a){b.sprites().forEach(function(c){l(a,c)&&(d&&a.kill(),h&&c.kill(),k.push({a:a,b:c}))})});return k};var t=b.collideRect=function(a,b){return a.rect.collideRect(b.rect)};b.collideMask=function(a,b){if(!a.mask||!b.mask)throw Error("Both sprites must have 'mask' attribute set to an gamejs.mask.Mask");return a.mask.overlap(b.mask,[b.rect.left-a.rect.left,b.rect.top-a.rect.top])};b.collideCircle=function(a,b){return a.rect.center[0]*
a.rect.center[0]+a.rect.center[1]*a.rect.center[1]<=(a.radius*a.radius||(a.rect.width*a.rect.width+a.rect.height*a.rect.height)/4)+(b.radius*b.radius||(b.rect.width*b.rect.width+b.rect.height*b.rect.height)/4)}}},["gamejs","gamejs/utils/arrays"]);
require.define({"gamejs/draw":function(q,b){b.line=function(a,b,o,t,c){a=a.context;a.save();a.beginPath();a.strokeStyle=b;a.lineWidth=c||1;a.moveTo(o[0],o[1]);a.lineTo(t[0],t[1]);a.stroke();a.restore()};b.lines=function(a,b,o,t,c){o=o||!1;a=a.context;a.save();a.beginPath();a.strokeStyle=a.fillStyle=b;a.lineWidth=c||1;for(b=0;b<t.length;b++)c=t[b],b===0?a.moveTo(c[0],c[1]):a.lineTo(c[0],c[1]);o&&a.lineTo(t[0][0],t[0][1]);a.stroke();a.restore()};b.circle=function(a,b,o,t,c){if(!t)throw Error("[circle] radius required argument");
if(!o||!(o instanceof Array))throw Error("[circle] pos must be given & array"+o);a=a.context;a.save();a.beginPath();a.strokeStyle=a.fillStyle=b;a.lineWidth=c||1;a.arc(o[0],o[1],t,0,2*Math.PI,!0);c===void 0||c===0?a.fill():a.stroke();a.restore()};b.rect=function(a,b,o,t){a=a.context;a.save();a.strokeStyle=a.fillStyle=b;isNaN(t)||t===0?a.fillRect(o.left,o.top,o.width,o.height):(a.lineWidth=t||1,a.strokeRect(o.left,o.top,o.width,o.height));a.restore()};b.arc=function(a,b,o,t,c,e){a=a.context;a.save();
a.strokeStyle=a.fillStyle=b;a.arc(o.center[0],o.center[1],o.width/2,t*(Math.PI/180),c*(Math.PI/180),!1);isNaN(e)||e===0?a.fill():(a.lineWidth=e||1,a.stroke());a.restore()};b.polygon=function(a,b,o,t){var c=a.context;c.save();c.fillStyle=c.strokeStyle=b;c.beginPath();o.forEach(function(a,b){b==0?c.moveTo(a[0],a[1]):c.lineTo(a[0],a[1])});c.closePath();isNaN(t)||t===0?c.fill():(c.lineWidth=t||1,c.stroke());c.restore()}}},[]);
require.define({"gamejs/pathfinding/astar":function(q,b){function a(){var a={};this.store=function(c,b){a[c[0]+"-"+c[1]]=b};this.find=function(c){return a[c[0]+"-"+c[1]]};return this}var l=q("../utils/binaryheap").BinaryHeap;b.findRoute=function(b,c,e,d){function h(a){k.push(a);o.store(a.point,a)}function n(a){var c=o.find(a),d=g.length+b.actualDistance(g.point,a);if(!c||c.length>d)c&&k.remove(c),h({point:a,from:g,length:d})}var k=new l(function(a){if(a.score===void 0)a.score=b.estimatedDistance(a.point,
e)+a.length;return a.score}),o=new a;h({point:c,from:null,length:0});for(var c=Date.now(),g=null;k.size()>0&&(!d||Date.now()-c<d);){g=k.pop();if(e[0]===g.point[0]&&e[1]===g.point[1])return g;b.adjacent(g.point).forEach(n)}return null};var o=b.Map=function(){throw Error("not instantiable, this is an interface");};o.prototype.adjacent=function(){};o.prototype.estimatedDistance=function(){};o.prototype.actualDistance=function(){}}},["gamejs/utils/binaryheap"]);
require.define({"gamejs/surfacearray":function(q,b){var a=q("../gamejs"),l=q("./utils/objects").accessors;b.blitArray=function(a,b){a.context.putImageData(b.imageData,0,0)};b.SurfaceArray=function(b){this.set=function(a,b,e){a=a*4+b*t[0]*4;c[a]=e[0];c[a+1]=e[1];c[a+2]=e[2];c[a+3]=e[3]===void 0?255:e[3]};this.get=function(a,b){var e=a*4+b*t[0]*4;return[c[e],c[e+1],c[e+2],c[e+3]]};this.surface=null;l(this,{surface:{get:function(){var c=new a.Surface(t);c.context.putImageData(e,0,0);return c}},imageData:{get:function(){return e}}});
this.getSize=function(){return t};var t=null,c=null,e=null;b instanceof Array?(t=b,e=a.display.getSurface().context.createImageData(t[0],t[1]),c=e.data):(t=b.getSize(),c=e=b.getImageData(0,0,t[0],t[1]));return this}}},["gamejs","gamejs/utils/objects"]);
require.define({"gamejs/image":function(q,b){var a=q("../gamejs"),l={};b.load=function(b){var t;if(typeof b==="string"){if(t=l[b],!t)throw Error('Missing "'+b+'", gamejs.preload() all images before trying to load them.');}else t=b;b=document.createElement("canvas");b.width=t.naturalWidth||t.width;b.height=t.naturalHeight||t.height;b.getContext("2d").drawImage(t,0,0);t.getSize=function(){return[t.naturalWidth,t.naturalHeight]};var c=new a.Surface(t.getSize());c._canvas=b;return c};b.init=function(){};
b.preload=function(b){function t(){d++;d%10===0&&a.log("gamejs.image: preloaded  "+d+" of "+h)}function c(){l[this.gamejsKey]=this;t()}function e(){t();throw Error("Error loading "+this.src);}var d=0,h=0,n;for(n in b)if(!(n.indexOf("png")==-1&&n.indexOf("jpg")==-1&&n.indexOf("gif")==-1)){var k=new Image;k.addEventListener("load",c,!0);k.addEventListener("error",e,!0);k.src=b[n];k.gamejsKey=n;h++}return function(){return h>0?d/h:1}}}},["gamejs"]);
require.define({"gamejs/mask":function(q,b){var a=q("../gamejs"),l=q("./utils/objects");b.fromSurface=function(a,c){for(var c=c&&255-c||255,b=a.getImageData(),d=a.getSize(),h=new o(d),n=0;n<b.length;n+=4){var k=parseInt(n/4/d[0],10),l=parseInt(n/4%d[0],10);b[n+3]>=c&&h.setAt(l,k)}return h};var o=b.Mask=function(a){this.width=a[0];this.height=a[1];this._bits=[];for(a=0;a<this.width;a++){this._bits[a]=[];for(var c=0;c<this.height;c++)this._bits[a][c]=!1}};o.prototype.overlapRect=function(b,c){var e=
this.rect,d=b.rect;c&&d.moveIp(c);if(!d.collideRect(e))return null;var h=Math.max(e.left,d.left),n=Math.max(e.top,d.top);return new a.Rect([h,n],[Math.min(e.right,d.right)-h,Math.min(e.bottom,d.bottom)-n])};o.prototype.overlap=function(a,c){var b=this.overlapRect(a,c);if(b===null)return!1;var d=this.rect,h=a.rect;c&&h.moveIp(c);for(var n=b.top;n<=b.bottom;n++)for(var k=b.left;k<=b.right;k++)if(this.getAt(k-d.left,n-d.top)&&a.getAt(k-h.left,n-h.top))return!0;return!1};o.prototype.overlapArea=function(a,
c){var b=this.overlapRect(a,c);if(b===null)return 0;var d=this.rect,h=a.rect;c&&h.moveIp(c);for(var n=0,k=b.top;k<=b.bottom;k++)for(var l=b.left;l<=b.right;l++)this.getAt(l-d.left,k-d.top)&&a.getAt(l-h.left,k-h.top)&&n++;return n};o.prototype.overlapMask=function(a,c){var b=this.overlapRect(a,c);if(b===null)return 0;var d=this.rect,h=a.rect;c&&h.moveIp(c);for(var n=new o([b.width,b.height]),k=b.top;k<=b.bottom;k++)for(var l=b.left;l<=b.right;l++)this.getAt(l-d.left,k-d.top)&&a.getAt(l-h.left,k-h.top)&&
n.setAt(l,k);return n};o.prototype.setAt=function(a,c){this._bits[a][c]=!0};o.prototype.getAt=function(a,c){a=parseInt(a,10);c=parseInt(c,10);if(a<0||c<0||a>=this.width||c>=this.height)return!1;return this._bits[a][c]};o.prototype.invert=function(){this._bits=this._bits.map(function(a){return a.map(function(a){return!a})})};o.prototype.getSize=function(){return[this.width,this.height]};l.accessors(o.prototype,{rect:{get:function(){return new a.Rect([0,0],[this.width,this.height])}},length:{get:function(){var a=
0;this._bits.forEach(function(c){c.forEach(function(c){c&&a++})});return a}}})}},["gamejs","gamejs/utils/objects"]);
require.define({"gamejs/mixer":function(q,b){function a(a){a instanceof Array||(a=[a]);a.forEach(function(a){l[a.gamejsKey]=a})}q("../gamejs");var l={},o=!1;b.init=function(){var b=Array.prototype.slice.call(document.getElementsByTagName("audio"),0);a(b)};b.preload=function(b){function c(){a(this);h++;h==d&&(o=!1)}function e(){h++;h==d&&(o=!1);throw Error("Error loading "+this.src);}var d=0,h=0,n;for(n in b)if(!(n.indexOf("wav")==-1&&n.indexOf("ogg")==-1&&n.indexOf("webm")==-1)){d++;var k=new Audio;
k.addEventListener("canplay",c,!0);k.addEventListener("error",e,!0);k.src=b[n];k.gamejsKey=n;k.load()}d>0&&(o=!0);return function(){return d>0?h/d:1}};b.isPreloading=function(){return o};b.Sound=function(a){var c;c=typeof a==="string"?l[a]:a;if(!c)throw Error('Missing "'+a+'", gamejs.preload() all audio files before loading');var b=this.audio=new Audio;b.preload="auto";b.loop=!1;b.src=c.src;this.play=function(){(b.ended||b.paused)&&b.play()};this.stop=function(){b.pause()};this.setVolume=function(a){b.volume=
a};this.getVolume=function(){return b.volume};this.getLength=function(){return b.duration};return this}}},["gamejs"]);
require.define({"gamejs/http":function(q,b){function a(a){return eval("("+a.responseText+")")}b.Response=function(){this.getResponseHeader=function(){};throw Error("response class not instantiable");};var l=b.ajax=function(a,b,d,h){var d=d||null,n=new XMLHttpRequest;n.open(a,b,!1);h&&n.setRequestHeader("Accept",h);d instanceof Object&&(d=JSON.stringify(d),n.setRequestHeader("Content-Type","application/json"));n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.send(d);return n},o=b.get=function(a){return l("GET",
a)},t=b.post=function(a,b,d){return l("POST",a,b,d)};b.load=function(c){return a(o((window.$g&&$g.ajaxBaseHref||"./")+c))};b.save=function(c,b,d){return a(t((window.$g&&$g.ajaxBaseHref||"./")+c,{payload:b},d))}}},[]);
require.define({settings:function(q,b){var a=b.settings={SCREEN_WIDTH:800,SCREEN_HEIGHT:600,FPS:60,PHYS_SCALE:10,SERVER:"ws://www.banditracer.eu:8001",STARTING_BALANCE:3E3,MAX_INDIVIDUAL_SOUND_CHANNELS:4,MAX_GLOBAL_SOUND_CHANNELS:8,STARTING_LEAGUE:0,DEBUG:!1,SOUND:!0};b.get=function(b){return a[b]};b.init=function(){for(var b in a)window.hasOwnProperty(b)&&(a[b]=window[b])};b.set=function(b,o){a[b]=o}}},[]);
require.define({bots:function(q,b){b.names=["Bob","The Dominator","Desert Penguin","Smiley"];var a=q("./car_descriptions");b.generateBotCarDescr=function(){var b=[],o;for(o in a)b.push(o);o=["Machinegun","MissileLauncher"];return{type:b[Math.floor(Math.random()*b.length)],front_weapon:{type:o[Math.floor(Math.random()*o.length)],ammo_upgrades:0,damage_upgrades:0},util:null,rear_weapon:null,acc_upgrades:0,speed_upgrades:0,armor_upgrades:0}};b.CatLady={type:"Sandbug",name:"Cat Lady",front_weapon:{type:"Machinegun",
ammo_upgrades:0,damage_upgrades:0},util:null,rear_weapon:{type:"MineLauncher",ammo_upgrades:0,damage_upgrades:0},acc_upgrades:0,speed_upgrades:0,armor_upgrades:0};b.Bob={type:"Hillbilly",name:"Bob",front_weapon:{type:"MissileLauncher",ammo_upgrades:1,damage_upgrades:1},util:null,rear_weapon:null,acc_upgrades:2,speed_upgrades:0,armor_upgrades:0};b.Dominator={type:"Sandbug",name:"The Dominator",front_weapon:{type:"Machinegun",ammo_upgrades:3,damage_upgrades:0},util:null,rear_weapon:null,acc_upgrades:0,
speed_upgrades:0,armor_upgrades:2};b.HotShot={type:"Racer",name:"HotShot",front_weapon:{type:"Machinegun",ammo_upgrades:5,damage_upgrades:3},util:{type:"Shockwave",ammo_upgrades:4,damage_upgrades:0},rear_weapon:null,acc_upgrades:0,speed_upgrades:0,armor_upgrades:0};b.TheDude={type:"Hillbilly",name:"The Dude",front_weapon:{type:"HomingMissiles",ammo_upgrades:1,damage_upgrades:1},util:null,rear_weapon:{type:"Oil",ammo_upgrades:1,damage_upgrades:1},acc_upgrades:2,speed_upgrades:2,armor_upgrades:0};b.Ratman=
{type:"Bandit",name:"Ratman",front_weapon:{type:"PlasmaCannon",ammo_upgrades:2,damage_upgrades:0},util:{type:"RepairKit",ammo_upgrades:2,damage_upgrades:0},rear_weapon:null,acc_upgrades:0,speed_upgrades:2,armor_upgrades:2}}},["car_descriptions"]);
require.define({editor:function(q,b){function a(a){return[Math.floor(a[0]/6)*6,Math.floor(a[1]/6)*6]}function l(a){var m=[];a.start_positions.length<6&&m.push("All six starting positions must be placed.");a.ai_waypoints.length<2&&m.push("At least two AI waypoints must be placed.");a.checkpoints.length<2&&m.push("At least two checkpoints must be placed.");a.title||m.push("Level must have a title.");console.log(m);return m}function o(a){function m(a){N[a]==void 0&&(N[a]=c,b.dict[c]=a,c++);return N[a]}
var b=G([2500,2500]);b.size=a.size;b.bgtile=a.bgtile;b.title=a.title;b.laps=a.laps;b.dict={};var N={},c=1;a.props.forEach(function(a){b.props.push({p:a.position,f:m(a.original.filename),a:a.angle})});a.decals.forEach(function(a){b.decals.push({p:a.position,f:m(a.original.filename),a:a.angle})});a.ai_waypoints.forEach(function(a){b.ai_waypoints.push({p:a.position,n:a.number})});a.checkpoints.forEach(function(a){b.checkpoints.push({p:a.position,n:a.number})});a.start_positions.forEach(function(a){b.start_positions.push({p:a.position,
n:a.number,a:a.angle})});return b}function t(a,m){for(var b=0;b<m.length;b++)if(m[b].instance_id==a.instance_id){m.splice(b,1);break}}function c(a){a.text="On";a.size=[100,40];c.superConstructor.apply(this,[a]);this.layer=a.layer;this.scene=a.scene;this.is_on=!0;this.onClick(this.onclick,this)}function e(a){a.size=[220,300];e.superConstructor.apply(this,[a]);this.scene=a.scene;this.playbtn=new h.Button({parent:this,text:"Play",size:[180,40],lean:"both",position:[20,20]});this.playbtn.onClick(function(){this.close();
var a=l(this.scene.level);a.length?this.scene.alert(a[0]):n.game.playLevel(o(this.scene.level),!1,!1,"editor")},this);this.testaibtn=new h.Button({parent:this,text:"Test AI",size:[180,40],lean:"both",position:[20,70]});this.testaibtn.onClick(function(){this.close();var a=l(this.scene.level);a.length?this.scene.alert(a[0]):n.game.playLevel(o(this.scene.level),!0,!1,"editor")},this);this.cancelbtn=new h.Button({parent:this,text:"Cancel",size:[180,40],lean:"both",position:[20,120]});this.cancelbtn.onClick(function(){this.close()},
this)}var d=q("./gamejs-gui"),h=q("./ui"),n=q("./combatracer");q("./settings");var k=q("gamejs"),M=q("./renderer"),g=q("./resources"),y=q("./skin"),R=[280,280],L=1,C=["decalinstance","propinstance","checkpointinstance","startpositioninstance","aiwaypointinstance"],G=function(a){return{size:a,title:"New track",bgtile:"sand.png",props:[],decals:[],laps:3,ai_waypoints:[],checkpoints:[],start_positions:[]}};ToolViewSelectItem=b.ToolViewSelectItem=function(a){a.size=[200,22];this.what=a.what;ToolViewSelectItem.superConstructor.apply(this,
[a]);this.label=new d.Label({position:[0,0],parent:this,font:h.getFont(y.track_selector.item_font),text:a.text});this.center(this.label);this.label.move([this.size[0]-this.label.size[0]-16,this.label.position[1]]);this.selected=!1;this.on(d.EVT_MOUSE_DOWN,this.select,this)};k.utils.objects.extend(ToolViewSelectItem,d.View);ToolViewSelectItem.prototype.select=function(){this.selected=!0;this.refresh();this.despatchEvent({type:"select",what:this.what})};ToolViewSelectItem.prototype.deselect=function(){this.selected=
!1;this.refresh()};ToolViewSelectItem.prototype.paint=function(){this.surface.fill(this.selected?y.track_selector.front_color:this.isHovered()?y.track_selector.item_hover_color:y.track_selector.back_color)};var v=b.ToolView=function(a){v.superConstructor.apply(this,[a]);this.scene=a.scene;this.scw=new d.ScrollableView({parent:this,size:[this.size[0],this.size[1]-20],position:[0,0]});this.scw.setHorizontalScrollbar(new d.HorizontalScrollbar({parent:this,size:[this.size[0],20],position:[0,this.size[1]-
20]}))};k.utils.objects.extend(v,d.View);var F=b.DecalView=function(a){F.superConstructor.apply(this,[a]);this.filename_to_decal={};g.decals.forEach(function(a){var f=new w({filename:a,size:[100,100],position:[0,3],scene:this.scene,parent:this.scw});this.scene.tools.push(f);this.filename_to_decal[a]=f;f.on("select",this.scene.selectTool,this.scene)},this);d.layout.horizontal(this.scw.children,2,2);this.scw.autoSetScrollableArea()};k.utils.objects.extend(F,v);var S=b.MarkerView=function(a){this.scene=
a.scene;S.superConstructor.apply(this,[a]);new d.Label({parent:this,font:h.getFont("16_33"),text:"AI Waypoints",position:[20,2]});this.ai_waypoint=new A({parent:this,position:[40,45],size:[40,40],scene:this.scene});this.scene.tools.push(this.ai_waypoint);this.ai_waypoint.on("select",this.scene.selectTool,this.scene);this.ai_waypoint_up=new h.IncrementButton({direction:"up",position:[100,30],size:[40,30],parent:this});this.ai_waypoint_up.onClick(function(){this.setNumber(this.number+1)},this.ai_waypoint);
this.ai_waypoint_down=new h.IncrementButton({direction:"down",position:[100,70],size:[40,30],parent:this});this.ai_waypoint_down.onClick(function(){this.setNumber(this.number-1)},this.ai_waypoint);new d.Label({parent:this,font:h.getFont("16_33"),text:"Checkpoints",position:[150,2]});this.checkpoint=new r({parent:this,position:[170,45],size:[170,40],scene:this.scene});this.scene.tools.push(this.checkpoint);this.checkpoint.on("select",this.scene.selectTool,this.scene);this.checkpoint_up=new h.IncrementButton({direction:"up",
position:[230,30],size:[40,30],parent:this});this.checkpoint_up.onClick(function(){this.setNumber(this.number+1)},this.checkpoint);this.checkpoint_down=new h.IncrementButton({direction:"down",position:[230,70],size:[40,30],parent:this});this.checkpoint_down.onClick(function(){this.setNumber(this.number-1)},this.checkpoint);new d.Label({parent:this,font:h.getFont("16_33"),text:"Start Positions",position:[280,2]});this.start_position=new p({parent:this,position:[300,35],size:[60,60],scene:this.scene});
this.scene.tools.push(this.start_position);this.start_position.on("select",this.scene.selectTool,this.scene);this.start_position_up=new h.IncrementButton({direction:"up",position:[370,30],size:[40,30],parent:this});this.start_position_up.onClick(function(){this.setNumber(this.number+1)},this.start_position);this.start_position_down=new h.IncrementButton({direction:"down",position:[370,70],size:[40,30],parent:this});this.start_position_down.onClick(function(){this.setNumber(this.number-1)},this.start_position)};
k.utils.objects.extend(S,d.View);var j=b.PropertiesView=function(a){j.superConstructor.apply(this,[a]);this.scene=a.scene;new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"Title",position:[100,2]});this.title=new d.TextInput({parent:this.scw,font:h.getFont("16_33"),text:this.scene.level.title,position:[40,50],size:[180,30]});this.title.on(d.EVT_CHANGE,this.titleChange,this);new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"Width, PX",position:[260,2]});this.widthlbl=new d.Label({parent:this.scw,
font:h.getFont("16_33"),text:String(this.scene.level.size[0]),position:[260,50]});this.width_up_btn=new h.IncrementButton({parent:this.scw,position:[350,20],size:[40,40],direction:"up"});this.width_up_btn.onClick(function(){this.scene.level.size[0]=Math.max(1E3,this.scene.level.size[0]+100);this.scene.resizeLevelView()},this);this.width_down_btn=new h.IncrementButton({parent:this.scw,position:[350,70],size:[40,40],direction:"down"});this.width_down_btn.onClick(function(){this.scene.level.size[0]=
Math.max(1E3,this.scene.level.size[0]-100);this.scene.resizeLevelView()},this);new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"Height, PX",position:[420,2]});this.heightlbl=new d.Label({parent:this.scw,font:h.getFont("16_33"),text:String(this.scene.level.size[1]),position:[420,50]});this.height_up_btn=new h.IncrementButton({parent:this.scw,position:[520,20],size:[40,40],direction:"up"});this.height_up_btn.onClick(function(){this.scene.level.size[1]=Math.max(1E3,this.scene.level.size[1]+
100);this.scene.resizeLevelView()},this);this.height_down_btn=new h.IncrementButton({parent:this.scw,position:[520,70],size:[40,40],direction:"down"});this.height_down_btn.onClick(function(){this.scene.level.size[1]=Math.max(1E3,this.scene.level.size[1]-100);this.scene.resizeLevelView()},this);new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"Laps",position:[590,2]});this.lapslbl=new d.Label({parent:this.scw,font:h.getFont("16_33"),text:String(this.scene.level.laps),position:[600,50]});this.laps_up_btn=
new h.IncrementButton({parent:this.scw,position:[700,20],size:[40,40],direction:"up"});this.laps_up_btn.onClick(function(){this.scene.level.laps=Math.max(1,this.scene.level.laps+1);this.lapslbl.setText(String(this.scene.level.laps))},this);this.laps_down_btn=new h.IncrementButton({parent:this.scw,position:[700,70],size:[40,40],direction:"down"});this.laps_down_btn.onClick(function(){this.scene.level.laps=Math.max(1,this.scene.level.laps-1);this.lapslbl.setText(String(this.scene.level.laps))},this);
this.scw.autoSetScrollableArea()};k.utils.objects.extend(j,v);j.prototype.titleChange=function(a){this.scene.level.title=a.value};var z=b.PropView=function(a){z.superConstructor.apply(this,[a]);this.filename_to_prop={};g.props.forEach(function(a){var f=new O({filename:a,size:[100,100],position:[0,3],scene:this.scene,parent:this.scw});this.scene.tools.push(f);this.filename_to_prop[a]=f;f.on("select",this.scene.selectTool,this.scene)},this);d.layout.horizontal(this.scw.children,2,2);this.scw.autoSetScrollableArea()};
k.utils.objects.extend(z,v);var B=b.LayerView=function(a){B.superConstructor.apply(this,[a]);new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"Decals",position:[10,2]});new c({parent:this.scw,layer:"decals",scene:this.scene,position:[10,50]});new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"Props",position:[160,2]});new c({parent:this.scw,layer:"props",scene:this.scene,position:[160,50]});new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"AI Waypoints",position:[320,2]});
new c({parent:this.scw,layer:"ai_waypoints",scene:this.scene,position:[320,50]});new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"Checkpoints",position:[470,2]});new c({parent:this.scw,layer:"checkpoints",scene:this.scene,position:[470,50]});new d.Label({parent:this.scw,font:h.getFont("16_33"),text:"Start pos.",position:[620,2]});new c({parent:this.scw,layer:"start_positions",scene:this.scene,position:[620,50]});this.scw.autoSetScrollableArea()};k.utils.objects.extend(B,v);var Q=b.BgView=
function(a){Q.superConstructor.apply(this,[a]);g.tiles.forEach(function(a){new U({filename:a,size:[100,100],position:[0,3],scene:this.scene,parent:this.scw})},this);d.layout.horizontal(this.scw.children,2,2);this.scw.autoSetScrollableArea()};k.utils.objects.extend(Q,v);var u=b.Instance=function(a){u.superConstructor.apply(this,[a]);this.instance_id=L++;this.angle=a.angle;this.original=a.original;this.subtype="instance";this.selected=!1;this.scene=a.scene;this.on(d.EVT_MOUSE_DOWN,this.select,this);
this.on("select",this.scene.selectInstance,this.scene)};k.utils.objects.extend(u,d.View);u.prototype.select=function(){if(!this.selected&&!(this.scene.selected&&this.scene.selected.subtype=="tool"))this.selected=!0,this.despatchEvent({type:"select",instance:this}),this.refresh()};u.prototype.move=function(a){this.selected&&d.View.prototype.move.apply(this,[a])};u.prototype.deselect=function(){this.selected=!1;this.refresh()};u.prototype.paint=function(){this.surface.clear();var a=this.original.getCursorImage(this.angle);
this.surface.blit(a,[(this.size[0]-a.getSize()[0])/2,(this.size[1]-a.getSize()[1])/2]);this.selected&&k.draw.rect(this.surface,"#0026FF",new k.Rect([0,0],this.surface.getSize()),6)};var K=function(a){K.superConstructor.apply(this,[a]);d.draggable(this);this.type="checkpointinstance";this.number=a.number;this.on("select",function(){this.scene.marker_view.checkpoint.setNumber(this.number)},this)};k.utils.objects.extend(K,u);K.prototype.destroy=function(a){a===void 0&&(a=!0);u.prototype.destroy.apply(this,
[]);a&&(t(this,this.scene.level.checkpoints),this.scene.level.checkpoints.forEach(function(a){a.number>this.number&&(a.number--,a.refresh())},this))};K.prototype.paint=function(){this.surface.clear();this.surface.blit(this.original.genHugeImage(this.number),[0,0]);this.selected&&k.draw.rect(this.surface,"#0026FF",new k.Rect([0,0],this.surface.getSize()),6)};var D=function(a){D.superConstructor.apply(this,[a]);this.type="startpositioninstance";this.number=a.number;this.on("select",function(){this.scene.marker_view.start_position.setNumber(this.number)},
this)};k.utils.objects.extend(D,u);D.prototype.move=function(f){u.prototype.move.apply(this,[a(f)])};D.prototype.destroy=function(a){a===void 0&&(a=!0);u.prototype.destroy.apply(this,[]);a&&(t(this,this.scene.level.start_positions),this.scene.level.start_positions.forEach(function(a){a.number>this.number&&(a.number--,a.refresh())},this))};D.prototype.paint=function(){this.surface.clear();this.surface.blit(this.original.genImage(this.number,this.angle),[0,0]);this.selected&&k.draw.rect(this.surface,
"#0026FF",new k.Rect([0,0],this.surface.getSize()),6)};var T=function(a){T.superConstructor.apply(this,[a]);d.draggable(this);this.type="aiwaypointinstance";this.number=a.number;this.on("select",function(){this.scene.marker_view.ai_waypoint.setNumber(this.number)},this)};k.utils.objects.extend(T,u);T.prototype.destroy=function(a){a===void 0&&(a=!0);u.prototype.destroy.apply(this,[]);a&&(t(this,this.scene.level.ai_waypoints),this.scene.level.ai_waypoints.forEach(function(m){m.number==this.number&&
(a=!1)},this),a&&this.scene.level.ai_waypoints.forEach(function(a){a.number>this.number&&(a.number--,a.refresh())},this))};T.prototype.paint=function(){this.surface.clear();this.surface.blit(this.original.genImage(this.number),[0,0]);this.selected&&k.draw.rect(this.surface,"#0026FF",new k.Rect([0,0],this.surface.getSize()),6)};var I=function(a){I.superConstructor.apply(this,[a]);this.type="decalinstance"};k.utils.objects.extend(I,u);I.prototype.destroy=function(){u.prototype.destroy.apply(this,[]);
t(this,this.scene.level.decals)};I.prototype.move=function(f){u.prototype.move.apply(this,[a(f)])};var J=function(a){J.superConstructor.apply(this,[a]);d.draggable(this);this.type="propinstance"};k.utils.objects.extend(J,u);J.prototype.destroy=function(){u.prototype.destroy.apply(this,[]);t(this,this.scene.level.props)};var U=function(a){this.filename=a.filename;a.image=M.cache.getTile(a.filename);U.superConstructor.apply(this,[a]);this.scene=a.scene;this.on(d.EVT_MOUSE_DOWN,this.select,this)};k.utils.objects.extend(U,
d.Image);U.prototype.select=function(){this.scene.level.bgtile=this.filename;this.scene.level_view.refresh()};var P=b.Tool=function(a){P.superConstructor.apply(this,[a]);this.selected=!1;this.angle=0;this.rotate_angle=a.rotate_angle;this.on(d.EVT_MOUSE_DOWN,this.select,this);this.subtype="tool";this.scene=a.scene};k.utils.objects.extend(P,d.Image);P.prototype.select=function(){this.selected=!0;this.despatchEvent({type:"select",tool:this});this.refresh()};P.prototype.rotateLeft=function(){this.angle-=
this.rotate_angle;this.angle<0&&(this.angle+=360);this.refresh()};P.prototype.rotateRight=function(){this.angle+=this.rotate_angle;this.angle>=360&&(this.angle-=360);this.refresh()};P.prototype.deselect=function(){this.selected=!1;this.refresh()};P.prototype.paint=function(){d.Image.prototype.paint.apply(this,[]);this.selected&&k.draw.rect(this.surface,"#0026FF",new k.Rect([0,0],this.surface.getSize()),6)};var r=b.Checkpoint=function(a){a.image=this.genImage(1);a.rotate_angle=0;a.size=[40,40];a.rotate_angle=
0;r.superConstructor.apply(this,[a]);this.number=1;this.type="checkpoint"};k.utils.objects.extend(r,P);r.prototype.genImage=function(a){var m=new k.Surface([40,40]),b=h.getFont("editor_checkpoint");k.draw.rect(m,"RGBA(255, 86, 86, 0.2)",new k.Rect([0,0],m.getSize()));b.render(m,String(a),[12,12]);k.draw.rect(m,"#FF5656",new k.Rect([0,0],m.getSize()),3);return m};r.prototype.genHugeImage=function(a){var m=new k.Surface([280,280]),b=h.getFont("editor_checkpoint");k.draw.rect(m,"RGBA(255, 86, 86, 0.2)",
new k.Rect([0,0],m.getSize()));b.render(m,String(a),[130,130]);k.draw.rect(m,"#FF5656",new k.Rect([0,0],m.getSize()),3);return m};r.prototype.getCursorImage=function(){return this.genHugeImage(this.number)};r.prototype.setNumber=function(a){this.number=Math.max(1,a);this.setImage(this.genImage(this.number))};r.prototype.place=function(a){this.getCursorImage();for(var m,b=0;b<this.scene.level.checkpoints.length;b++)m=this.scene.level.checkpoints[b],m.number==this.number&&m.destroy(!1);this.scene.level.checkpoints.push(new K({parent:this.scene.level_view,
size:R,scene:this.scene,angle:0,original:this,number:this.number,position:[a[0]-Math.ceil(R[0]/2),a[1]-Math.ceil(R[0]/2)]}));this.setNumber(this.number+1);this.refresh()};var p=b.StartPosition=function(a){a.image=this.genImage(1);a.rotate_angle=90;p.superConstructor.apply(this,[a]);this.type="startposition";this.number=1};k.utils.objects.extend(p,P);p.prototype.genImage=function(a,m){var b=new k.Surface([60,60]),N=h.getFont("editor_start_pos"),c=b.getSize()[0],r=b.getSize()[1];k.draw.polygon(b,"#3AFF51",
[[10,10],[20,0],[c-20,0],[c-10,10],[c-10,r],[10,r]],3);if(m===void 0)m=this.angle;b=k.transform.rotate(b,m);N.render(b,String(a),[20,20]);return b};p.prototype.getCursorImage=function(){return this.genImage(this.number)};p.prototype.setNumber=function(a){this.number=Math.min(Math.max(1,a),6);this.setImage(this.genImage(this.number))};p.prototype.place=function(f){this.getCursorImage();for(var m=this.size,b,N=0;N<this.scene.level.start_positions.length;N++)b=this.scene.level.start_positions[N],b.number==
this.number&&b.destroy(!1);this.scene.level.start_positions.push(new D({parent:this.scene.level_view,size:m,scene:this.scene,angle:this.angle,original:this,number:this.number,position:a([f[0]-Math.ceil(m[0]/2),f[1]-Math.ceil(m[0]/2)])}));this.setNumber(this.number+1);this.refresh()};var A=b.AIWaypoint=function(a){a.image=this.genImage(1);a.rotate_angle=0;A.superConstructor.apply(this,[a]);d.draggable(this);this.type="aiwaypoint";this.number=1};k.utils.objects.extend(A,P);A.prototype.genImage=function(a){var m=
new k.Surface([40,40]);h.getFont("editor_ai_wp").render(m,String(a),[12,12]);k.draw.rect(m,"#0094FF",new k.Rect([0,0],m.getSize()),3);return m};A.prototype.getCursorImage=function(){return this.genImage(this.number)};A.prototype.setNumber=function(a){this.number=Math.max(1,a);this.setImage(this.genImage(this.number))};A.prototype.place=function(a){for(var m=this.getCursorImage().getSize(),b,N=0;N<this.scene.level.ai_waypoints.length;N++)b=this.scene.level.ai_waypoints[N],b.number>=this.number&&b.number++;
this.scene.level.ai_waypoints.push(new T({parent:this.scene.level_view,size:m,scene:this.scene,angle:0,original:this,number:this.number,position:[a[0]-Math.ceil(m[0]/2),a[1]-Math.ceil(m[0]/2)]}));this.setNumber(this.number+1);this.refresh()};var w=b.Decal=function(a){a.image=M.cache.getDecalSprite(a.filename,0);a.rotate_angle=90;w.superConstructor.apply(this,[a]);this.type="decal";this.filename=a.filename};k.utils.objects.extend(w,P);w.prototype.getCursorImage=function(a){if(a==void 0)a=this.angle;
return M.cache.getDecalSprite(this.filename,a)};w.prototype.place=function(f){var m=this.getCursorImage().getSize();this.scene.level.decals.push(new I({parent:this.scene.level_view,size:m,scene:this.scene,angle:this.angle,original:this,position:a([f[0]-Math.ceil(m[0]/2),f[1]-Math.ceil(m[0]/2)])}))};var O=b.Prop=function(a){a.image=M.cache.getPropSprite(a.filename,0);a.rotate_angle=5;O.superConstructor.apply(this,[a]);this.type="prop";this.filename=a.filename;this.scene=a.scene};k.utils.objects.extend(O,
P);O.prototype.getCursorImage=function(a){if(a==void 0)a=this.angle;return M.cache.getPropSprite(this.filename,a)};O.prototype.place=function(a){var m=this.getCursorImage(this.angle).getSize();this.scene.level.props.push(new J({parent:this.scene.level_view,size:m,scene:this.scene,angle:this.angle,original:this,position:[a[0]-Math.ceil(m[0]/2),a[1]-Math.ceil(m[0]/2)]}))};var V=b.LevelView=function(a){this.scene=a.scene;V.superConstructor.apply(this,[a]);this.mpos=[0,0];this.on(d.EVT_MOUSE_MOTION,function(a){this.mpos=
a.pos;this.refresh()},this)};k.utils.objects.extend(V,d.View);V.prototype.paint=function(){for(var a=M.cache.getTile(this.scene.level.bgtile),m=a.getSize(),b=0;b<this.size[0];b+=m[0])for(var N=0;N<this.size[1];N+=m[1])this.surface.blit(a,[b,N])};V.prototype.post_paint=function(){if(this.isHovered()&&this.scene.selected&&this.scene.selected.subtype=="tool"&&this.scene.selected.getCursorImage){var f=this.scene.selected.getCursorImage(),m=f.getSize(),m=[parseInt(this.mpos[0]-m[0]/2),parseInt(this.mpos[1]-
m[1]/2)];if(this.scene.selected.type=="decal"||this.scene.selected.type=="startposition")m=a(m);this.surface.blit(f,m)}};V.prototype.draw=function(){var a=!1;this.children.forEach(function(m){if(m.draw()||this._refresh)a=!0},this);if(this._refresh||a){this.paint();for(var m,b=0;b<C.length;b++)m=C[b],this.children.forEach(function(a){a.type==m&&a.visible&&this.blitChild(a)},this);this.scene.minimap.image.blit(this.surface,new k.Rect([0,0],this.scene.minimap.image.getSize()),new k.Rect([0,0],this.surface.getSize()));
this.scene.minimap.refresh();this.post_paint();this.despatchEvent({type:d.EVT_PAINT,surface:this.surface});a=!0;this._refresh=!1}return a};var H=b.EditorScene=function(){document.getElementById("gjs-canvas").oncontextmenu=new Function("return false");this.gui=new d.GUI(n.game.display);this.gui.on(d.EVT_PAINT,function(){this.surface.clear()},this.gui);this.alertdialog=new h.Dialog({parent:this.gui,size:[600,150]});this.tools=[];this.minimap=new d.Image({position:[0,0],size:[200,200],parent:this.gui,
image:new k.Surface([200,200])});this.saveloadbtn=new h.Button({position:[0,210],size:[190,50],parent:this.gui,text:"Save / Load",lean:"left"});this.saveloadbtn.onClick(function(){this.textarea.value=JSON.stringify(o(this.level));$(this.dialogel).dialog("open")},this);this.playdialog=new e({parent:this.gui,scene:this});this.playbtn=new h.Button({position:[0,270],size:[190,50],parent:this.gui,text:"Play",lean:"left"});this.playbtn.onClick(function(){this.show()},this.playdialog);this.helpbtn=new h.Button({position:[0,
330],size:[190,50],parent:this.gui,text:"Help",lean:"left"});this.helpbtn.onClick(function(){window.open("http://www.banditracer.eu/index.php?page=track-editor-help")},this);this.backbtn=new h.Button({position:[0,390],size:[190,50],parent:this.gui,text:"Back",lean:"left"});this.backbtn.onClick(function(){n.game.showTitle()},this);this.dialog=new h.Dialog({parent:this.gui,size:[450,150]});this.scw=new d.ScrollableView({parent:this.gui,position:[200,0],size:[this.gui.size[0]-200-20,this.gui.size[1]-
150-20]});this.hscrollbar=new d.HorizontalScrollbar({parent:this.gui,position:[200,this.gui.size[1]-150-20],size:[this.gui.size[0]-200-20,20]});this.scw.setHorizontalScrollbar(this.hscrollbar);this.vscrollbar=new d.VerticalScrollbar({parent:this.gui,position:[this.gui.size[0]-20,0],size:[20,this.gui.size[1]-150-20]});this.scw.setVerticalScrollbar(this.vscrollbar);this.level=G([2500,2500]);this.level_view=new V({parent:this.scw,size:[20,20],scene:this,position:[0,0]});this.decal_view=new F({parent:this.gui,
scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.prop_view=new z({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.prop_view.hide();this.marker_view=new S({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.marker_view.hide();this.bg_view=new Q({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.bg_view.hide();
this.layer_view=new B({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.layer_view.hide();this.properties_view=new j({parent:this.gui,scene:this,position:[200,this.gui.size[1]-150],size:[this.gui.size[0]-200,150]});this.properties_view.hide();this.select_decal_view=new ToolViewSelectItem({parent:this.gui,what:"decalView",position:[0,this.gui.size[1]-150],text:"Decals"});this.select_decal_view.on("select",this.selectView,this);this.select_decal_view.selected=
!0;this.select_prop_view=new ToolViewSelectItem({parent:this.gui,what:"propView",position:[0,this.gui.size[1]-150+22],text:"Props"});this.select_prop_view.on("select",this.selectView,this);this.select_marker_view=new ToolViewSelectItem({parent:this.gui,what:"markerView",position:[0,this.gui.size[1]-150+44],text:"Markers"});this.select_marker_view.on("select",this.selectView,this);this.select_bg_view=new ToolViewSelectItem({parent:this.gui,what:"bgView",position:[0,this.gui.size[1]-150+66],text:"Background"});
this.select_bg_view.on("select",this.selectView,this);this.select_properties_view=new ToolViewSelectItem({parent:this.gui,what:"propertiesView",position:[0,this.gui.size[1]-150+88],text:"Properties"});this.select_properties_view.on("select",this.selectView,this);this.select_layer_view=new ToolViewSelectItem({parent:this.gui,what:"layerView",position:[0,this.gui.size[1]-150+110],text:"Layers"});this.select_layer_view.on("select",this.selectView,this);this.gui.on(d.EVT_MOUSE_WHEEL,this.mouseWheel,this);
this.level_view.on(d.EVT_MOUSE_DOWN,this.viewMouseDown,this);this.gui.on(d.EVT_MOUSE_DOWN,this.mouseDown,this);this.level_view.on(d.EVT_KEY_DOWN,this.keyDown,this);this.dialogel=document.getElementById("saveload_dialog");if(!this.dialogel){this.dialogel=document.createElement("div");this.dialogel.id="saveload_dialog";var a=document.createElement("p");a.innerHTML='To save, copy level code below and save it as a text file on your computer or however is convenient. To load, paste level code into textarea below and click "load".';
this.dialogel.appendChild(a);this.textarea=document.createElement("textarea");this.textarea.style.width="400px";this.textarea.style.height="300px";this.dialogel.appendChild(this.textarea);document.body.appendChild(this.dialogel);$(this.dialogel).click(function(a){a.stopPropagation()})}$(this.dialogel).dialog({autoOpen:!1,title:"Save / Load",width:460,buttons:[{text:"New",click:function(){n.game.editor_scene.loadLevel(G([2500,2500]));$(this).dialog("close")}},{text:"Load example",click:function(){n.game.editor_scene.loadExample();
$(this).dialog("close")}},{text:"Load",click:function(){n.game.editor_scene.load();$(this).dialog("close")}},{text:"Close",click:function(){$(this).dialog("close")}}]});$(this.dialogel).scene=this;this.loadLevel(this.level)};H.prototype.selectView=function(a){a.what=="decalView"?this.decal_view.show():(this.decal_view.hide(),this.select_decal_view.deselect());a.what=="propView"?this.prop_view.show():(this.prop_view.hide(),this.select_prop_view.deselect());a.what=="markerView"?this.marker_view.show():
(this.marker_view.hide(),this.select_marker_view.deselect());a.what=="bgView"?this.bg_view.show():(this.bg_view.hide(),this.select_bg_view.deselect());a.what=="propertiesView"?this.properties_view.show():(this.properties_view.hide(),this.select_properties_view.deselect());a.what=="layerView"?this.layer_view.show():(this.layer_view.hide(),this.select_layer_view.deselect())};H.prototype.mouseDown=function(a){if(a.button==2)this.deselectEverything(),this.selected=null};H.prototype.destroyInstance=function(a){a.destroy();
this.deselectEverything(this.instance);if(this.selected.subtype=="instance"&&this.selected.instance_id==a.instance_id)this.selected=null};H.prototype.keyDown=function(a){this.selected&&this.selected.subtype=="instance"&&a.key==46&&this.destroyInstance(this.selected)};H.prototype.viewMouseDown=function(a){a.button==0&&this.selected&&this.selected.place&&this.selected.place(a.pos)};H.prototype.selectTool=function(a){this.deselectEverything(this.selected=a.tool)};H.prototype.deselectEverything=function(a){this.tools.forEach(function(m){(!a||
!(m.type==a.type&&m.filename==a.filename))&&m.deselect()},this);this.level_view.children.forEach(function(m){(!a||m.instance_id!=a.instance_id)&&m.deselect()},this)};H.prototype.selectInstance=function(a){this.deselectEverything(this.selected=a.instance)};H.prototype.mouseWheel=function(a){if(this.selected)if(a.delta<0){if(this.selected.rotateRight)for(var m=0;m<Math.abs(a.delta);m++)this.selected.rotateRight()}else if(a.delta>0&&this.selected.rotateLeft)for(m=0;m<Math.abs(a.delta);m++)this.selected.rotateLeft()};
H.prototype.loadExample=function(){try{this.loadLevel(JSON.parse('{"size":[2100,1100],"title":"Example Raceway","bgtile":"sand.png","props":[{"p":[413,159],"f":1,"a":270},{"p":[687,158],"f":1,"a":270},{"p":[960,157],"f":1,"a":270},{"p":[310,259],"f":2,"a":240},{"p":[283,350],"f":2,"a":180},{"p":[282,442],"f":2,"a":180},{"p":[283,515],"f":2,"a":150},{"p":[360,579],"f":2,"a":105},{"p":[469,596],"f":2,"a":90},{"p":[561,596],"f":2,"a":90},{"p":[654,596],"f":2,"a":90},{"p":[706,561],"f":2,"a":15},{"p":[725,475],"f":2,"a":15},{"p":[768,388],"f":2,"a":225},{"p":[857,355],"f":2,"a":75},{"p":[957,261],"f":1,"a":270},{"p":[1232,352],"f":2,"a":90},{"p":[1321,351],"f":2,"a":90},{"p":[1310,276],"f":2,"a":330},{"p":[1238,278],"f":3,"a":0},{"p":[1272,278],"f":3,"a":0},{"p":[1307,282],"f":3,"a":0},{"p":[1608,587],"f":2,"a":270},{"p":[1704,586],"f":2,"a":270},{"p":[1577,628],"f":2,"a":150},{"p":[1669,686],"f":2,"a":90},{"p":[1729,626],"f":2,"a":45},{"p":[1802,618],"f":3,"a":0},{"p":[1103,-73],"f":1,"a":270},{"p":[832,-74],"f":1,"a":270},{"p":[562,-73],"f":1,"a":270},{"p":[1367,19],"f":2,"a":285},{"p":[1449,49],"f":2,"a":300},{"p":[1516,115],"f":2,"a":330},{"p":[1558,204],"f":2,"a":345},{"p":[1578,304],"f":2,"a":0},{"p":[1610,361],"f":2,"a":270},{"p":[1702,359],"f":2,"a":270},{"p":[1794,359],"f":2,"a":270},{"p":[1877,359],"f":2,"a":285},{"p":[1943,410],"f":2,"a":330},{"p":[1988,498],"f":2,"a":345},{"p":[2006,598],"f":2,"a":0},{"p":[1992,685],"f":2,"a":15},{"p":[1956,767],"f":2,"a":30},{"p":[1901,839],"f":2,"a":45},{"p":[1833,894],"f":2,"a":75},{"p":[1752,921],"f":2,"a":90},{"p":[1660,927],"f":2,"a":90},{"p":[1557,909],"f":2,"a":105},{"p":[1462,870],"f":2,"a":120},{"p":[1389,810],"f":2,"a":135},{"p":[1352,738],"f":2,"a":165},{"p":[1349,655],"f":2,"a":180},{"p":[1380,622],"f":3,"a":0},{"p":[1352,612],"f":3,"a":0},{"p":[1080,493],"f":1,"a":270},{"p":[988,585],"f":2,"a":90},{"p":[953,645],"f":2,"a":0},{"p":[913,717],"f":2,"a":30},{"p":[853,783],"f":2,"a":60},{"p":[781,826],"f":2,"a":90},{"p":[503,739],"f":1,"a":270},{"p":[410,828],"f":2,"a":90},{"p":[320,825],"f":2,"a":90},{"p":[219,802],"f":2,"a":105},{"p":[133,754],"f":2,"a":135},{"p":[75,689],"f":2,"a":150},{"p":[45,613],"f":2,"a":165},{"p":[-42,349],"f":1,"a":0},{"p":[48,257],"f":2,"a":180},{"p":[53,154],"f":2,"a":210},{"p":[106,74],"f":2,"a":225},{"p":[182,24],"f":2,"a":240},{"p":[289,21],"f":2,"a":270},{"p":[383,19],"f":2,"a":270},{"p":[472,18],"f":2,"a":270}],"decals":[{"p":[114,84],"f":4,"a":0},{"p":[426,36],"f":5,"a":0},{"p":[714,36],"f":5,"a":0},{"p":[1002,36],"f":5,"a":0},{"p":[1290,84],"f":4,"a":90},{"p":[1386,396],"f":6,"a":0},{"p":[1410,636],"f":4,"a":270},{"p":[1716,636],"f":4,"a":180},{"p":[1812,420],"f":7,"a":90},{"p":[1668,420],"f":8,"a":90},{"p":[1578,420],"f":8,"a":90},{"p":[1194,420],"f":9,"a":90},{"p":[1002,420],"f":9,"a":90},{"p":[786,420],"f":7,"a":0},{"p":[762,636],"f":7,"a":180},{"p":[474,612],"f":5,"a":0},{"p":[114,540],"f":4,"a":270},{"p":[114,402],"f":8,"a":180},{"p":[114,342],"f":8,"a":180},{"p":[378,660],"f":8,"a":270},{"p":[1446,372],"f":10,"a":90},{"p":[1524,372],"f":10,"a":90},{"p":[1614,450],"f":10,"a":180},{"p":[1614,540],"f":10,"a":180},{"p":[1062,90],"f":11,"a":90},{"p":[1062,168],"f":11,"a":90},{"p":[1014,102],"f":12,"a":90},{"p":[924,210],"f":12,"a":90},{"p":[822,102],"f":12,"a":90},{"p":[720,210],"f":12,"a":90},{"p":[600,102],"f":12,"a":90},{"p":[480,210],"f":12,"a":90}],"ai_waypoints":[{"p":[1362,212],"n":1},{"p":[1492,504],"n":2},{"p":[1559,750],"n":3},{"p":[928,554],"n":6},{"p":[1849,727],"n":4},{"p":[1814,544],"n":5},{"p":[1109,443],"n":6},{"p":[739,675],"n":7},{"p":[343,688],"n":8},{"p":[228,463],"n":9},{"p":[237,277],"n":10},{"p":[444,186],"n":11}],"checkpoints":[{"p":[1107,45],"n":1},{"p":[1377,648],"n":2},{"p":[1763,409],"n":3},{"p":[787,413],"n":4},{"p":[118,577],"n":5},{"p":[167,67],"n":6}],"start_positions":[{"p":[965,95],"n":1,"a":90},{"p":[872,203],"n":2,"a":90},{"p":[771,98],"n":3,"a":90},{"p":[668,206],"n":4,"a":90},{"p":[546,94],"n":5,"a":90},{"p":[426,202],"n":6,"a":90}],"dict":{"1":"9tires.png","2":"3tires.png","3":"tire.png","4":"dideliskampas.png","5":"ilgas.png","6":"kryzius.png","7":"lenktas.png","8":"trumpas.png","9":"paprastas.png","10":"arrow.png","11":"startbar.png","12":"white_bar.png"}}'))}catch(a){alert("failed! "+
a)}};H.prototype.load=function(){try{this.loadLevel(JSON.parse(this.textarea.value))}catch(a){alert("failed! "+a)}};H.prototype.resizeLevelView=function(){var a=this.level.size,m=a[0],b=a[1];this.level_view.resize(a);this.scw.autoSetScrollableArea();this.properties_view.widthlbl.setText(String(m));this.properties_view.heightlbl.setText(String(b));a=Math.max(m,b)/198;m=[parseInt(m/a),parseInt(b/a)];this.minimap.resize(m);this.minimap.image=new k.Surface(m)};H.prototype.loadLevel=function(a){this.level=
G(a.size);this.level.bgtile=a.bgtile;this.level.title=a.title;if(a.laps)this.level.laps=a.laps;this.properties_view.title.setText(a.title);this.properties_view.lapslbl.setText(String(this.level.laps));this.resizeLevelView();this.level_view.children=[];var m,b,N;a.decals.forEach(function(m){b=this.decal_view.filename_to_decal[a.dict[m.f]];N=new I({parent:this.level_view,size:b.getCursorImage().getSize(),scene:this,angle:m.a,original:b,position:m.p});this.level.decals.push(N)},this);a.props.forEach(function(b){m=
this.prop_view.filename_to_prop[a.dict[b.f]];N=new J({parent:this.level_view,size:m.getCursorImage(b.a).getSize(),scene:this,angle:b.a,original:m,position:b.p});this.level.props.push(N)},this);var c=0,r=0,g=0;a.ai_waypoints.forEach(function(a){N=new T({parent:this.level_view,size:this.marker_view.ai_waypoint.getCursorImage().getSize(),scene:this,angle:0,number:a.n,original:this.marker_view.ai_waypoint,position:a.p});this.level.ai_waypoints.push(N);c=Math.max(c,a.n)},this);this.marker_view.ai_waypoint.setNumber(c+
1);a.checkpoints.forEach(function(a){N=new K({parent:this.level_view,size:R,scene:this,angle:0,original:this.marker_view.checkpoint,number:a.n,position:a.p});this.level.checkpoints.push(N);r=Math.max(r,a.n)},this);this.marker_view.checkpoint.setNumber(r+1);a.start_positions.forEach(function(a){N=new D({parent:this.level_view,size:this.marker_view.start_position.size,scene:this,angle:a.a,original:this.marker_view.start_position,number:a.n,position:a.p});this.level.start_positions.push(N);g=Math.max(g,
a.n)},this);this.marker_view.start_position.setNumber(g+1);this.level_view.refresh()};H.prototype.alert=function(){this.dialog.show(text,button)};H.prototype.clearAlert=function(){this.dialog.close()};H.prototype.handleEvent=function(a){this.gui.despatchEvent(a)};H.prototype.alert=function(a,m){this.alertdialog.show(a,m)};H.prototype.clearAlert=function(){this.alertdialog.close()};H.prototype.update=function(a){if(this.ping&&(this.ms_to_ping-=a,this.ms_to_ping<=0))this.game.getCommunicator().queueMessage("PING"),
this.ms_to_ping=1E4;this.gui.update(a)};H.prototype.draw=function(){this.gui.draw()};k.utils.objects.extend(c,h.Button);c.prototype.onclick=function(){this.is_on?(this.scene.level[this.layer].forEach(function(a){a.hide()}),this.is_on=!1,this.setText("Off")):(this.scene.level[this.layer].forEach(function(a){a.show()}),this.is_on=!0,this.setText("On"))};k.utils.objects.extend(e,d.Dialog)}},["gamejs-gui","ui","combatracer","settings","gamejs","renderer","resources","skin"]);
require.define({car_descriptions:function(q,b){b.Bandit={width:1.7,height:3.5,id:"Bandit",name:"Bandit",description:"Small but agile",filenames:["bandit_yellow.png","bandit_green.png","bandit_blue.png","bandit_red.png"],art_filename:"bandit_big.png",power:105,max_speed:110,max_steer_angle:17,health:80,power_upgrade:6,speed_upgrade:4,armor_upgrade:20,upgrade_price:600,speed_stars:1,acceleration_stars:4,armor_stars:1,handling_stars:4,price:3E3,main_weapon:"Machinegun",wheels:[{x:-0.85,y:-1,width:0.4,
length:0.8,revolving:!0,powered:!0,filename:"wheel.png"},{x:0.85,y:-1,width:0.4,length:0.8,revolving:!0,powered:!0,filename:"wheel.png"},{x:-0.85,y:1.1,width:0.4,length:0.8,revolving:!1,powered:!1,filename:"wheel.png"},{x:0.85,y:1.1,width:0.4,length:0.8,revolving:!1,powered:!1,filename:"wheel.png"}]};b.Sandbug={id:"Sandbug",width:1.8,height:4,name:"Sandbug",description:"A basic, low budget car",filenames:["sandbug_yellow.png","sandbug_green.png","sandbug_blue.png","sandbug_red.png"],art_filename:"sandbug_big.png",
power:75,max_steer_angle:15,max_speed:100,health:100,power_upgrade:7,speed_upgrade:4,armor_upgrade:20,upgrade_price:300,speed_stars:1,acceleration_stars:1,armor_stars:2,handling_stars:2,price:1E3,wheels:[{x:-0.9,y:-1.2,width:0.4,length:0.8,revolving:!0,powered:!0,filename:"wheel.png"},{x:0.9,y:-1.2,width:0.4,length:0.8,revolving:!0,powered:!0,filename:"wheel.png"},{x:-0.9,y:1.2,width:0.4,length:0.8,revolving:!1,powered:!1,filename:"wheel.png"},{x:0.9,y:1.2,width:0.4,length:0.8,revolving:!1,powered:!1,
filename:"wheel.png"}]};b.Racer={width:2,id:"Racer",name:"Racer",description:"A well rounded racing car",height:4,filenames:["racer_yellow.png","racer_green.png","racer_blue.png","racer_red.png"],art_filename:"racer_big.png",power:90,max_steer_angle:16,max_speed:125,health:100,power_upgrade:7,speed_upgrade:4,armor_upgrade:20,upgrade_price:600,speed_stars:3,acceleration_stars:2,armor_stars:2,handling_stars:3,price:4500,main_weapon:"Machinegun",wheels:[{x:-1,y:-1.2,width:0.4,length:0.8,revolving:!0,
powered:!0,filename:"wheel.png"},{x:1,y:-1.2,width:0.4,length:0.8,revolving:!0,powered:!0,filename:"wheel.png"},{x:-1,y:1.2,width:0.4,length:0.8,revolving:!1,powered:!1,filename:"wheel.png"},{x:1,y:1.2,width:0.4,length:0.8,revolving:!1,powered:!1,filename:"wheel.png"}]};b.Hillbilly={width:2.4,height:5,id:"Hillbilly",name:"Hillbilly",description:"Sturdy, lots of space in the back",filenames:["samaritan_yellow.png","samaritan_green.png","samaritan_blue.png","samaritan_red.png"],art_filename:"samaritan_big.png",
power:120,max_steer_angle:16,max_speed:115,health:140,power_upgrade:10,speed_upgrade:4,armor_upgrade:25,upgrade_price:600,speed_stars:2,armor_stars:3,acceleration_stars:1,handling_stars:2,price:4E3,wheels:[{x:-1,y:-1.7,width:0.6,length:1.2,revolving:!0,powered:!0,filename:"big_wheel.png"},{x:1,y:-1.7,width:0.6,length:1.2,revolving:!0,powered:!0,filename:"big_wheel.png"},{x:-0.9,y:1.6,width:0.6,length:1.2,revolving:!1,powered:!1,filename:"big_wheel.png"},{x:0.9,y:1.6,width:0.6,length:1.2,revolving:!1,
powered:!1,filename:"big_wheel.png"}]};b.Brawler={width:3,height:6,id:"Brawler",name:"Brawler",description:"Heavily armored combat SUV",filenames:["brawler_yellow.png","brawler_green.png","brawler_blue.png","brawler_red.png"],art_filename:"brawler_big.png",power:150,max_steer_angle:16,max_speed:120,health:180,power_upgrade:12,speed_upgrade:4,armor_upgrade:30,upgrade_price:600,speed_stars:3,armor_stars:4,acceleration_stars:1,handling_stars:1,price:6E3,main_weapon:"MissileLauncher",wheels:[{x:-1.25,
y:-2,width:0.6,length:1.2,revolving:!0,powered:!0,filename:"big_wheel.png"},{x:1.25,y:-2,width:0.6,length:1.2,revolving:!0,powered:!0,filename:"big_wheel.png"},{x:-1.25,y:2.1,width:0.6,length:1.2,revolving:!1,powered:!1,filename:"big_wheel.png"},{x:1.25,y:2.1,width:0.6,length:1.2,revolving:!1,powered:!1,filename:"big_wheel.png"}]}}},[]);
require.define({particles:function(q,b){var a=q("gamejs"),l=q("./box2d"),o=q("./utils"),t=b.Particle=function(b,e,d,h,n,k){this.position=h;this.world=b;this.color=e;this.life=d;this.direction=n;this.height=this.width=0.2;b=new l.b2BodyDef;b.position=o.listToVector(this.position);b.angle=0;b.linearDamping=0;b.angularDamping=0;this.body=this.world.CreateBody(b);b=new l.b2PolygonDef;b.SetAsBox(this.width/2,this.height/2);b.density=1;b.friction=0.3;b.restitution=1;this.type="particle";this.body.CreateShape(b);
this.body.SetMassFromShapes();this.body.SetUserData({obj:this,type:"projectile"});this.world.addParticle(this);console.log("boo");this.update=function(a){this.life-=a;this.life<=0&&this.world.destroy(this)};this.draw=function(b){a.draw.line(b,this.color,b.getScreenPoint(this.body.GetWorldPoint(new l.b2Vec2(0,-0.1))),b.getScreenPoint(this.body.GetWorldPoint(new l.b2Vec2(0,0.1))),2)};this.setSpeed=function(a){this.body.SetLinearVelocity({x:this.direction[0]*(a*1E3/3600),y:this.direction[1]*(a*1E3/3600)})};
this.setSpeed(k);return this};b.burst=function(a){if(!a.color)a.color="#FF6A00";if(!a.count)a.count=10;if(!a.life)a.life=500;var b,d=80/a.count;for(b=0;b<a.count;b++)new t(a.world,a.color,a.life,a.position,o.rotateVector(a.direction,-40+d*(b+1)),100)}}},["gamejs","box2d","utils"]);
require.define({ui:function(q,b){var a=q("gamejs"),l=q("./gamejs-gui"),o=q("./skin"),t=q("./renderer"),c=q("./settings"),e=q("./combatracer"),d=q("./car_descriptions");q("./weapon_descriptions");var h=q("./levels"),n=q("./utils"),k=q("./sounds"),M=q("./leagues");b.fonts={};b.init=function(){for(var a in o.fonts)b.fonts[a]=new l.CachedFont(o.fonts[a][0],o.fonts[a][1])};var g=b.getFont=function(a){return b.fonts[a]},y=function(a){this.background_color=a.background_color||o.ui_background;this.header_height=
a.header_height||110;y.superConstructor.apply(this,[a])};a.utils.objects.extend(y,l.View);y.prototype.paint=function(){this.surface.clear();a.draw.rect(this.surface,o.ui_header_background,new a.Rect([0,0],[this.surface.getSize()[0],this.header_height]));a.draw.rect(this.surface,this.background_color,new a.Rect([0,this.header_height],[this.surface.getSize()[0],this.surface.getSize()[1]-this.header_height]))};(b.UIScene=function(){var a=this.cache=a=t.cache,b=this.game=e.game;this.gui=new l.GUI(b.display);
this.gui.on(l.EVT_PAINT,function(){this.surface.clear()},this.gui);this.container=new y({position:[0,0],size:[800,600],parent:this.gui});this.gui.center(this.container);this.br_title=new R({position:[60,11],parent:this.container});this.guncar=new l.Image({position:[32,66],parent:this.container,image:a.getUIImage("guncar.png")});this.ping=!1;this.ms_to_ping=1E4;this.dialog=new F({parent:this.gui,size:[450,150]});this.alert=function(a,b){this.dialog.show(a,b)};this.clearAlert=function(){this.dialog.close()};
this.handleEvent=function(a){this.gui.despatchEvent(a)};this.returnToTitle=function(){this.game.showTitle()};this.handleMessageDefault=function(a,b){a==="ERR"?this.alert(b.text):a==="CRITICAL_ERR"?(this.returnToTitle(),this.game.title_scene.alert(b.text)):a==="HELLO"||a==="PONG"||this.alert("Unknown server message:"+a)};this.renderer=new t.UIRenderer(c.get("SCREEN_WIDTH"),c.get("SCREEN_HEIGHT"),this.cache);this.update=function(a){if(this.ping&&(this.ms_to_ping-=a,this.ms_to_ping<=0))this.game.getCommunicator().queueMessage("PING"),
this.ms_to_ping=1E4;this.gui.update(a)};this.draw=function(){this.gui.draw()};return this}).prototype.handleMessage=function(a,b){console.log("uiscene",a,b);this.handleMessageDefault(a,b)};var R=b.BRTitle=function(a){a.text="Bandit Racer";a.font=g("header_black");R.superConstructor.apply(this,[a])};a.utils.objects.extend(R,l.Label);R.prototype.paint=function(){var a=g("header_brown"),b=g("header_black"),c=0;b.render(this.surface,"B",[0,0],null,-3);c+=b.getTextSize("B")[0]-3;a.render(this.surface,
"andit ",[c,0],null,-3);c+=a.getTextSize("andit ")[0]-3;b.render(this.surface,"R",[c,0],null,-3);c+=b.getTextSize("R")[0]-3;a.render(this.surface,"acer",[c,0],null,-3)};var L=b.NameInput=function(a){a.size=[200,40];a.font=g("alias");a.scw_size=[190,40];L.superConstructor.apply(this,[a])};a.utils.objects.extend(L,l.TextInput);L.prototype.paint=function(){this.surface.clear();a.draw.polygon(this.surface,"#FFF",[[10,0],[this.size[0],0],[this.size[0]-10,this.size[1]],[0,this.size[1]]])};var C=b.TitleButton=
function(a){a.font=a.font||g(o.title_button.font);C.superConstructor.apply(this,[a]);this.onClick(function(){k.play({filename:"button_click.wav"})})};a.utils.objects.extend(C,l.Button);C.prototype.paint=function(){var b=this.isHovered()?o.title_button.fill_hover:o.title_button.fill;this.surface.clear();a.draw.polygon(this.surface,b,[[40,0],[this.size[0],0],[this.size[0],this.size[1]],[0,this.size[1]]])};var G=b.Button=function(a){this.font=a.font=a.font||g(o.button.font);this.hover_font=a.hover_font;
this.fill=a.fill||o.button.fill;this.hover_fill=a.hover_fill||o.button.hover_fill;this.lean=a.lean||"right";G.superConstructor.apply(this,[a]);this.onClick(function(){k.play({filename:"button_click.wav"})})};a.utils.objects.extend(G,l.Button);G.prototype.paint=function(){this.label.font=this.label&&this.isHovered()&&this.hover_font?this.hover_font:this.font;this.label.refresh();var b=this.isHovered()?this.hover_fill:this.fill;this.surface.clear();this.lean=="right"?a.draw.polygon(this.surface,b,[[10,
0],[this.size[0],0],[this.size[0],this.size[1]],[0,this.size[1]]]):this.lean=="both"?a.draw.polygon(this.surface,b,[[10,0],[this.size[0],0],[this.size[0]-10,this.size[1]],[0,this.size[1]]]):this.lean=="none"?a.draw.rect(this.surface,b,new a.Rect([0,0],this.getSize())):a.draw.polygon(this.surface,b,[[0,0],[this.size[0]-10,0],[this.size[0],this.size[1]],[0,this.size[1]]])};var v=b.YesNoDialog=function(a){v.superConstructor.apply(this,[a]);this.label=new l.Label({position:[0,0],parent:this,font:g(o.dialog.font),
text:a.text||"b"});this.yes=new G({position:[0,0],size:[150,50],parent:this,lean:"both",text:"Yes"});this.no=new G({position:[0,0],size:[150,50],parent:this,lean:"both",text:"No"});this.center(this.yes);this.center(this.no);this.center(this.label);this.label.move([this.label.getPosition()[0],this.label.getPosition()[1]-30]);this.yes.move([this.yes.position[0]-80,this.yes.position[1]+30]);this.no.move([this.no.position[0]+80,this.no.position[1]+30]);this.yes.onClick(function(){this.close()},this);
this.no.onClick(function(){this.close()},this)};a.utils.objects.extend(v,l.Dialog);var F=b.Dialog=function(a){F.superConstructor.apply(this,[a]);this.label=new l.Label({position:[0,0],parent:this,font:g(o.dialog.font),text:"b"});this.btn=new G({position:[0,0],size:[150,50],parent:this,lean:"both",text:"Ok"});this.center(this.btn);this.btn.move([this.btn.position[0],this.btn.position[1]+30]);this.btn.onClick(function(){this.close()},this)};a.utils.objects.extend(F,l.Dialog);F.prototype.show=function(a,
b){b==void 0&&(b=!0);this.label.setText(a);this.center(this.label);this.label.move([this.label.position[0],this.label.position[1]-30]);b?this.btn.show():this.btn.hide();l.Dialog.prototype.show.apply(this,[])};var S=b.GoToGarage=function(a){a.size=[210,180];S.superConstructor.apply(this,[a]);this.img=new l.Image({position:[0,0],parent:this,image:t.cache.getUIImage("garage.png")});this.center(this.img);this.img.move([this.img.position[0],7]);this.lbl=new l.Label({position:[0,0],parent:this,font:g(o.garage_btn.font),
text:"Garage"});this.center(this.lbl);this.lbl.move([this.lbl.position[0],this.size[1]-this.lbl.size[1]-17])};a.utils.objects.extend(S,l.View);S.prototype.paint=function(){this.surface.fill(o.garage_btn.label_bg);a.draw.rect(this.surface,this.isHovered()?o.garage_btn.bg_color_hover:o.garage_btn.bg_color,new a.Rect([0,0],[this.size[0],126]))};var j=b.DifficultySelect=function(a){j.superConstructor.apply(this,[a]);this.difficulties=["Easy","Medium","Hard"];new l.Label({parent:this,position:[10,6],font:g(o.sp_car_display.font1),
text:"Difficulty:"});this.difflbl=new l.Label({parent:this,position:[27,17],font:g(o.sp_car_display.font2),text:this.difficulties[e.game.player.singleplayer.difficulty-1]});this.left=new u({parent:this,position:[5,28],size:[16,25],direction:"left"});this.left.onClick(function(){e.game.player.singleplayer.difficulty--;if(e.game.player.singleplayer.difficulty==0)e.game.player.singleplayer.difficulty=3;this.difflbl.setText(this.difficulties[e.game.player.singleplayer.difficulty-1])},this);this.right=
new u({parent:this,position:[185,28],size:[16,25],direction:"right"});this.right.onClick(function(){e.game.player.singleplayer.difficulty++;if(e.game.player.singleplayer.difficulty==4)e.game.player.singleplayer.difficulty=1;this.difflbl.setText(this.difficulties[e.game.player.singleplayer.difficulty-1])},this)};a.utils.objects.extend(j,l.View);j.prototype.paint=function(){a.draw.polygon(this.surface,o.sp_car_display.bg_color,[[0,0],[this.size[0]-20,0],[this.size[0],20],[this.size[0],this.size[1]],
[0,this.size[1]]])};var z=b.CarDisplay=function(a){a.size=[210,65];z.superConstructor.apply(this,[a]);this.gameinfo=a.gameinfo;new l.Label({parent:this,position:[10,6],font:g(o.sp_car_display.font1),text:"Current Car:"});this.carlbl=new l.Label({parent:this,position:[20,17],font:g(o.sp_car_display.font2),text:d[this.gameinfo.car.type].name})};a.utils.objects.extend(z,l.View);z.prototype.paint=function(){a.draw.polygon(this.surface,o.sp_car_display.bg_color,[[0,0],[this.size[0],0],[this.size[0],this.size[1]-
20],[this.size[0]-20,this.size[1]],[0,this.size[1]]])};TrackSelectorItem=b.TrackSelectorItem=function(a){a.size=[226,22];this.track=a.track;this.track_obj=h[this.track];TrackSelectorItem.superConstructor.apply(this,[a]);this.label=new l.Label({position:[0,0],parent:this,font:g(o.track_selector.item_font),text:this.track_obj.title});this.center(this.label);this.label.move([this.size[0]-this.label.size[0]-16,this.label.position[1]]);this.selected=!1;this.on(l.EVT_MOUSE_DOWN,this.select,this)};a.utils.objects.extend(TrackSelectorItem,
l.View);TrackSelectorItem.prototype.select=function(){this.selected=!0;this.refresh();k.play({filename:"button_click.wav"});this.despatchEvent({type:"track_select",track:this.track})};TrackSelectorItem.prototype.deselect=function(){this.selected=!1;this.refresh()};TrackSelectorItem.prototype.paint=function(){this.surface.fill(this.selected?o.track_selector.front_color:this.isHovered()?o.track_selector.item_hover_color:o.track_selector.back_color)};TrackSelector=b.TrackSelector=function(b){b.size=
[536,320];TrackSelector.superConstructor.apply(this,[b]);this.track=null;this.tbg1=new l.View({position:[0,0],size:[226,261],parent:this});this.tbg1.on(l.EVT_PAINT,function(){a.draw.polygon(this.surface,o.track_selector.back_color,[[0,0],[this.size[0],0],[this.size[0],this.size[1]],[20,this.size[1]],[0,this.size[1]-20]])},this.tbg1);this.tbg2=new l.View({position:[226,0],size:[310,320],parent:this});this.tbg2.on(l.EVT_PAINT,function(){this.surface.fill(o.track_selector.front_color)},this.tbg2);this.trackdisplay=
new B({parent:this.tbg2,position:[0,0]});var c,b=M[e.game.player.singleplayer.league];new l.Label({parent:this.tbg1,position:[10,0],font:g("alias"),text:b.name});b.tracks.forEach(function(a){h[a].title&&!n.inArray(e.game.player.singleplayer.completed_tracks,a)&&(c=new TrackSelectorItem({parent:this.tbg1,track:a,position:[0,0]}),c.on("track_select",this.select,this))},this);l.layout.vertical(this.tbg1.children,5)};a.utils.objects.extend(TrackSelector,l.View);TrackSelector.prototype.select=function(a){this.track=
a.track;this.tbg1.children.forEach(function(a){a.deselect&&a.track!=this.track&&a.deselect()},this);this.trackdisplay.setTrack(this.track)};var B=b.TrackDisplay=function(a){this.lbl=this.img=this.track=null;a.size=[316,320];B.superConstructor.apply(this,[a]);a.track&&this.setTrack(a.track);this.lbl2=new l.Label({parent:this,position:[0,0],font:g(o.trackdisplay.font),text:"Select a track!"});this.center(this.lbl2)};a.utils.objects.extend(B,l.View);B.prototype.setTrack=function(b){if(this.track=b){this.lbl2.hide();
var c=n.renderLevelBackground(h[b],!1),j=c.getSize(),d=j[0]>j[1]?j[0]/280:j[1]/280,j=[parseInt(j[0]/d),parseInt(j[1]/d)];s=new a.Surface(j[0],j[1]);s.blit(c,new a.Rect([0,0],j),new a.Rect([0,0],c.getSize()));this.img?(this.img.resize(s.getSize()),this.img.setImage(s)):this.img=new l.Image({parent:this,position:[15,10],image:s});this.lbl?this.lbl.setText(h[b].title):this.lbl=new l.Label({parent:this,position:[0,0],text:h[b].title,font:g(o.trackdisplay.font)});this.center(this.lbl);this.lbl.move([this.lbl.position[0],
this.size[1]-this.lbl.size[1]-5])}};var Q=b.Table=function(a){Q.superConstructor.apply(this,[a]);this.columns=a.columns;this.data=a.data;this.header=new l.View({parent:this,size:[this.size[0],30],position:[0,0]});this.header.on(l.EVT_PAINT,function(){this.surface.fill(o.table.header_fill)},this.header);var b=0;this.columns.forEach(function(a){new l.Label({parent:this.header,position:[b+20,3],font:g(o.table.header_font),text:a.label});b+=a.width},this);this.body=new l.View({parent:this,size:[this.size[0],
this.size[1]-30],position:[0,30]});this.body.on(l.EVT_PAINT,function(){this.surface.fill(o.table.body_fill)},this.body);this.data&&this.setData(this.data)};a.utils.objects.extend(Q,l.View);Q.prototype.setData=function(a){this.body.children=[];var b=0,c;a.forEach(function(a){c=0;var j=new l.View({parent:this.body,size:[this.size[0],30],position:[0,b]});this.columns.forEach(function(b){new l.Label({parent:j,position:[c+20,3],font:g(o.table.header_font),text:String(a[b.key]),font:g(o.table.data_font)});
c+=b.width},this);b+=30},this)};var u=b.IncrementButton=function(b){var c=new a.Surface(b.size),g=new a.Surface(b.size),j=b.direction=="up"?[[parseInt(b.size[0]/2),0],b.size,[0,b.size[1]]]:b.direction=="down"?[[0,0],[b.size[0],0],[parseInt(b.size[0]/2),b.size[1]]]:b.direction=="left"?[[0,parseInt(b.size[1]/2)],[b.size[0],0],b.size]:[[0,0],[b.size[0],parseInt(b.size[1]/2)],[0,b.size[1]]];a.draw.polygon(c,o.title_button.fill,j);a.draw.polygon(g,o.title_button.fill_hover,j);b.image=c;b.image_hover=g;
b.image_down=!1;u.superConstructor.apply(this,[b]);this.onClick(function(){k.play({filename:"button_click.wav"})})};a.utils.objects.extend(u,l.Button);var K=b.Stars=function(a){a.image=t.cache["static"][a.stars+"stars.png"];K.superConstructor.apply(this,[a])};a.utils.objects.extend(K,l.Image);K.prototype.setStars=function(a){a=t.cache["static"][a+"stars.png"];this.resize(a.getSize());this.setImage(a)};var D=b.KeyExplanation=function(a){a.size=[400,52];D.superConstructor.apply(this,[a]);var b=g("25_66");
this.key=a.key;this.text=a.text;a=60;this.key.length>1&&(a=b.getTextSize(this.key)[0]+50);this.btn=new l.Button({size:[a,this.getSize()[1]],position:[0,0],font:b,parent:this,image:t.cache.getUIImage("key_bg.png"),text:this.key});this.btn.label.move([this.btn.label.getPosition()[0],this.btn.label.getPosition()[1]-7]);this.lbl=new l.Label({position:[0,0],parent:this,font:b,text:this.text});this.center(this.lbl);this.lbl.move([a+30,this.lbl.getPosition()[1]])};a.utils.objects.extend(D,l.View)}},["gamejs",
"gamejs-gui","skin","renderer","settings","combatracer","car_descriptions","weapon_descriptions","levels","utils","sounds","leagues"]);
require.define({garage:function(q,b){var a=q("gamejs"),l=q("./ui");q("./utils");q("./levels");var o=q("./sounds"),t=q("./car_descriptions"),c=q("./weapon_descriptions"),e=q("./gamejs-gui"),d=q("./skin");q("./combatracer");var h=q("./renderer"),n={front_weapon:"Front weapon slot",util:"Utility slot",rear_weapon:"Rear weapon slot"},k={acc_upgrades:"Acceleration",speed_upgrades:"Top Speed",armor_upgrades:"Armor"},M=b.GarageScene=function(a){M.superConstructor.apply(this,[]);this.player_data=a;this.car_descr=
t[this.player_data.car.type];this.container.header_height=130;this.container.background_color=d.garage.background_color;this.container.refresh();this.container.on(e.EVT_PAINT,this.paintBackground,this);this.container.on(e.EVT_AFTER_PAINT,this.afterPaint,this);this.selected_slot=this.selected_item=null;this.titlelbl=new e.Label({parent:this.container,position:[210,40],text:"Garage",font:l.getFont("header_black")});this.backbtn=new l.Button({parent:this.container,size:[130,50],position:[670,530],font:l.getFont(d.garage.back_button.font),
hover_font:l.getFont(d.garage.back_button.hover_font),fill:d.garage.back_button.fill,hover_fill:d.garage.back_button.hover_fill,text:"BACK",lean:"right"});this.buy_car_btn=new l.Button({parent:this.container,size:[300,50],position:[350,530],font:l.getFont("button2_hover"),fill:"#006837",hover_fill:"#00381C",text:"BUY NEW CAR",lean:"both"});this.buy_car_btn.onClick(function(){this.game.showCarDealer(this.player_data)},this);this.balance_label=new e.Label({parent:this.container,font:l.getFont(d.garage.balance_font),
position:[8,172],text:"Balance "+this.player_data.balance+"\u20ac"});new e.Label({parent:this.container,position:[52,234],font:l.getFont(d.garage.car_title_font),text:this.car_descr.name});this.weapon_info=new C({parent:this.container,scene:this,position:[270,160]});this.tuning=new L({parent:this.container,scene:this,position:[537,160]});this.weapon_info.buy_s.button.onClick(this.buyItem,this);this.backbtn.onClick(function(){this.game.returnTo()},this);this.shop=new G({parent:this.container,scene:this,
position:[275,440]});this.shop.on("select",this.selectWeapon,this);this.slots={};this.slots.front_weapon=new EquipmentSlot({parent:this.container,position:[144,295],scene:this,slot_type:"front_weapon"});this.slots.util=new EquipmentSlot({parent:this.container,position:[80,390],scene:this,slot_type:"util"});this.slots.rear_weapon=new EquipmentSlot({parent:this.container,position:[107,505],scene:this,slot_type:"rear_weapon"});for(var b in this.slots)this.slots[b].on("select",this.selectSlot,this);this.slots.front_weapon.select()};
a.utils.objects.extend(M,l.UIScene);M.prototype.selectSlot=function(a){this.shop.selectRow(a.item.slot_type);this.selected_item=this.selected_slot=a.item;this.weapon_info.setItem(a.item)};M.prototype.credit=function(a){if(this.player_data.balance-a<0)return this.alert("Insufficient funds!"),!1;this.player_data.balance-=a;this.balance_label.setText("Balance "+this.player_data.balance+"\u20ac");return!0};M.prototype.buyItem=function(){this.player_data.car[this.selected_slot.slot_type]&&this.selected_item.weapon==
this.player_data.car[this.selected_slot.slot_type].type&&this.alert("This weapon is already equipped!");this.credit(this.selected_item.descr.price)&&(this.player_data.car[this.selected_slot.slot_type]={type:this.selected_item.weapon,ammo_upgrades:0,damage_upgrades:0},this.selected_slot.deselect(),this.selected_slot.select())};M.prototype.deselectSlots=function(){for(var a in this.slots)this.slots[a].deselect()};M.prototype.deselectAll=function(){this.shop.deselectAll();this.deselectSlots()};M.prototype.selectWeapon=
function(a){this.deselectSlots();for(var b in this.slots)if(this.player_data.car[this.slots[b].slot_type]&&a.item.weapon==this.player_data.car[this.slots[b].slot_type].type){a.item.deselect();this.slots[b].select();return}this.weapon_info.setItem(a.item);this.selected_item=a.item};M.prototype.afterPaint=function(){if(this.selected_slot){var b=[];this.selected_slot.slot_type=="front_weapon"?b=[[270,290],[230,290],[230,315],[195,315],[195,320],[230,320],[230,460],[270,460],[270,455],[235,455],[235,
295],[270,295]]:this.selected_slot.slot_type=="util"?b=[[270,290],[230,290],[230,410],[130,410],[130,415],[230,415],[230,460],[270,460],[270,455],[235,455],[235,295],[270,295]]:this.selected_slot.slot_type=="rear_weapon"&&(b=[[270,290],[230,290],[230,525],[157,525],[157,530],[235,530],[235,460],[270,460],[270,455],[235,455],[235,295],[270,295]]);b&&a.draw.polygon(this.container.surface,d.garage.slot_path,b)}};M.prototype.paintBackground=function(){a.draw.polygon(this.container.surface,d.garage.balance_background,
[[0,160],[250,160],[240,210],[0,210]]);a.draw.rect(this.container.surface,d.garage.car_title_background,new a.Rect([45,230],[170,30]));a.draw.rect(this.container.surface,d.garage.car_background,new a.Rect([45,260],[170,310]));var b=h.cache["static"][this.car_descr.art_filename],c=b.getSize(),c=[parseInt(290/c[1]*c[0]),290];this.container.surface.blit(b,[parseInt(45+(170-c[0])/2),270]);a.draw.rect(this.container.surface,d.garage.store_background,new a.Rect([270,435],[515,60]));a.draw.rect(this.container.surface,
d.garage.store_border,new a.Rect([273,438],[509,54]),5);a.draw.rect(this.container.surface,"#333333",new a.Rect([215,242],[322,5]))};EquipmentSlot=b.EquipmentSlot=function(a){a.size=[50,50];EquipmentSlot.superConstructor.apply(this,[a]);this.type="equipment_slot";this.slot_type=a.slot_type;this.selected=!1;this.scene=a.scene;this.on(e.EVT_MOUSE_DOWN,this.select,this);this.on(e.EVT_MOUSE_DOWN,function(){o.play({filename:"button_click.wav"})})};a.utils.objects.extend(EquipmentSlot,e.View);EquipmentSlot.prototype.select=
function(){if(!this.selected)this.scene.deselectAll(),this.selected=!0,this.despatchEvent({type:"select",item:this}),this.refresh()};EquipmentSlot.prototype.deselect=function(){if(this.selected)this.selected=!1,this.refresh()};EquipmentSlot.prototype.paint=function(){this.surface.clear();this.surface.fill(this.selected?d.garage.slot_bg_selected:d.garage.slot_bg);a.draw.rect(this.surface,d.garage.slot_border,new a.Rect([1,1],[48,48]),2);if(this.scene.player_data.car[this.slot_type]){var b=h.cache["static"][c[this.scene.player_data.car[this.slot_type].type].icon],
g=b.getSize();this.surface.blit(b,[parseInt((50-g[0])/2),parseInt((50-g[1])/2)])}};var g=function(a){a.fill=d.garage.white_button.bg;a.hover_fill=d.garage.white_button.bg_hover;a.font=l.getFont(d.garage.white_button.font);a.hover_font=l.getFont(d.garage.white_button.hover_font);a.lean="none";g.superConstructor.apply(this,[a])};a.utils.objects.extend(g,l.Button);var y=function(a){a.fill="#4D4D4D";a.hover_fill="#F2F2F2";a.font=l.getFont(d.garage.white_button.hover_font);a.hover_font=l.getFont(d.garage.white_button.font);
a.lean="none";y.superConstructor.apply(this,[a])};a.utils.objects.extend(y,l.Button);var R=function(a){a.size=[230,45];R.superConstructor.apply(this,[a]);new e.Image({parent:this,position:[10,8],image:h.cache["static"]["ico_ammo.png"]});this.ammo_label=new e.Label({position:[50,14],parent:this,text:"0",font:l.getFont(d.garage.weapon_label_font)});this.damage_icon=new e.Image({parent:this,position:[85,8],image:h.cache["static"]["ico_damage.png"]});this.damage_label=new e.Label({position:[125,14],parent:this,
text:"0",font:l.getFont(d.garage.weapon_label_font)});this.button=new g({position:[175,5],parent:this,size:[50,35],text:"BUY"})};a.utils.objects.extend(R,e.View);R.prototype.paint=function(){this.surface.fill("#CCCCCC")};var L=function(a){a.size=[250,240];L.superConstructor.apply(this,[a]);this.scene=a.scene;this.label=new e.Label({parent:this,font:l.getFont("g_white_title"),position:[20,10],text:"Tuning"});new j({parent:this,position:[10,45],upgrade_type:"acc_upgrades",scene:this.scene});new j({parent:this,
position:[10,110],upgrade_type:"speed_upgrades",scene:this.scene});new j({parent:this,position:[10,175],upgrade_type:"armor_upgrades",scene:this.scene})};a.utils.objects.extend(L,e.View);L.prototype.paint=function(){a.draw.rect(this.surface,d.garage.tuning_title_background,new a.Rect([0,0],[250,40]));a.draw.rect(this.surface,d.garage.tuning_background,new a.Rect([0,40],[250,200]))};var C=function(a){a.size=[250,240];C.superConstructor.apply(this,[a]);this.label=new e.Label({parent:this,font:l.getFont(d.garage.weapon_label_font),
position:[20,10],text:"I"});this.label.setText(" ");this.text=new e.Text({parent:this,width:220,font:l.getFont(d.garage.weapon_info_text_font),position:[15,45],text:"I"});this.scene=a.scene;this.price_label=new e.Label({position:[10,10],parent:this,text:"? \u20ac",font:l.getFont(d.garage.weapon_label_font)});this.price_label.on(e.EVT_RESIZE,function(){this.price_label.move([this.getSize()[0]-this.price_label.getSize()[0]-10,this.price_label.getPosition()[1]])},this);this.buy_s=new R({parent:this,
visible:!1,position:[10,185]});this.damage_upgrade=new z({parent:this,visible:!1,scene:this.scene,upgrade_type:"damage",position:[10,110]});this.ammo_upgrade=new z({parent:this,visible:!1,scene:this.scene,upgrade_type:"ammo",position:[10,165]})};a.utils.objects.extend(C,e.View);C.prototype.paint=function(){a.draw.rect(this.surface,d.garage.weapon_info_title_background,new a.Rect([0,0],[250,40]));a.draw.rect(this.surface,d.garage.weapon_info_background,new a.Rect([0,40],[250,200]))};C.prototype.setItem=
function(a){var b=!1;this.item=a;a.type=="shop_item"?(b=a.descr,this.buy_s.show(),this.ammo_upgrade.hide(),this.damage_upgrade.hide(),this.price_label.show(),this.price_label.setText(b.price+" \u20ac"),this.buy_s.ammo_label.setText(String(b.ammo_capacity)),b.damage_upgrade?(this.buy_s.damage_label.show(),this.buy_s.damage_icon.show(),this.buy_s.damage_label.setText(String(b.damage))):(this.buy_s.damage_label.hide(),this.buy_s.damage_icon.hide())):a.type=="equipment_slot"&&(this.buy_s.hide(),this.price_label.hide(),
this.scene.player_data.car[a.slot_type]?(b=c[this.scene.player_data.car[a.slot_type].type],this.ammo_upgrade.show(),this.ammo_upgrade.setDescr(this.scene.player_data.car[a.slot_type]),b.damage_upgrade?(this.damage_upgrade.show(),this.damage_upgrade.setDescr(this.scene.player_data.car[a.slot_type])):this.damage_upgrade.hide()):(this.ammo_upgrade.hide(),this.damage_upgrade.hide(),this.label.setText(n[a.slot_type]),this.text.setText("This slot is empty. Buy something from the shop below to fill it!")));
b&&(this.label.setText(b.name),this.text.setText(b.description))};var G=b.Shop=function(a){this.rows={};this.items=[];a.size=[510,50];this.scene=a.scene;G.superConstructor.apply(this,[a]);a=new F({parent:this,size:this.getSize(),position:[0,0],type:"front_weapon",visible:!1});this.rows.front_weapon=a;a=new F({parent:this,size:this.getSize(),position:[0,0],type:"util",visible:!1});this.rows.util=a;a=new F({parent:this,size:this.getSize(),position:[0,0],type:"rear_weapon",visible:!1});this.rows.rear_weapon=
a;var b,g;for(g in c)b=c[g],a=this.rows[b.type],a.children.length&&new v({parent:a}),a=new S({parent:a,weapon:g,descr:b}),a.on("select",this.selectItem,this),this.items.push(a);for(var j in this.rows)e.layout.horizontal(this.rows[j].children)};a.utils.objects.extend(G,e.View);G.prototype.deselectAll=function(){this.items.forEach(function(a){a.deselect()})};G.prototype.selectItem=function(a){this.despatchEvent(a)};G.prototype.selectRow=function(a){for(var b in this.rows)b==a?this.rows[b].show():this.rows[b].hide()};
var v=b.ShopItemSep=function(a){a.size=[5,50];v.superConstructor.apply(this,[a])};a.utils.objects.extend(v,e.View);v.prototype.paint=function(){this.surface.clear();a.draw.rect(this.surface,d.garage.store_border,new a.Rect([0,8],[5,34]))};var F=b.ShopItemRow=function(a){this.type=a.type;F.superConstructor.apply(this,[a])};a.utils.objects.extend(F,e.View);var S=b.ShopItem=function(a){this.descr=a.descr;this.weapon=a.weapon;a.size=[50,50];S.superConstructor.apply(this,[a]);this.type="shop_item";this.img=
h.cache["static"][this.descr.icon];this.selected=!1;this.on(e.EVT_MOUSE_DOWN,this.select,this);this.on(e.EVT_MOUSE_DOWN,function(){o.play({filename:"button_click.wav"})})};a.utils.objects.extend(S,e.View);S.prototype.select=function(){if(!this.selected)this.parent.parent.scene.deselectAll(),this.selected=!0,this.despatchEvent({type:"select",item:this}),this.refresh()};S.prototype.paint=function(){e.View.prototype.paint.apply(this,[]);this.selected&&this.surface.fill(d.garage.selected_shop_item_bg);
var a=this.img.getSize();this.surface.blit(this.img,[parseInt((50-a[0])/2),parseInt((50-a[1])/2)])};S.prototype.deselect=function(){if(this.selected)this.selected=!1,this.refresh()};var j=function(a){a.size=[230,60];this.scene=a.scene;this.upgrade_type=a.upgrade_type;this.descr=t[this.scene.player_data.car.type];j.superConstructor.apply(this,[a]);new e.Label({parent:this,position:[20,0],parent:this,font:l.getFont("g_white_title"),text:k[this.upgrade_type]});this.stars=new l.Stars({position:[2,25],
parent:this,stars:this.getValue()});this.price_label=new e.Label({position:[0,29],parent:this,text:this.descr.upgrade_price+"\u20ac",font:l.getFont("g_white_title"),visible:this.getValue()<5});this.button=new y({position:[135,20],parent:this,size:[90,35],text:"UPGRADE",visible:this.getValue()<5});this.button.onClick(this.buy,this);this.price_label.on(e.EVT_RESIZE,function(){this.price_label.move([this.getSize()[0]-this.button.getSize()[0]-this.price_label.getSize()[0]-10,this.price_label.getPosition()[1]])},
this);this.price_label.resize(this.price_label.getSize())};a.utils.objects.extend(j,e.View);j.prototype.getValue=function(){return this.scene.player_data.car[this.upgrade_type]};j.prototype.buy=function(){this.getValue()>=5?this.scene.alert("Upgrade maxed out!"):this.scene.credit(this.descr.upgrade_price)&&(this.scene.player_data.car[this.upgrade_type]++,this.stars.setStars(this.getValue()),this.getValue()>=5&&(this.price_label.hide(),this.button.hide()))};j.prototype.paint=function(){this.surface.clear();
a.draw.rect(this.surface,"#333333",new a.Rect([0,15],[this.getSize()[0],this.getSize()[1]-15]))};var z=function(a){a.size=[230,60];this.upgrade_type=a.upgrade_type;this.weapon_descr=this.descr=null;this.scene=a.scene;z.superConstructor.apply(this,[a]);new e.Image({parent:this,position:[5,23],image:h.cache["static"]["ico_"+this.upgrade_type+".png"]});this.stars=new l.Stars({position:[40,0],parent:this,stars:0});this.label=new e.Label({position:[35,29],parent:this,text:"0",font:l.getFont(d.garage.weapon_label_font)});
this.price_label=new e.Label({position:[0,29],parent:this,text:"0 \u20ac",font:l.getFont(d.garage.weapon_label_font)});this.button=new g({position:[135,20],parent:this,size:[90,35],text:"UPGRADE"});this.button.onClick(this.buy,this);this.price_label.on(e.EVT_RESIZE,function(){this.price_label.move([this.getSize()[0]-this.button.getSize()[0]-this.price_label.getSize()[0]-10,this.price_label.getPosition()[1]])},this)};a.utils.objects.extend(z,e.View);z.prototype.setDescr=function(a){if(this.descr=a)this.weapon_descr=
c[this.descr.type],a=this.descr[this.upgrade_type+"_upgrades"],this.stars.setStars(a),this.label.setText(String(this.getCurValue())),this.price_label.setText(this.weapon_descr[this.upgrade_type+"_upgrade_price"]+"\u20ac"),a<5?(this.button.show(),this.price_label.show()):(this.button.hide(),this.price_label.hide())};z.prototype.buy=function(){!(this.descr[this.upgrade_type+"_upgrades"]>=5)&&this.scene.credit(this.weapon_descr[this.upgrade_type+"_upgrade_price"])&&(this.descr[this.upgrade_type+"_upgrades"]++,
this.setDescr(this.descr))};z.prototype.getCurValue=function(){return(this.upgrade_type=="damage"?this.weapon_descr.damage:this.weapon_descr.ammo_capacity)+this.descr[this.upgrade_type+"_upgrades"]*this.weapon_descr[this.upgrade_type+"_upgrade"]};z.prototype.paint=function(){this.surface.clear();a.draw.rect(this.surface,"#CCCCCC",new a.Rect([0,15],[this.getSize()[0],this.getSize()[1]-15]))};var B=b.BuyCarScene=function(a){B.superConstructor.apply(this,[]);this.player_data=a;this.container.header_height=
130;this.container.background_color=d.garage.background_color;this.container.on(e.EVT_PAINT,this.paint,this);this.container.refresh();this.titlelbl=new e.Label({parent:this.container,position:[210,40],text:"Car Deal",font:l.getFont("header_black")});this.backbtn=new l.Button({parent:this.container,size:[130,50],position:[0,540],font:l.getFont(d.garage.back_button.font),hover_font:l.getFont(d.garage.back_button.hover_font),fill:d.garage.back_button.fill,hover_fill:d.garage.back_button.hover_fill,text:"BACK",
lean:"left"});this.backbtn.onClick(function(){this.game.showGarage(this.player_data)},this);this.car_list=new K({position:[25,160],parent:this.container,scene:this});this.carinfo=new D({position:[450,160],parent:this.container,scene:this});this.balance_label=new e.Label({parent:this.container,font:l.getFont(d.garage.balance_font),position:[260,550],text:"Balance "+this.player_data.balance+"\u20ac"});this.buy_car_btn=new l.Button({parent:this.container,size:[100,50],position:[700,540],font:l.getFont("button2_hover"),
fill:"#006837",hover_fill:"#00381C",text:"BUY",lean:"right",visible:!1});this.buy_car_btn.onClick(this.buy,this)};a.utils.objects.extend(B,l.UIScene);B.prototype.paint=function(){a.draw.rect(this.container.surface,"#B3B3B3",new a.Rect([250,540],[300,50]))};B.prototype.buy=function(){if(this.carinfo.descr&&this.credit(this.carinfo.descr.price))this.player_data.car.type=this.carinfo.descr.id,this.player_data.car.acc_upgrades=0,this.player_data.car.speed_upgrades=0,this.player_data.car.armor_upgrades=
0,this.game.showGarage(this.player_data)};B.prototype.credit=function(a){if(this.player_data.balance-a<0)return this.alert("Insufficient funds!"),!1;this.player_data.balance-=a;this.balance_label.setText("Balance "+this.player_data.balance+"\u20ac");return!0};var Q=function(a){Q.superConstructor.apply(this,[a])};a.utils.objects.extend(Q,e.View);Q.prototype.paint=function(){this.surface.fill("#CCCCCC")};var u=function(a){this.descr=a.descr;u.superConstructor.apply(this,[a]);var a=this.getSize()[0],
b=this.getSize()[1],c=h.cache.getCarSprite(this.descr.filenames[0],0);new e.Image({parent:this,image:c,position:[5+parseInt((50-c.getSize()[0])/2),5+parseInt((b-10-c.getSize()[1])/2)]});new e.Label({parent:this,font:l.getFont("16_33"),text:this.descr.name,position:[60,5]});new e.Text({parent:this,font:l.getFont("13_grayish"),text:this.descr.description,width:a-b,position:[60,28]});a=new e.Label({parent:this,font:l.getFont("16_33"),text:this.descr.price+"\u20ac",position:[a-100,b-25]});a.move([this.getSize()[0]-
a.getSize()[0]-10,a.getPosition()[1]]);this.on(e.EVT_MOUSE_DOWN,function(){o.play({filename:"button_click.wav"});this.parent.parent.scene.carinfo.setDescr(this.descr)},this)};a.utils.objects.extend(u,e.View);u.prototype.paint=function(){this.isHovered()?this.surface.fill("#E2E2E2"):this.surface.clear()};var K=function(a){a.size=[330,360];this.scene=a.scene;K.superConstructor.apply(this,[a]);this.scw=new e.ScrollableView({parent:this,position:[5,5],size:[this.getSize()[0]-25,this.getSize()[1]-10]});
this.scw.setVerticalScrollbar(new e.VerticalScrollbar({parent:this,position:[this.getSize()[0]-20,5],size:[20,this.getSize()[1]-10]}));var a=[],b;for(b in t)a.push(t[b]);a.sort(function(a,b){return a.price-b.price});a.forEach(function(a){this.scw.children.length&&new Q({parent:this.scw,position:[10,0],size:[this.scw.getSize()[0]-20,5]});new u({parent:this.scw,size:[this.scw.getSize()[0],100],descr:a})},this);e.layout.vertical(this.scw.children);this.scw.autoSetScrollableArea()};a.utils.objects.extend(K,
e.View);K.prototype.paint=function(){this.surface.clear();var b=this.getSize()[1],c=this.getSize()[0];a.draw.rect(this.surface,"#999999",new a.Rect([0,0],[c,5]));a.draw.rect(this.surface,"#999999",new a.Rect([0,b-5],[c,5]));a.draw.rect(this.surface,"#999999",new a.Rect([0,5],[5,b-10]));a.draw.rect(this.surface,"#F2F2F2",new a.Rect([5,5],[c-5,b-10]))};var D=function(a){a.size=[330,360];this.scene=a.scene;this.descr=null;D.superConstructor.apply(this,[a]);this.carimg=null;this.cartitle=new e.Label({parent:this,
position:[20,178],text:"Car not selected",font:l.getFont("alias")});this.cardescr=new e.Text({parent:this,position:[20,213],width:310,font:l.getFont("16_33"),text:"Select a car!"});this.pricelabel=new e.Label({parent:this,position:[230,178],font:l.getFont("alias"),text:"0\u20ac",visible:!1});this.acceleration_label=new e.Label({parent:this,position:[20,240],font:l.getFont("16_33"),text:"Acceleration:",visible:!1});this.acceleration_stars=new l.Stars({parent:this,position:[135,240],stars:0,visible:!1});
this.speed_label=new e.Label({parent:this,position:[20,270],font:l.getFont("16_33"),text:"Top Speed:",visible:!1});this.speed_stars=new l.Stars({parent:this,position:[135,270],stars:0,visible:!1});this.armor_label=new e.Label({parent:this,position:[20,300],font:l.getFont("16_33"),text:"Armor:",visible:!1});this.armor_stars=new l.Stars({parent:this,position:[135,300],stars:0,visible:!1});this.handling_label=new e.Label({parent:this,position:[20,330],font:l.getFont("16_33"),text:"Handling:",visible:!1});
this.handling_stars=new l.Stars({parent:this,position:[135,330],stars:0,visible:!1});this.pricelabel.on(e.EVT_RESIZE,function(){this.pricelabel.move([this.getSize()[0]-this.pricelabel.getSize()[0]-10,this.pricelabel.getPosition()[1]])},this)};a.utils.objects.extend(D,e.View);D.prototype.paint=function(){this.surface.fill("#B3B3B3");a.draw.rect(this.surface,"#F5F5F5",new a.Rect([0,0],[this.getSize()[0],180]));this.carimg&&this.surface.blit(this.carimg,[20,5])};D.prototype.setDescr=function(b){this.descr=
b;this.carimg=a.transform.rotate(h.cache["static"][this.descr.art_filename],90);this.cartitle.setText(b.name);this.cardescr.setText(b.description);this.pricelabel.show();this.scene.player_data.car.type!=b.id?(this.pricelabel.setText(b.price+"\u20ac"),this.scene.buy_car_btn.show()):(this.pricelabel.setText("OWNED"),this.scene.buy_car_btn.hide());this.acceleration_stars.setStars(b.acceleration_stars);this.speed_stars.setStars(b.speed_stars);this.armor_stars.setStars(b.armor_stars);this.handling_stars.setStars(b.handling_stars);
this.acceleration_label.show();this.armor_label.show();this.speed_label.show();this.handling_label.show();this.acceleration_stars.show();this.speed_stars.show();this.armor_stars.show();this.handling_stars.show();this.refresh()}}},["gamejs","ui","utils","levels","sounds","car_descriptions","weapon_descriptions","gamejs-gui","skin","combatracer","renderer"]);
require.define({weapons:function(q,b){var a=q("gamejs"),l=q("./box2d"),o=q("./utils");q("./sounds");q("./buffs");var t=o.vec,c=o.arr,e=q("./weapon_descriptions"),d=a.utils.vectors,h=a.utils.math;radians=h.radians;degrees=h.degrees;var n=q("./animation"),h=b.Projectile=function(a){this.weapon=a.weapon;this.speed=a.speed;this.damage=a.damage;this.position=a.position;this.angle=a.angle;this.width=a.width;this.height=a.height;this.speed=a.speed;this.damage=a.damage;this.car=a.car;this.world=this.car.world;
this.type="projectile";this.spent=!1;var b=new l.b2BodyDef;b.position=t(this.position);b.type=l.b2Body.b2_dynamicBody;b.angle=radians(this.angle);b.linearDamping=0;b.angularDamping=0;b.bullet=!0;b.fixedRotation=!0;this.body=this.world.CreateBody(b);this.body.SetUserData(this);b=new l.b2FixtureDef;b.shape=new l.b2PolygonShape;b.shape.SetAsBox(this.width/2,this.height/2);b.restitution=1;b.density=1.0E-5;b.friction=0;b.isSensor=a.sensor==void 0?!1:a.sensor;this.body.CreateFixture(b);this.getState=function(){return{p:c(this.body.GetPosition()),
a:degrees(this.body.GetAngle()),lv:c(this.body.GetLinearVelocity())}};this.interpolate=function(a,b,c){return{p:o.interpolatePoints(a.p,b.p,c),a:o.interpolateInts(a.a,b.a,c),lv:a.lv}};this.setState=function(a){this.body.SetPositionAndAngle(t(a.p),radians(a.a));this.body.SetLinearVelocity(t(a.lv))};this.getSpeedKMH=function(){var a=c(this.body.GetLinearVelocity());return d.len(a)/1E3*3600};this.setSpeed=function(a){var b=this.getSpeedKMH()<1?c(this.car.body.GetWorldVector(t(0,-1))):c(this.body.GetWorldVector(t(0,
-1))),b=d.multiply(b,a*1E3/3600);this.body.SetLinearVelocity(t(b))};this.impact=function(a){if((a.type=="car"||a.type=="prop")&&!this.spent){this.car.world.event("destroy",this.id);a.type=="car"&&a.hit(this.damage,this.car);if(this.onimpact)this.onimpact(a);this.spent=!0}};this.setSpeed(this.speed);this.draw=function(){console.log("draw not implemented for projectile")};this.update=function(){var a=c(this.body.GetPosition());(a[0]<0||a[1]<0||a[0]>this.car.world.width||a[1]>this.car.world.height)&&
this.car.world.event("destroy",this.id)};return this};b.Mine=function(a){this.position=a.position;this.car=a.car;this.height=this.width=2;this.type="mine";this.damage=a.damage;this.world=this.car.world;a=new l.b2BodyDef;a.position=t(this.position);a.angle=0;a.fixedRotation=!0;a.linearDamping=0;a.angularDamping=0;this.body=this.world.CreateBody(a);this.body.SetUserData(this);a=new l.b2FixtureDef;a.shape=new l.b2PolygonShape;a.shape.SetAsBox(this.width/2,this.height/2);a.isSensor=!0;this.body.CreateFixture(a);
this.getState=function(){return null};this.setState=function(){};this.impact=function(a){a.type=="car"&&(this.car.world.objects.car.forEach(function(b){if(b==a||d.distance(this.position,c(b.body.GetPosition()))<=8)if(b.hit(this.damage,this.car),this.onimpact)this.onimpact()},this),this.car.world.destroyObj(this.id),this.car.world.spawnAnimation("explosion",this.position),this.car.world.playSound("explosion.wav",this.position))};this.draw=function(a){a.drawStatic("mine.png",this.position)};this.destroy=
function(){this.car.world.event("destroy",this.id)};return this};var k=b.StaticListener=function(a){this.position=a.position;this.car=a.car;this.width=a.width;this.height=a.height;this.damage=a.damage;this.world=this.car.world;this.weapon=a.weapon;a=new l.b2BodyDef;a.position=t(this.position);a.angle=0;a.fixedRotation=!0;a.linearDamping=0;a.angularDamping=0;this.body=this.world.CreateBody(a);this.body.SetUserData(this);this.drawn=!1;a=new l.b2FixtureDef;a.shape=new l.b2PolygonShape;a.shape.SetAsBox(this.width/
2,this.height/2);a.isSensor=!0;this.body.CreateFixture(a);this.getState=function(){return null};this.setState=function(){}};b.OilPuddle=function(a){this.position=a.position;this.car=a.car;this.width=4.5;this.height=3.5;this.damage=a.damage;this.world=this.car.world;this.weapon=a.weapon;a=new l.b2BodyDef;a.position=t(this.position);a.angle=0;a.fixedRotation=!0;a.linearDamping=0;a.angularDamping=0;this.body=this.world.CreateBody(a);this.body.SetUserData(this);this.drawn=!1;a=new l.b2FixtureDef;a.shape=
new l.b2PolygonShape;a.shape.SetAsBox(this.width/2,this.height/2);a.isSensor=!0;this.body.CreateFixture(a);this.getState=function(){return null};this.setState=function(){};this.impact=function(a){a.type=="car"&&this.car.world.createBuff("SlipDebuff",a,{duration:e.Oil.duration})};this.draw=function(a){if(!this.drawn){var b=a.cache.getStaticSprite("oil_spill.png"),c=b.getSize(),g=[this.position[0]*this.car.world.phys_scale,this.position[1]*this.car.world.phys_scale];a.background.blit(b,[g[0]-c[0]/2,
g[1]-c[1]/2]);this.drawn=!0}};return this};var M=b.Missile=function(a){a.width=0.5;a.height=2.5;this.tts=50;M.superConstructor.apply(this,[a]);this.car.world.playSound("missile_launch.wav",this.position);this.destroy=function(){this.car.world.event("destroy",this.id)};this.onimpact=function(){var a=c(this.body.GetPosition());this.car.world.spawnAnimation("explosion",a);this.car.world.playSound("explosion.wav",a)};this.draw=function(a){this.spent||a.drawCar("missile.png",c(this.body.GetPosition()),
degrees(this.body.GetAngle()))};this.update=function(a){this.tts-=a;if(this.tts<0)this.car.world.spawnAnimation("smoke",c(this.body.GetWorldPoint(t([0,1.25])))),this.tts=50};return this};a.utils.objects.extend(M,h);var g=b.NapalmFlame=function(a){this.burn_cooldown=200;a.width=4;a.height=4;this.life=6E3;g.superConstructor.apply(this,[a]);this.burning={};this.collapse=!1;this.animation=new n.Animation({filename:"fire64.png",duration:800,repeat:!0,expand_from:30,expand_to:64});this.impact=function(a){if(a.type==
"car"&&!this.burning[a.id])a.hit(this.damage,this.car),this.burning[a.id]=this.burn_cooldown};this.update=function(a){for(var b in this.burning)this.burning[b]-=a,this.burning[b]<0&&delete this.burning[b];this.animation.update(a);this.life-=a;if(this.life<=800&&!this.collapse)this.animation.age=0,this.animation.expand_from=64,this.animation.expand_to=30,this.collapse=!0;this.life<0&&this.car.world.event("destroy",this.id)};this.draw=function(a){this.animation.draw(a,c(this.body.GetPosition()))}};
a.utils.objects.extend(g,k);var y=b.HomingMissile=function(b){y.superConstructor.apply(this,[b]);this.draw=function(a){this.spent||a.drawCar("missile_homing.png",c(this.body.GetPosition()),degrees(this.body.GetAngle()))};this.update=function(b){this.tts-=b;if(this.tts<0)this.car.world.spawnAnimation("smoke",c(this.body.GetWorldPoint(t([0,1.25])))),this.tts=50;var g=null,j=1E6;this.car.world.objects.car.forEach(function(b){if(c(this.body.GetLocalPoint(b.body.GetPosition()))[1]<0){var d=a.utils.vectors.distance(c(this.body.GetPosition()),
c(b.body.GetPosition()));j>d&&(g=b,j=d)}return!1},this);if(g){var d=c(this.body.GetLocalPoint(g.body.GetPosition())),h=this.body.GetAngle();d[0]<0?h+=a.utils.math.radians(-90/700*b):d[0]>0&&(h+=a.utils.math.radians(90/700*b));this.body.SetAngle(h);this.setSpeed(this.speed)}}};a.utils.objects.extend(y,M);var R=b.Bullet=function(a){a.width=0.3;a.height=0.8;R.superConstructor.apply(this,[a]);this.color="#FFD800";this.car.world.playSound("machinegun_shot.wav",this.position);this.onimpact=function(a){var b=
c(this.body.GetPosition());this.car.world.spawnAnimation("small_explosion",b);a.type=="car"?this.car.world.playSound("bullet_impact_metal.wav",b):a.type=="prop"&&this.car.world.playSound("bullet_impact_soft.wav",b)};this.draw=function(a){this.spent||a.drawCar("bullet.png",c(this.body.GetPosition()),degrees(this.body.GetAngle()))};this.destroy=function(){this.car.world.destroyObj(this.id)};return this};a.utils.objects.extend(R,h);b.PlasmaProjectile=function(a){a.width=0.6;a.height=2.5;a.sensor=!0;
R.superConstructor.apply(this,[a]);this.impact=function(a){if(a.type=="car"||a.type=="prop")if(a.type=="car"&&a.hit(this.damage,this.car),this.onimpact)this.onimpact(a)};this.onimpact=function(){this.car.world.spawnAnimation("small_explosion",c(this.body.GetPosition()))};this.draw=function(a){this.spent||a.drawCar("plasma_projectile.png",c(this.body.GetPosition()),degrees(this.body.GetAngle()))};this.destroy=function(){this.car.world.destroyObj(this.id)};return this};a.utils.objects.extend(R,h);h=
b.Weapon=function(a){this.car=a.car;this.weapon_id=a.weapon_id;this.ammo_capacity=a.ammo_capacity+a.ammo_upgrades*a.ammo_upgrade;this.fire_rate=a.fire_rate;this.ammo=this.cooldown=0;this.damage=a.damage+a.damage_upgrades*a.damage_upgrade;this.speed=a.speed;this.projectile=a.projectile;this.pars=a;this.update=function(a){this.cooldown>0&&(this.cooldown-=a)};this.reload=function(){this.ammo=this.ammo_capacity};this.getState=function(){return{a:this.ammo}};this.setState=function(a){this.ammo=a.a};this._fire=
function(){if(this.ammo&&this.cooldown<=0)this.fire(),this.ammo--,this.cooldown=this.fire_rate};this.fire=function(){this.car.world.event("create",{type:"weapon",obj_name:this.projectile,pars:{position:this.getFirePos(),damage:this.damage,speed:this.speed,angle:this.car.getAngle(),car:this.car.id}})};this.getFirePos=function(){return c(this.car.body.GetWorldPoint(t(0,-(this.car.height/2+3))))};return this};k=b.RepairKit=function(a){L.superConstructor.apply(this,[a]);this.type="repairkit";this.AI=
function(){if(this.car.health<=this.car.max_health/2)return!0;return!1};this._fire=function(){if(this.ammo&&this.cooldown<=0&&this.car.health<this.car.max_health)this.fire(),this.ammo--,this.cooldown=this.fire_rate};this.fire=function(){this.car.world.spawnAnimation("heal",c(this.car.body.GetPosition()),this.car);this.car.world.playSound("repair.wav",c(this.car.body.GetPosition()));this.car.hit(-this.damage,this.car)}};a.utils.objects.extend(k,h);var L=b.Machinegun=function(a){this.type="machinegun";
L.superConstructor.apply(this,[a]);this.ofst_x=-0.5;this.AI=B;this.getFirePos=function(){this.ofst_x*=-1;return c(this.car.body.GetWorldPoint(t(this.ofst_x,-(this.car.height/2+0.8))))};return this};a.utils.objects.extend(L,h);var C=b.PlasmaCannon=function(a){this.type="plasmacannon";C.superConstructor.apply(this,[a]);this.AI=B;this.fire=function(){var a=c(this.car.body.GetWorldPoint(t(-0.6,-(this.car.height/2+3))));this.car.world.event("create",{type:"weapon",obj_name:this.projectile,pars:{position:a,
damage:this.damage,speed:this.speed,angle:this.car.getAngle(),car:this.car.id}});this.ammo&&(a=c(this.car.body.GetWorldPoint(t(0.6,-(this.car.height/2+3)))),this.car.world.event("create",{type:"weapon",obj_name:this.projectile,pars:{position:a,damage:this.damage,speed:this.speed,angle:this.car.getAngle(),car:this.car.id}}),this.ammo--)};return this};a.utils.objects.extend(C,h);var G=b.NOS=function(a){G.superConstructor.apply(this,[a]);this.duration=a.duration;this.type="nos";this.AI=function(){if(this.car.getSpeedKMH()>
this.car.getMaxSpeed()-10)return!0;return!1};this.fire=function(){this.car.world.createBuff("EngineBuff",this.car,{duration:this.duration,value:this.damage})}};a.utils.objects.extend(G,h);var v=b.ShockwaveGenerator=function(a){v.superConstructor.apply(this,[a]);this.type="shockwave";this.AI=j;this.fire=function(){this.car.world.objects.car.forEach(function(a){if(a.id!=this.car.id){var b=c(this.car.body.GetPosition()),g=c(a.body.GetPosition());d.distance(b,g)<=12&&(a.hit(this.damage,this.car),this.car.world.createBuff("SlipDebuff",
a,{duration:500}),b=d.unit(d.substract(g,b)),b=d.multiply(b,400),a.body.ApplyImpulse(t(b),a.body.GetPosition()))}},this);this.car.world.playSound("shockwave.wav",c(this.car.body.GetPosition()));this.car.world.spawnAnimation("shockwave",c(this.car.body.GetPosition()),this.car)}};a.utils.objects.extend(v,h);var F=b.MineLauncher=function(a){this.type="minelauncher";F.superConstructor.apply(this,[a]);this.AI=z;this.getFirePos=function(){return c(this.car.body.GetWorldPoint(t(0,this.car.height/2+3)))};
return this};a.utils.objects.extend(F,h);k=b.MissileLauncher=function(a){this.type="missilelauncher";F.superConstructor.apply(this,[a]);this.AI=B;this.getFirePos=function(){return c(this.car.body.GetWorldPoint(t(0,-(this.car.height/2+3))))};return this};a.utils.objects.extend(k,h);var S=b.Oil=function(a){this.type="oil";S.superConstructor.apply(this,[a]);this.AI=z;this.getFirePos=function(){return c(this.car.body.GetWorldPoint(t(0,this.car.height/2+5)))};return this};a.utils.objects.extend(S,h);var j=
function(){var a,b;for(a=0;a<this.car.world.objects.car.length;a++)if(b=this.car.world.objects.car[a],b.id!=this.car.id&&(len=d.distance(c(this.car.body.GetPosition()),c(b.body.GetPosition())),len<=10))return!0;return!1},z=function(){var a,b;for(a=0;a<this.car.world.objects.car.length;a++)if(b=this.car.world.objects.car[a],b.id!=this.car.id&&(len=d.distance(c(this.car.body.GetPosition()),c(b.body.GetPosition())),angle=degrees(d.angle([0,1],c(this.car.body.GetLocalPoint(b.body.GetPosition())))),len<
20&&angle<15))return!0;return!1},B=function(){var a,b;for(a=0;a<this.car.world.objects.car.length;a++)if(b=this.car.world.objects.car[a],b.id!=this.car.id&&(len=d.distance(c(this.car.body.GetPosition()),c(b.body.GetPosition())),angle=degrees(d.angle([0,-1],c(this.car.body.GetLocalPoint(b.body.GetPosition())))),len<50&&angle<15))return!0;return!1}}},["gamejs","box2d","utils","sounds","buffs","weapon_descriptions","animation"]);
require.define({gamejs:function(q,b){function a(){var a=0,b=0,c=0,h=0;if(arguments.length===2)arguments[0]instanceof Array&&arguments[1]instanceof Array?(a=arguments[0][0],b=arguments[0][1],c=arguments[1][0],h=arguments[1][1]):(a=arguments[0],b=arguments[1]);else if(arguments.length===1&&arguments[0]instanceof Array)a=arguments[0][0],b=arguments[0][1],c=arguments[0][2],h=arguments[0][3];else if(arguments.length===1&&arguments[0]instanceof d)a=arguments[0].left,b=arguments[0].top,c=arguments[0].width,
h=arguments[0].height;else if(arguments.length===4)a=arguments[0],b=arguments[1],c=arguments[2],h=arguments[3];else throw Error("not a valid rectangle specification");return{left:a||0,top:b||0,width:c||0,height:h||0}}var l=q("./gamejs/utils/matrix"),o=q("./gamejs/utils/objects"),t=["info","warn","error","fatal"],c=2;b.setLogLevel=function(a){if(typeof a==="string"&&t.indexOf(a))c=t.indexOf(a);else if(typeof a==="number")c=a;else throw Error("invalid logLevel ",a," Must be one of: ",t);return c};var e=
b.log=function(){var a=Array.prototype.slice.apply(arguments,[0]);a.unshift(Date.now());window.console!==void 0&&console.log.apply&&console.log.apply(console,a)};b.info=function(){c<=t.indexOf("info")&&e.apply(this,arguments)};b.warn=function(){c<=t.indexOf("warn")&&e.apply(this,arguments)};b.error=function(){c<=t.indexOf("error")&&e.apply(this,arguments)};b.fatal=function(){c<=t.indexOf("fatal")&&e.apply(this,arguments)};var d=b.Rect=function(){var b=a.apply(this,arguments);this.left=b.left;this.top=
b.top;this.width=b.width;this.height=b.height;return this};o.accessors(d.prototype,{bottom:{get:function(){return this.top+this.height},set:function(a){this.top=a-this.height}},right:{get:function(){return this.left+this.width},set:function(a){this.left=a-this.width}},center:{get:function(){return[this.left+this.width/2,this.top+this.height/2]},set:function(){var b=a.apply(this,arguments);this.left=b.left-this.width/2;this.top=b.top-this.height/2}}});d.prototype.move=function(){var b=a.apply(this,
arguments);return new d(this.left+b.left,this.top+b.top,this.width,this.height)};d.prototype.moveIp=function(){var b=a.apply(this,arguments);this.left+=b.left;this.top+=b.top};d.prototype.clip=function(a){if(!this.collideRect(a))return new d(0,0,0,0);var b,c,h,e;if(this.left>=a.left&&this.left<a.right)b=this.left;else if(a.left>=this.left&&a.left<this.right)b=a.left;this.right>a.left&&this.right<=a.right?h=this.right-b:a.right>this.left&&a.right<=this.right&&(h=a.right-b);if(this.top>=a.top&&this.top<
a.bottom)c=this.top;else if(a.top>=this.top&&a.top<this.bottom)c=a.top;this.bottom>a.top&&this.bottom<=a.bottom?e=this.bottom-c:a.bottom>this.top&&a.bottom<=this.bottom&&(e=a.bottom-c);return new d(b,c,h,e)};d.prototype.union=function(a){var b,c;b=Math.min(this.left,a.left);c=Math.min(this.top,a.top);return new d(b,c,Math.max(this.right,a.right)-b,Math.max(this.bottom,a.bottom)-c)};d.prototype.collidePoint=function(){var b=a.apply(this,arguments);return this.left<=b.left&&b.left<=this.right&&this.top<=
b.top&&b.top<=this.bottom};d.prototype.collideRect=function(a){return!(this.left>a.right||this.right<a.left||this.top>a.bottom||this.bottom<a.top)};d.prototype.collideLine=function(a,b){var c=a[0],d=a[1],h=b[0],e=b[1],k=!0,n=!0,l=!0;[[this.left,this.top],[this.left,this.bottom],[this.right,this.top],[this.right,this.bottom]].map(function(a){return(e-d)*a[0]+(c-h)*a[1]+(h*d-c*e)}).forEach(function(a){a>0?n=!1:a<0?k=!1:a===0&&(l=!1)},this);if((k||n)&&l)return!1;return!(c>this.right&&h>this.right||c<
this.left&&h<this.left||d<this.top&&e<this.top||d>this.bottom&&e>this.bottom)};d.prototype.toString=function(){return["[",this.left,",",this.top,"] [",this.width,",",this.height,"]"].join("")};d.prototype.clone=function(){return new d(this)};var h=b.Surface=function(){var b=a.apply(this,arguments),c=b.left,h=b.top;if(arguments.length==1&&arguments[0]instanceof d)c=b.width,h=b.height;this._matrix=l.identity();this._canvas=document.createElement("canvas");this._canvas.width=c;this._canvas.height=h;
this._blitAlpha=1;return this};h.prototype.blit=function(a,b,c){if(b instanceof d){var b=b.clone(),h=a.getSize();if(!b.width)b.width=h[0];if(!b.height)b.height=h[1]}else b=b&&b instanceof Array&&b.length==2?new d(b,a.getSize()):new d([0,0],a.getSize());c=c instanceof d?c:c&&c instanceof Array&&c.length==2?new d(c,a.getSize()):new d([0,0],a.getSize());if(isNaN(b.left)||isNaN(b.top)||isNaN(b.width)||isNaN(b.height))throw Error("[blit] bad parameters, destination is "+b);this.context.save();h=l.translate(l.identity(),
b.left,b.top);h=l.multiply(h,a._matrix);this.context.transform(h[0],h[1],h[2],h[3],h[4],h[5]);srcRect=a.getRect();this.context.globalAlpha=a._blitAlpha;this.context.drawImage(a.canvas,c.left,c.top,c.width,c.height,0,0,b.width,b.height);this.context.restore()};h.prototype.getSize=function(){return[this.canvas.width,this.canvas.height]};h.prototype.getRect=function(){return new d([0,0],this.getSize())};h.prototype.fill=function(a){this.context.save();this.context.fillStyle=a||"#000000";this.context.fillRect(0,
0,this.canvas.width,this.canvas.height);this.context.restore()};h.prototype.clear=function(){var a=this.getSize();this.context.clearRect(0,0,a[0],a[1])};o.accessors(h.prototype,{rect:{get:function(){return this.getRect()}},context:{get:function(){return this._canvas.getContext("2d")}},canvas:{get:function(){return this._canvas}}});h.prototype.clone=function(){var a=new h(this.getRect());a.blit(this);return a};h.prototype.getAlpha=function(){return 1-this._blitAlpha};h.prototype.setAlpha=function(a){if(!isNaN(a)&&
!(a<0||a>1))return this._blitAlpha=1-a,1-this._blitAlpha};h.prototype.getImageData=function(){var a=this.getSize();return this.context.getImageData(0,0,a[0],a[1]).data};b.display=q("./gamejs/display");b.draw=q("./gamejs/draw");b.event=q("./gamejs/event");b.font=q("./gamejs/font");b.http=q("./gamejs/http");b.image=q("./gamejs/image");b.mask=q("./gamejs/mask");b.mixer=q("./gamejs/mixer");b.sprite=q("./gamejs/sprite");b.surfacearray=q("./gamejs/surfacearray");b.time=q("./gamejs/time");b.transform=q("./gamejs/transform");
b.utils={arrays:q("./gamejs/utils/arrays"),objects:q("./gamejs/utils/objects"),matrix:q("./gamejs/utils/matrix"),vectors:q("./gamejs/utils/vectors"),math:q("./gamejs/utils/math")};b.pathfinding={astar:q("./gamejs/pathfinding/astar")};var n=b,k={};b.ready=function(a){function b(){if(!document.body)return window.setTimeout(b,50);h=n.image.preload(k);try{d=n.mixer.preload(k)}catch(a){n.debug("Error loading audio files ",a)}window.setTimeout(c,50)}function c(){if(h()<1||d()<1)return window.setTimeout(c,
100);n.display.init();n.image.init();n.mixer.init();n.event.init();a()}var d=null,h=null;n.time.init();window.setTimeout(b,13);return function(){if(h)return 0.5*h()+0.5*d();return 0.1}};b.preload=function(a){var b=window.$g&&$g.resourceBaseHref||".";b.slice(-1)=="/"&&(b=b.slice(0,b.length-1));a.forEach(function(a){k[a]=(window.$g&&$g.resourceBaseHref||".")+("/"+a).replace(/\/+/g,"/")},this)}}},["gamejs/utils/matrix","gamejs/utils/objects","gamejs/display","gamejs/draw","gamejs/event","gamejs/font",
"gamejs/http","gamejs/image","gamejs/mask","gamejs/mixer","gamejs/sprite","gamejs/surfacearray","gamejs/time","gamejs/transform","gamejs/utils/arrays","gamejs/utils/vectors","gamejs/utils/math","gamejs/pathfinding/astar"]);
require.define({"settings-example":function(q,b){var a=b.settings={SCREEN_WIDTH:800,SCREEN_HEIGHT:600,FPS:60,PHYS_SCALE:10,STARTING_BALANCE:1E5,MAX_INDIVIDUAL_SOUND_CHANNELS:4,MAX_GLOBAL_SOUND_CHANNELS:8,STARTING_LEAGUE:0,SERVER:"ws://www.banditracer.eu:8000",DEBUG:!0,SOUND:!0};b.get=function(b){return a[b]};b.init=function(){for(var b in a)window.hasOwnProperty(b)&&(a[b]=window[b])};b.set=function(b,o){a[b]=o}}},[]);
require.define({buffs:function(q,b){var a=q("gamejs"),l=b.EFFECT_NO_GRIP="no_grip",o=b.EFFECT_ENGINE="engine",t=b.Buff=function(a){this.age=0;this.duration=a.duration?a.duration:null;this.effect=a.effect;this.value=a.value;this.car=a.car;this.car.buffs.push(this)};t.prototype.update=function(a){this.age+=a;this.age>this.duration&&this.car.world.destroyObj(this.id)};t.prototype.destroy=function(){for(var a=0;a<this.car.buffs.length;a++)if(this.car.buffs[a].id==this.id){this.car.buffs.splice(a,1);break}};
var c=b.EngineBuff=function(a){a.effect=o;c.superConstructor.apply(this,[a])};a.utils.objects.extend(c,t);var e=b.SlipDebuff=function(a){a.effect=l;e.superConstructor.apply(this,[a])};a.utils.objects.extend(e,t)}},["gamejs"]);
require.define({cars:function(q,b){var a=q("gamejs"),l=q("./box2d"),o=q("./utils");q("./sounds");var t=q("./buffs"),c=q("./car_descriptions"),e=o.vec,d=o.arr,h=a.utils.vectors,n=a.utils.math;radians=n.radians;degrees=n.degrees;q("./animation");var k=b.STEER_NONE=0,M=b.STEER_RIGHT=1,g=b.STEER_LEFT=2,y=b.ACC_NONE=0,R=b.ACC_ACCELERATE=1,L=b.ACC_BRAKE=2,C=b.Wheel=function(b){this.x=b.x;this.y=b.y;this.position=[b.x,b.y];this.angle=0;this.car=b.car;this.length=b.length;this.width=b.width;this.revolving=
revolving=b.revolving;this.k_velocity=this.joint=this.body=null;this.world=this.car.world;this.alive=!0;this.respawn_location=null;this.respawn_angle=0;this.powered=b.powered;this.filename=b.filename;this.type="wheel";this.prev_position=null;b=new l.b2BodyDef;b.type=l.b2Body.b2_dynamicBody;b.position=this.car.body.GetWorldPoint(e([this.position[0],this.position[1]]));b.angle=this.car.body.GetAngle();this.body=this.world.CreateBody(b);this.body.SetUserData(this);b=new l.b2FixtureDef;b.density=1;b.isSensor=
!0;b.shape=new l.b2PolygonShape;b.shape.SetAsBox(this.width/2,this.length/2);this.body.CreateFixture(b);this.revolving?(b=new l.b2RevoluteJointDef,b.Initialize(this.car.body,this.body,this.body.GetWorldCenter()),b.enableMotor=!1,b.referenceAngle=0):(b=new l.b2PrismaticJointDef,b.Initialize(this.car.body,this.body,this.body.GetWorldCenter(),e([1,0])),b.enableLimit=!0,b.lowerTranslation=b.upperTranslation=b.referenceAngle=0);this.world.b2world.CreateJoint(b);this.getLocalPosition=function(){return this.position};
this.resetAngle=function(){this.body.SetAngle(this.car.body.GetAngle())};this.setAngle=function(a){this.body.SetAngle(this.car.body.GetAngle()+radians(a))};this.getWorldPosition=function(){return d(this.car.body.GetWorldPoint(e(this.position)))};this.draw=function(b){b.drawCar(this.filename,d(this.car.body.GetWorldPoint(e([this.x,this.y]))),degrees(this.body.GetAngle()));if(this.prev_position&&a.utils.vectors.angle(d(this.body.GetLinearVelocity()),d(this.body.GetWorldVector(e([0,-1]))))>a.utils.math.radians(20)){var c=
this.car.world.phys_scale,g=this.prev_position,j=d(this.body.GetPosition()),h=[-this.width/2,0],k=[this.width/2,0],n=this.body.GetAngle(),h=a.utils.vectors.rotate(h,n),k=a.utils.vectors.rotate(k,n);a.draw.polygon(b.background,"#282828",[[(h[0]+g[0])*c,(h[1]+g[1])*c],[(h[0]+j[0])*c,(h[1]+j[1])*c],[(k[0]+j[0])*c,(k[1]+j[1])*c],[(k[0]+g[0])*c,(k[1]+g[1])*c]])}this.prev_position=d(this.body.GetPosition())};this.getLocalVelocity=function(){return d(this.car.body.GetLocalVector(this.car.body.GetLinearVelocityFromLocalPoint(e(this.position))))};
this.getDirectionVector=function(){return h.rotate(this.getLocalVelocity()[1]>0?[0,1]:[0,-1],this.body.GetAngle())};this.getSidewaysVector=function(){return d(this.body.GetWorldVector(e([-1,0])))};this.getKillVelocityVector=function(){var a=d(this.body.GetLinearVelocity()),b=this.getDirectionVector(),a=h.dot(a,b);return h.multiply(b,a)};this.killSidewaysVelocity=function(){var a=this.getKillVelocityVector();this.k_velocity=a;this.body.SetLinearVelocity(e(a))};this.die=function(){this.alive=!1;this.body.SetLinearVelocity(e(0,
0));this.prev_position=null};this.respawn=function(){this.alive=!0};this.teleport=function(a){this.body.SetPosition(e(a))};this.getAngle=function(){return degrees(this.body.GetAngle())};this.getLocalAngle=function(){var a=n.normaliseDegrees(n.degrees(this.body.GetAngle()-this.car.body.GetAngle()));a>180&&(a-=360);return a};return this};b.Car=function(a){this.angle=a.angle?a.angle:0;this.world=a.world;this.position=a.position;this.width=a.width;this.height=a.height;this.filename=a.filename;this.alias=
a.alias?a.alias:"";this.type="car";this.car_type=a.type;this.descr=c[this.car_type];this.next_buff_id=1;this.buffs=[];this.health=this.max_health=a.health+a.armor_upgrades*this.descr.armor_upgrade;this.active=this.alive=!0;this.next_checkpoint_no=1;this.time_to_respawn=this.lap=0;this.respawn_position=null;this.respawn_angle=0;this.respawn_time=2E3;this.deaths=this.kills=0;this.hits=[];this.front_weapon=a.front_weapon;this.rear_weapon=a.rear_weapon;this.util=a.util;if(this.front_weapon)this.front_weapon.car=
this;if(this.rear_weapon)this.rear_weapon.car=this;if(this.util)this.util.car=this;this.fire_util=this.fire_rear_weapon=this.fire_front_weapon=!1;this.accelerate=y;this.steer=k;this.max_steer_angle=a.max_steer_angle;this.power=a.power+a.acc_upgrades*this.descr.power_upgrade;this.max_speed=a.max_speed+a.speed_upgrades*this.descr.speed_upgrade;this.turn_msec=a.turn_msec?a.turn_msec:200;this.mod_speed=0;this.local_engine_pos=[0,-(a.height/2)];this.smoke_cd=this.cur_wheel_angle=0;var b=new l.b2BodyDef;
b.type=l.b2Body.b2_dynamicBody;b.position=e(a.position[0],a.position[1]);b.angle=radians(a.angle+1.0E-5);b.linearDamping=0.15;b.angularDamping=0.3;this.body=this.world.CreateBody(b);this.body.SetUserData(this);b=new l.b2FixtureDef;b.density=1;b.friction=0.3;b.restitution=0.4;b.shape=new l.b2PolygonShape;var n=this.width/2,q=this.height/2;b.shape.SetAsArray([e(n,q),e(-n,q),e(-n,-q),e(0,-q-0.5),e(n,-q)]);this.body.CreateFixture(b);this.wheels=[];var j;a.wheels.forEach(function(a){a.car=this;this.wheels.push(new C(a))},
this);this.impact=function(a){a.type=="car"&&this.world.playSound("thud.wav",d(this.body.GetPosition()))};this.getLocalVelocity=function(){return d(this.body.GetLocalVector(this.body.GetLinearVelocityFromLocalPoint(e([0,0]))))};this.crossFinishLine=function(){this.front_weapon&&this.front_weapon.reload();this.rear_weapon&&this.rear_weapon.reload();this.util&&this.util.reload()};this.getPower=function(){var a=this.power;this.buffs.forEach(function(b){b.effect==t.EFFECT_ENGINE&&(a+=b.value)},this);
return parseInt(a)};this.getMaxSpeed=function(){var a=this.max_speed;this.buffs.forEach(function(b){b.effect==t.EFFECT_ENGINE&&(a+=b.value)},this);return parseInt(a+this.mod_speed)};this.updateCheckpoint=function(){var a=this.world.checkpoints[this.next_checkpoint_no],b=this.body.GetPosition();if(b.x>=a.pt1[0]&&b.x<=a.pt2[0]&&b.y>=a.pt1[1]&&b.y<=a.pt2[1])this.next_checkpoint_no==1&&(this.lap++,this.crossFinishLine()),this.next_checkpoint_no==this.world.max_checkpoint?this.next_checkpoint_no=1:this.next_checkpoint_no++};
this.getRacePosition=function(){var a=this.world.objects.car.length,b,c;for(b=0;b<this.world.objects.car.length;b++)c=this.world.objects.car[b],c!==this&&(this.lap>c.lap?a--:this.lap==c.lap&&(this.next_checkpoint_no>c.next_checkpoint_no||this.next_checkpoint_no==1&&c.next_checkpoint_no!=1)?a--:this.lap==c.lap&&this.next_checkpoint_no==c.next_checkpoint_no&&h.distance(d(this.alive?this.body.GetPosition():this.respawn_location),this.world.checkpoints[this.next_checkpoint_no].center)<h.distance(d(c.alive?
c.body.GetPosition():c.respawn_location),this.world.checkpoints[c.next_checkpoint_no].center)&&a--);return a};this.getPoweredWheels=function(){var a=[];this.wheels.forEach(function(b){b.powered&&a.push(b)});return a};this.getRevolvingWheels=function(){var a=[];this.wheels.forEach(function(b){b.revolving&&a.push(b)});return a};this.getDirectionVector=function(){return h.rotate([0,-1],this.front_left_wheel.body.GetAngle())};this.getBackwardDirectionVector=function(){return h.rotate([0,1],this.back_left_wheel.body.GetAngle())};
this.getState=function(){var a={p:d(this.body.GetPosition()),a:degrees(this.body.GetAngle()),lv:d(this.body.GetLinearVelocity()),l:this.lap,nc:this.next_checkpoint_no,ac:this.active,h:this.health,al:this.alive,w:[],wf:this.front_weapon?this.front_weapon.getState():0,wr:this.rear_weapon?this.rear_weapon.getState():0,wu:this.util?this.util.getState():0};this.wheels.forEach(function(b){a.w.push(degrees(b.body.GetAngle()))});if(!this.alive)a.rl=this.respawn_location;return a};this.interpolate=function(a,
b,c){for(var g=[],j=0;j<a.w.length;j++)g[g.length]=o.interpolateInts(a.w[j],b.w[j],c);var b={p:o.interpolatePoints(a.p,b.p,c),a:o.interpolateInts(a.a,b.a,c),w:g},d;for(d in a)b.hasOwnProperty(d)||(b[d]=a[d]);return b};this.setState=function(a){this.health=a.h;this.alive=a.al;this.lap=a.l;this.active=a.ac;this.next_checkpoint_no=a.nc;this.body.SetPositionAndAngle(e(a.p),radians(a.a));this.body.SetLinearVelocity(e(a.lv));for(var b,c=0;c<this.wheels.length;c++)b=this.wheels[c],b.teleport(d(this.body.GetWorldPoint(e(b.position)))),
b.body.SetPositionAndAngle(b.body.GetPosition(),radians(a.w[c]));if(a.rl)this.respawn_location=a.rl;this.front_weapon&&a.wf&&this.front_weapon.setState(a.wf);this.rear_weapon&&a.wr&&this.rear_weapon.setState(a.wr);this.util&&a.wu&&this.util.setState(wu)};this.hasEffect=function(a){for(var b=0;b<this.buffs.length;b++)if(this.buffs[b].effect==a)return!0;return!1};this.clearBuffs=function(){this.buffs.forEach(function(a){this.world.destroyObj(a.id)},this)};this.getSpeedKMH=function(){var a=d(this.body.GetLinearVelocity());
return h.len(a)/1E3*3600};this.getAngle=function(){return degrees(this.body.GetAngle())};this.setSpeed=function(a){var b=d(this.body.GetLinearVelocity()),b=e(h.multiply(h.unit(b),a*1E3/3600));this.body.SetLinearVelocity(b)};this.draw=function(a){if(this.alive&&this.active){this.wheels.forEach(function(b){b.draw(a)});var b=d(this.body.GetPosition());a.drawCar(this.filename,b,this.getAngle());this.alias&&this.world.mode==1&&a.drawText(this.alias,"alias",a.getScreenPoint([b[0]-this.width,b[1]-this.height]))}};
this.teleport=function(a,b){b=b?radians(b):this.body.GetAngle();this.body.SetPositionAndAngle(e(a),b);this.wheels.forEach(function(a){a.teleport(d(this.body.GetWorldPoint(e(a.position))))},this)};this.die=function(){this.alive=!1;this.deaths+=1;this.time_to_respawn=this.respawn_time;this.respawn_location=d(this.body.GetPosition());this.world.spawnAnimation("explosion",d(this.body.GetPosition()));this.world.playSound("explosion.wav",d(this.body.GetPosition()));this.respawn_angle=degrees(this.body.GetAngle());
this.teleport([0,0]);this.body.SetLinearVelocity(e(0,0));this.wheels.forEach(function(a){a.die()});this.clearBuffs()};this.respawn=function(){this.alive=!0;this.wheels.forEach(function(a){a.respawn()});this.teleport(this.respawn_location,this.respawn_angle);this.health=this.max_health};this.kill=function(){this.kills+=1};this.hit=function(a,b){this.hits.push({damage:a,owner:b})};this.processHits=function(){this.hits.forEach(function(a){if(this.alive)this.health=Math.min(this.health-a.damage,this.max_health),
this.health<=0&&(this.die(),a.owner&&a.owner.kill(this))},this);this.hits=[]};this.update=function(a){this.active&&(this.alive?(this.processHits(),this.alive&&this.updateAlive(a)):(this.time_to_respawn-=a,this.time_to_respawn<=0&&this.respawn()))};this.updateAlive=function(a){this.updateCheckpoint();var b=this.steer,c=this.accelerate,k=this.getSpeedKMH(),n=d(this.body.GetLocalVector(this.body.GetLinearVelocity())),l=this.getMaxSpeed(),l=n[1]>0?0.5*l:l;this.hasEffect(t.EFFECT_NO_GRIP)||this.wheels.forEach(function(a){a.killSidewaysVelocity()});
n=this.max_steer_angle;k<100&&(n+=(40-n)*(1-k/100));var o=this.max_steer_angle/this.turn_msec*a,q=this.getRevolvingWheels();for(j=0;j<q.length;j++)wheel=q[j],b==M?(this.cur_wheel_angle=Math.min(Math.max(this.cur_wheel_angle,0)+o,n),wheel.setAngle(this.cur_wheel_angle)):b==g?(this.cur_wheel_angle=Math.max(Math.min(this.cur_wheel_angle,0)-o,-n),wheel.setAngle(this.cur_wheel_angle)):(this.cur_wheel_angle=0,wheel.resetAngle());var b=c==R&&k<l?[0,-1]:c==L?this.getLocalVelocity()[1]<0?[0,1.2]:[0,0.7]:[0,
0],v=h.multiply(b,this.getPower());this.getPoweredWheels().forEach(function(a){var b=a.body.GetWorldCenter();a.body.ApplyForce(a.body.GetWorldVector(e(v)),b)});this.getSpeedKMH()<4&&c==y&&this.setSpeed(0);this.front_weapon&&(this.front_weapon.update(a),this.fire_front_weapon&&this.front_weapon._fire());this.rear_weapon&&(this.rear_weapon.update(a),this.fire_rear_weapon&&this.rear_weapon._fire());this.util&&(this.util.update(a),this.fire_util&&this.util._fire());this.health<=40?this.smoke_cd<=0?(this.world.spawnAnimation("smoke",
d(this.body.GetWorldPoint(e(0,-1.5)))),this.smoke_cd=100):this.smoke_cd-=a:this.smoke_cd=0};return this};b.carEventFromDescription=function(a,b,c,g,j){return{type:"car",obj_name:c.type,pars:{position:a,angle:b,alias:g,handling_upgrades:c.handling_upgrades?c.handling_upgrades:0,engine_sound:j,acc_upgrades:c.acc_upgrades,speed_upgrades:c.speed_upgrades,armor_upgrades:c.armor_upgrades,front_weapon:c.front_weapon?o.copy(c.front_weapon,{}):null,util:c.util?o.copy(c.util,{}):null,rear_weapon:c.rear_weapon?
o.copy(c.rear_weapon,{}):null}}}}},["gamejs","box2d","utils","sounds","buffs","car_descriptions","animation"]);
require.define({box2d:function(q,b){var a={};(function(a,b){function d(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function)Object.defineProperty=function(a,b,c){c.get instanceof Function&&a.__defineGetter__(b,c.get);c.set instanceof Function&&a.__defineSetter__(b,c.set)};a.inherit=function(a,b){d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a};a.generateCallback=
function(a,b){return function(){b.apply(a,arguments)}};a.NVector=function(a){a===b&&(a=0);for(var c=Array(a||0),d=0;d<a;++d)c[d]=0;return c};a.is=function(a,c){if(a===null)return!1;if(c instanceof Function&&a instanceof c)return!0;if(a.constructor.__implements!=b&&a.constructor.__implements[c])return!0;return!1};a.parseUInt=function(a){return Math.abs(parseInt(a))}})(a);var l=Array,o=a.NVector;typeof a==="undefined"&&(a={});if(typeof a.Collision==="undefined")a.Collision={};if(typeof a.Collision.Shapes===
"undefined")a.Collision.Shapes={};if(typeof a.Common==="undefined")a.Common={};if(typeof a.Common.Math==="undefined")a.Common.Math={};if(typeof a.Dynamics==="undefined")a.Dynamics={};if(typeof a.Dynamics.Contacts==="undefined")a.Dynamics.Contacts={};if(typeof a.Dynamics.Controllers==="undefined")a.Dynamics.Controllers={};if(typeof a.Dynamics.Joints==="undefined")a.Dynamics.Joints={};(function(){function b(){b.b2AABB.apply(this,arguments)}function e(){e.b2Bound.apply(this,arguments)}function d(){d.b2BoundValues.apply(this,
arguments);this.constructor===d&&this.b2BoundValues.apply(this,arguments)}function h(){h.b2Collision.apply(this,arguments)}function n(){n.b2ContactID.apply(this,arguments);this.constructor===n&&this.b2ContactID.apply(this,arguments)}function k(){k.b2ContactPoint.apply(this,arguments)}function l(){l.b2Distance.apply(this,arguments)}function g(){g.b2DistanceInput.apply(this,arguments)}function y(){y.b2DistanceOutput.apply(this,arguments)}function o(){o.b2DistanceProxy.apply(this,arguments)}function q(){q.b2DynamicTree.apply(this,
arguments);this.constructor===q&&this.b2DynamicTree.apply(this,arguments)}function t(){t.b2DynamicTreeBroadPhase.apply(this,arguments)}function G(){G.b2DynamicTreeNode.apply(this,arguments)}function v(){v.b2DynamicTreePair.apply(this,arguments)}function F(){F.b2Manifold.apply(this,arguments);this.constructor===F&&this.b2Manifold.apply(this,arguments)}function S(){S.b2ManifoldPoint.apply(this,arguments);this.constructor===S&&this.b2ManifoldPoint.apply(this,arguments)}function j(){j.b2Point.apply(this,
arguments)}function z(){z.b2RayCastInput.apply(this,arguments);this.constructor===z&&this.b2RayCastInput.apply(this,arguments)}function B(){B.b2RayCastOutput.apply(this,arguments)}function Q(){Q.b2Segment.apply(this,arguments)}function u(){u.b2SeparationFunction.apply(this,arguments)}function K(){K.b2Simplex.apply(this,arguments);this.constructor===K&&this.b2Simplex.apply(this,arguments)}function D(){D.b2SimplexCache.apply(this,arguments)}function T(){T.b2SimplexVertex.apply(this,arguments)}function I(){I.b2TimeOfImpact.apply(this,
arguments)}function J(){J.b2TOIInput.apply(this,arguments)}function U(){U.b2WorldManifold.apply(this,arguments);this.constructor===U&&this.b2WorldManifold.apply(this,arguments)}function P(){P.ClipVertex.apply(this,arguments)}function r(){r.Features.apply(this,arguments)}function p(){p.b2CircleShape.apply(this,arguments);this.constructor===p&&this.b2CircleShape.apply(this,arguments)}function A(){A.b2EdgeChainDef.apply(this,arguments);this.constructor===A&&this.b2EdgeChainDef.apply(this,arguments)}
function w(){w.b2EdgeShape.apply(this,arguments);this.constructor===w&&this.b2EdgeShape.apply(this,arguments)}function O(){O.b2MassData.apply(this,arguments)}function V(){V.b2PolygonShape.apply(this,arguments);this.constructor===V&&this.b2PolygonShape.apply(this,arguments)}function H(){H.b2Shape.apply(this,arguments);this.constructor===H&&this.b2Shape.apply(this,arguments)}function f(){f.b2Color.apply(this,arguments);this.constructor===f&&this.b2Color.apply(this,arguments)}function m(){m.b2Settings.apply(this,
arguments)}function E(){E.b2Mat22.apply(this,arguments);this.constructor===E&&this.b2Mat22.apply(this,arguments)}function N(){N.b2Mat33.apply(this,arguments);this.constructor===N&&this.b2Mat33.apply(this,arguments)}function W(){W.b2Math.apply(this,arguments)}function Ia(){Ia.b2Sweep.apply(this,arguments)}function X(){X.b2Transform.apply(this,arguments);this.constructor===X&&this.b2Transform.apply(this,arguments)}function Y(){Y.b2Vec2.apply(this,arguments);this.constructor===Y&&this.b2Vec2.apply(this,
arguments)}function Z(){Z.b2Vec3.apply(this,arguments);this.constructor===Z&&this.b2Vec3.apply(this,arguments)}function aa(){aa.b2Body.apply(this,arguments);this.constructor===aa&&this.b2Body.apply(this,arguments)}function ba(){ba.b2BodyDef.apply(this,arguments);this.constructor===ba&&this.b2BodyDef.apply(this,arguments)}function Ja(){Ja.b2ContactFilter.apply(this,arguments)}function Ka(){Ka.b2ContactImpulse.apply(this,arguments)}function La(){La.b2ContactListener.apply(this,arguments)}function ca(){ca.b2ContactManager.apply(this,
arguments);this.constructor===ca&&this.b2ContactManager.apply(this,arguments)}function da(){da.b2DebugDraw.apply(this,arguments);this.constructor===da&&this.b2DebugDraw.apply(this,arguments)}function Ma(){Ma.b2DestructionListener.apply(this,arguments)}function Na(){Na.b2FilterData.apply(this,arguments)}function ea(){ea.b2Fixture.apply(this,arguments);this.constructor===ea&&this.b2Fixture.apply(this,arguments)}function fa(){fa.b2FixtureDef.apply(this,arguments);this.constructor===fa&&this.b2FixtureDef.apply(this,
arguments)}function ga(){ga.b2Island.apply(this,arguments);this.constructor===ga&&this.b2Island.apply(this,arguments)}function Oa(){Oa.b2TimeStep.apply(this,arguments)}function ha(){ha.b2World.apply(this,arguments);this.constructor===ha&&this.b2World.apply(this,arguments)}function Pa(){Pa.b2CircleContact.apply(this,arguments)}function ia(){ia.b2Contact.apply(this,arguments);this.constructor===ia&&this.b2Contact.apply(this,arguments)}function ja(){ja.b2ContactConstraint.apply(this,arguments);this.constructor===
ja&&this.b2ContactConstraint.apply(this,arguments)}function Qa(){Qa.b2ContactConstraintPoint.apply(this,arguments)}function Ra(){Ra.b2ContactEdge.apply(this,arguments)}function ka(){ka.b2ContactFactory.apply(this,arguments);this.constructor===ka&&this.b2ContactFactory.apply(this,arguments)}function Sa(){Sa.b2ContactRegister.apply(this,arguments)}function Ta(){Ta.b2ContactResult.apply(this,arguments)}function la(){la.b2ContactSolver.apply(this,arguments);this.constructor===la&&this.b2ContactSolver.apply(this,
arguments)}function Ua(){Ua.b2EdgeAndCircleContact.apply(this,arguments)}function ma(){ma.b2NullContact.apply(this,arguments);this.constructor===ma&&this.b2NullContact.apply(this,arguments)}function Va(){Va.b2PolyAndCircleContact.apply(this,arguments)}function Wa(){Wa.b2PolyAndEdgeContact.apply(this,arguments)}function Xa(){Xa.b2PolygonContact.apply(this,arguments)}function na(){na.b2PositionSolverManifold.apply(this,arguments);this.constructor===na&&this.b2PositionSolverManifold.apply(this,arguments)}
function Ya(){Ya.b2BuoyancyController.apply(this,arguments)}function Za(){Za.b2ConstantAccelController.apply(this,arguments)}function $a(){$a.b2ConstantForceController.apply(this,arguments)}function ab(){ab.b2Controller.apply(this,arguments)}function bb(){bb.b2ControllerEdge.apply(this,arguments)}function cb(){cb.b2GravityController.apply(this,arguments)}function db(){db.b2TensorDampingController.apply(this,arguments)}function oa(){oa.b2DistanceJoint.apply(this,arguments);this.constructor===oa&&this.b2DistanceJoint.apply(this,
arguments)}function pa(){pa.b2DistanceJointDef.apply(this,arguments);this.constructor===pa&&this.b2DistanceJointDef.apply(this,arguments)}function qa(){qa.b2FrictionJoint.apply(this,arguments);this.constructor===qa&&this.b2FrictionJoint.apply(this,arguments)}function ra(){ra.b2FrictionJointDef.apply(this,arguments);this.constructor===ra&&this.b2FrictionJointDef.apply(this,arguments)}function sa(){sa.b2GearJoint.apply(this,arguments);this.constructor===sa&&this.b2GearJoint.apply(this,arguments)}function ta(){ta.b2GearJointDef.apply(this,
arguments);this.constructor===ta&&this.b2GearJointDef.apply(this,arguments)}function eb(){eb.b2Jacobian.apply(this,arguments)}function ua(){ua.b2Joint.apply(this,arguments);this.constructor===ua&&this.b2Joint.apply(this,arguments)}function va(){va.b2JointDef.apply(this,arguments);this.constructor===va&&this.b2JointDef.apply(this,arguments)}function fb(){fb.b2JointEdge.apply(this,arguments)}function wa(){wa.b2LineJoint.apply(this,arguments);this.constructor===wa&&this.b2LineJoint.apply(this,arguments)}
function xa(){xa.b2LineJointDef.apply(this,arguments);this.constructor===xa&&this.b2LineJointDef.apply(this,arguments)}function ya(){ya.b2MouseJoint.apply(this,arguments);this.constructor===ya&&this.b2MouseJoint.apply(this,arguments)}function za(){za.b2MouseJointDef.apply(this,arguments);this.constructor===za&&this.b2MouseJointDef.apply(this,arguments)}function Aa(){Aa.b2PrismaticJoint.apply(this,arguments);this.constructor===Aa&&this.b2PrismaticJoint.apply(this,arguments)}function Ba(){Ba.b2PrismaticJointDef.apply(this,
arguments);this.constructor===Ba&&this.b2PrismaticJointDef.apply(this,arguments)}function Ca(){Ca.b2PulleyJoint.apply(this,arguments);this.constructor===Ca&&this.b2PulleyJoint.apply(this,arguments)}function Da(){Da.b2PulleyJointDef.apply(this,arguments);this.constructor===Da&&this.b2PulleyJointDef.apply(this,arguments)}function Ea(){Ea.b2RevoluteJoint.apply(this,arguments);this.constructor===Ea&&this.b2RevoluteJoint.apply(this,arguments)}function Fa(){Fa.b2RevoluteJointDef.apply(this,arguments);this.constructor===
Fa&&this.b2RevoluteJointDef.apply(this,arguments)}function Ga(){Ga.b2WeldJoint.apply(this,arguments);this.constructor===Ga&&this.b2WeldJoint.apply(this,arguments)}function Ha(){Ha.b2WeldJointDef.apply(this,arguments);this.constructor===Ha&&this.b2WeldJointDef.apply(this,arguments)}a.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";a.Collision.b2AABB=b;a.Collision.b2Bound=e;a.Collision.b2BoundValues=d;a.Collision.b2Collision=h;a.Collision.b2ContactID=n;a.Collision.b2ContactPoint=k;a.Collision.b2Distance=
l;a.Collision.b2DistanceInput=g;a.Collision.b2DistanceOutput=y;a.Collision.b2DistanceProxy=o;a.Collision.b2DynamicTree=q;a.Collision.b2DynamicTreeBroadPhase=t;a.Collision.b2DynamicTreeNode=G;a.Collision.b2DynamicTreePair=v;a.Collision.b2Manifold=F;a.Collision.b2ManifoldPoint=S;a.Collision.b2Point=j;a.Collision.b2RayCastInput=z;a.Collision.b2RayCastOutput=B;a.Collision.b2Segment=Q;a.Collision.b2SeparationFunction=u;a.Collision.b2Simplex=K;a.Collision.b2SimplexCache=D;a.Collision.b2SimplexVertex=T;
a.Collision.b2TimeOfImpact=I;a.Collision.b2TOIInput=J;a.Collision.b2WorldManifold=U;a.Collision.ClipVertex=P;a.Collision.Features=r;a.Collision.Shapes.b2CircleShape=p;a.Collision.Shapes.b2EdgeChainDef=A;a.Collision.Shapes.b2EdgeShape=w;a.Collision.Shapes.b2MassData=O;a.Collision.Shapes.b2PolygonShape=V;a.Collision.Shapes.b2Shape=H;a.Common.b2internal="Box2D.Common.b2internal";a.Common.b2Color=f;a.Common.b2Settings=m;a.Common.Math.b2Mat22=E;a.Common.Math.b2Mat33=N;a.Common.Math.b2Math=W;a.Common.Math.b2Sweep=
Ia;a.Common.Math.b2Transform=X;a.Common.Math.b2Vec2=Y;a.Common.Math.b2Vec3=Z;a.Dynamics.b2Body=aa;a.Dynamics.b2BodyDef=ba;a.Dynamics.b2ContactFilter=Ja;a.Dynamics.b2ContactImpulse=Ka;a.Dynamics.b2ContactListener=La;a.Dynamics.b2ContactManager=ca;a.Dynamics.b2DebugDraw=da;a.Dynamics.b2DestructionListener=Ma;a.Dynamics.b2FilterData=Na;a.Dynamics.b2Fixture=ea;a.Dynamics.b2FixtureDef=fa;a.Dynamics.b2Island=ga;a.Dynamics.b2TimeStep=Oa;a.Dynamics.b2World=ha;a.Dynamics.Contacts.b2CircleContact=Pa;a.Dynamics.Contacts.b2Contact=
ia;a.Dynamics.Contacts.b2ContactConstraint=ja;a.Dynamics.Contacts.b2ContactConstraintPoint=Qa;a.Dynamics.Contacts.b2ContactEdge=Ra;a.Dynamics.Contacts.b2ContactFactory=ka;a.Dynamics.Contacts.b2ContactRegister=Sa;a.Dynamics.Contacts.b2ContactResult=Ta;a.Dynamics.Contacts.b2ContactSolver=la;a.Dynamics.Contacts.b2EdgeAndCircleContact=Ua;a.Dynamics.Contacts.b2NullContact=ma;a.Dynamics.Contacts.b2PolyAndCircleContact=Va;a.Dynamics.Contacts.b2PolyAndEdgeContact=Wa;a.Dynamics.Contacts.b2PolygonContact=Xa;
a.Dynamics.Contacts.b2PositionSolverManifold=na;a.Dynamics.Controllers.b2BuoyancyController=Ya;a.Dynamics.Controllers.b2ConstantAccelController=Za;a.Dynamics.Controllers.b2ConstantForceController=$a;a.Dynamics.Controllers.b2Controller=ab;a.Dynamics.Controllers.b2ControllerEdge=bb;a.Dynamics.Controllers.b2GravityController=cb;a.Dynamics.Controllers.b2TensorDampingController=db;a.Dynamics.Joints.b2DistanceJoint=oa;a.Dynamics.Joints.b2DistanceJointDef=pa;a.Dynamics.Joints.b2FrictionJoint=qa;a.Dynamics.Joints.b2FrictionJointDef=
ra;a.Dynamics.Joints.b2GearJoint=sa;a.Dynamics.Joints.b2GearJointDef=ta;a.Dynamics.Joints.b2Jacobian=eb;a.Dynamics.Joints.b2Joint=ua;a.Dynamics.Joints.b2JointDef=va;a.Dynamics.Joints.b2JointEdge=fb;a.Dynamics.Joints.b2LineJoint=wa;a.Dynamics.Joints.b2LineJointDef=xa;a.Dynamics.Joints.b2MouseJoint=ya;a.Dynamics.Joints.b2MouseJointDef=za;a.Dynamics.Joints.b2PrismaticJoint=Aa;a.Dynamics.Joints.b2PrismaticJointDef=Ba;a.Dynamics.Joints.b2PulleyJoint=Ca;a.Dynamics.Joints.b2PulleyJointDef=Da;a.Dynamics.Joints.b2RevoluteJoint=
Ea;a.Dynamics.Joints.b2RevoluteJointDef=Fa;a.Dynamics.Joints.b2WeldJoint=Ga;a.Dynamics.Joints.b2WeldJointDef=Ha})();a.postDefs=[];(function(){var b=a.Collision.Shapes.b2CircleShape,e=a.Collision.Shapes.b2PolygonShape,d=a.Collision.Shapes.b2Shape,h=a.Common.b2Settings,n=a.Common.Math.b2Math,k=a.Common.Math.b2Sweep,q=a.Common.Math.b2Transform,g=a.Common.Math.b2Vec2,y=a.Collision.b2AABB,t=a.Collision.b2Bound,L=a.Collision.b2BoundValues,C=a.Collision.b2Collision,G=a.Collision.b2ContactID,v=a.Collision.b2ContactPoint,
F=a.Collision.b2Distance,S=a.Collision.b2DistanceInput,j=a.Collision.b2DistanceOutput,z=a.Collision.b2DistanceProxy,B=a.Collision.b2DynamicTree,Q=a.Collision.b2DynamicTreeBroadPhase,u=a.Collision.b2DynamicTreeNode,K=a.Collision.b2DynamicTreePair,D=a.Collision.b2Manifold,T=a.Collision.b2ManifoldPoint,I=a.Collision.b2Point,J=a.Collision.b2RayCastInput,U=a.Collision.b2RayCastOutput,P=a.Collision.b2Segment,r=a.Collision.b2SeparationFunction,p=a.Collision.b2Simplex,A=a.Collision.b2SimplexCache,w=a.Collision.b2SimplexVertex,
O=a.Collision.b2TimeOfImpact,V=a.Collision.b2TOIInput,H=a.Collision.b2WorldManifold,f=a.Collision.ClipVertex,m=a.Collision.Features,E=a.Collision.IBroadPhase;y.b2AABB=function(){this.lowerBound=new g;this.upperBound=new g};y.prototype.IsValid=function(){var a=this.upperBound.y-this.lowerBound.y;return a=(a=this.upperBound.x-this.lowerBound.x>=0&&a>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};y.prototype.GetCenter=function(){return new g((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+
this.upperBound.y)/2)};y.prototype.GetExtents=function(){return new g((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};y.prototype.Contains=function(a){var f;return f=(f=(f=(f=this.lowerBound.x<=a.lowerBound.x)&&this.lowerBound.y<=a.lowerBound.y)&&a.upperBound.x<=this.upperBound.x)&&a.upperBound.y<=this.upperBound.y};y.prototype.RayCast=function(a,f){var b=-Number.MAX_VALUE,m=Number.MAX_VALUE,c=f.p1.x,r=f.p1.y,g=f.p2.x-f.p1.x,j=f.p2.y-f.p1.y,d=Math.abs(j),h=a.normal,
p=0,w=0,E=p=0,E=0;if(Math.abs(g)<Number.MIN_VALUE){if(c<this.lowerBound.x||this.upperBound.x<c)return!1}else{p=1/g;w=(this.lowerBound.x-c)*p;p*=this.upperBound.x-c;E=-1;w>p&&(E=w,w=p,p=E,E=1);if(w>b)h.x=E,h.y=0,b=w;m=Math.min(m,p);if(b>m)return!1}if(d<Number.MIN_VALUE){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else{p=1/j;w=(this.lowerBound.y-r)*p;p*=this.upperBound.y-r;E=-1;w>p&&(E=w,w=p,p=E,E=1);if(w>b)h.y=E,h.x=0,b=w;m=Math.min(m,p);if(b>m)return!1}a.fraction=b;return!0};y.prototype.TestOverlap=
function(a){var f=a.lowerBound.y-this.upperBound.y,b=this.lowerBound.y-a.upperBound.y;if(a.lowerBound.x-this.upperBound.x>0||f>0)return!1;if(this.lowerBound.x-a.upperBound.x>0||b>0)return!1;return!0};y.Combine=function(a,f){var b=new y;b.Combine(a,f);return b};y.prototype.Combine=function(a,f){this.lowerBound.x=Math.min(a.lowerBound.x,f.lowerBound.x);this.lowerBound.y=Math.min(a.lowerBound.y,f.lowerBound.y);this.upperBound.x=Math.max(a.upperBound.x,f.upperBound.x);this.upperBound.y=Math.max(a.upperBound.y,
f.upperBound.y)};t.b2Bound=function(){};t.prototype.IsLower=function(){return(this.value&1)==0};t.prototype.IsUpper=function(){return(this.value&1)==1};t.prototype.Swap=function(a){var f=this.value,b=this.proxy,m=this.stabbingCount;this.value=a.value;this.proxy=a.proxy;this.stabbingCount=a.stabbingCount;a.value=f;a.proxy=b;a.stabbingCount=m};L.b2BoundValues=function(){};L.prototype.b2BoundValues=function(){this.lowerValues=new o;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=new o;this.upperValues[0]=
0;this.upperValues[1]=0};C.b2Collision=function(){};C.ClipSegmentToLine=function(a,f,b,m){m===void 0&&(m=0);var c,r=0;c=f[0];var g=c.v;c=f[1];var j=c.v,d=b.x*g.x+b.y*g.y-m;c=b.x*j.x+b.y*j.y-m;d<=0&&a[r++].Set(f[0]);c<=0&&a[r++].Set(f[1]);if(d*c<0)b=d/(d-c),c=a[r],c=c.v,c.x=g.x+b*(j.x-g.x),c.y=g.y+b*(j.y-g.y),c=a[r],c.id=(d>0?f[0]:f[1]).id,++r;return r};C.EdgeSeparation=function(a,f,b,m,c){b===void 0&&(b=0);parseInt(a.m_vertexCount);var r=a.m_vertices,a=a.m_normals,g=parseInt(m.m_vertexCount),j=m.m_vertices,
d,p;d=f.R;p=a[b];a=d.col1.x*p.x+d.col2.x*p.y;m=d.col1.y*p.x+d.col2.y*p.y;d=c.R;var h=d.col1.x*a+d.col1.y*m;d=d.col2.x*a+d.col2.y*m;for(var w=0,E=Number.MAX_VALUE,e=0;e<g;++e)p=j[e],p=p.x*h+p.y*d,p<E&&(E=p,w=e);p=r[b];d=f.R;b=f.position.x+(d.col1.x*p.x+d.col2.x*p.y);f=f.position.y+(d.col1.y*p.x+d.col2.y*p.y);p=j[w];d=c.R;r=c.position.x+(d.col1.x*p.x+d.col2.x*p.y);c=c.position.y+(d.col1.y*p.x+d.col2.y*p.y);r-=b;c-=f;return r*a+c*m};C.FindMaxSeparation=function(a,f,b,m,c){var r=parseInt(f.m_vertexCount),
g=f.m_normals,j,d;d=c.R;j=m.m_centroid;var p=c.position.x+(d.col1.x*j.x+d.col2.x*j.y),h=c.position.y+(d.col1.y*j.x+d.col2.y*j.y);d=b.R;j=f.m_centroid;p-=b.position.x+(d.col1.x*j.x+d.col2.x*j.y);h-=b.position.y+(d.col1.y*j.x+d.col2.y*j.y);d=p*b.R.col1.x+h*b.R.col1.y;for(var h=p*b.R.col2.x+h*b.R.col2.y,p=0,w=-Number.MAX_VALUE,E=0;E<r;++E)j=g[E],j=j.x*d+j.y*h,j>w&&(w=j,p=E);g=C.EdgeSeparation(f,b,p,m,c);j=parseInt(p-1>=0?p-1:r-1);d=C.EdgeSeparation(f,b,j,m,c);var h=parseInt(p+1<r?p+1:0),w=C.EdgeSeparation(f,
b,h,m,c),e=E=0,A=0;if(d>g&&d>w)A=-1,E=j,e=d;else if(w>g)A=1,E=h,e=w;else return a[0]=p,g;for(;;)if(p=A==-1?E-1>=0?E-1:r-1:E+1<r?E+1:0,g=C.EdgeSeparation(f,b,p,m,c),g>e)E=p,e=g;else break;a[0]=E;return e};C.FindIncidentEdge=function(a,f,b,m,c,r){m===void 0&&(m=0);parseInt(f.m_vertexCount);var j=f.m_normals,g=parseInt(c.m_vertexCount),f=c.m_vertices,c=c.m_normals,d;d=b.R;var b=j[m],j=d.col1.x*b.x+d.col2.x*b.y,p=d.col1.y*b.x+d.col2.y*b.y;d=r.R;b=d.col1.x*j+d.col1.y*p;p=d.col2.x*j+d.col2.y*p;j=b;d=0;
for(var h=Number.MAX_VALUE,w=0;w<g;++w)b=c[w],b=j*b.x+p*b.y,b<h&&(h=b,d=w);c=parseInt(d);j=parseInt(c+1<g?c+1:0);g=a[0];b=f[c];d=r.R;g.v.x=r.position.x+(d.col1.x*b.x+d.col2.x*b.y);g.v.y=r.position.y+(d.col1.y*b.x+d.col2.y*b.y);g.id.features.referenceEdge=m;g.id.features.incidentEdge=c;g.id.features.incidentVertex=0;g=a[1];b=f[j];d=r.R;g.v.x=r.position.x+(d.col1.x*b.x+d.col2.x*b.y);g.v.y=r.position.y+(d.col1.y*b.x+d.col2.y*b.y);g.id.features.referenceEdge=m;g.id.features.incidentEdge=j;g.id.features.incidentVertex=
1};C.MakeClipPointVector=function(){var a=new l(2);a[0]=new f;a[1]=new f;return a};C.CollidePolygons=function(a,f,b,m,c){var r;a.m_pointCount=0;var g=f.m_radius+m.m_radius;C.s_edgeAO[0]=0;var j=C.FindMaxSeparation(C.s_edgeAO,f,b,m,c);r=C.s_edgeAO[0];if(!(j>g)){var d;C.s_edgeBO[0]=0;var p=C.FindMaxSeparation(C.s_edgeBO,m,c,f,b);d=C.s_edgeBO[0];if(!(p>g)){var w=0,E=0;p>0.98*j+0.0010?(j=m,m=f,f=c,w=d,a.m_type=D.e_faceB,E=1):(j=f,f=b,b=c,w=r,a.m_type=D.e_faceA,E=0);r=C.s_incidentEdge;C.FindIncidentEdge(r,
j,f,w,m,b);d=parseInt(j.m_vertexCount);var c=j.m_vertices,j=c[w],e;e=w+1<d?c[parseInt(w+1)]:c[0];w=C.s_localTangent;w.Set(e.x-j.x,e.y-j.y);w.Normalize();c=C.s_localNormal;c.x=w.y;c.y=-w.x;m=C.s_planePoint;m.Set(0.5*(j.x+e.x),0.5*(j.y+e.y));p=C.s_tangent;d=f.R;p.x=d.col1.x*w.x+d.col2.x*w.y;p.y=d.col1.y*w.x+d.col2.y*w.y;var A=C.s_tangent2;A.x=-p.x;A.y=-p.y;w=C.s_normal;w.x=p.y;w.y=-p.x;var H=C.s_v11,k=C.s_v12;H.x=f.position.x+(d.col1.x*j.x+d.col2.x*j.y);H.y=f.position.y+(d.col1.y*j.x+d.col2.y*j.y);
k.x=f.position.x+(d.col1.x*e.x+d.col2.x*e.y);k.y=f.position.y+(d.col1.y*e.x+d.col2.y*e.y);f=w.x*H.x+w.y*H.y;d=p.x*k.x+p.y*k.y+g;e=C.s_clipPoints1;j=C.s_clipPoints2;k=0;k=C.ClipSegmentToLine(e,r,A,-p.x*H.x-p.y*H.y+g);if(!(k<2)&&(k=C.ClipSegmentToLine(j,e,p,d),!(k<2))){a.m_localPlaneNormal.SetV(c);a.m_localPoint.SetV(m);for(m=c=0;m<h.b2_maxManifoldPoints;++m)if(r=j[m],w.x*r.v.x+w.y*r.v.y-f<=g)p=a.m_points[c],d=b.R,A=r.v.x-b.position.x,H=r.v.y-b.position.y,p.m_localPoint.x=A*d.col1.x+H*d.col1.y,p.m_localPoint.y=
A*d.col2.x+H*d.col2.y,p.m_id.Set(r.id),p.m_id.features.flip=E,++c;a.m_pointCount=c}}}};C.CollideCircles=function(a,f,b,m,c){a.m_pointCount=0;var r,j;r=b.R;j=f.m_p;var g=b.position.x+(r.col1.x*j.x+r.col2.x*j.y),b=b.position.y+(r.col1.y*j.x+r.col2.y*j.y);r=c.R;j=m.m_p;g=c.position.x+(r.col1.x*j.x+r.col2.x*j.y)-g;c=c.position.y+(r.col1.y*j.x+r.col2.y*j.y)-b;r=f.m_radius+m.m_radius;if(!(g*g+c*c>r*r))a.m_type=D.e_circles,a.m_localPoint.SetV(f.m_p),a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(m.m_p),
a.m_points[0].m_id.key=0};C.CollidePolygonAndCircle=function(a,f,b,m,c){var r=a.m_pointCount=0,j=0,g,d;d=c.R;g=m.m_p;var p=c.position.y+(d.col1.y*g.x+d.col2.y*g.y),r=c.position.x+(d.col1.x*g.x+d.col2.x*g.y)-b.position.x,j=p-b.position.y;d=b.R;b=r*d.col1.x+j*d.col1.y;d=r*d.col2.x+j*d.col2.y;for(var w=0,p=-Number.MAX_VALUE,c=f.m_radius+m.m_radius,h=parseInt(f.m_vertexCount),E=f.m_vertices,f=f.m_normals,e=0;e<h;++e){g=E[e];r=b-g.x;j=d-g.y;g=f[e];r=g.x*r+g.y*j;if(r>c)return;r>p&&(p=r,w=e)}r=parseInt(w);
j=parseInt(r+1<h?r+1:0);g=E[r];E=E[j];if(p<Number.MIN_VALUE)a.m_pointCount=1,a.m_type=D.e_faceA,a.m_localPlaneNormal.SetV(f[w]),a.m_localPoint.x=0.5*(g.x+E.x),a.m_localPoint.y=0.5*(g.y+E.y);else if(p=(b-E.x)*(g.x-E.x)+(d-E.y)*(g.y-E.y),(b-g.x)*(E.x-g.x)+(d-g.y)*(E.y-g.y)<=0){if((b-g.x)*(b-g.x)+(d-g.y)*(d-g.y)>c*c)return;a.m_pointCount=1;a.m_type=D.e_faceA;a.m_localPlaneNormal.x=b-g.x;a.m_localPlaneNormal.y=d-g.y;a.m_localPlaneNormal.Normalize();a.m_localPoint.SetV(g)}else if(p<=0){if((b-E.x)*(b-E.x)+
(d-E.y)*(d-E.y)>c*c)return;a.m_pointCount=1;a.m_type=D.e_faceA;a.m_localPlaneNormal.x=b-E.x;a.m_localPlaneNormal.y=d-E.y;a.m_localPlaneNormal.Normalize();a.m_localPoint.SetV(E)}else{w=0.5*(g.x+E.x);g=0.5*(g.y+E.y);p=(b-w)*f[r].x+(d-g)*f[r].y;if(p>c)return;a.m_pointCount=1;a.m_type=D.e_faceA;a.m_localPlaneNormal.x=f[r].x;a.m_localPlaneNormal.y=f[r].y;a.m_localPlaneNormal.Normalize();a.m_localPoint.Set(w,g)}a.m_points[0].m_localPoint.SetV(m.m_p);a.m_points[0].m_id.key=0};C.TestOverlap=function(a,f){var b=
f.lowerBound,c=a.upperBound,m=b.x-c.x,r=b.y-c.y,b=a.lowerBound,c=f.upperBound,g=b.y-c.y;if(m>0||r>0)return!1;if(b.x-c.x>0||g>0)return!1;return!0};a.postDefs.push(function(){a.Collision.b2Collision.s_incidentEdge=C.MakeClipPointVector();a.Collision.b2Collision.s_clipPoints1=C.MakeClipPointVector();a.Collision.b2Collision.s_clipPoints2=C.MakeClipPointVector();a.Collision.b2Collision.s_edgeAO=new o(1);a.Collision.b2Collision.s_edgeBO=new o(1);a.Collision.b2Collision.s_localTangent=new g;a.Collision.b2Collision.s_localNormal=
new g;a.Collision.b2Collision.s_planePoint=new g;a.Collision.b2Collision.s_normal=new g;a.Collision.b2Collision.s_tangent=new g;a.Collision.b2Collision.s_tangent2=new g;a.Collision.b2Collision.s_v11=new g;a.Collision.b2Collision.s_v12=new g;a.Collision.b2Collision.b2CollidePolyTempVec=new g;a.Collision.b2Collision.b2_nullFeature=255});G.b2ContactID=function(){this.features=new m};G.prototype.b2ContactID=function(){this.features._m_id=this};G.prototype.Set=function(a){this.key=a._key};G.prototype.Copy=
function(){var a=new G;a.key=this.key;return a};Object.defineProperty(G.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(G.prototype,"key",{enumerable:!1,configurable:!0,set:function(a){a===void 0&&(a=0);this._key=a;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});v.b2ContactPoint=function(){this.position=
new g;this.velocity=new g;this.normal=new g;this.id=new G};F.b2Distance=function(){};F.Distance=function(a,f,b){++F.b2_gjkCalls;var c=b.proxyA,m=b.proxyB,r=b.transformA,j=b.transformB,d=F.s_simplex;d.ReadCache(f,c,r,m,j);var p=d.m_vertices,w=F.s_saveA,E=F.s_saveB,e=0;d.GetClosestPoint().LengthSquared();for(var A=0,H,k=0;k<20;){e=d.m_count;for(A=0;A<e;A++)w[A]=p[A].indexA,E[A]=p[A].indexB;switch(d.m_count){case 1:break;case 2:d.Solve2();break;case 3:d.Solve3();break;default:h.b2Assert(!1)}if(d.m_count==
3)break;H=d.GetClosestPoint();H.LengthSquared();A=d.GetSearchDirection();if(A.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;H=p[d.m_count];H.indexA=c.GetSupport(n.MulTMV(r.R,A.GetNegative()));H.wA=n.MulX(r,c.GetVertex(H.indexA));H.indexB=m.GetSupport(n.MulTMV(j.R,A));H.wB=n.MulX(j,m.GetVertex(H.indexB));H.w=n.SubtractVV(H.wB,H.wA);++k;++F.b2_gjkIters;for(var O=!1,A=0;A<e;A++)if(H.indexA==w[A]&&H.indexB==E[A]){O=!0;break}if(O)break;++d.m_count}F.b2_gjkMaxIters=n.Max(F.b2_gjkMaxIters,k);d.GetWitnessPoints(a.pointA,
a.pointB);a.distance=n.SubtractVV(a.pointA,a.pointB).Length();a.iterations=k;d.WriteCache(f);if(b.useRadii)f=c.m_radius,m=m.m_radius,a.distance>f+m&&a.distance>Number.MIN_VALUE?(a.distance-=f+m,b=n.SubtractVV(a.pointB,a.pointA),b.Normalize(),a.pointA.x+=f*b.x,a.pointA.y+=f*b.y,a.pointB.x-=m*b.x,a.pointB.y-=m*b.y):(H=new g,H.x=0.5*(a.pointA.x+a.pointB.x),H.y=0.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=H.x,a.pointA.y=a.pointB.y=H.y,a.distance=0)};a.postDefs.push(function(){a.Collision.b2Distance.s_simplex=
new p;a.Collision.b2Distance.s_saveA=new o(3);a.Collision.b2Distance.s_saveB=new o(3)});S.b2DistanceInput=function(){};j.b2DistanceOutput=function(){this.pointA=new g;this.pointB=new g};z.b2DistanceProxy=function(){};z.prototype.Set=function(a){switch(a.GetType()){case d.e_circleShape:a=a instanceof b?a:null;this.m_vertices=new l(1,!0);this.m_vertices[0]=a.m_p;this.m_count=1;this.m_radius=a.m_radius;break;case d.e_polygonShape:a=a instanceof e?a:null;this.m_vertices=a.m_vertices;this.m_count=a.m_vertexCount;
this.m_radius=a.m_radius;break;default:h.b2Assert(!1)}};z.prototype.GetSupport=function(a){for(var f=0,b=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,c=1;c<this.m_count;++c){var m=this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;m>b&&(f=c,b=m)}return f};z.prototype.GetSupportVertex=function(a){for(var f=0,b=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,c=1;c<this.m_count;++c){var m=this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;m>b&&(f=c,b=m)}return this.m_vertices[f]};z.prototype.GetVertexCount=
function(){return this.m_count};z.prototype.GetVertex=function(a){a===void 0&&(a=0);h.b2Assert(0<=a&&a<this.m_count);return this.m_vertices[a]};B.b2DynamicTree=function(){};B.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=0};B.prototype.CreateProxy=function(a,f){var b=this.AllocateNode(),c=h.b2_aabbExtension,m=h.b2_aabbExtension;b.aabb.lowerBound.x=a.lowerBound.x-c;b.aabb.lowerBound.y=a.lowerBound.y-m;b.aabb.upperBound.x=a.upperBound.x+c;b.aabb.upperBound.y=
a.upperBound.y+m;b.userData=f;this.InsertLeaf(b);return b};B.prototype.DestroyProxy=function(a){this.RemoveLeaf(a);this.FreeNode(a)};B.prototype.MoveProxy=function(a,f,b){h.b2Assert(a.IsLeaf());if(a.aabb.Contains(f))return!1;this.RemoveLeaf(a);var c=h.b2_aabbExtension+h.b2_aabbMultiplier*(b.x>0?b.x:-b.x),b=h.b2_aabbExtension+h.b2_aabbMultiplier*(b.y>0?b.y:-b.y);a.aabb.lowerBound.x=f.lowerBound.x-c;a.aabb.lowerBound.y=f.lowerBound.y-b;a.aabb.upperBound.x=f.upperBound.x+c;a.aabb.upperBound.y=f.upperBound.y+
b;this.InsertLeaf(a);return!0};B.prototype.Rebalance=function(a){a===void 0&&(a=0);if(this.m_root!=null)for(var f=0;f<a;f++){for(var b=this.m_root,c=0;b.IsLeaf()==!1;)b=this.m_path>>c&1?b.child2:b.child1,c=c+1&31;++this.m_path;this.RemoveLeaf(b);this.InsertLeaf(b)}};B.prototype.GetFatAABB=function(a){return a.aabb};B.prototype.GetUserData=function(a){return a.userData};B.prototype.Query=function(a,f){if(this.m_root!=null){var b=new l,c=0;for(b[c++]=this.m_root;c>0;){var m=b[--c];if(m.aabb.TestOverlap(f))if(m.IsLeaf()){if(!a(m))break}else b[c++]=
m.child1,b[c++]=m.child2}}};B.prototype.RayCast=function(a,f){if(this.m_root!=null){var b=f.p1,c=f.p2,m=n.SubtractVV(b,c);m.Normalize();var m=n.CrossFV(1,m),r=n.AbsV(m),g=f.maxFraction,j=new y,d=0,p=0,d=b.x+g*(c.x-b.x),p=b.y+g*(c.y-b.y);j.lowerBound.x=Math.min(b.x,d);j.lowerBound.y=Math.min(b.y,p);j.upperBound.x=Math.max(b.x,d);j.upperBound.y=Math.max(b.y,p);var w=new l,E=0;for(w[E++]=this.m_root;E>0;)if(g=w[--E],g.aabb.TestOverlap(j)!=!1&&(d=g.aabb.GetCenter(),p=g.aabb.GetExtents(),!(Math.abs(m.x*
(b.x-d.x)+m.y*(b.y-d.y))-r.x*p.x-r.y*p.y>0)))if(g.IsLeaf()){d=new J;d.p1=f.p1;d.p2=f.p2;d.maxFraction=f.maxFraction;g=a(d,g);if(g==0)break;if(g>0)d=b.x+g*(c.x-b.x),p=b.y+g*(c.y-b.y),j.lowerBound.x=Math.min(b.x,d),j.lowerBound.y=Math.min(b.y,p),j.upperBound.x=Math.max(b.x,d),j.upperBound.y=Math.max(b.y,p)}else w[E++]=g.child1,w[E++]=g.child2}};B.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;this.m_freeList=a.parent;a.parent=null;a.child1=null;a.child2=null;return a}return new u};
B.prototype.FreeNode=function(a){a.parent=this.m_freeList;this.m_freeList=a};B.prototype.InsertLeaf=function(a){++this.m_insertionCount;if(this.m_root==null)this.m_root=a,this.m_root.parent=null;else{var f=a.aabb.GetCenter(),b=this.m_root;if(b.IsLeaf()==!1){do var c=b.child1,b=b.child2,b=Math.abs((c.aabb.lowerBound.x+c.aabb.upperBound.x)/2-f.x)+Math.abs((c.aabb.lowerBound.y+c.aabb.upperBound.y)/2-f.y)<Math.abs((b.aabb.lowerBound.x+b.aabb.upperBound.x)/2-f.x)+Math.abs((b.aabb.lowerBound.y+b.aabb.upperBound.y)/
2-f.y)?c:b;while(b.IsLeaf()==!1)}f=b.parent;c=this.AllocateNode();c.parent=f;c.userData=null;c.aabb.Combine(a.aabb,b.aabb);if(f){b.parent.child1==b?f.child1=c:f.child2=c;c.child1=b;c.child2=a;b.parent=c;a.parent=c;do{if(f.aabb.Contains(c.aabb))break;f.aabb.Combine(f.child1.aabb,f.child2.aabb);c=f;f=f.parent}while(f)}else c.child1=b,c.child2=a,b.parent=c,this.m_root=a.parent=c}};B.prototype.RemoveLeaf=function(a){if(a==this.m_root)this.m_root=null;else{var f=a.parent,b=f.parent,a=f.child1==a?f.child2:
f.child1;if(b){b.child1==f?b.child1=a:b.child2=a;a.parent=b;for(this.FreeNode(f);b;){f=b.aabb;b.aabb=y.Combine(b.child1.aabb,b.child2.aabb);if(f.Contains(b.aabb))break;b=b.parent}}else this.m_root=a,a.parent=null,this.FreeNode(f)}};Q.b2DynamicTreeBroadPhase=function(){this.m_tree=new B;this.m_moveBuffer=new l;this.m_pairBuffer=new l;this.m_pairCount=0};Q.prototype.CreateProxy=function(a,b){var f=this.m_tree.CreateProxy(a,b);++this.m_proxyCount;this.BufferMove(f);return f};Q.prototype.DestroyProxy=
function(a){this.UnBufferMove(a);--this.m_proxyCount;this.m_tree.DestroyProxy(a)};Q.prototype.MoveProxy=function(a,b,f){this.m_tree.MoveProxy(a,b,f)&&this.BufferMove(a)};Q.prototype.TestOverlap=function(a,b){var f=this.m_tree.GetFatAABB(a),c=this.m_tree.GetFatAABB(b);return f.TestOverlap(c)};Q.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)};Q.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)};Q.prototype.GetProxyCount=function(){return this.m_proxyCount};Q.prototype.UpdatePairs=
function(a){for(var b=this,f=b.m_pairCount=0,c,f=0;f<b.m_moveBuffer.length;++f){c=b.m_moveBuffer[f];var m=b.m_tree.GetFatAABB(c);b.m_tree.Query(function(a){if(a==c)return!0;b.m_pairCount==b.m_pairBuffer.length&&(b.m_pairBuffer[b.m_pairCount]=new K);var f=b.m_pairBuffer[b.m_pairCount];f.proxyA=a<c?a:c;f.proxyB=a>=c?a:c;++b.m_pairCount;return!0},m)}for(f=b.m_moveBuffer.length=0;f<b.m_pairCount;){var m=b.m_pairBuffer[f],r=b.m_tree.GetUserData(m.proxyA),g=b.m_tree.GetUserData(m.proxyB);a(r,g);for(++f;f<
b.m_pairCount;){r=b.m_pairBuffer[f];if(r.proxyA!=m.proxyA||r.proxyB!=m.proxyB)break;++f}}};Q.prototype.Query=function(a,b){this.m_tree.Query(a,b)};Q.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,b)};Q.prototype.Validate=function(){};Q.prototype.Rebalance=function(a){a===void 0&&(a=0);this.m_tree.Rebalance(a)};Q.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a};Q.prototype.UnBufferMove=function(a){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(a)),
1)};Q.prototype.ComparePairs=function(){return 0};Q.__implements={};Q.__implements[E]=!0;u.b2DynamicTreeNode=function(){this.aabb=new y};u.prototype.IsLeaf=function(){return this.child1==null};K.b2DynamicTreePair=function(){};D.b2Manifold=function(){this.m_pointCount=0};D.prototype.b2Manifold=function(){this.m_points=new l(h.b2_maxManifoldPoints);for(var a=0;a<h.b2_maxManifoldPoints;a++)this.m_points[a]=new T;this.m_localPlaneNormal=new g;this.m_localPoint=new g};D.prototype.Reset=function(){for(var a=
0;a<h.b2_maxManifoldPoints;a++)(this.m_points[a]instanceof T?this.m_points[a]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};D.prototype.Set=function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<h.b2_maxManifoldPoints;b++)(this.m_points[b]instanceof T?this.m_points[b]:null).Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal);this.m_localPoint.SetV(a.m_localPoint);this.m_type=a.m_type};D.prototype.Copy=function(){var a=
new D;a.Set(this);return a};a.postDefs.push(function(){a.Collision.b2Manifold.e_circles=1;a.Collision.b2Manifold.e_faceA=2;a.Collision.b2Manifold.e_faceB=4});T.b2ManifoldPoint=function(){this.m_localPoint=new g;this.m_id=new G};T.prototype.b2ManifoldPoint=function(){this.Reset()};T.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};T.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint);this.m_normalImpulse=a.m_normalImpulse;
this.m_tangentImpulse=a.m_tangentImpulse;this.m_id.Set(a.m_id)};I.b2Point=function(){this.p=new g};I.prototype.Support=function(){return this.p};I.prototype.GetFirstVertex=function(){return this.p};J.b2RayCastInput=function(){this.p1=new g;this.p2=new g};J.prototype.b2RayCastInput=function(a,b,f){a===void 0&&(a=null);b===void 0&&(b=null);f===void 0&&(f=1);a&&this.p1.SetV(a);b&&this.p2.SetV(b);this.maxFraction=f};U.b2RayCastOutput=function(){this.normal=new g};P.b2Segment=function(){this.p1=new g;
this.p2=new g};P.prototype.TestSegment=function(a,b,f,c){c===void 0&&(c=0);var m=f.p1,r=f.p2.x-m.x,g=f.p2.y-m.y,f=this.p2.y-this.p1.y,j=-(this.p2.x-this.p1.x),d=100*Number.MIN_VALUE,p=-(r*f+g*j);if(p>d){var w=m.x-this.p1.x,E=m.y-this.p1.y,m=w*f+E*j;if(0<=m&&m<=c*p&&(c=-r*E+g*w,-d*p<=c&&c<=p*(1+d)))return m/=p,c=Math.sqrt(f*f+j*j),f/=c,j/=c,a[0]=m,b.Set(f,j),!0}return!1};P.prototype.Extend=function(a){this.ExtendForward(a);this.ExtendBackward(a)};P.prototype.ExtendForward=function(a){var b=this.p2.x-
this.p1.x,f=this.p2.y-this.p1.y,a=Math.min(b>0?(a.upperBound.x-this.p1.x)/b:b<0?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,f>0?(a.upperBound.y-this.p1.y)/f:f<0?(a.lowerBound.y-this.p1.y)/f:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+b*a;this.p2.y=this.p1.y+f*a};P.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,f=-this.p2.y+this.p1.y,a=Math.min(b>0?(a.upperBound.x-this.p2.x)/b:b<0?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,f>0?(a.upperBound.y-this.p2.y)/f:f<
0?(a.lowerBound.y-this.p2.y)/f:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+b*a;this.p1.y=this.p2.y+f*a};r.b2SeparationFunction=function(){this.m_localPoint=new g;this.m_axis=new g};r.prototype.Initialize=function(a,b,f,c,m){this.m_proxyA=b;this.m_proxyB=c;var j=parseInt(a.count);h.b2Assert(0<j&&j<3);var d,p,w,E,e=E=w=c=b=0,A=0,e=0;j==1?(this.m_type=r.e_points,d=this.m_proxyA.GetVertex(a.indexA[0]),p=this.m_proxyB.GetVertex(a.indexB[0]),j=d,a=f.R,b=f.position.x+(a.col1.x*j.x+a.col2.x*j.y),c=f.position.y+
(a.col1.y*j.x+a.col2.y*j.y),j=p,a=m.R,w=m.position.x+(a.col1.x*j.x+a.col2.x*j.y),E=m.position.y+(a.col1.y*j.x+a.col2.y*j.y),this.m_axis.x=w-b,this.m_axis.y=E-c,this.m_axis.Normalize()):(a.indexB[0]==a.indexB[1]?(this.m_type=r.e_faceA,b=this.m_proxyA.GetVertex(a.indexA[0]),c=this.m_proxyA.GetVertex(a.indexA[1]),p=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=0.5*(b.x+c.x),this.m_localPoint.y=0.5*(b.y+c.y),this.m_axis=n.CrossVF(n.SubtractVV(c,b),1),this.m_axis.Normalize(),j=this.m_axis,a=
f.R,e=a.col1.x*j.x+a.col2.x*j.y,A=a.col1.y*j.x+a.col2.y*j.y,j=this.m_localPoint,a=f.R,b=f.position.x+(a.col1.x*j.x+a.col2.x*j.y),c=f.position.y+(a.col1.y*j.x+a.col2.y*j.y),j=p,a=m.R,w=m.position.x+(a.col1.x*j.x+a.col2.x*j.y),E=m.position.y+(a.col1.y*j.x+a.col2.y*j.y),e=(w-b)*e+(E-c)*A):a.indexA[0]==a.indexA[0]?(this.m_type=r.e_faceB,w=this.m_proxyB.GetVertex(a.indexB[0]),E=this.m_proxyB.GetVertex(a.indexB[1]),d=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=0.5*(w.x+E.x),this.m_localPoint.y=
0.5*(w.y+E.y),this.m_axis=n.CrossVF(n.SubtractVV(E,w),1),this.m_axis.Normalize(),j=this.m_axis,a=m.R,e=a.col1.x*j.x+a.col2.x*j.y,A=a.col1.y*j.x+a.col2.y*j.y,j=this.m_localPoint,a=m.R,w=m.position.x+(a.col1.x*j.x+a.col2.x*j.y),E=m.position.y+(a.col1.y*j.x+a.col2.y*j.y),j=d,a=f.R,b=f.position.x+(a.col1.x*j.x+a.col2.x*j.y),c=f.position.y+(a.col1.y*j.x+a.col2.y*j.y),e=(b-w)*e+(c-E)*A):(b=this.m_proxyA.GetVertex(a.indexA[0]),c=this.m_proxyA.GetVertex(a.indexA[1]),w=this.m_proxyB.GetVertex(a.indexB[0]),
E=this.m_proxyB.GetVertex(a.indexB[1]),n.MulX(f,d),d=n.MulMV(f.R,n.SubtractVV(c,b)),n.MulX(m,p),e=n.MulMV(m.R,n.SubtractVV(E,w)),m=d.x*d.x+d.y*d.y,p=e.x*e.x+e.y*e.y,a=n.SubtractVV(e,d),f=d.x*a.x+d.y*a.y,a=e.x*a.x+e.y*a.y,d=d.x*e.x+d.y*e.y,A=m*p-d*d,e=0,A!=0&&(e=n.Clamp((d*a-f*p)/A,0,1)),(d*e+a)/p<0&&(e=n.Clamp((d-f)/m,0,1)),d=new g,d.x=b.x+e*(c.x-b.x),d.y=b.y+e*(c.y-b.y),p=new g,p.x=w.x+e*(E.x-w.x),p.y=w.y+e*(E.y-w.y),e==0||e==1?(this.m_type=r.e_faceB,this.m_axis=n.CrossVF(n.SubtractVV(E,w),1),this.m_axis.Normalize(),
this.m_localPoint=p):(this.m_type=r.e_faceA,this.m_axis=n.CrossVF(n.SubtractVV(c,b),1),this.m_localPoint=d)),e<0&&this.m_axis.NegativeSelf())};r.prototype.Evaluate=function(a,b){var f,c,m=0;switch(this.m_type){case r.e_points:return f=n.MulTMV(a.R,this.m_axis),c=n.MulTMV(b.R,this.m_axis.GetNegative()),f=this.m_proxyA.GetSupportVertex(f),c=this.m_proxyB.GetSupportVertex(c),f=n.MulX(a,f),c=n.MulX(b,c),m=(c.x-f.x)*this.m_axis.x+(c.y-f.y)*this.m_axis.y;case r.e_faceA:return m=n.MulMV(a.R,this.m_axis),
f=n.MulX(a,this.m_localPoint),c=n.MulTMV(b.R,m.GetNegative()),c=this.m_proxyB.GetSupportVertex(c),c=n.MulX(b,c),m=(c.x-f.x)*m.x+(c.y-f.y)*m.y;case r.e_faceB:return m=n.MulMV(b.R,this.m_axis),c=n.MulX(b,this.m_localPoint),f=n.MulTMV(a.R,m.GetNegative()),f=this.m_proxyA.GetSupportVertex(f),f=n.MulX(a,f),m=(f.x-c.x)*m.x+(f.y-c.y)*m.y;default:return h.b2Assert(!1),0}};a.postDefs.push(function(){a.Collision.b2SeparationFunction.e_points=1;a.Collision.b2SeparationFunction.e_faceA=2;a.Collision.b2SeparationFunction.e_faceB=
4});p.b2Simplex=function(){this.m_v1=new w;this.m_v2=new w;this.m_v3=new w;this.m_vertices=new l(3)};p.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};p.prototype.ReadCache=function(a,b,f,c,m){h.b2Assert(0<=a.count&&a.count<=3);var r,j;this.m_count=a.count;for(var d=this.m_vertices,g=0;g<this.m_count;g++){var p=d[g];p.indexA=a.indexA[g];p.indexB=a.indexB[g];r=b.GetVertex(p.indexA);j=c.GetVertex(p.indexB);p.wA=n.MulX(f,r);p.wB=
n.MulX(m,j);p.w=n.SubtractVV(p.wB,p.wA);p.a=0}if(this.m_count>1&&(a=a.metric,r=this.GetMetric(),r<0.5*a||2*a<r||r<Number.MIN_VALUE))this.m_count=0;if(this.m_count==0)p=d[0],p.indexA=0,p.indexB=0,r=b.GetVertex(0),j=c.GetVertex(0),p.wA=n.MulX(f,r),p.wB=n.MulX(m,j),p.w=n.SubtractVV(p.wB,p.wA),this.m_count=1};p.prototype.WriteCache=function(b){b.metric=this.GetMetric();b.count=a.parseUInt(this.m_count);for(var f=this.m_vertices,c=0;c<this.m_count;c++)b.indexA[c]=a.parseUInt(f[c].indexA),b.indexB[c]=a.parseUInt(f[c].indexB)};
p.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=n.SubtractVV(this.m_v2.w,this.m_v1.w);return n.CrossVV(a,this.m_v1.w.GetNegative())>0?n.CrossFV(1,a):n.CrossVF(a,1);default:return h.b2Assert(!1),new g}};p.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return h.b2Assert(!1),new g;case 1:return this.m_v1.w;case 2:return new g(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*
this.m_v2.w.y);default:return h.b2Assert(!1),new g}};p.prototype.GetWitnessPoints=function(a,b){switch(this.m_count){case 0:h.b2Assert(!1);break;case 1:a.SetV(this.m_v1.wA);b.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x;a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+
this.m_v3.a*this.m_v3.wA.x;b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:h.b2Assert(!1)}};p.prototype.GetMetric=function(){switch(this.m_count){case 0:return h.b2Assert(!1),0;case 1:return 0;case 2:return n.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return n.CrossVV(n.SubtractVV(this.m_v2.w,this.m_v1.w),n.SubtractVV(this.m_v3.w,this.m_v1.w));default:return h.b2Assert(!1),0}};p.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,
f=n.SubtractVV(b,a),a=-(a.x*f.x+a.y*f.y);a<=0?this.m_count=this.m_v1.a=1:(b=b.x*f.x+b.y*f.y,b<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(f=1/(b+a),this.m_v1.a=b*f,this.m_v2.a=a*f,this.m_count=2))};p.prototype.Solve3=function(){var a=this.m_v1.w,b=this.m_v2.w,f=this.m_v3.w,c=n.SubtractVV(b,a),m=n.Dot(a,c),r=n.Dot(b,c),m=-m,j=n.SubtractVV(f,a),g=n.Dot(a,j),d=n.Dot(f,j),g=-g,p=n.SubtractVV(f,b),w=n.Dot(b,p),p=n.Dot(f,p),w=-w,j=n.CrossVV(c,j),c=j*n.CrossVV(b,f),f=j*n.CrossVV(f,a),a=j*n.CrossVV(a,
b);m<=0&&g<=0?this.m_count=this.m_v1.a=1:r>0&&m>0&&a<=0?(d=1/(r+m),this.m_v1.a=r*d,this.m_v2.a=m*d,this.m_count=2):d>0&&g>0&&f<=0?(r=1/(d+g),this.m_v1.a=d*r,this.m_v3.a=g*r,this.m_count=2,this.m_v2.Set(this.m_v3)):r<=0&&w<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):d<=0&&p<=0?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):p>0&&w>0&&c<=0?(r=1/(p+w),this.m_v2.a=p*r,this.m_v3.a=w*r,this.m_count=2,this.m_v1.Set(this.m_v3)):(r=1/(c+f+a),this.m_v1.a=c*r,this.m_v2.a=f*r,this.m_v3.a=a*
r,this.m_count=3)};A.b2SimplexCache=function(){this.indexA=new o(3);this.indexB=new o(3)};w.b2SimplexVertex=function(){};w.prototype.Set=function(a){this.wA.SetV(a.wA);this.wB.SetV(a.wB);this.w.SetV(a.w);this.a=a.a;this.indexA=a.indexA;this.indexB=a.indexB};O.b2TimeOfImpact=function(){};O.TimeOfImpact=function(a){++O.b2_toiCalls;var b=a.proxyA,f=a.proxyB,c=a.sweepA,m=a.sweepB;h.b2Assert(c.t0==m.t0);h.b2Assert(1-c.t0>Number.MIN_VALUE);var r=b.m_radius+f.m_radius,a=a.tolerance,j=0,g=0,d=0;O.s_cache.count=
0;for(O.s_distanceInput.useRadii=!1;;){c.GetTransform(O.s_xfA,j);m.GetTransform(O.s_xfB,j);O.s_distanceInput.proxyA=b;O.s_distanceInput.proxyB=f;O.s_distanceInput.transformA=O.s_xfA;O.s_distanceInput.transformB=O.s_xfB;F.Distance(O.s_distanceOutput,O.s_cache,O.s_distanceInput);if(O.s_distanceOutput.distance<=0){j=1;break}O.s_fcn.Initialize(O.s_cache,b,O.s_xfA,f,O.s_xfB);var p=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(p<=0){j=1;break}g==0&&(d=p>r?n.Max(r-a,0.75*r):n.Max(p-a,0.02*r));if(p-d<0.5*a){if(g==
0){j=1;break}break}var w=j,E=j,e=1;c.GetTransform(O.s_xfA,e);m.GetTransform(O.s_xfB,e);var A=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(A>=d){j=1;break}for(var H=0;;){var k=0,k=H&1?E+(d-p)*(e-E)/(A-p):0.5*(E+e);c.GetTransform(O.s_xfA,k);m.GetTransform(O.s_xfB,k);var V=O.s_fcn.Evaluate(O.s_xfA,O.s_xfB);if(n.Abs(V-d)<0.025*a){w=k;break}V>d?(E=k,p=V):(e=k,A=V);++H;++O.b2_toiRootIters;if(H==50)break}O.b2_toiMaxRootIters=n.Max(O.b2_toiMaxRootIters,H);if(w<(1+100*Number.MIN_VALUE)*j)break;j=w;g++;++O.b2_toiIters;
if(g==1E3)break}O.b2_toiMaxIters=n.Max(O.b2_toiMaxIters,g);return j};a.postDefs.push(function(){a.Collision.b2TimeOfImpact.b2_toiCalls=0;a.Collision.b2TimeOfImpact.b2_toiIters=0;a.Collision.b2TimeOfImpact.b2_toiMaxIters=0;a.Collision.b2TimeOfImpact.b2_toiRootIters=0;a.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;a.Collision.b2TimeOfImpact.s_cache=new A;a.Collision.b2TimeOfImpact.s_distanceInput=new S;a.Collision.b2TimeOfImpact.s_xfA=new q;a.Collision.b2TimeOfImpact.s_xfB=new q;a.Collision.b2TimeOfImpact.s_fcn=
new r;a.Collision.b2TimeOfImpact.s_distanceOutput=new j});V.b2TOIInput=function(){this.proxyA=new z;this.proxyB=new z;this.sweepA=new k;this.sweepB=new k};H.b2WorldManifold=function(){this.m_normal=new g};H.prototype.b2WorldManifold=function(){this.m_points=new l(h.b2_maxManifoldPoints);for(var a=0;a<h.b2_maxManifoldPoints;a++)this.m_points[a]=new g};H.prototype.Initialize=function(a,b,f,c,m){f===void 0&&(f=0);m===void 0&&(m=0);if(a.m_pointCount!=0){var r=0,j,g,d=0,p=0,w=0,E=0,e=0;j=0;switch(a.m_type){case D.e_circles:g=
b.R;j=a.m_localPoint;r=b.position.x+g.col1.x*j.x+g.col2.x*j.y;b=b.position.y+g.col1.y*j.x+g.col2.y*j.y;g=c.R;j=a.m_points[0].m_localPoint;a=c.position.x+g.col1.x*j.x+g.col2.x*j.y;c=c.position.y+g.col1.y*j.x+g.col2.y*j.y;j=a-r;g=c-b;d=j*j+g*g;d>Number.MIN_VALUE*Number.MIN_VALUE?(d=Math.sqrt(d),this.m_normal.x=j/d,this.m_normal.y=g/d):(this.m_normal.x=1,this.m_normal.y=0);j=b+f*this.m_normal.y;c-=m*this.m_normal.y;this.m_points[0].x=0.5*(r+f*this.m_normal.x+(a-m*this.m_normal.x));this.m_points[0].y=
0.5*(j+c);break;case D.e_faceA:g=b.R;j=a.m_localPlaneNormal;d=g.col1.x*j.x+g.col2.x*j.y;p=g.col1.y*j.x+g.col2.y*j.y;g=b.R;j=a.m_localPoint;w=b.position.x+g.col1.x*j.x+g.col2.x*j.y;E=b.position.y+g.col1.y*j.x+g.col2.y*j.y;this.m_normal.x=d;this.m_normal.y=p;for(r=0;r<a.m_pointCount;r++)g=c.R,j=a.m_points[r].m_localPoint,e=c.position.x+g.col1.x*j.x+g.col2.x*j.y,j=c.position.y+g.col1.y*j.x+g.col2.y*j.y,this.m_points[r].x=e+0.5*(f-(e-w)*d-(j-E)*p-m)*d,this.m_points[r].y=j+0.5*(f-(e-w)*d-(j-E)*p-m)*p;
break;case D.e_faceB:g=c.R;j=a.m_localPlaneNormal;d=g.col1.x*j.x+g.col2.x*j.y;p=g.col1.y*j.x+g.col2.y*j.y;g=c.R;j=a.m_localPoint;w=c.position.x+g.col1.x*j.x+g.col2.x*j.y;E=c.position.y+g.col1.y*j.x+g.col2.y*j.y;this.m_normal.x=-d;this.m_normal.y=-p;for(r=0;r<a.m_pointCount;r++)g=b.R,j=a.m_points[r].m_localPoint,e=b.position.x+g.col1.x*j.x+g.col2.x*j.y,j=b.position.y+g.col1.y*j.x+g.col2.y*j.y,this.m_points[r].x=e+0.5*(m-(e-w)*d-(j-E)*p-f)*d,this.m_points[r].y=j+0.5*(m-(e-w)*d-(j-E)*p-f)*p}}};f.ClipVertex=
function(){this.v=new g;this.id=new G};f.prototype.Set=function(a){this.v.SetV(a.v);this.id.Set(a.id)};m.Features=function(){};Object.defineProperty(m.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(m.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(a){a===void 0&&(a=0);this._referenceEdge=a;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(m.prototype,"incidentEdge",
{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(m.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(a){a===void 0&&(a=0);this._incidentEdge=a;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(m.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});Object.defineProperty(m.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(a){a===
void 0&&(a=0);this._incidentVertex=a;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}});Object.defineProperty(m.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(m.prototype,"flip",{enumerable:!1,configurable:!0,set:function(a){a===void 0&&(a=0);this._flip=a;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();(function(){var b=a.Common.b2Settings,e=a.Collision.Shapes.b2CircleShape,d=a.Collision.Shapes.b2EdgeChainDef,
h=a.Collision.Shapes.b2EdgeShape,n=a.Collision.Shapes.b2MassData,k=a.Collision.Shapes.b2PolygonShape,q=a.Collision.Shapes.b2Shape,g=a.Common.Math.b2Mat22,y=a.Common.Math.b2Math,t=a.Common.Math.b2Transform,L=a.Common.Math.b2Vec2,C=a.Collision.b2Distance,G=a.Collision.b2DistanceInput,v=a.Collision.b2DistanceOutput,F=a.Collision.b2DistanceProxy,S=a.Collision.b2SimplexCache;a.inherit(e,a.Collision.Shapes.b2Shape);e.prototype.__super=a.Collision.Shapes.b2Shape.prototype;e.b2CircleShape=function(){a.Collision.Shapes.b2Shape.b2Shape.apply(this,
arguments);this.m_p=new L};e.prototype.Copy=function(){var a=new e;a.Set(this);return a};e.prototype.Set=function(b){this.__super.Set.call(this,b);a.is(b,e)&&this.m_p.SetV((b instanceof e?b:null).m_p)};e.prototype.TestPoint=function(a,b){var c=a.R,g=a.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),c=a.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y),g=b.x-g,c=b.y-c;return g*g+c*c<=this.m_radius*this.m_radius};e.prototype.RayCast=function(a,b,c){var g=c.R,d=b.p1.x-(c.position.x+(g.col1.x*
this.m_p.x+g.col2.x*this.m_p.y)),c=b.p1.y-(c.position.y+(g.col1.y*this.m_p.x+g.col2.y*this.m_p.y)),g=b.p2.x-b.p1.x,e=b.p2.y-b.p1.y,h=d*g+c*e,k=g*g+e*e,n=h*h-k*(d*d+c*c-this.m_radius*this.m_radius);if(n<0||k<Number.MIN_VALUE)return!1;h=-(h+Math.sqrt(n));if(0<=h&&h<=b.maxFraction*k)return h/=k,a.fraction=h,a.normal.x=d+h*g,a.normal.y=c+h*e,a.normal.Normalize(),!0;return!1};e.prototype.ComputeAABB=function(a,b){var c=b.R,g=b.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y),c=b.position.y+(c.col1.y*
this.m_p.x+c.col2.y*this.m_p.y);a.lowerBound.Set(g-this.m_radius,c-this.m_radius);a.upperBound.Set(g+this.m_radius,c+this.m_radius)};e.prototype.ComputeMass=function(a,g){g===void 0&&(g=0);a.mass=g*b.b2_pi*this.m_radius*this.m_radius;a.center.SetV(this.m_p);a.I=a.mass*(0.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};e.prototype.ComputeSubmergedArea=function(a,b,c,g){b===void 0&&(b=0);var c=y.MulX(c,this.m_p),d=-(y.Dot(a,c)-b);if(d<-this.m_radius+Number.MIN_VALUE)return 0;
if(d>this.m_radius)return g.SetV(c),Math.PI*this.m_radius*this.m_radius;var b=this.m_radius*this.m_radius,e=d*d,d=b*(Math.asin(d/this.m_radius)+Math.PI/2)+d*Math.sqrt(b-e),b=-2/3*Math.pow(b-e,1.5)/d;g.x=c.x+a.x*b;g.y=c.y+a.y*b;return d};e.prototype.GetLocalPosition=function(){return this.m_p};e.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)};e.prototype.GetRadius=function(){return this.m_radius};e.prototype.SetRadius=function(a){a===void 0&&(a=0);this.m_radius=a};e.prototype.b2CircleShape=
function(a){a===void 0&&(a=0);this.__super.b2Shape.call(this);this.m_type=q.e_circleShape;this.m_radius=a};d.b2EdgeChainDef=function(){};d.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};a.inherit(h,a.Collision.Shapes.b2Shape);h.prototype.__super=a.Collision.Shapes.b2Shape.prototype;h.b2EdgeShape=function(){a.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new L;this.m_v1=new L;this.m_v2=new L;this.m_coreV1=new L;this.m_coreV2=new L;
this.m_normal=new L;this.m_direction=new L;this.m_cornerDir1=new L;this.m_cornerDir2=new L};h.prototype.TestPoint=function(){return!1};h.prototype.RayCast=function(a,b,c){var g,d=b.p2.x-b.p1.x,e=b.p2.y-b.p1.y;g=c.R;var h=c.position.x+(g.col1.x*this.m_v1.x+g.col2.x*this.m_v1.y),k=c.position.y+(g.col1.y*this.m_v1.x+g.col2.y*this.m_v1.y),n=c.position.y+(g.col1.y*this.m_v2.x+g.col2.y*this.m_v2.y)-k,c=-(c.position.x+(g.col1.x*this.m_v2.x+g.col2.x*this.m_v2.y)-h);g=100*Number.MIN_VALUE;var l=-(d*n+e*c);
if(l>g){var h=b.p1.x-h,y=b.p1.y-k,k=h*n+y*c;if(0<=k&&k<=b.maxFraction*l&&(b=-d*y+e*h,-g*l<=b&&b<=l*(1+g)))return k/=l,a.fraction=k,b=Math.sqrt(n*n+c*c),a.normal.x=n/b,a.normal.y=c/b,!0}return!1};h.prototype.ComputeAABB=function(a,b){var c=b.R,g=b.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),d=b.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),e=b.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y),c=b.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y);g<e?(a.lowerBound.x=g,
a.upperBound.x=e):(a.lowerBound.x=e,a.upperBound.x=g);d<c?(a.lowerBound.y=d,a.upperBound.y=c):(a.lowerBound.y=c,a.upperBound.y=d)};h.prototype.ComputeMass=function(a){a.mass=0;a.center.SetV(this.m_v1);a.I=0};h.prototype.ComputeSubmergedArea=function(a,b,c,g){b===void 0&&(b=0);var d=new L(a.x*b,a.y*b),e=y.MulX(c,this.m_v1),c=y.MulX(c,this.m_v2),h=y.Dot(a,e)-b,a=y.Dot(a,c)-b;if(h>0)if(a>0)return 0;else e.x=-a/(h-a)*e.x+h/(h-a)*c.x,e.y=-a/(h-a)*e.y+h/(h-a)*c.y;else if(a>0)c.x=-a/(h-a)*e.x+h/(h-a)*c.x,
c.y=-a/(h-a)*e.y+h/(h-a)*c.y;g.x=(d.x+e.x+c.x)/3;g.y=(d.y+e.y+c.y)/3;return 0.5*((e.x-d.x)*(c.y-d.y)-(e.y-d.y)*(c.x-d.x))};h.prototype.GetLength=function(){return this.m_length};h.prototype.GetVertex1=function(){return this.m_v1};h.prototype.GetVertex2=function(){return this.m_v2};h.prototype.GetCoreVertex1=function(){return this.m_coreV1};h.prototype.GetCoreVertex2=function(){return this.m_coreV2};h.prototype.GetNormalVector=function(){return this.m_normal};h.prototype.GetDirectionVector=function(){return this.m_direction};
h.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};h.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};h.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};h.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};h.prototype.GetFirstVertex=function(a){var b=a.R;return new L(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))};h.prototype.GetNextEdge=function(){return this.m_nextEdge};
h.prototype.GetPrevEdge=function(){return this.m_prevEdge};h.prototype.Support=function(a,b,c){b===void 0&&(b=0);c===void 0&&(c=0);var g=a.R,d=a.position.x+(g.col1.x*this.m_coreV1.x+g.col2.x*this.m_coreV1.y),e=a.position.y+(g.col1.y*this.m_coreV1.x+g.col2.y*this.m_coreV1.y),h=a.position.x+(g.col1.x*this.m_coreV2.x+g.col2.x*this.m_coreV2.y),a=a.position.y+(g.col1.y*this.m_coreV2.x+g.col2.y*this.m_coreV2.y);d*b+e*c>h*b+a*c?(this.s_supportVec.x=d,this.s_supportVec.y=e):(this.s_supportVec.x=h,this.s_supportVec.y=
a);return this.s_supportVec};h.prototype.b2EdgeShape=function(a,g){this.__super.b2Shape.call(this);this.m_type=q.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=a;this.m_v2=g;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-b.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);
this.m_coreV2.Set(-b.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};h.prototype.SetPrevEdge=function(a,b,c,g){this.m_prevEdge=a;this.m_coreV1=b;this.m_cornerDir1=c;this.m_cornerConvex1=g};h.prototype.SetNextEdge=function(a,b,c,g){this.m_nextEdge=a;this.m_coreV2=b;this.m_cornerDir2=c;this.m_cornerConvex2=g};n.b2MassData=function(){this.mass=
0;this.center=new L(0,0);this.I=0};a.inherit(k,a.Collision.Shapes.b2Shape);k.prototype.__super=a.Collision.Shapes.b2Shape.prototype;k.b2PolygonShape=function(){a.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};k.prototype.Copy=function(){var a=new k;a.Set(this);return a};k.prototype.Set=function(b){this.__super.Set.call(this,b);if(a.is(b,k)){b=b instanceof k?b:null;this.m_centroid.SetV(b.m_centroid);this.m_vertexCount=b.m_vertexCount;this.Reserve(this.m_vertexCount);for(var c=0;c<this.m_vertexCount;c++)this.m_vertices[c].SetV(b.m_vertices[c]),
this.m_normals[c].SetV(b.m_normals[c])}};k.prototype.SetAsArray=function(a,b){b===void 0&&(b=0);for(var c=new l,g=0,d,g=0;g<a.length;++g)d=a[g],c.push(d);this.SetAsVector(c,b)};k.AsArray=function(a,b){b===void 0&&(b=0);var c=new k;c.SetAsArray(a,b);return c};k.prototype.SetAsVector=function(a,g){g===void 0&&(g=0);if(g==0)g=a.length;b.b2Assert(2<=g);this.m_vertexCount=g;this.Reserve(g);for(var d=0,d=0;d<this.m_vertexCount;d++)this.m_vertices[d].SetV(a[d]);for(d=0;d<this.m_vertexCount;++d){var e=parseInt(d),
h=parseInt(d+1<this.m_vertexCount?d+1:0),e=y.SubtractVV(this.m_vertices[h],this.m_vertices[e]);b.b2Assert(e.LengthSquared()>Number.MIN_VALUE);this.m_normals[d].SetV(y.CrossVF(e,1));this.m_normals[d].Normalize()}this.m_centroid=k.ComputeCentroid(this.m_vertices,this.m_vertexCount)};k.AsVector=function(a,b){b===void 0&&(b=0);var c=new k;c.SetAsVector(a,b);return c};k.prototype.SetAsBox=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-b);
this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid.SetZero()};k.AsBox=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);var c=new k;c.SetAsBox(a,b);return c};k.prototype.SetAsOrientedBox=function(a,b,c,g){a===void 0&&(a=0);b===void 0&&(b=0);c===void 0&&(c=null);g===void 0&&(g=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,
-b);this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,0);this.m_centroid=c;a=new t;a.position=c;a.R.Set(g);for(c=0;c<this.m_vertexCount;++c)this.m_vertices[c]=y.MulX(a,this.m_vertices[c]),this.m_normals[c]=y.MulMV(a.R,this.m_normals[c])};k.AsOrientedBox=function(a,b,c,g){a===void 0&&(a=0);b===void 0&&(b=0);c===void 0&&(c=null);g===void 0&&(g=0);var d=new k;
d.SetAsOrientedBox(a,b,c,g);return d};k.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(a);this.m_vertices[1].SetV(b);this.m_centroid.x=0.5*(a.x+b.x);this.m_centroid.y=0.5*(a.y+b.y);this.m_normals[0]=y.CrossVF(y.SubtractVV(b,a),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};k.AsEdge=function(a,b){var c=new k;c.SetAsEdge(a,b);return c};k.prototype.TestPoint=function(a,b){var c;c=a.R;
for(var g=b.x-a.position.x,d=b.y-a.position.y,e=g*c.col1.x+d*c.col1.y,h=g*c.col2.x+d*c.col2.y,k=0;k<this.m_vertexCount;++k)if(c=this.m_vertices[k],g=e-c.x,d=h-c.y,c=this.m_normals[k],c.x*g+c.y*d>0)return!1;return!0};k.prototype.RayCast=function(a,b,c){var g=0,d=b.maxFraction,e=0,h=0,k,n,e=b.p1.x-c.position.x,h=b.p1.y-c.position.y;k=c.R;var l=e*k.col1.x+h*k.col1.y,y=e*k.col2.x+h*k.col2.y,e=b.p2.x-c.position.x,h=b.p2.y-c.position.y;k=c.R;b=e*k.col1.x+h*k.col1.y-l;k=e*k.col2.x+h*k.col2.y-y;for(var o=
parseInt(-1),r=0;r<this.m_vertexCount;++r){n=this.m_vertices[r];e=n.x-l;h=n.y-y;n=this.m_normals[r];e=n.x*e+n.y*h;h=n.x*b+n.y*k;if(h==0){if(e<0)return!1}else h<0&&e<g*h?(g=e/h,o=r):h>0&&e<d*h&&(d=e/h);if(d<g-Number.MIN_VALUE)return!1}if(o>=0)return a.fraction=g,k=c.R,n=this.m_normals[o],a.normal.x=k.col1.x*n.x+k.col2.x*n.y,a.normal.y=k.col1.y*n.x+k.col2.y*n.y,!0;return!1};k.prototype.ComputeAABB=function(a,b){for(var c=b.R,g=this.m_vertices[0],d=b.position.x+(c.col1.x*g.x+c.col2.x*g.y),e=b.position.y+
(c.col1.y*g.x+c.col2.y*g.y),h=d,k=e,n=1;n<this.m_vertexCount;++n)var g=this.m_vertices[n],l=b.position.x+(c.col1.x*g.x+c.col2.x*g.y),g=b.position.y+(c.col1.y*g.x+c.col2.y*g.y),d=d<l?d:l,e=e<g?e:g,h=h>l?h:l,k=k>g?k:g;a.lowerBound.x=d-this.m_radius;a.lowerBound.y=e-this.m_radius;a.upperBound.x=h+this.m_radius;a.upperBound.y=k+this.m_radius};k.prototype.ComputeMass=function(a,b){b===void 0&&(b=0);if(this.m_vertexCount==2)a.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=0.5*(this.m_vertices[0].y+
this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var c=0,g=0,d=0,e=0,h=1/3,k=0;k<this.m_vertexCount;++k){var n=this.m_vertices[k],l=k+1<this.m_vertexCount?this.m_vertices[parseInt(k+1)]:this.m_vertices[0],y=n.x-0,o=n.y-0,r=l.x-0,p=l.y-0,A=y*p-o*r,w=0.5*A;d+=w;c+=w*h*(0+n.x+l.x);g+=w*h*(0+n.y+l.y);n=y;e+=A*(h*(0.25*(n*n+r*n+r*r)+(0*n+0*r))+0+(h*(0.25*(o*o+p*o+p*p)+(0*o+0*p))+0))}a.mass=b*d;c*=1/d;g*=1/d;a.center.Set(c,g);a.I=b*e}};k.prototype.ComputeSubmergedArea=function(a,b,c,g){b===void 0&&(b=0);for(var d=
y.MulTMV(c.R,a),e=b-y.Dot(a,c.position),h=new o,k=0,l=parseInt(-1),b=parseInt(-1),q=!1,a=a=0;a<this.m_vertexCount;++a){h[a]=y.Dot(d,this.m_vertices[a])-e;var t=h[a]<-Number.MIN_VALUE;a>0&&(t?q||(l=a-1,k++):q&&(b=a-1,k++));q=t}switch(k){case 0:return q?(a=new n,this.ComputeMass(a,1),g.SetV(y.MulX(c,a.center)),a.mass):0;case 1:l==-1?l=this.m_vertexCount-1:b=this.m_vertexCount-1}a=parseInt((l+1)%this.m_vertexCount);d=parseInt((b+1)%this.m_vertexCount);e=(0-h[l])/(h[a]-h[l]);h=(0-h[b])/(h[d]-h[b]);l=
new L(this.m_vertices[l].x*(1-e)+this.m_vertices[a].x*e,this.m_vertices[l].y*(1-e)+this.m_vertices[a].y*e);b=new L(this.m_vertices[b].x*(1-h)+this.m_vertices[d].x*h,this.m_vertices[b].y*(1-h)+this.m_vertices[d].y*h);h=0;e=new L;for(k=this.m_vertices[a];a!=d;)a=(a+1)%this.m_vertexCount,q=a==d?b:this.m_vertices[a],t=0.5*((k.x-l.x)*(q.y-l.y)-(k.y-l.y)*(q.x-l.x)),h+=t,e.x+=t*(l.x+k.x+q.x)/3,e.y+=t*(l.y+k.y+q.y)/3,k=q;e.Multiply(1/h);g.SetV(y.MulX(c,e));return h};k.prototype.GetVertexCount=function(){return this.m_vertexCount};
k.prototype.GetVertices=function(){return this.m_vertices};k.prototype.GetNormals=function(){return this.m_normals};k.prototype.GetSupport=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,g=1;g<this.m_vertexCount;++g){var d=this.m_vertices[g].x*a.x+this.m_vertices[g].y*a.y;d>c&&(b=g,c=d)}return b};k.prototype.GetSupportVertex=function(a){for(var b=0,c=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,g=1;g<this.m_vertexCount;++g){var d=this.m_vertices[g].x*a.x+this.m_vertices[g].y*
a.y;d>c&&(b=g,c=d)}return this.m_vertices[b]};k.prototype.Validate=function(){return!1};k.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=q.e_polygonShape;this.m_centroid=new L;this.m_vertices=new l;this.m_normals=new l};k.prototype.Reserve=function(a){a===void 0&&(a=0);for(var b=parseInt(this.m_vertices.length);b<a;b++)this.m_vertices[b]=new L,this.m_normals[b]=new L};k.ComputeCentroid=function(a,b){b===void 0&&(b=0);for(var c=new L,g=0,d=1/3,h=0;h<b;++h){var e=a[h],
k=h+1<b?a[parseInt(h+1)]:a[0],n=0.5*((e.x-0)*(k.y-0)-(e.y-0)*(k.x-0));g+=n;c.x+=n*d*(0+e.x+k.x);c.y+=n*d*(0+e.y+k.y)}c.x*=1/g;c.y*=1/g;return c};k.ComputeOBB=function(a,b,c){c===void 0&&(c=0);for(var g=0,d=new l(c+1),g=0;g<c;++g)d[g]=b[g];d[c]=d[0];b=Number.MAX_VALUE;for(g=1;g<=c;++g){var h=d[parseInt(g-1)],e=d[g].x-h.x,k=d[g].y-h.y,n=Math.sqrt(e*e+k*k);e/=n;k/=n;for(var y=-k,o=e,q=n=Number.MAX_VALUE,r=-Number.MAX_VALUE,p=-Number.MAX_VALUE,A=0;A<c;++A){var w=d[A].x-h.x,O=d[A].y-h.y,V=e*w+k*O,w=y*
w+o*O;V<n&&(n=V);w<q&&(q=w);V>r&&(r=V);w>p&&(p=w)}A=(r-n)*(p-q);if(A<0.95*b)b=A,a.R.col1.x=e,a.R.col1.y=k,a.R.col2.x=y,a.R.col2.y=o,e=0.5*(n+r),k=0.5*(q+p),y=a.R,a.center.x=h.x+(y.col1.x*e+y.col2.x*k),a.center.y=h.y+(y.col1.y*e+y.col2.y*k),a.extents.x=0.5*(r-n),a.extents.y=0.5*(p-q)}};a.postDefs.push(function(){a.Collision.Shapes.b2PolygonShape.s_mat=new g});q.b2Shape=function(){};q.prototype.Copy=function(){return null};q.prototype.Set=function(a){this.m_radius=a.m_radius};q.prototype.GetType=function(){return this.m_type};
q.prototype.TestPoint=function(){return!1};q.prototype.RayCast=function(){return!1};q.prototype.ComputeAABB=function(){};q.prototype.ComputeMass=function(){};q.prototype.ComputeSubmergedArea=function(){return 0};q.TestOverlap=function(a,b,c,g){var d=new G;d.proxyA=new F;d.proxyA.Set(a);d.proxyB=new F;d.proxyB.Set(c);d.transformA=b;d.transformB=g;d.useRadii=!0;a=new S;a.count=0;b=new v;C.Distance(b,a,d);return b.distance<10*Number.MIN_VALUE};q.prototype.b2Shape=function(){this.m_type=q.e_unknownShape;
this.m_radius=b.b2_linearSlop};a.postDefs.push(function(){a.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1);a.Collision.Shapes.b2Shape.e_circleShape=0;a.Collision.Shapes.b2Shape.e_polygonShape=1;a.Collision.Shapes.b2Shape.e_edgeShape=2;a.Collision.Shapes.b2Shape.e_shapeTypeCount=3;a.Collision.Shapes.b2Shape.e_hitCollide=1;a.Collision.Shapes.b2Shape.e_missCollide=0;a.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})})();(function(){var b=a.Common.b2Color,e=a.Common.b2Settings,d=a.Common.Math.b2Math;
b.b2Color=function(){this._b=this._g=this._r=0};b.prototype.b2Color=function(b,c,e){b===void 0&&(b=0);c===void 0&&(c=0);e===void 0&&(e=0);this._r=a.parseUInt(255*d.Clamp(b,0,1));this._g=a.parseUInt(255*d.Clamp(c,0,1));this._b=a.parseUInt(255*d.Clamp(e,0,1))};b.prototype.Set=function(b,c,e){b===void 0&&(b=0);c===void 0&&(c=0);e===void 0&&(e=0);this._r=a.parseUInt(255*d.Clamp(b,0,1));this._g=a.parseUInt(255*d.Clamp(c,0,1));this._b=a.parseUInt(255*d.Clamp(e,0,1))};Object.defineProperty(b.prototype,"r",
{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._r=a.parseUInt(255*d.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"g",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._g=a.parseUInt(255*d.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"b",{enumerable:!1,configurable:!0,set:function(b){b===void 0&&(b=0);this._b=a.parseUInt(255*d.Clamp(b,0,1))}});Object.defineProperty(b.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<
16|this._g<<8|this._b}});e.b2Settings=function(){};e.b2MixFriction=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);return Math.sqrt(a*b)};e.b2MixRestitution=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);return a>b?a:b};e.b2Assert=function(a){if(!a)throw"Assertion Failed";};a.postDefs.push(function(){a.Common.b2Settings.VERSION="2.1alpha";a.Common.b2Settings.USHRT_MAX=65535;a.Common.b2Settings.b2_pi=Math.PI;a.Common.b2Settings.b2_maxManifoldPoints=2;a.Common.b2Settings.b2_aabbExtension=0.1;a.Common.b2Settings.b2_aabbMultiplier=
2;a.Common.b2Settings.b2_polygonRadius=2*e.b2_linearSlop;a.Common.b2Settings.b2_linearSlop=0.0050;a.Common.b2Settings.b2_angularSlop=2/180*e.b2_pi;a.Common.b2Settings.b2_toiSlop=8*e.b2_linearSlop;a.Common.b2Settings.b2_maxTOIContactsPerIsland=32;a.Common.b2Settings.b2_maxTOIJointsPerIsland=32;a.Common.b2Settings.b2_velocityThreshold=1;a.Common.b2Settings.b2_maxLinearCorrection=0.2;a.Common.b2Settings.b2_maxAngularCorrection=8/180*e.b2_pi;a.Common.b2Settings.b2_maxTranslation=10;a.Common.b2Settings.b2_maxTranslationSquared=
e.b2_maxTranslation*e.b2_maxTranslation;a.Common.b2Settings.b2_maxRotation=0.5*e.b2_pi;a.Common.b2Settings.b2_maxRotationSquared=e.b2_maxRotation*e.b2_maxRotation;a.Common.b2Settings.b2_contactBaumgarte=0.2;a.Common.b2Settings.b2_timeToSleep=0.5;a.Common.b2Settings.b2_linearSleepTolerance=0.01;a.Common.b2Settings.b2_angularSleepTolerance=2/180*e.b2_pi})})();(function(){var b=a.Common.Math.b2Mat22,e=a.Common.Math.b2Mat33,d=a.Common.Math.b2Math,h=a.Common.Math.b2Sweep,n=a.Common.Math.b2Transform,k=
a.Common.Math.b2Vec2,l=a.Common.Math.b2Vec3;b.b2Mat22=function(){this.col1=new k;this.col2=new k};b.prototype.b2Mat22=function(){this.SetIdentity()};b.FromAngle=function(a){a===void 0&&(a=0);var d=new b;d.Set(a);return d};b.FromVV=function(a,d){var e=new b;e.SetVV(a,d);return e};b.prototype.Set=function(a){a===void 0&&(a=0);var b=Math.cos(a),a=Math.sin(a);this.col1.x=b;this.col2.x=-a;this.col1.y=a;this.col2.y=b};b.prototype.SetVV=function(a,b){this.col1.SetV(a);this.col2.SetV(b)};b.prototype.Copy=
function(){var a=new b;a.SetM(this);return a};b.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2)};b.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y};b.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};b.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};b.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};b.prototype.GetInverse=
function(a){var b=this.col1.x,c=this.col2.x,d=this.col1.y,e=this.col2.y,h=b*e-c*d;h!=0&&(h=1/h);a.col1.x=h*e;a.col2.x=-h*c;a.col1.y=-h*d;a.col2.y=h*b;return a};b.prototype.Solve=function(a,b,c){b===void 0&&(b=0);c===void 0&&(c=0);var d=this.col1.x,e=this.col2.x,h=this.col1.y,k=this.col2.y,n=d*k-e*h;n!=0&&(n=1/n);a.x=n*(k*b-e*c);a.y=n*(d*c-h*b);return a};b.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};e.b2Mat33=function(){this.col1=new l;this.col2=new l;this.col3=new l};e.prototype.b2Mat33=
function(a,b,c){a===void 0&&(a=null);b===void 0&&(b=null);c===void 0&&(c=null);!a&&!b&&!c?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c))};e.prototype.SetVVV=function(a,b,c){this.col1.SetV(a);this.col2.SetV(b);this.col3.SetV(c)};e.prototype.Copy=function(){return new e(this.col1,this.col2,this.col3)};e.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2);this.col3.SetV(a.col3)};e.prototype.AddM=function(a){this.col1.x+=
a.col1.x;this.col1.y+=a.col1.y;this.col1.z+=a.col1.z;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y;this.col2.z+=a.col2.z;this.col3.x+=a.col3.x;this.col3.y+=a.col3.y;this.col3.z+=a.col3.z};e.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=1};e.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=
0};e.prototype.Solve22=function(a,b,c){b===void 0&&(b=0);c===void 0&&(c=0);var d=this.col1.x,e=this.col2.x,h=this.col1.y,k=this.col2.y,n=d*k-e*h;n!=0&&(n=1/n);a.x=n*(k*b-e*c);a.y=n*(d*c-h*b);return a};e.prototype.Solve33=function(a,b,c,d){b===void 0&&(b=0);c===void 0&&(c=0);d===void 0&&(d=0);var e=this.col1.x,h=this.col1.y,k=this.col1.z,n=this.col2.x,l=this.col2.y,j=this.col2.z,o=this.col3.x,q=this.col3.y,t=this.col3.z,u=e*(l*t-j*q)+h*(j*o-n*t)+k*(n*q-l*o);u!=0&&(u=1/u);a.x=u*(b*(l*t-j*q)+c*(j*o-
n*t)+d*(n*q-l*o));a.y=u*(e*(c*t-d*q)+h*(d*o-b*t)+k*(b*q-c*o));a.z=u*(e*(l*d-j*c)+h*(j*b-n*d)+k*(n*c-l*b));return a};d.b2Math=function(){};d.IsValid=function(a){a===void 0&&(a=0);return isFinite(a)};d.Dot=function(a,b){return a.x*b.x+a.y*b.y};d.CrossVV=function(a,b){return a.x*b.y-a.y*b.x};d.CrossVF=function(a,b){b===void 0&&(b=0);return new k(b*a.y,-b*a.x)};d.CrossFV=function(a,b){a===void 0&&(a=0);return new k(-a*b.y,a*b.x)};d.MulMV=function(a,b){return new k(a.col1.x*b.x+a.col2.x*b.y,a.col1.y*b.x+
a.col2.y*b.y)};d.MulTMV=function(a,b){return new k(d.Dot(b,a.col1),d.Dot(b,a.col2))};d.MulX=function(a,b){var c=d.MulMV(a.R,b);c.x+=a.position.x;c.y+=a.position.y;return c};d.MulXT=function(a,b){var c=d.SubtractVV(b,a.position),e=c.x*a.R.col1.x+c.y*a.R.col1.y;c.y=c.x*a.R.col2.x+c.y*a.R.col2.y;c.x=e;return c};d.AddVV=function(a,b){return new k(a.x+b.x,a.y+b.y)};d.SubtractVV=function(a,b){return new k(a.x-b.x,a.y-b.y)};d.Distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};d.DistanceSquared=
function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};d.MulFV=function(a,b){a===void 0&&(a=0);return new k(a*b.x,a*b.y)};d.AddMM=function(a,e){return b.FromVV(d.AddVV(a.col1,e.col1),d.AddVV(a.col2,e.col2))};d.MulMM=function(a,e){return b.FromVV(d.MulMV(a,e.col1),d.MulMV(a,e.col2))};d.MulTMM=function(a,e){var h=new k(d.Dot(a.col1,e.col1),d.Dot(a.col2,e.col1)),n=new k(d.Dot(a.col1,e.col2),d.Dot(a.col2,e.col2));return b.FromVV(h,n)};d.Abs=function(a){a===void 0&&(a=0);return a>0?a:-a};d.AbsV=function(a){return new k(d.Abs(a.x),
d.Abs(a.y))};d.AbsM=function(a){return b.FromVV(d.AbsV(a.col1),d.AbsV(a.col2))};d.Min=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);return a<b?a:b};d.MinV=function(a,b){return new k(d.Min(a.x,b.x),d.Min(a.y,b.y))};d.Max=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);return a>b?a:b};d.MaxV=function(a,b){return new k(d.Max(a.x,b.x),d.Max(a.y,b.y))};d.Clamp=function(a,b,c){a===void 0&&(a=0);b===void 0&&(b=0);c===void 0&&(c=0);return a<b?b:a>c?c:a};d.ClampV=function(a,b,c){return d.MaxV(b,d.MinV(a,
c))};d.Swap=function(a,b){var c=a[0];a[0]=b[0];b[0]=c};d.Random=function(){return Math.random()*2-1};d.RandomRange=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);var c=Math.random();return(b-a)*c+a};d.NextPowerOfTwo=function(a){a===void 0&&(a=0);a|=a>>1&2147483647;a|=a>>2&1073741823;a|=a>>4&268435455;a|=a>>8&16777215;a|=a>>16&65535;return a+1};d.IsPowerOfTwo=function(a){a===void 0&&(a=0);return a>0&&(a&a-1)==0};a.postDefs.push(function(){a.Common.Math.b2Math.b2Vec2_zero=new k(0,0);a.Common.Math.b2Math.b2Mat22_identity=
b.FromVV(new k(1,0),new k(0,1));a.Common.Math.b2Math.b2Transform_identity=new n(d.b2Vec2_zero,d.b2Mat22_identity)});h.b2Sweep=function(){this.localCenter=new k;this.c0=new k;this.c=new k};h.prototype.Set=function(a){this.localCenter.SetV(a.localCenter);this.c0.SetV(a.c0);this.c.SetV(a.c);this.a0=a.a0;this.a=a.a;this.t0=a.t0};h.prototype.Copy=function(){var a=new h;a.localCenter.SetV(this.localCenter);a.c0.SetV(this.c0);a.c.SetV(this.c);a.a0=this.a0;a.a=this.a;a.t0=this.t0;return a};h.prototype.GetTransform=
function(a,b){b===void 0&&(b=0);a.position.x=(1-b)*this.c0.x+b*this.c.x;a.position.y=(1-b)*this.c0.y+b*this.c.y;a.R.Set((1-b)*this.a0+b*this.a);var c=a.R;a.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y;a.position.y-=c.col1.y*this.localCenter.x+c.col2.y*this.localCenter.y};h.prototype.Advance=function(a){a===void 0&&(a=0);if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x;this.c0.y=(1-b)*this.c0.y+b*this.c.y;this.a0=(1-
b)*this.a0+b*this.a;this.t0=a}};n.b2Transform=function(){this.position=new k;this.R=new b};n.prototype.b2Transform=function(a,b){a===void 0&&(a=null);b===void 0&&(b=null);a&&(this.position.SetV(a),this.R.SetM(b))};n.prototype.Initialize=function(a,b){this.position.SetV(a);this.R.SetM(b)};n.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};n.prototype.Set=function(a){this.position.SetV(a.position);this.R.SetM(a.R)};n.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,
this.R.col1.x)};k.b2Vec2=function(){};k.prototype.b2Vec2=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.x=a;this.y=b};k.prototype.SetZero=function(){this.y=this.x=0};k.prototype.Set=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.x=a;this.y=b};k.prototype.SetV=function(a){this.x=a.x;this.y=a.y};k.prototype.GetNegative=function(){return new k(-this.x,-this.y)};k.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};k.Make=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);
return new k(a,b)};k.prototype.Copy=function(){return new k(this.x,this.y)};k.prototype.Add=function(a){this.x+=a.x;this.y+=a.y};k.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y};k.prototype.Multiply=function(a){a===void 0&&(a=0);this.x*=a;this.y*=a};k.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y;this.y=a.col1.y*b+a.col2.y*this.y};k.prototype.MulTM=function(a){var b=d.Dot(this,a.col1);this.y=d.Dot(this,a.col2);this.x=b};k.prototype.CrossVF=function(a){a===void 0&&
(a=0);var b=this.x;this.x=a*this.y;this.y=-a*b};k.prototype.CrossFV=function(a){a===void 0&&(a=0);var b=this.x;this.x=-a*this.y;this.y=a*b};k.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y};k.prototype.MaxV=function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y};k.prototype.Abs=function(){if(this.x<0)this.x=-this.x;if(this.y<0)this.y=-this.y};k.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};k.prototype.LengthSquared=
function(){return this.x*this.x+this.y*this.y};k.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;this.x*=b;this.y*=b;return a};k.prototype.IsValid=function(){return d.IsValid(this.x)&&d.IsValid(this.y)};l.b2Vec3=function(){};l.prototype.b2Vec3=function(a,b,c){a===void 0&&(a=0);b===void 0&&(b=0);c===void 0&&(c=0);this.x=a;this.y=b;this.z=c};l.prototype.SetZero=function(){this.x=this.y=this.z=0};l.prototype.Set=function(a,b,c){a===
void 0&&(a=0);b===void 0&&(b=0);c===void 0&&(c=0);this.x=a;this.y=b;this.z=c};l.prototype.SetV=function(a){this.x=a.x;this.y=a.y;this.z=a.z};l.prototype.GetNegative=function(){return new l(-this.x,-this.y,-this.z)};l.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z};l.prototype.Copy=function(){return new l(this.x,this.y,this.z)};l.prototype.Add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};l.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z};l.prototype.Multiply=
function(a){a===void 0&&(a=0);this.x*=a;this.y*=a;this.z*=a}})();(function(){var b=a.Common.Math.b2Math,e=a.Common.Math.b2Sweep,d=a.Common.Math.b2Transform,h=a.Common.Math.b2Vec2,n=a.Common.b2Color,k=a.Common.b2Settings,q=a.Collision.b2AABB,g=a.Collision.b2ContactPoint,t=a.Collision.b2DynamicTreeBroadPhase,R=a.Collision.b2RayCastInput,L=a.Collision.b2RayCastOutput,C=a.Collision.Shapes.b2CircleShape,G=a.Collision.Shapes.b2EdgeShape,v=a.Collision.Shapes.b2MassData,F=a.Collision.Shapes.b2PolygonShape,
S=a.Collision.Shapes.b2Shape,j=a.Dynamics.b2Body,z=a.Dynamics.b2BodyDef,B=a.Dynamics.b2ContactFilter,Q=a.Dynamics.b2ContactImpulse,u=a.Dynamics.b2ContactListener,K=a.Dynamics.b2ContactManager,D=a.Dynamics.b2DebugDraw,T=a.Dynamics.b2DestructionListener,I=a.Dynamics.b2FilterData,J=a.Dynamics.b2Fixture,U=a.Dynamics.b2FixtureDef,P=a.Dynamics.b2Island,r=a.Dynamics.b2TimeStep,p=a.Dynamics.b2World,A=a.Dynamics.Contacts.b2Contact,w=a.Dynamics.Contacts.b2ContactFactory,O=a.Dynamics.Contacts.b2ContactSolver,
V=a.Dynamics.Joints.b2Joint,H=a.Dynamics.Joints.b2PulleyJoint;j.b2Body=function(){this.m_xf=new d;this.m_sweep=new e;this.m_linearVelocity=new h;this.m_force=new h};j.prototype.connectEdges=function(a,m,d){d===void 0&&(d=0);var r=Math.atan2(m.GetDirectionVector().y,m.GetDirectionVector().x),d=b.MulFV(Math.tan((r-d)*0.5),m.GetDirectionVector()),d=b.SubtractVV(d,m.GetNormalVector()),d=b.MulFV(k.b2_toiSlop,d),d=b.AddVV(d,m.GetVertex1()),p=b.AddVV(a.GetDirectionVector(),m.GetDirectionVector());p.Normalize();
var e=b.Dot(a.GetDirectionVector(),m.GetNormalVector())>0;a.SetNextEdge(m,d,p,e);m.SetPrevEdge(a,d,p,e);return r};j.prototype.CreateFixture=function(a){if(this.m_world.IsLocked()==!0)return null;var b=new J;b.Create(this,this.m_xf,a);this.m_flags&j.e_activeFlag&&b.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);b.m_next=this.m_fixtureList;this.m_fixtureList=b;++this.m_fixtureCount;b.m_body=this;b.m_density>0&&this.ResetMassData();this.m_world.m_flags|=p.e_newFixture;return b};j.prototype.CreateFixture2=
function(a,b){b===void 0&&(b=0);var c=new U;c.shape=a;c.density=b;return this.CreateFixture(c)};j.prototype.DestroyFixture=function(a){if(this.m_world.IsLocked()!=!0){for(var b=this.m_fixtureList,c=null;b!=null;){if(b==a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next;break}c=b;b=b.m_next}for(b=this.m_contactList;b;){var c=b.contact,b=b.next,d=c.GetFixtureA(),r=c.GetFixtureB();(a==d||a==r)&&this.m_world.m_contactManager.Destroy(c)}this.m_flags&j.e_activeFlag&&a.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);
a.Destroy();a.m_body=null;a.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};j.prototype.SetPositionAndAngle=function(a,b){b===void 0&&(b=0);var c;if(this.m_world.IsLocked()!=!0){this.m_xf.R.Set(b);this.m_xf.position.SetV(a);c=this.m_xf.R;var d=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y;this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=
b;d=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(d,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};j.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())};j.prototype.GetTransform=function(){return this.m_xf};j.prototype.GetPosition=function(){return this.m_xf.position};j.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,this.GetAngle())};j.prototype.GetAngle=function(){return this.m_sweep.a};
j.prototype.SetAngle=function(a){a===void 0&&(a=0);this.SetPositionAndAngle(this.GetPosition(),a)};j.prototype.GetWorldCenter=function(){return this.m_sweep.c};j.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};j.prototype.SetLinearVelocity=function(a){this.m_type!=j.b2_staticBody&&this.m_linearVelocity.SetV(a)};j.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};j.prototype.SetAngularVelocity=function(a){a===void 0&&(a=0);if(this.m_type!=j.b2_staticBody)this.m_angularVelocity=
a};j.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};j.prototype.GetDefinition=function(){var a=new z;a.type=this.GetType();a.allowSleep=(this.m_flags&j.e_allowSleepFlag)==j.e_allowSleepFlag;a.angle=this.GetAngle();a.angularDamping=this.m_angularDamping;a.angularVelocity=this.m_angularVelocity;a.fixedRotation=(this.m_flags&j.e_fixedRotationFlag)==j.e_fixedRotationFlag;a.bullet=(this.m_flags&j.e_bulletFlag)==j.e_bulletFlag;a.awake=(this.m_flags&j.e_awakeFlag)==j.e_awakeFlag;
a.linearDamping=this.m_linearDamping;a.linearVelocity.SetV(this.GetLinearVelocity());a.position=this.GetPosition();a.userData=this.GetUserData();return a};j.prototype.ApplyForce=function(a,b){this.m_type==j.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)};j.prototype.ApplyTorque=function(a){a===void 0&&(a=0);this.m_type==j.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_torque+=
a)};j.prototype.ApplyImpulse=function(a,b){this.m_type==j.b2_dynamicBody&&(this.IsAwake()==!1&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))};j.prototype.Split=function(a){for(var m=this.GetLinearVelocity().Copy(),d=this.GetAngularVelocity(),r=this.GetWorldCenter(),p=this.m_world.CreateBody(this.GetDefinition()),e,h=this.m_fixtureList;h;)if(a(h)){var g=
h.m_next;e?e.m_next=g:this.m_fixtureList=g;this.m_fixtureCount--;h.m_next=p.m_fixtureList;p.m_fixtureList=h;p.m_fixtureCount++;h.m_body=p;h=g}else e=h,h=h.m_next;this.ResetMassData();p.ResetMassData();e=this.GetWorldCenter();a=p.GetWorldCenter();e=b.AddVV(m,b.CrossFV(d,b.SubtractVV(e,r)));m=b.AddVV(m,b.CrossFV(d,b.SubtractVV(a,r)));this.SetLinearVelocity(e);p.SetLinearVelocity(m);this.SetAngularVelocity(d);p.SetAngularVelocity(d);this.SynchronizeFixtures();p.SynchronizeFixtures();return p};j.prototype.Merge=
function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--;b.m_next=this.m_fixtureList;this.m_fixtureList=b;this.m_fixtureCount++;b.m_body=r;b=c}d.m_fixtureCount=0;var d=this,r=a;d.GetWorldCenter();r.GetWorldCenter();d.GetLinearVelocity().Copy();r.GetLinearVelocity().Copy();d.GetAngularVelocity();r.GetAngularVelocity();d.ResetMassData();this.SynchronizeFixtures()};j.prototype.GetMass=function(){return this.m_mass};j.prototype.GetInertia=function(){return this.m_I};j.prototype.GetMassData=
function(a){a.mass=this.m_mass;a.I=this.m_I;a.center.SetV(this.m_sweep.localCenter)};j.prototype.SetMassData=function(a){k.b2Assert(this.m_world.IsLocked()==!1);if(this.m_world.IsLocked()!=!0&&this.m_type==j.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=a.mass;if(this.m_mass<=0)this.m_mass=1;this.m_invMass=1/this.m_mass;if(a.I>0&&(this.m_flags&j.e_fixedRotationFlag)==0)this.m_I=a.I-this.m_mass*(a.center.x*a.center.x+a.center.y*a.center.y),this.m_invI=1/this.m_I;var m=this.m_sweep.c.Copy();
this.m_sweep.localCenter.SetV(a.center);this.m_sweep.c0.SetV(b.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-m.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-m.x)}};j.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==j.b2_staticBody||this.m_type==j.b2_kinematicBody)){for(var a=h.Make(0,0),
m=this.m_fixtureList;m;m=m.m_next)if(m.m_density!=0){var d=m.GetMassData();this.m_mass+=d.mass;a.x+=d.center.x*d.mass;a.y+=d.center.y*d.mass;this.m_I+=d.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,a.x*=this.m_invMass,a.y*=this.m_invMass):this.m_invMass=this.m_mass=1;this.m_I>0&&(this.m_flags&j.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(a.x*a.x+a.y*a.y),this.m_I*=this.m_inertiaScale,k.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0;m=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(a);
this.m_sweep.c0.SetV(b.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-m.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-m.x)}};j.prototype.GetWorldPoint=function(a){var b=this.m_xf.R,a=new h(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return a};j.prototype.GetWorldVector=function(a){return b.MulMV(this.m_xf.R,a)};j.prototype.GetLocalPoint=
function(a){return b.MulXT(this.m_xf,a)};j.prototype.GetLocalVector=function(a){return b.MulTMV(this.m_xf.R,a)};j.prototype.GetLinearVelocityFromWorldPoint=function(a){return new h(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};j.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R,a=new h(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;
return new h(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};j.prototype.GetLinearDamping=function(){return this.m_linearDamping};j.prototype.SetLinearDamping=function(a){a===void 0&&(a=0);this.m_linearDamping=a};j.prototype.GetAngularDamping=function(){return this.m_angularDamping};j.prototype.SetAngularDamping=function(a){a===void 0&&(a=0);this.m_angularDamping=a};j.prototype.SetType=function(a){a===void 0&&
(a=0);if(this.m_type!=a){this.m_type=a;this.ResetMassData();if(this.m_type==j.b2_staticBody)this.m_linearVelocity.SetZero(),this.m_angularVelocity=0;this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(a=this.m_contactList;a;a=a.next)a.contact.FlagForFiltering()}};j.prototype.GetType=function(){return this.m_type};j.prototype.SetBullet=function(a){a?this.m_flags|=j.e_bulletFlag:this.m_flags&=~j.e_bulletFlag};j.prototype.IsBullet=function(){return(this.m_flags&j.e_bulletFlag)==j.e_bulletFlag};
j.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=j.e_allowSleepFlag:(this.m_flags&=~j.e_allowSleepFlag,this.SetAwake(!0))};j.prototype.SetAwake=function(a){a?(this.m_flags|=j.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~j.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};j.prototype.IsAwake=function(){return(this.m_flags&j.e_awakeFlag)==j.e_awakeFlag};j.prototype.SetFixedRotation=function(a){a?this.m_flags|=
j.e_fixedRotationFlag:this.m_flags&=~j.e_fixedRotationFlag;this.ResetMassData()};j.prototype.IsFixedRotation=function(){return(this.m_flags&j.e_fixedRotationFlag)==j.e_fixedRotationFlag};j.prototype.SetActive=function(a){if(a!=this.IsActive()){var b;if(a){this.m_flags|=j.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.CreateProxy(a,this.m_xf)}else{this.m_flags&=~j.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=
b.m_next)b.DestroyProxy(a);for(a=this.m_contactList;a;)b=a,a=a.next,this.m_world.m_contactManager.Destroy(b.contact);this.m_contactList=null}}};j.prototype.IsActive=function(){return(this.m_flags&j.e_activeFlag)==j.e_activeFlag};j.prototype.IsSleepingAllowed=function(){return(this.m_flags&j.e_allowSleepFlag)==j.e_allowSleepFlag};j.prototype.GetFixtureList=function(){return this.m_fixtureList};j.prototype.GetJointList=function(){return this.m_jointList};j.prototype.GetControllerList=function(){return this.m_controllerList};
j.prototype.GetContactList=function(){return this.m_contactList};j.prototype.GetNext=function(){return this.m_next};j.prototype.GetUserData=function(){return this.m_userData};j.prototype.SetUserData=function(a){this.m_userData=a};j.prototype.GetWorld=function(){return this.m_world};j.prototype.b2Body=function(a,b){this.m_flags=0;a.bullet&&(this.m_flags|=j.e_bulletFlag);a.fixedRotation&&(this.m_flags|=j.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=j.e_allowSleepFlag);a.awake&&(this.m_flags|=j.e_awakeFlag);
a.active&&(this.m_flags|=j.e_activeFlag);this.m_world=b;this.m_xf.position.SetV(a.position);this.m_xf.R.Set(a.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,d=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*d.x+c.col2.x*d.y;this.m_sweep.c.y=c.col1.y*d.x+c.col2.y*d.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=
null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(a.linearVelocity);this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=a.type;this.m_invMass=this.m_type==j.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=0;this.m_inertiaScale=a.inertiaScale;this.m_userData=a.userData;this.m_fixtureList=null;this.m_fixtureCount=0};j.prototype.SynchronizeFixtures=
function(){var a=j.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,c=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*c.x+b.col2.x*c.y);a.position.y=this.m_sweep.c0.y-(b.col1.y*c.x+b.col2.y*c.y);c=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.Synchronize(c,a,this.m_xf)};j.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y);
this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)};j.prototype.ShouldCollide=function(a){if(this.m_type!=j.b2_dynamicBody&&a.m_type!=j.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&b.joint.m_collideConnected==!1)return!1;return!0};j.prototype.Advance=function(a){a===void 0&&(a=0);this.m_sweep.Advance(a);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=this.m_sweep.a0;this.SynchronizeTransform()};a.postDefs.push(function(){a.Dynamics.b2Body.s_xf1=new d;
a.Dynamics.b2Body.e_islandFlag=1;a.Dynamics.b2Body.e_awakeFlag=2;a.Dynamics.b2Body.e_allowSleepFlag=4;a.Dynamics.b2Body.e_bulletFlag=8;a.Dynamics.b2Body.e_fixedRotationFlag=16;a.Dynamics.b2Body.e_activeFlag=32;a.Dynamics.b2Body.b2_staticBody=0;a.Dynamics.b2Body.b2_kinematicBody=1;a.Dynamics.b2Body.b2_dynamicBody=2});z.b2BodyDef=function(){this.position=new h;this.linearVelocity=new h};z.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,
0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=j.b2_staticBody;this.active=!0;this.inertiaScale=1};B.b2ContactFilter=function(){};B.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),d=b.GetFilterData();if(c.groupIndex==d.groupIndex&&c.groupIndex!=0)return c.groupIndex>0;return(c.maskBits&d.categoryBits)!=0&&(c.categoryBits&d.maskBits)!=0};B.prototype.RayCollide=function(a,b){if(!a)return!0;return this.ShouldCollide(a instanceof
J?a:null,b)};a.postDefs.push(function(){a.Dynamics.b2ContactFilter.b2_defaultFilter=new B});Q.b2ContactImpulse=function(){this.normalImpulses=new o(k.b2_maxManifoldPoints);this.tangentImpulses=new o(k.b2_maxManifoldPoints)};u.b2ContactListener=function(){};u.prototype.BeginContact=function(){};u.prototype.EndContact=function(){};u.prototype.PreSolve=function(){};u.prototype.PostSolve=function(){};a.postDefs.push(function(){a.Dynamics.b2ContactListener.b2_defaultListener=new u});K.b2ContactManager=
function(){};K.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=B.b2_defaultFilter;this.m_contactListener=u.b2_defaultListener;this.m_contactFactory=new w(this.m_allocator);this.m_broadPhase=new t};K.prototype.AddPair=function(a,b){var c=a instanceof J?a:null,d=b instanceof J?b:null,r=c.GetBody(),p=d.GetBody();if(r!=p){for(var e=p.GetContactList();e;){if(e.other==r){var h=e.contact.GetFixtureA(),g=e.contact.GetFixtureB();if(h==c&&g==d)return;if(h==
d&&g==c)return}e=e.next}if(p.ShouldCollide(r)!=!1&&this.m_contactFilter.ShouldCollide(c,d)!=!1){e=this.m_contactFactory.Create(c,d);c=e.GetFixtureA();d=e.GetFixtureB();r=c.m_body;p=d.m_body;e.m_prev=null;e.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null)this.m_world.m_contactList.m_prev=e;this.m_world.m_contactList=e;e.m_nodeA.contact=e;e.m_nodeA.other=p;e.m_nodeA.prev=null;e.m_nodeA.next=r.m_contactList;if(r.m_contactList!=null)r.m_contactList.prev=e.m_nodeA;r.m_contactList=
e.m_nodeA;e.m_nodeB.contact=e;e.m_nodeB.other=r;e.m_nodeB.prev=null;e.m_nodeB.next=p.m_contactList;if(p.m_contactList!=null)p.m_contactList.prev=e.m_nodeB;p.m_contactList=e.m_nodeB;++this.m_world.m_contactCount}}};K.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(a.generateCallback(this,this.AddPair))};K.prototype.Destroy=function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),b=b.GetBody(),c=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a);if(a.m_prev)a.m_prev.m_next=
a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_world.m_contactList)this.m_world.m_contactList=a.m_next;if(a.m_nodeA.prev)a.m_nodeA.prev.next=a.m_nodeA.next;if(a.m_nodeA.next)a.m_nodeA.next.prev=a.m_nodeA.prev;if(a.m_nodeA==b.m_contactList)b.m_contactList=a.m_nodeA.next;if(a.m_nodeB.prev)a.m_nodeB.prev.next=a.m_nodeB.next;if(a.m_nodeB.next)a.m_nodeB.next.prev=a.m_nodeB.prev;if(a.m_nodeB==c.m_contactList)c.m_contactList=a.m_nodeB.next;this.m_contactFactory.Destroy(a);--this.m_contactCount};
K.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),d=b.GetBody(),r=c.GetBody();if(d.IsAwake()==!1&&r.IsAwake()==!1)a=a.GetNext();else{if(a.m_flags&A.e_filterFlag){if(r.ShouldCollide(d)==!1){b=a;a=b.GetNext();this.Destroy(b);continue}if(this.m_contactFilter.ShouldCollide(b,c)==!1){b=a;a=b.GetNext();this.Destroy(b);continue}a.m_flags&=~A.e_filterFlag}this.m_broadPhase.TestOverlap(b.m_proxy,c.m_proxy)==!1?(b=a,a=b.GetNext(),this.Destroy(b)):
(a.Update(this.m_contactListener),a=a.GetNext())}}};a.postDefs.push(function(){a.Dynamics.b2ContactManager.s_evalCP=new g});D.b2DebugDraw=function(){};D.prototype.b2DebugDraw=function(){};D.prototype.SetFlags=function(){};D.prototype.GetFlags=function(){};D.prototype.AppendFlags=function(){};D.prototype.ClearFlags=function(){};D.prototype.SetSprite=function(){};D.prototype.GetSprite=function(){};D.prototype.SetDrawScale=function(){};D.prototype.GetDrawScale=function(){};D.prototype.SetLineThickness=
function(){};D.prototype.GetLineThickness=function(){};D.prototype.SetAlpha=function(){};D.prototype.GetAlpha=function(){};D.prototype.SetFillAlpha=function(){};D.prototype.GetFillAlpha=function(){};D.prototype.SetXFormScale=function(){};D.prototype.GetXFormScale=function(){};D.prototype.DrawPolygon=function(){};D.prototype.DrawSolidPolygon=function(){};D.prototype.DrawCircle=function(){};D.prototype.DrawSolidCircle=function(){};D.prototype.DrawSegment=function(){};D.prototype.DrawTransform=function(){};
a.postDefs.push(function(){a.Dynamics.b2DebugDraw.e_shapeBit=1;a.Dynamics.b2DebugDraw.e_jointBit=2;a.Dynamics.b2DebugDraw.e_aabbBit=4;a.Dynamics.b2DebugDraw.e_pairBit=8;a.Dynamics.b2DebugDraw.e_centerOfMassBit=16;a.Dynamics.b2DebugDraw.e_controllerBit=32});T.b2DestructionListener=function(){};T.prototype.SayGoodbyeJoint=function(){};T.prototype.SayGoodbyeFixture=function(){};I.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};I.prototype.Copy=function(){var a=new I;
a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a};J.b2Fixture=function(){this.m_filter=new I};J.prototype.GetType=function(){return this.m_shape.GetType()};J.prototype.GetShape=function(){return this.m_shape};J.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,this.m_body!=null))for(a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),d=b.GetFixtureB();if(c==this||d==this)b.SetSensor(c.IsSensor()||d.IsSensor());
a=a.next}};J.prototype.IsSensor=function(){return this.m_isSensor};J.prototype.SetFilterData=function(a){this.m_filter=a.Copy();if(!this.m_body)for(a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),d=b.GetFixtureB();(c==this||d==this)&&b.FlagForFiltering();a=a.next}};J.prototype.GetFilterData=function(){return this.m_filter.Copy()};J.prototype.GetBody=function(){return this.m_body};J.prototype.GetNext=function(){return this.m_next};J.prototype.GetUserData=function(){return this.m_userData};
J.prototype.SetUserData=function(a){this.m_userData=a};J.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)};J.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())};J.prototype.GetMassData=function(a){a===void 0&&(a=null);a==null&&(a=new v);this.m_shape.ComputeMass(a,this.m_density);return a};J.prototype.SetDensity=function(a){a===void 0&&(a=0);this.m_density=a};J.prototype.GetDensity=function(){return this.m_density};
J.prototype.GetFriction=function(){return this.m_friction};J.prototype.SetFriction=function(a){a===void 0&&(a=0);this.m_friction=a};J.prototype.GetRestitution=function(){return this.m_restitution};J.prototype.SetRestitution=function(a){a===void 0&&(a=0);this.m_restitution=a};J.prototype.GetAABB=function(){return this.m_aabb};J.prototype.b2Fixture=function(){this.m_aabb=new q;this.m_shape=this.m_next=this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};J.prototype.Create=
function(a,b,c){this.m_userData=c.userData;this.m_friction=c.friction;this.m_restitution=c.restitution;this.m_body=a;this.m_next=null;this.m_filter=c.filter.Copy();this.m_isSensor=c.isSensor;this.m_shape=c.shape.Copy();this.m_density=c.density};J.prototype.Destroy=function(){this.m_shape=null};J.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b);this.m_proxy=a.CreateProxy(this.m_aabb,this)};J.prototype.DestroyProxy=function(a){if(this.m_proxy!=null)a.DestroyProxy(this.m_proxy),
this.m_proxy=null};J.prototype.Synchronize=function(a,d,r){if(this.m_proxy){var e=new q,p=new q;this.m_shape.ComputeAABB(e,d);this.m_shape.ComputeAABB(p,r);this.m_aabb.Combine(e,p);d=b.SubtractVV(r.position,d.position);a.MoveProxy(this.m_proxy,this.m_aabb,d)}};U.b2FixtureDef=function(){this.filter=new I};U.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;
this.isSensor=!1};P.b2Island=function(){};P.prototype.b2Island=function(){this.m_bodies=new l;this.m_contacts=new l;this.m_joints=new l};P.prototype.Initialize=function(a,b,c,d,r,e){a===void 0&&(a=0);b===void 0&&(b=0);c===void 0&&(c=0);var p=0;this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=c;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=d;this.m_listener=r;this.m_contactSolver=e;for(p=this.m_bodies.length;p<a;p++)this.m_bodies[p]=null;for(p=this.m_contacts.length;p<
b;p++)this.m_contacts[p]=null;for(p=this.m_joints.length;p<c;p++)this.m_joints[p]=null};P.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};P.prototype.Solve=function(a,d,r){for(var e=0,p=0,h,e=0;e<this.m_bodyCount;++e)p=this.m_bodies[e],p.GetType()==j.b2_dynamicBody&&(p.m_linearVelocity.x+=a.dt*(d.x+p.m_invMass*p.m_force.x),p.m_linearVelocity.y+=a.dt*(d.y+p.m_invMass*p.m_force.y),p.m_angularVelocity+=a.dt*p.m_invI*p.m_torque,p.m_linearVelocity.Multiply(b.Clamp(1-
a.dt*p.m_linearDamping,0,1)),p.m_angularVelocity*=b.Clamp(1-a.dt*p.m_angularDamping,0,1));this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);d=this.m_contactSolver;d.InitVelocityConstraints(a);for(e=0;e<this.m_jointCount;++e)h=this.m_joints[e],h.InitVelocityConstraints(a);for(e=0;e<a.velocityIterations;++e){for(p=0;p<this.m_jointCount;++p)h=this.m_joints[p],h.SolveVelocityConstraints(a);d.SolveVelocityConstraints()}for(e=0;e<this.m_jointCount;++e)h=this.m_joints[e],
h.FinalizeVelocityConstraints();d.FinalizeVelocityConstraints();for(e=0;e<this.m_bodyCount;++e)if(p=this.m_bodies[e],p.GetType()!=j.b2_staticBody){var g=a.dt*p.m_linearVelocity.x,w=a.dt*p.m_linearVelocity.y;g*g+w*w>k.b2_maxTranslationSquared&&(p.m_linearVelocity.Normalize(),p.m_linearVelocity.x*=k.b2_maxTranslation*a.inv_dt,p.m_linearVelocity.y*=k.b2_maxTranslation*a.inv_dt);g=a.dt*p.m_angularVelocity;if(g*g>k.b2_maxRotationSquared)p.m_angularVelocity=p.m_angularVelocity<0?-k.b2_maxRotation*a.inv_dt:
k.b2_maxRotation*a.inv_dt;p.m_sweep.c0.SetV(p.m_sweep.c);p.m_sweep.a0=p.m_sweep.a;p.m_sweep.c.x+=a.dt*p.m_linearVelocity.x;p.m_sweep.c.y+=a.dt*p.m_linearVelocity.y;p.m_sweep.a+=a.dt*p.m_angularVelocity;p.SynchronizeTransform()}for(e=0;e<a.positionIterations;++e){g=d.SolvePositionConstraints(k.b2_contactBaumgarte);w=!0;for(p=0;p<this.m_jointCount;++p)h=this.m_joints[p],h=h.SolvePositionConstraints(k.b2_contactBaumgarte),w=w&&h;if(g&&w)break}this.Report(d.m_constraints);if(r){r=Number.MAX_VALUE;d=k.b2_linearSleepTolerance*
k.b2_linearSleepTolerance;g=k.b2_angularSleepTolerance*k.b2_angularSleepTolerance;for(e=0;e<this.m_bodyCount;++e)if(p=this.m_bodies[e],p.GetType()!=j.b2_staticBody){if((p.m_flags&j.e_allowSleepFlag)==0)r=p.m_sleepTime=0;(p.m_flags&j.e_allowSleepFlag)==0||p.m_angularVelocity*p.m_angularVelocity>g||b.Dot(p.m_linearVelocity,p.m_linearVelocity)>d?r=p.m_sleepTime=0:(p.m_sleepTime+=a.dt,r=b.Min(r,p.m_sleepTime))}if(r>=k.b2_timeToSleep)for(e=0;e<this.m_bodyCount;++e)p=this.m_bodies[e],p.SetAwake(!1)}};P.prototype.SolveTOI=
function(a){var b=0,c=0;this.m_contactSolver.Initialize(a,this.m_contacts,this.m_contactCount,this.m_allocator);for(var d=this.m_contactSolver,b=0;b<this.m_jointCount;++b)this.m_joints[b].InitVelocityConstraints(a);for(b=0;b<a.velocityIterations;++b){d.SolveVelocityConstraints();for(c=0;c<this.m_jointCount;++c)this.m_joints[c].SolveVelocityConstraints(a)}for(b=0;b<this.m_bodyCount;++b)if(c=this.m_bodies[b],c.GetType()!=j.b2_staticBody){var r=a.dt*c.m_linearVelocity.x,p=a.dt*c.m_linearVelocity.y;r*
r+p*p>k.b2_maxTranslationSquared&&(c.m_linearVelocity.Normalize(),c.m_linearVelocity.x*=k.b2_maxTranslation*a.inv_dt,c.m_linearVelocity.y*=k.b2_maxTranslation*a.inv_dt);r=a.dt*c.m_angularVelocity;if(r*r>k.b2_maxRotationSquared)c.m_angularVelocity=c.m_angularVelocity<0?-k.b2_maxRotation*a.inv_dt:k.b2_maxRotation*a.inv_dt;c.m_sweep.c0.SetV(c.m_sweep.c);c.m_sweep.a0=c.m_sweep.a;c.m_sweep.c.x+=a.dt*c.m_linearVelocity.x;c.m_sweep.c.y+=a.dt*c.m_linearVelocity.y;c.m_sweep.a+=a.dt*c.m_angularVelocity;c.SynchronizeTransform()}for(b=
0;b<a.positionIterations;++b){r=d.SolvePositionConstraints(0.75);p=!0;for(c=0;c<this.m_jointCount;++c)var e=this.m_joints[c].SolvePositionConstraints(k.b2_contactBaumgarte),p=p&&e;if(r&&p)break}this.Report(d.m_constraints)};P.prototype.Report=function(a){if(this.m_listener!=null)for(var b=0;b<this.m_contactCount;++b){for(var c=this.m_contacts[b],d=a[b],r=0;r<d.pointCount;++r)P.s_impulse.normalImpulses[r]=d.points[r].normalImpulse,P.s_impulse.tangentImpulses[r]=d.points[r].tangentImpulse;this.m_listener.PostSolve(c,
P.s_impulse)}};P.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a};P.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a};P.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a};a.postDefs.push(function(){a.Dynamics.b2Island.s_impulse=new Q});r.b2TimeStep=function(){};r.prototype.Set=function(a){this.dt=a.dt;this.inv_dt=a.inv_dt;this.positionIterations=a.positionIterations;this.velocityIterations=a.velocityIterations;
this.warmStarting=a.warmStarting};p.b2World=function(){this.s_stack=new l;this.m_contactManager=new K;this.m_contactSolver=new O;this.m_island=new P};p.prototype.b2World=function(a,b){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;p.m_warmStarting=!0;p.m_continuousPhysics=!0;this.m_allowSleep=b;this.m_gravity=a;this.m_inv_dt0=0;this.m_contactManager.m_world=
this;this.m_groundBody=this.CreateBody(new z)};p.prototype.SetDestructionListener=function(a){this.m_destructionListener=a};p.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a};p.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a};p.prototype.SetDebugDraw=function(a){this.m_debugDraw=a};p.prototype.SetBroadPhase=function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var d=
c.m_fixtureList;d;d=d.m_next)d.m_proxy=a.CreateProxy(b.GetFatAABB(d.m_proxy),d)};p.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};p.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};p.prototype.CreateBody=function(a){if(this.IsLocked()==!0)return null;a=new j(a,this);a.m_prev=null;if(a.m_next=this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a};p.prototype.DestroyBody=function(a){if(this.IsLocked()!=
!0){for(var b=a.m_jointList;b;){var c=b,b=b.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint);this.DestroyJoint(c.joint)}for(b=a.m_controllerList;b;)c=b,b=b.nextController,c.controller.RemoveBody(a);for(b=a.m_contactList;b;)c=b,b=b.next,this.m_contactManager.Destroy(c.contact);a.m_contactList=null;for(b=a.m_fixtureList;b;)c=b,b=b.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxy(this.m_contactManager.m_broadPhase),
c.Destroy();a.m_fixtureList=null;a.m_fixtureCount=0;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_bodyList)this.m_bodyList=a.m_next;--this.m_bodyCount}};p.prototype.CreateJoint=function(a){var b=V.Create(a,null);b.m_prev=null;if(b.m_next=this.m_jointList)this.m_jointList.m_prev=b;this.m_jointList=b;++this.m_jointCount;b.m_edgeA.joint=b;b.m_edgeA.other=b.m_bodyB;b.m_edgeA.prev=null;if(b.m_edgeA.next=b.m_bodyA.m_jointList)b.m_bodyA.m_jointList.prev=b.m_edgeA;
b.m_bodyA.m_jointList=b.m_edgeA;b.m_edgeB.joint=b;b.m_edgeB.other=b.m_bodyA;b.m_edgeB.prev=null;if(b.m_edgeB.next=b.m_bodyB.m_jointList)b.m_bodyB.m_jointList.prev=b.m_edgeB;b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,d=a.bodyB;if(a.collideConnected==!1)for(a=d.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next;return b};p.prototype.DestroyJoint=function(a){var b=a.m_collideConnected;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_jointList)this.m_jointList=
a.m_next;var c=a.m_bodyA,d=a.m_bodyB;c.SetAwake(!0);d.SetAwake(!0);if(a.m_edgeA.prev)a.m_edgeA.prev.next=a.m_edgeA.next;if(a.m_edgeA.next)a.m_edgeA.next.prev=a.m_edgeA.prev;if(a.m_edgeA==c.m_jointList)c.m_jointList=a.m_edgeA.next;a.m_edgeA.prev=null;a.m_edgeA.next=null;if(a.m_edgeB.prev)a.m_edgeB.prev.next=a.m_edgeB.next;if(a.m_edgeB.next)a.m_edgeB.next.prev=a.m_edgeB.prev;if(a.m_edgeB==d.m_jointList)d.m_jointList=a.m_edgeB.next;a.m_edgeB.prev=null;a.m_edgeB.next=null;V.Destroy(a,null);--this.m_jointCount;
if(b==!1)for(a=d.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next};p.prototype.AddController=function(a){a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList=a;a.m_world=this;this.m_controllerCount++;return a};p.prototype.RemoveController=function(a){if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(this.m_controllerList==a)this.m_controllerList=a.m_next;this.m_controllerCount--};p.prototype.CreateController=function(a){if(a.m_world!=this)throw Error("Controller can only be a member of one world");
a.m_next=this.m_controllerList;a.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=a;this.m_controllerList=a;++this.m_controllerCount;a.m_world=this;return a};p.prototype.DestroyController=function(a){a.Clear();if(a.m_next)a.m_next.m_prev=a.m_prev;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a==this.m_controllerList)this.m_controllerList=a.m_next;--this.m_controllerCount};p.prototype.SetWarmStarting=function(a){p.m_warmStarting=a};p.prototype.SetContinuousPhysics=function(a){p.m_continuousPhysics=
a};p.prototype.GetBodyCount=function(){return this.m_bodyCount};p.prototype.GetJointCount=function(){return this.m_jointCount};p.prototype.GetContactCount=function(){return this.m_contactCount};p.prototype.SetGravity=function(a){this.m_gravity=a};p.prototype.GetGravity=function(){return this.m_gravity};p.prototype.GetGroundBody=function(){return this.m_groundBody};p.prototype.Step=function(a,b,c){a===void 0&&(a=0);b===void 0&&(b=0);c===void 0&&(c=0);this.m_flags&p.e_newFixture&&(this.m_contactManager.FindNewContacts(),
this.m_flags&=~p.e_newFixture);this.m_flags|=p.e_locked;var d=p.s_timestep2;d.dt=a;d.velocityIterations=b;d.positionIterations=c;d.inv_dt=a>0?1/a:0;d.dtRatio=this.m_inv_dt0*a;d.warmStarting=p.m_warmStarting;this.m_contactManager.Collide();d.dt>0&&this.Solve(d);p.m_continuousPhysics&&d.dt>0&&this.SolveTOI(d);if(d.dt>0)this.m_inv_dt0=d.inv_dt;this.m_flags&=~p.e_locked};p.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0};p.prototype.DrawDebugData=
function(){if(this.m_debugDraw!=null){this.m_debugDraw.m_sprite.graphics.clear();var a=this.m_debugDraw.GetFlags(),b,c,d;new h;new h;new h;var r;new q;new q;r=[new h,new h,new h,new h];var e=new n(0,0,0);if(a&D.e_shapeBit)for(b=this.m_bodyList;b;b=b.m_next){r=b.m_xf;for(c=b.GetFixtureList();c;c=c.m_next)d=c.GetShape(),b.IsActive()==!1?e.Set(0.5,0.5,0.3):b.GetType()==j.b2_staticBody?e.Set(0.5,0.9,0.5):b.GetType()==j.b2_kinematicBody?e.Set(0.5,0.5,0.9):b.IsAwake()==!1?e.Set(0.6,0.6,0.6):e.Set(0.9,0.7,
0.7),this.DrawShape(d,r,e)}if(a&D.e_jointBit)for(b=this.m_jointList;b;b=b.m_next)this.DrawJoint(b);if(a&D.e_controllerBit)for(b=this.m_controllerList;b;b=b.m_next)b.Draw(this.m_debugDraw);if(a&D.e_pairBit){e.Set(0.3,0.9,0.9);for(b=this.m_contactManager.m_contactList;b;b=b.GetNext())d=b.GetFixtureA(),c=b.GetFixtureB(),d=d.GetAABB().GetCenter(),c=c.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(d,c,e)}if(a&D.e_aabbBit){d=this.m_contactManager.m_broadPhase;r=[new h,new h,new h,new h];for(b=this.m_bodyList;b;b=
b.GetNext())if(b.IsActive()!=!1)for(c=b.GetFixtureList();c;c=c.GetNext()){var g=d.GetFatAABB(c.m_proxy);r[0].Set(g.lowerBound.x,g.lowerBound.y);r[1].Set(g.upperBound.x,g.lowerBound.y);r[2].Set(g.upperBound.x,g.upperBound.y);r[3].Set(g.lowerBound.x,g.upperBound.y);this.m_debugDraw.DrawPolygon(r,4,e)}}if(a&D.e_centerOfMassBit)for(b=this.m_bodyList;b;b=b.m_next)r=p.s_xf,r.R=b.m_xf.R,r.position=b.GetWorldCenter(),this.m_debugDraw.DrawTransform(r)}};p.prototype.QueryAABB=function(a,b){var c=this.m_contactManager.m_broadPhase;
c.Query(function(b){return a(c.GetUserData(b))},b)};p.prototype.QueryShape=function(a,b,c){c===void 0&&(c=null);c==null&&(c=new d,c.SetIdentity());var r=this.m_contactManager.m_broadPhase,p=new q;b.ComputeAABB(p,c);r.Query(function(d){d=r.GetUserData(d)instanceof J?r.GetUserData(d):null;if(S.TestOverlap(b,c,d.GetShape(),d.GetBody().GetTransform()))return a(d);return!0},p)};p.prototype.QueryPoint=function(a,b){var c=this.m_contactManager.m_broadPhase,d=new q;d.lowerBound.Set(b.x-k.b2_linearSlop,b.y-
k.b2_linearSlop);d.upperBound.Set(b.x+k.b2_linearSlop,b.y+k.b2_linearSlop);c.Query(function(d){d=c.GetUserData(d)instanceof J?c.GetUserData(d):null;if(d.TestPoint(b))return a(d);return!0},d)};p.prototype.RayCast=function(a,b,c){var d=this.m_contactManager.m_broadPhase,r=new L,p=new R(b,c);d.RayCast(function(p,e){var g=d.GetUserData(e),g=g instanceof J?g:null;if(g.RayCast(r,p)){var j=r.fraction,w=new h((1-j)*b.x+j*c.x,(1-j)*b.y+j*c.y);return a(g,w,r.normal,j)}return p.maxFraction},p)};p.prototype.RayCastOne=
function(a,b){var c;this.RayCast(function(a,b,f,d){d===void 0&&(d=0);c=a;return d},a,b);return c};p.prototype.RayCastAll=function(a,b){var c=new l;this.RayCast(function(a){c[c.length]=a;return 1},a,b);return c};p.prototype.GetBodyList=function(){return this.m_bodyList};p.prototype.GetJointList=function(){return this.m_jointList};p.prototype.GetContactList=function(){return this.m_contactList};p.prototype.IsLocked=function(){return(this.m_flags&p.e_locked)>0};p.prototype.Solve=function(a){for(var b,
c=this.m_controllerList;c;c=c.m_next)c.Step(a);c=this.m_island;c.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~j.e_islandFlag;for(var d=this.m_contactList;d;d=d.m_next)d.m_flags&=~A.e_islandFlag;for(d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var d=this.s_stack,r=this.m_bodyList;r;r=r.m_next)if(!(r.m_flags&j.e_islandFlag)&&!(r.IsAwake()==
!1||r.IsActive()==!1)&&r.GetType()!=j.b2_staticBody){c.Clear();var p=0;d[p++]=r;for(r.m_flags|=j.e_islandFlag;p>0;)if(b=d[--p],c.AddBody(b),b.IsAwake()==!1&&b.SetAwake(!0),b.GetType()!=j.b2_staticBody){for(var e,g=b.m_contactList;g;g=g.next)if(!(g.contact.m_flags&A.e_islandFlag)&&!(g.contact.IsSensor()==!0||g.contact.IsEnabled()==!1||g.contact.IsTouching()==!1))c.AddContact(g.contact),g.contact.m_flags|=A.e_islandFlag,e=g.other,e.m_flags&j.e_islandFlag||(d[p++]=e,e.m_flags|=j.e_islandFlag);for(b=
b.m_jointList;b;b=b.next)if(b.joint.m_islandFlag!=!0&&(e=b.other,e.IsActive()!=!1))c.AddJoint(b.joint),b.joint.m_islandFlag=!0,e.m_flags&j.e_islandFlag||(d[p++]=e,e.m_flags|=j.e_islandFlag)}c.Solve(a,this.m_gravity,this.m_allowSleep);for(p=0;p<c.m_bodyCount;++p)b=c.m_bodies[p],b.GetType()==j.b2_staticBody&&(b.m_flags&=~j.e_islandFlag)}for(p=0;p<d.length;++p){if(!d[p])break;d[p]=null}for(b=this.m_bodyList;b;b=b.m_next)b.IsAwake()==!1||b.IsActive()==!1||b.GetType()!=j.b2_staticBody&&b.SynchronizeFixtures();
this.m_contactManager.FindNewContacts()};p.prototype.SolveTOI=function(a){var b,c,d,r=this.m_island;r.Initialize(this.m_bodyCount,k.b2_maxTOIContactsPerIsland,k.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var e=p.s_queue;for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~j.e_islandFlag,b.m_sweep.t0=0;for(d=this.m_contactList;d;d=d.m_next)d.m_flags&=~(A.e_toiFlag|A.e_islandFlag);for(d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;for(;;){var g=null,h=1;
for(d=this.m_contactList;d;d=d.m_next)if(!(d.IsSensor()==!0||d.IsEnabled()==!1||d.IsContinuous()==!1)){b=1;if(d.m_flags&A.e_toiFlag)b=d.m_toi;else{b=d.m_fixtureA;c=d.m_fixtureB;b=b.m_body;c=c.m_body;if((b.GetType()!=j.b2_dynamicBody||b.IsAwake()==!1)&&(c.GetType()!=j.b2_dynamicBody||c.IsAwake()==!1))continue;var w=b.m_sweep.t0;if(b.m_sweep.t0<c.m_sweep.t0)w=c.m_sweep.t0,b.m_sweep.Advance(w);else if(c.m_sweep.t0<b.m_sweep.t0)w=b.m_sweep.t0,c.m_sweep.Advance(w);b=d.ComputeTOI(b.m_sweep,c.m_sweep);k.b2Assert(0<=
b&&b<=1);b>0&&b<1&&(b=(1-b)*w+b,b>1&&(b=1));d.m_toi=b;d.m_flags|=A.e_toiFlag}Number.MIN_VALUE<b&&b<h&&(g=d,h=b)}if(g==null||1-100*Number.MIN_VALUE<h)break;b=g.m_fixtureA;c=g.m_fixtureB;b=b.m_body;c=c.m_body;p.s_backupA.Set(b.m_sweep);p.s_backupB.Set(c.m_sweep);b.Advance(h);c.Advance(h);g.Update(this.m_contactManager.m_contactListener);g.m_flags&=~A.e_toiFlag;if(g.IsSensor()==!0||g.IsEnabled()==!1)b.m_sweep.Set(p.s_backupA),c.m_sweep.Set(p.s_backupB),b.SynchronizeTransform(),c.SynchronizeTransform();
else if(g.IsTouching()!=!1){b.GetType()!=j.b2_dynamicBody&&(b=c);r.Clear();g=d=0;e[d+g++]=b;for(b.m_flags|=j.e_islandFlag;g>0;)if(b=e[d++],--g,r.AddBody(b),b.IsAwake()==!1&&b.SetAwake(!0),b.GetType()==j.b2_dynamicBody){for(c=b.m_contactList;c;c=c.next){if(r.m_contactCount==r.m_contactCapacity)break;if(!(c.contact.m_flags&A.e_islandFlag)&&!(c.contact.IsSensor()==!0||c.contact.IsEnabled()==!1||c.contact.IsTouching()==!1))r.AddContact(c.contact),c.contact.m_flags|=A.e_islandFlag,w=c.other,w.m_flags&
j.e_islandFlag||(w.GetType()!=j.b2_staticBody&&(w.Advance(h),w.SetAwake(!0)),e[d+g]=w,++g,w.m_flags|=j.e_islandFlag)}for(b=b.m_jointList;b;b=b.next)if(r.m_jointCount!=r.m_jointCapacity&&b.joint.m_islandFlag!=!0&&(w=b.other,w.IsActive()!=!1))r.AddJoint(b.joint),b.joint.m_islandFlag=!0,w.m_flags&j.e_islandFlag||(w.GetType()!=j.b2_staticBody&&(w.Advance(h),w.SetAwake(!0)),e[d+g]=w,++g,w.m_flags|=j.e_islandFlag)}d=p.s_timestep;d.warmStarting=!1;d.dt=(1-h)*a.dt;d.inv_dt=1/d.dt;d.dtRatio=0;d.velocityIterations=
a.velocityIterations;d.positionIterations=a.positionIterations;r.SolveTOI(d);for(h=h=0;h<r.m_bodyCount;++h)if(b=r.m_bodies[h],b.m_flags&=~j.e_islandFlag,b.IsAwake()!=!1&&b.GetType()==j.b2_dynamicBody){b.SynchronizeFixtures();for(c=b.m_contactList;c;c=c.next)c.contact.m_flags&=~A.e_toiFlag}for(h=0;h<r.m_contactCount;++h)d=r.m_contacts[h],d.m_flags&=~(A.e_toiFlag|A.e_islandFlag);for(h=0;h<r.m_jointCount;++h)d=r.m_joints[h],d.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};p.prototype.DrawJoint=
function(a){var b=a.GetBodyA(),c=a.GetBodyB(),d=b.m_xf.position,r=c.m_xf.position,e=a.GetAnchorA(),g=a.GetAnchorB(),h=p.s_jointColor;switch(a.m_type){case V.e_distanceJoint:this.m_debugDraw.DrawSegment(e,g,h);break;case V.e_pulleyJoint:b=a instanceof H?a:null;a=b.GetGroundAnchorA();b=b.GetGroundAnchorB();this.m_debugDraw.DrawSegment(a,e,h);this.m_debugDraw.DrawSegment(b,g,h);this.m_debugDraw.DrawSegment(a,b,h);break;case V.e_mouseJoint:this.m_debugDraw.DrawSegment(e,g,h);break;default:b!=this.m_groundBody&&
this.m_debugDraw.DrawSegment(d,e,h),this.m_debugDraw.DrawSegment(e,g,h),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,g,h)}};p.prototype.DrawShape=function(a,d,r){switch(a.m_type){case S.e_circleShape:var p=a instanceof C?a:null;this.m_debugDraw.DrawSolidCircle(b.MulX(d,p.m_p),p.m_radius,d.R.col1,r);break;case S.e_polygonShape:for(var p=0,p=a instanceof F?a:null,a=parseInt(p.GetVertexCount()),e=p.GetVertices(),g=new l(a),p=0;p<a;++p)g[p]=b.MulX(d,e[p]);this.m_debugDraw.DrawSolidPolygon(g,a,
r);break;case S.e_edgeShape:p=a instanceof G?a:null,this.m_debugDraw.DrawSegment(b.MulX(d,p.GetVertex1()),b.MulX(d,p.GetVertex2()),r)}};a.postDefs.push(function(){a.Dynamics.b2World.s_timestep2=new r;a.Dynamics.b2World.s_xf=new d;a.Dynamics.b2World.s_backupA=new e;a.Dynamics.b2World.s_backupB=new e;a.Dynamics.b2World.s_timestep=new r;a.Dynamics.b2World.s_queue=new l;a.Dynamics.b2World.s_jointColor=new n(0.5,0.8,0.8);a.Dynamics.b2World.e_newFixture=1;a.Dynamics.b2World.e_locked=2})})();(function(){var b=
a.Collision.Shapes.b2CircleShape,e=a.Collision.Shapes.b2EdgeShape,d=a.Collision.Shapes.b2PolygonShape,h=a.Collision.Shapes.b2Shape,n=a.Dynamics.Contacts.b2CircleContact,k=a.Dynamics.Contacts.b2Contact,q=a.Dynamics.Contacts.b2ContactConstraint,g=a.Dynamics.Contacts.b2ContactConstraintPoint,t=a.Dynamics.Contacts.b2ContactEdge,R=a.Dynamics.Contacts.b2ContactFactory,L=a.Dynamics.Contacts.b2ContactRegister,C=a.Dynamics.Contacts.b2ContactResult,G=a.Dynamics.Contacts.b2ContactSolver,v=a.Dynamics.Contacts.b2EdgeAndCircleContact,
F=a.Dynamics.Contacts.b2NullContact,S=a.Dynamics.Contacts.b2PolyAndCircleContact,j=a.Dynamics.Contacts.b2PolyAndEdgeContact,z=a.Dynamics.Contacts.b2PolygonContact,B=a.Dynamics.Contacts.b2PositionSolverManifold,Q=a.Dynamics.b2Body,u=a.Dynamics.b2TimeStep,K=a.Common.b2Settings,D=a.Common.Math.b2Mat22,T=a.Common.Math.b2Math,I=a.Common.Math.b2Vec2,J=a.Collision.b2Collision,U=a.Collision.b2ContactID,P=a.Collision.b2Manifold,r=a.Collision.b2TimeOfImpact,p=a.Collision.b2TOIInput,A=a.Collision.b2WorldManifold;
a.inherit(n,a.Dynamics.Contacts.b2Contact);n.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;n.b2CircleContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};n.Create=function(){return new n};n.Destroy=function(){};n.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};n.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),d=this.m_fixtureB.GetBody();J.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof b?this.m_fixtureA.GetShape():
null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,d.m_xf)};k.b2Contact=function(){this.m_nodeA=new t;this.m_nodeB=new t;this.m_manifold=new P;this.m_oldManifold=new P};k.prototype.GetManifold=function(){return this.m_manifold};k.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),d=this.m_fixtureA.GetShape(),f=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),d.m_radius,c.GetTransform(),f.m_radius)};
k.prototype.IsTouching=function(){return(this.m_flags&k.e_touchingFlag)==k.e_touchingFlag};k.prototype.IsContinuous=function(){return(this.m_flags&k.e_continuousFlag)==k.e_continuousFlag};k.prototype.SetSensor=function(a){a?this.m_flags|=k.e_sensorFlag:this.m_flags&=~k.e_sensorFlag};k.prototype.IsSensor=function(){return(this.m_flags&k.e_sensorFlag)==k.e_sensorFlag};k.prototype.SetEnabled=function(a){a?this.m_flags|=k.e_enabledFlag:this.m_flags&=~k.e_enabledFlag};k.prototype.IsEnabled=function(){return(this.m_flags&
k.e_enabledFlag)==k.e_enabledFlag};k.prototype.GetNext=function(){return this.m_next};k.prototype.GetFixtureA=function(){return this.m_fixtureA};k.prototype.GetFixtureB=function(){return this.m_fixtureB};k.prototype.FlagForFiltering=function(){this.m_flags|=k.e_filterFlag};k.prototype.b2Contact=function(){};k.prototype.Reset=function(a,b){a===void 0&&(a=null);b===void 0&&(b=null);this.m_flags=k.e_enabledFlag;if(!a||!b)this.m_fixtureB=this.m_fixtureA=null;else{if(a.IsSensor()||b.IsSensor())this.m_flags|=
k.e_sensorFlag;var c=a.GetBody(),d=b.GetBody();if(c.GetType()!=Q.b2_dynamicBody||c.IsBullet()||d.GetType()!=Q.b2_dynamicBody||d.IsBullet())this.m_flags|=k.e_continuousFlag;this.m_fixtureA=a;this.m_fixtureB=b;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}};k.prototype.Update=function(a){var b=this.m_oldManifold;
this.m_oldManifold=this.m_manifold;this.m_manifold=b;this.m_flags|=k.e_enabledFlag;var c=!1,b=(this.m_flags&k.e_touchingFlag)==k.e_touchingFlag,d=this.m_fixtureA.m_body,f=this.m_fixtureB.m_body,r=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&k.e_sensorFlag)r&&(c=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape(),d=d.GetTransform(),f=f.GetTransform(),c=h.TestOverlap(c,d,r,f)),this.m_manifold.m_pointCount=0;else{d.GetType()!=Q.b2_dynamicBody||d.IsBullet()||f.GetType()!=
Q.b2_dynamicBody||f.IsBullet()?this.m_flags|=k.e_continuousFlag:this.m_flags&=~k.e_continuousFlag;if(r){this.Evaluate();c=this.m_manifold.m_pointCount>0;for(r=0;r<this.m_manifold.m_pointCount;++r){var p=this.m_manifold.m_points[r];p.m_normalImpulse=0;p.m_tangentImpulse=0;for(var e=p.m_id,g=0;g<this.m_oldManifold.m_pointCount;++g){var j=this.m_oldManifold.m_points[g];if(j.m_id.key==e.key){p.m_normalImpulse=j.m_normalImpulse;p.m_tangentImpulse=j.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=
0;c!=b&&(d.SetAwake(!0),f.SetAwake(!0))}c?this.m_flags|=k.e_touchingFlag:this.m_flags&=~k.e_touchingFlag;b==!1&&c==!0&&a.BeginContact(this);b==!0&&c==!1&&a.EndContact(this);(this.m_flags&k.e_sensorFlag)==0&&a.PreSolve(this,this.m_oldManifold)};k.prototype.Evaluate=function(){};k.prototype.ComputeTOI=function(a,b){k.s_input.proxyA.Set(this.m_fixtureA.GetShape());k.s_input.proxyB.Set(this.m_fixtureB.GetShape());k.s_input.sweepA=a;k.s_input.sweepB=b;k.s_input.tolerance=K.b2_linearSlop;return r.TimeOfImpact(k.s_input)};
a.postDefs.push(function(){a.Dynamics.Contacts.b2Contact.e_sensorFlag=1;a.Dynamics.Contacts.b2Contact.e_continuousFlag=2;a.Dynamics.Contacts.b2Contact.e_islandFlag=4;a.Dynamics.Contacts.b2Contact.e_toiFlag=8;a.Dynamics.Contacts.b2Contact.e_touchingFlag=16;a.Dynamics.Contacts.b2Contact.e_enabledFlag=32;a.Dynamics.Contacts.b2Contact.e_filterFlag=64;a.Dynamics.Contacts.b2Contact.s_input=new p});q.b2ContactConstraint=function(){this.localPlaneNormal=new I;this.localPoint=new I;this.normal=new I;this.normalMass=
new D;this.K=new D};q.prototype.b2ContactConstraint=function(){this.points=new l(K.b2_maxManifoldPoints);for(var a=0;a<K.b2_maxManifoldPoints;a++)this.points[a]=new g};g.b2ContactConstraintPoint=function(){this.localPoint=new I;this.rA=new I;this.rB=new I};t.b2ContactEdge=function(){};R.b2ContactFactory=function(){};R.prototype.b2ContactFactory=function(a){this.m_allocator=a;this.InitializeRegisters()};R.prototype.AddType=function(a,b,c,d){c===void 0&&(c=0);d===void 0&&(d=0);this.m_registers[c][d].createFcn=
a;this.m_registers[c][d].destroyFcn=b;this.m_registers[c][d].primary=!0;if(c!=d)this.m_registers[d][c].createFcn=a,this.m_registers[d][c].destroyFcn=b,this.m_registers[d][c].primary=!1};R.prototype.InitializeRegisters=function(){this.m_registers=new l(h.e_shapeTypeCount);for(var a=0;a<h.e_shapeTypeCount;a++){this.m_registers[a]=new l(h.e_shapeTypeCount);for(var b=0;b<h.e_shapeTypeCount;b++)this.m_registers[a][b]=new L}this.AddType(n.Create,n.Destroy,h.e_circleShape,h.e_circleShape);this.AddType(S.Create,
S.Destroy,h.e_polygonShape,h.e_circleShape);this.AddType(z.Create,z.Destroy,h.e_polygonShape,h.e_polygonShape);this.AddType(v.Create,v.Destroy,h.e_edgeShape,h.e_circleShape);this.AddType(j.Create,j.Destroy,h.e_polygonShape,h.e_edgeShape)};R.prototype.Create=function(a,b){var c=parseInt(a.GetType()),d=parseInt(b.GetType()),c=this.m_registers[c][d];if(c.pool)return d=c.pool,c.pool=d.m_next,c.poolCount--,d.Reset(a,b),d;d=c.createFcn;return d!=null?(c.primary?(d=d(this.m_allocator),d.Reset(a,b)):(d=d(this.m_allocator),
d.Reset(b,a)),d):null};R.prototype.Destroy=function(a){a.m_manifold.m_pointCount>0&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=parseInt(a.m_fixtureA.GetType()),c=parseInt(a.m_fixtureB.GetType()),b=this.m_registers[b][c];b.poolCount++;a.m_next=b.pool;b.pool=a;b=b.destroyFcn;b(a,this.m_allocator)};L.b2ContactRegister=function(){};C.b2ContactResult=function(){this.position=new I;this.normal=new I;this.id=new U};G.b2ContactSolver=function(){this.m_step=new u;this.m_constraints=
new l};G.prototype.b2ContactSolver=function(){};G.prototype.Initialize=function(a,b,c,d){c===void 0&&(c=0);var f;this.m_step.Set(a);this.m_allocator=d;a=0;for(this.m_constraintCount=c;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new q;for(a=0;a<c;++a){f=b[a];var d=f.m_fixtureA,r=f.m_fixtureB,p=d.m_shape.m_radius,e=r.m_shape.m_radius,g=d.m_body,h=r.m_body,j=f.GetManifold(),k=K.b2MixFriction(d.GetFriction(),r.GetFriction()),A=K.b2MixRestitution(d.GetRestitution(),
r.GetRestitution()),n=g.m_linearVelocity.x,l=g.m_linearVelocity.y,o=h.m_linearVelocity.x,t=h.m_linearVelocity.y,v=g.m_angularVelocity,u=h.m_angularVelocity;K.b2Assert(j.m_pointCount>0);G.s_worldManifold.Initialize(j,g.m_xf,p,h.m_xf,e);r=G.s_worldManifold.m_normal.x;f=G.s_worldManifold.m_normal.y;d=this.m_constraints[a];d.bodyA=g;d.bodyB=h;d.manifold=j;d.normal.x=r;d.normal.y=f;d.pointCount=j.m_pointCount;d.friction=k;d.restitution=A;d.localPlaneNormal.x=j.m_localPlaneNormal.x;d.localPlaneNormal.y=
j.m_localPlaneNormal.y;d.localPoint.x=j.m_localPoint.x;d.localPoint.y=j.m_localPoint.y;d.radius=p+e;d.type=j.m_type;for(p=0;p<d.pointCount;++p){k=j.m_points[p];e=d.points[p];e.normalImpulse=k.m_normalImpulse;e.tangentImpulse=k.m_tangentImpulse;e.localPoint.SetV(k.m_localPoint);var k=e.rA.x=G.s_worldManifold.m_points[p].x-g.m_sweep.c.x,A=e.rA.y=G.s_worldManifold.m_points[p].y-g.m_sweep.c.y,C=e.rB.x=G.s_worldManifold.m_points[p].x-h.m_sweep.c.x,y=e.rB.y=G.s_worldManifold.m_points[p].y-h.m_sweep.c.y,
B=k*f-A*r,z=C*f-y*r;B*=B;z*=z;e.normalMass=1/(g.m_invMass+h.m_invMass+g.m_invI*B+h.m_invI*z);var F=g.m_mass*g.m_invMass+h.m_mass*h.m_invMass;F+=g.m_mass*g.m_invI*B+h.m_mass*h.m_invI*z;e.equalizedMass=1/F;z=f;F=-r;B=k*F-A*z;z=C*F-y*z;B*=B;z*=z;e.tangentMass=1/(g.m_invMass+h.m_invMass+g.m_invI*B+h.m_invI*z);e.velocityBias=0;k=d.normal.x*(o+-u*y-n- -v*A)+d.normal.y*(t+u*C-l-v*k);k<-K.b2_velocityThreshold&&(e.velocityBias+=-d.restitution*k)}if(d.pointCount==2)t=d.points[0],o=d.points[1],j=g.m_invMass,
g=g.m_invI,n=h.m_invMass,h=h.m_invI,l=t.rA.x*f-t.rA.y*r,t=t.rB.x*f-t.rB.y*r,v=o.rA.x*f-o.rA.y*r,o=o.rB.x*f-o.rB.y*r,r=j+n+g*l*l+h*t*t,f=j+n+g*v*v+h*o*o,h=j+n+g*l*v+h*t*o,r*r<100*(r*f-h*h)?(d.K.col1.Set(r,h),d.K.col2.Set(h,f),d.K.GetInverse(d.normalMass)):d.pointCount=1}};G.prototype.InitVelocityConstraints=function(a){for(var b=0;b<this.m_constraintCount;++b){var c=this.m_constraints[b],d=c.bodyA,f=c.bodyB,r=d.m_invMass,p=d.m_invI,e=f.m_invMass,g=f.m_invI,h=c.normal.x,j=c.normal.y,k=j,A=-h,n=0,l=
0;if(a.warmStarting){l=c.pointCount;for(n=0;n<l;++n){var o=c.points[n];o.normalImpulse*=a.dtRatio;o.tangentImpulse*=a.dtRatio;var q=o.normalImpulse*h+o.tangentImpulse*k,t=o.normalImpulse*j+o.tangentImpulse*A;d.m_angularVelocity-=p*(o.rA.x*t-o.rA.y*q);d.m_linearVelocity.x-=r*q;d.m_linearVelocity.y-=r*t;f.m_angularVelocity+=g*(o.rB.x*t-o.rB.y*q);f.m_linearVelocity.x+=e*q;f.m_linearVelocity.y+=e*t}}else{l=c.pointCount;for(n=0;n<l;++n)d=c.points[n],d.normalImpulse=0,d.tangentImpulse=0}}};G.prototype.SolveVelocityConstraints=
function(){for(var a=0,b,c=0,d=0,f=0,r=d=d=c=c=0,p=c=c=0,e=c=f=0,g=0,h,j=0;j<this.m_constraintCount;++j){var f=this.m_constraints[j],k=f.bodyA,A=f.bodyB,n=k.m_angularVelocity,l=A.m_angularVelocity,o=k.m_linearVelocity,q=A.m_linearVelocity,t=k.m_invMass,v=k.m_invI,G=A.m_invMass,C=A.m_invI,e=f.normal.x,u=g=f.normal.y;h=-e;p=f.friction;for(a=0;a<f.pointCount;a++)b=f.points[a],c=q.x-l*b.rB.y-o.x+n*b.rA.y,d=q.y+l*b.rB.x-o.y-n*b.rA.x,c=c*u+d*h,c=b.tangentMass*-c,d=p*b.normalImpulse,d=T.Clamp(b.tangentImpulse+
c,-d,d),c=d-b.tangentImpulse,r=c*u,c*=h,o.x-=t*r,o.y-=t*c,n-=v*(b.rA.x*c-b.rA.y*r),q.x+=G*r,q.y+=G*c,l+=C*(b.rB.x*c-b.rB.y*r),b.tangentImpulse=d;parseInt(f.pointCount);if(f.pointCount==1)b=f.points[0],c=q.x+-l*b.rB.y-o.x- -n*b.rA.y,d=q.y+l*b.rB.x-o.y-n*b.rA.x,f=c*e+d*g,c=-b.normalMass*(f-b.velocityBias),d=b.normalImpulse+c,d=d>0?d:0,c=d-b.normalImpulse,r=c*e,c*=g,o.x-=t*r,o.y-=t*c,n-=v*(b.rA.x*c-b.rA.y*r),q.x+=G*r,q.y+=G*c,l+=C*(b.rB.x*c-b.rB.y*r),b.normalImpulse=d;else{b=f.points[0];var a=f.points[1],
c=b.normalImpulse,p=a.normalImpulse,B=(q.x-l*b.rB.y-o.x+n*b.rA.y)*e+(q.y+l*b.rB.x-o.y-n*b.rA.x)*g,y=(q.x-l*a.rB.y-o.x+n*a.rA.y)*e+(q.y+l*a.rB.x-o.y-n*a.rA.x)*g,d=B-b.velocityBias,r=y-a.velocityBias;h=f.K;d-=h.col1.x*c+h.col2.x*p;for(r-=h.col1.y*c+h.col2.y*p;;){h=f.normalMass;u=-(h.col1.x*d+h.col2.x*r);h=-(h.col1.y*d+h.col2.y*r);if(u>=0&&h>=0){c=u-c;p=h-p;f=c*e;c*=g;e*=p;g*=p;o.x-=t*(f+e);o.y-=t*(c+g);n-=v*(b.rA.x*c-b.rA.y*f+a.rA.x*g-a.rA.y*e);q.x+=G*(f+e);q.y+=G*(c+g);l+=C*(b.rB.x*c-b.rB.y*f+a.rB.x*
g-a.rB.y*e);b.normalImpulse=u;a.normalImpulse=h;break}u=-b.normalMass*d;h=0;y=f.K.col1.y*u+r;if(u>=0&&y>=0){c=u-c;p=h-p;f=c*e;c*=g;e*=p;g*=p;o.x-=t*(f+e);o.y-=t*(c+g);n-=v*(b.rA.x*c-b.rA.y*f+a.rA.x*g-a.rA.y*e);q.x+=G*(f+e);q.y+=G*(c+g);l+=C*(b.rB.x*c-b.rB.y*f+a.rB.x*g-a.rB.y*e);b.normalImpulse=u;a.normalImpulse=h;break}u=0;h=-a.normalMass*r;B=f.K.col2.x*h+d;if(h>=0&&B>=0){c=u-c;p=h-p;f=c*e;c*=g;e*=p;g*=p;o.x-=t*(f+e);o.y-=t*(c+g);n-=v*(b.rA.x*c-b.rA.y*f+a.rA.x*g-a.rA.y*e);q.x+=G*(f+e);q.y+=G*(c+g);
l+=C*(b.rB.x*c-b.rB.y*f+a.rB.x*g-a.rB.y*e);b.normalImpulse=u;a.normalImpulse=h;break}h=u=0;B=d;y=r;if(B>=0&&y>=0){c=u-c;p=h-p;f=c*e;c*=g;e*=p;g*=p;o.x-=t*(f+e);o.y-=t*(c+g);n-=v*(b.rA.x*c-b.rA.y*f+a.rA.x*g-a.rA.y*e);q.x+=G*(f+e);q.y+=G*(c+g);l+=C*(b.rB.x*c-b.rB.y*f+a.rB.x*g-a.rB.y*e);b.normalImpulse=u;a.normalImpulse=h;break}break}}k.m_angularVelocity=n;A.m_angularVelocity=l}};G.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],
c=b.manifold,d=0;d<b.pointCount;++d){var f=c.m_points[d],r=b.points[d];f.m_normalImpulse=r.normalImpulse;f.m_tangentImpulse=r.tangentImpulse}};G.prototype.SolvePositionConstraints=function(a){a===void 0&&(a=0);for(var b=0,c=0;c<this.m_constraintCount;c++){var d=this.m_constraints[c],f=d.bodyA,r=d.bodyB,p=f.m_mass*f.m_invMass,e=f.m_mass*f.m_invI,g=r.m_mass*r.m_invMass,h=r.m_mass*r.m_invI;G.s_psm.Initialize(d);for(var j=G.s_psm.m_normal,k=0;k<d.pointCount;k++){var A=d.points[k],n=G.s_psm.m_points[k],
l=G.s_psm.m_separations[k],o=n.x-f.m_sweep.c.x,q=n.y-f.m_sweep.c.y,t=n.x-r.m_sweep.c.x,n=n.y-r.m_sweep.c.y,b=b<l?b:l,l=T.Clamp(a*(l+K.b2_linearSlop),-K.b2_maxLinearCorrection,0);l*=-A.equalizedMass;A=l*j.x;l*=j.y;f.m_sweep.c.x-=p*A;f.m_sweep.c.y-=p*l;f.m_sweep.a-=e*(o*l-q*A);f.SynchronizeTransform();r.m_sweep.c.x+=g*A;r.m_sweep.c.y+=g*l;r.m_sweep.a+=h*(t*l-n*A);r.SynchronizeTransform()}}return b>-1.5*K.b2_linearSlop};a.postDefs.push(function(){a.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new A;
a.Dynamics.Contacts.b2ContactSolver.s_psm=new B});a.inherit(v,a.Dynamics.Contacts.b2Contact);v.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;v.b2EdgeAndCircleContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};v.Create=function(){return new v};v.Destroy=function(){};v.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};v.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),d=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,
this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,d.m_xf)};v.prototype.b2CollideEdgeAndCircle=function(){};a.inherit(F,a.Dynamics.Contacts.b2Contact);F.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;F.b2NullContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};F.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};F.prototype.Evaluate=function(){};
a.inherit(S,a.Dynamics.Contacts.b2Contact);S.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;S.b2PolyAndCircleContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};S.Create=function(){return new S};S.Destroy=function(){};S.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b);K.b2Assert(a.GetType()==h.e_polygonShape);K.b2Assert(b.GetType()==h.e_circleShape)};S.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,r=this.m_fixtureB.m_body;J.CollidePolygonAndCircle(this.m_manifold,
this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof b?this.m_fixtureB.GetShape():null,r.m_xf)};a.inherit(j,a.Dynamics.Contacts.b2Contact);j.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;j.b2PolyAndEdgeContact=function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};j.Create=function(){return new j};j.Destroy=function(){};j.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b);K.b2Assert(a.GetType()==
h.e_polygonShape);K.b2Assert(b.GetType()==h.e_edgeShape)};j.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,b.m_xf)};j.prototype.b2CollidePolyAndEdge=function(){};a.inherit(z,a.Dynamics.Contacts.b2Contact);z.prototype.__super=a.Dynamics.Contacts.b2Contact.prototype;z.b2PolygonContact=
function(){a.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};z.Create=function(){return new z};z.Destroy=function(){};z.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};z.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();J.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof d?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof d?this.m_fixtureB.GetShape():null,b.m_xf)};B.b2PositionSolverManifold=
function(){};B.prototype.b2PositionSolverManifold=function(){this.m_normal=new I;this.m_separations=new o(K.b2_maxManifoldPoints);this.m_points=new l(K.b2_maxManifoldPoints);for(var a=0;a<K.b2_maxManifoldPoints;a++)this.m_points[a]=new I};B.prototype.Initialize=function(a){K.b2Assert(a.pointCount>0);var b=0,c=0,d=0,f,r=0,p=0;switch(a.type){case P.e_circles:f=a.bodyA.m_xf.R;d=a.localPoint;b=a.bodyA.m_xf.position.x+(f.col1.x*d.x+f.col2.x*d.y);c=a.bodyA.m_xf.position.y+(f.col1.y*d.x+f.col2.y*d.y);f=
a.bodyB.m_xf.R;d=a.points[0].localPoint;r=a.bodyB.m_xf.position.x+(f.col1.x*d.x+f.col2.x*d.y);f=a.bodyB.m_xf.position.y+(f.col1.y*d.x+f.col2.y*d.y);var d=r-b,p=f-c,e=d*d+p*p;e>Number.MIN_VALUE*Number.MIN_VALUE?(e=Math.sqrt(e),this.m_normal.x=d/e,this.m_normal.y=p/e):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=0.5*(b+r);this.m_points[0].y=0.5*(c+f);this.m_separations[0]=d*this.m_normal.x+p*this.m_normal.y-a.radius;break;case P.e_faceA:f=a.bodyA.m_xf.R;d=a.localPlaneNormal;this.m_normal.x=
f.col1.x*d.x+f.col2.x*d.y;this.m_normal.y=f.col1.y*d.x+f.col2.y*d.y;f=a.bodyA.m_xf.R;d=a.localPoint;r=a.bodyA.m_xf.position.x+(f.col1.x*d.x+f.col2.x*d.y);p=a.bodyA.m_xf.position.y+(f.col1.y*d.x+f.col2.y*d.y);f=a.bodyB.m_xf.R;for(b=0;b<a.pointCount;++b)d=a.points[b].localPoint,c=a.bodyB.m_xf.position.x+(f.col1.x*d.x+f.col2.x*d.y),d=a.bodyB.m_xf.position.y+(f.col1.y*d.x+f.col2.y*d.y),this.m_separations[b]=(c-r)*this.m_normal.x+(d-p)*this.m_normal.y-a.radius,this.m_points[b].x=c,this.m_points[b].y=d;
break;case P.e_faceB:f=a.bodyB.m_xf.R;d=a.localPlaneNormal;this.m_normal.x=f.col1.x*d.x+f.col2.x*d.y;this.m_normal.y=f.col1.y*d.x+f.col2.y*d.y;f=a.bodyB.m_xf.R;d=a.localPoint;r=a.bodyB.m_xf.position.x+(f.col1.x*d.x+f.col2.x*d.y);p=a.bodyB.m_xf.position.y+(f.col1.y*d.x+f.col2.y*d.y);f=a.bodyA.m_xf.R;for(b=0;b<a.pointCount;++b)d=a.points[b].localPoint,c=a.bodyA.m_xf.position.x+(f.col1.x*d.x+f.col2.x*d.y),d=a.bodyA.m_xf.position.y+(f.col1.y*d.x+f.col2.y*d.y),this.m_separations[b]=(c-r)*this.m_normal.x+
(d-p)*this.m_normal.y-a.radius,this.m_points[b].Set(c,d);this.m_normal.x*=-1;this.m_normal.y*=-1}};a.postDefs.push(function(){a.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new I;a.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new I})})();(function(){var b=a.Common.Math.b2Mat22,e=a.Common.Math.b2Math,d=a.Common.Math.b2Vec2,h=a.Common.b2Color,n=a.Dynamics.Controllers.b2BuoyancyController,k=a.Dynamics.Controllers.b2ConstantAccelController,l=a.Dynamics.Controllers.b2ConstantForceController,
g=a.Dynamics.Controllers.b2Controller,o=a.Dynamics.Controllers.b2ControllerEdge,q=a.Dynamics.Controllers.b2GravityController,t=a.Dynamics.Controllers.b2TensorDampingController;a.inherit(n,a.Dynamics.Controllers.b2Controller);n.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;n.b2BuoyancyController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new d(0,-1);this.density=this.offset=0;this.velocity=new d(0,0);this.linearDrag=2;this.angularDrag=
1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};n.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity)this.gravity=this.GetWorld().GetGravity().Copy();for(var a=this.m_bodyList;a;a=a.nextBody){var b=a.body;if(b.IsAwake()!=!1){for(var c=new d,e=new d,g=0,h=0,k=b.GetFixtureList();k;k=k.GetNext()){var n=new d,l=k.GetShape().ComputeSubmergedArea(this.normal,this.offset,b.GetTransform(),n);g+=l;c.x+=l*n.x;c.y+=l*n.y;var o=0,o=1;h+=l*o;e.x+=l*n.x*o;e.y+=l*n.y*o}c.x/=g;
c.y/=g;e.x/=h;e.y/=h;g<Number.MIN_VALUE||(h=this.gravity.GetNegative(),h.Multiply(this.density*g),b.ApplyForce(h,e),e=b.GetLinearVelocityFromWorldPoint(c),e.Subtract(this.velocity),e.Multiply(-this.linearDrag*g),b.ApplyForce(e,c),b.ApplyTorque(-b.GetInertia()/b.GetMass()*g*b.GetAngularVelocity()*this.angularDrag))}}}};n.prototype.Draw=function(a){var b=new d,c=new d;b.x=this.normal.x*this.offset+this.normal.y*1E3;b.y=this.normal.y*this.offset-this.normal.x*1E3;c.x=this.normal.x*this.offset-this.normal.y*
1E3;c.y=this.normal.y*this.offset+this.normal.x*1E3;var e=new h(0,0,1);a.DrawSegment(b,c,e)};a.inherit(k,a.Dynamics.Controllers.b2Controller);k.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;k.b2ConstantAccelController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new d(0,0)};k.prototype.Step=function(a){for(var a=new d(this.A.x*a.dt,this.A.y*a.dt),b=this.m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.SetLinearVelocity(new d(c.GetLinearVelocity().x+
a.x,c.GetLinearVelocity().y+a.y))}};a.inherit(l,a.Dynamics.Controllers.b2Controller);l.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;l.b2ConstantForceController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new d(0,0)};l.prototype.Step=function(){for(var a=this.m_bodyList;a;a=a.nextBody){var b=a.body;b.IsAwake()&&b.ApplyForce(this.F,b.GetWorldCenter())}};g.b2Controller=function(){};g.prototype.Step=function(){};g.prototype.Draw=function(){};
g.prototype.AddBody=function(a){var b=new o;b.controller=this;b.body=a;b.nextBody=this.m_bodyList;b.prevBody=null;this.m_bodyList=b;if(b.nextBody)b.nextBody.prevBody=b;this.m_bodyCount++;b.nextController=a.m_controllerList;b.prevController=null;a.m_controllerList=b;if(b.nextController)b.nextController.prevController=b;a.m_controllerCount++};g.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;if(b.prevBody)b.prevBody.nextBody=b.nextBody;if(b.nextBody)b.nextBody.prevBody=
b.prevBody;if(b.nextController)b.nextController.prevController=b.prevController;if(b.prevController)b.prevController.nextController=b.nextController;if(this.m_bodyList==b)this.m_bodyList=b.nextBody;if(a.m_controllerList==b)a.m_controllerList=b.nextController;a.m_controllerCount--;this.m_bodyCount--};g.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};g.prototype.GetNext=function(){return this.m_next};g.prototype.GetWorld=function(){return this.m_world};g.prototype.GetBodyList=
function(){return this.m_bodyList};o.b2ControllerEdge=function(){};a.inherit(q,a.Dynamics.Controllers.b2Controller);q.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;q.b2GravityController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};q.prototype.Step=function(){var a=null,b=null,c=null,e=0,g=null,h=null,k=null,n=0,l=0,o=0,n=null;if(this.invSqr)for(a=this.m_bodyList;a;a=a.nextBody){b=a.body;c=b.GetWorldCenter();e=b.GetMass();
for(g=this.m_bodyList;g!=a;g=g.nextBody)h=g.body,k=h.GetWorldCenter(),n=k.x-c.x,l=k.y-c.y,o=n*n+l*l,o<Number.MIN_VALUE||(n=new d(n,l),n.Multiply(this.G/o/Math.sqrt(o)*e*h.GetMass()),b.IsAwake()&&b.ApplyForce(n,c),n.Multiply(-1),h.IsAwake()&&h.ApplyForce(n,k))}else for(a=this.m_bodyList;a;a=a.nextBody){b=a.body;c=b.GetWorldCenter();e=b.GetMass();for(g=this.m_bodyList;g!=a;g=g.nextBody)h=g.body,k=h.GetWorldCenter(),n=k.x-c.x,l=k.y-c.y,o=n*n+l*l,o<Number.MIN_VALUE||(n=new d(n,l),n.Multiply(this.G/o*
e*h.GetMass()),b.IsAwake()&&b.ApplyForce(n,c),n.Multiply(-1),h.IsAwake()&&h.ApplyForce(n,k))}};a.inherit(t,a.Dynamics.Controllers.b2Controller);t.prototype.__super=a.Dynamics.Controllers.b2Controller.prototype;t.b2TensorDampingController=function(){a.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new b;this.maxTimestep=0};t.prototype.SetAxisAligned=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.T.col1.x=-a;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-b;this.maxTimestep=
a>0||b>0?1/Math.max(a,b):0};t.prototype.Step=function(a){a=a.dt;if(!(a<=Number.MIN_VALUE)){if(a>this.maxTimestep&&this.maxTimestep>0)a=this.maxTimestep;for(var b=this.m_bodyList;b;b=b.nextBody){var c=b.body;if(c.IsAwake()){var g=c.GetWorldVector(e.MulMV(this.T,c.GetLocalVector(c.GetLinearVelocity())));c.SetLinearVelocity(new d(c.GetLinearVelocity().x+g.x*a,c.GetLinearVelocity().y+g.y*a))}}}}})();(function(){var b=a.Common.b2Settings,e=a.Common.Math.b2Mat22,d=a.Common.Math.b2Mat33,h=a.Common.Math.b2Math,
n=a.Common.Math.b2Vec2,k=a.Common.Math.b2Vec3,l=a.Dynamics.Joints.b2DistanceJoint,g=a.Dynamics.Joints.b2DistanceJointDef,o=a.Dynamics.Joints.b2FrictionJoint,q=a.Dynamics.Joints.b2FrictionJointDef,t=a.Dynamics.Joints.b2GearJoint,C=a.Dynamics.Joints.b2GearJointDef,G=a.Dynamics.Joints.b2Jacobian,v=a.Dynamics.Joints.b2Joint,F=a.Dynamics.Joints.b2JointDef,S=a.Dynamics.Joints.b2JointEdge,j=a.Dynamics.Joints.b2LineJoint,z=a.Dynamics.Joints.b2LineJointDef,B=a.Dynamics.Joints.b2MouseJoint,Q=a.Dynamics.Joints.b2MouseJointDef,
u=a.Dynamics.Joints.b2PrismaticJoint,K=a.Dynamics.Joints.b2PrismaticJointDef,D=a.Dynamics.Joints.b2PulleyJoint,T=a.Dynamics.Joints.b2PulleyJointDef,I=a.Dynamics.Joints.b2RevoluteJoint,J=a.Dynamics.Joints.b2RevoluteJointDef,U=a.Dynamics.Joints.b2WeldJoint,P=a.Dynamics.Joints.b2WeldJointDef;a.inherit(l,a.Dynamics.Joints.b2Joint);l.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;l.b2DistanceJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=
new n;this.m_u=new n};l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};l.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)};l.prototype.GetReactionTorque=function(){return 0};l.prototype.GetLength=function(){return this.m_length};l.prototype.SetLength=function(a){a===void 0&&(a=0);this.m_length=
a};l.prototype.GetFrequency=function(){return this.m_frequencyHz};l.prototype.SetFrequency=function(a){a===void 0&&(a=0);this.m_frequencyHz=a};l.prototype.GetDampingRatio=function(){return this.m_dampingRatio};l.prototype.SetDampingRatio=function(a){a===void 0&&(a=0);this.m_dampingRatio=a};l.prototype.b2DistanceJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;
this.m_dampingRatio=a.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};l.prototype.InitVelocityConstraints=function(a){var d,e=0,g=this.m_bodyA,h=this.m_bodyB;d=g.m_xf.R;var j=this.m_localAnchor1.x-g.m_sweep.localCenter.x,k=this.m_localAnchor1.y-g.m_sweep.localCenter.y,e=d.col1.x*j+d.col2.x*k,k=d.col1.y*j+d.col2.y*k,j=e;d=h.m_xf.R;var f=this.m_localAnchor2.x-h.m_sweep.localCenter.x,m=this.m_localAnchor2.y-h.m_sweep.localCenter.y,e=d.col1.x*f+d.col2.x*m,m=d.col1.y*f+d.col2.y*m,f=e;this.m_u.x=
h.m_sweep.c.x+f-g.m_sweep.c.x-j;this.m_u.y=h.m_sweep.c.y+m-g.m_sweep.c.y-k;e=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);e>b.b2_linearSlop?this.m_u.Multiply(1/e):this.m_u.SetZero();d=j*this.m_u.y-k*this.m_u.x;var n=f*this.m_u.y-m*this.m_u.x;d=g.m_invMass+g.m_invI*d*d+h.m_invMass+h.m_invI*n*n;this.m_mass=d!=0?1/d:0;if(this.m_frequencyHz>0){e-=this.m_length;var n=2*Math.PI*this.m_frequencyHz,l=this.m_mass*n*n;this.m_gamma=a.dt*(2*this.m_mass*this.m_dampingRatio*n+a.dt*l);this.m_gamma=this.m_gamma!=
0?1/this.m_gamma:0;this.m_bias=e*a.dt*l*this.m_gamma;this.m_mass=d+this.m_gamma;this.m_mass=this.m_mass!=0?1/this.m_mass:0}a.warmStarting?(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,d=this.m_impulse*this.m_u.y,g.m_linearVelocity.x-=g.m_invMass*a,g.m_linearVelocity.y-=g.m_invMass*d,g.m_angularVelocity-=g.m_invI*(j*d-k*a),h.m_linearVelocity.x+=h.m_invMass*a,h.m_linearVelocity.y+=h.m_invMass*d,h.m_angularVelocity+=h.m_invI*(f*d-m*a)):this.m_impulse=0};l.prototype.SolveVelocityConstraints=
function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,e=this.m_localAnchor1.y-b.m_sweep.localCenter.y,g=a.col1.x*d+a.col2.x*e,e=a.col1.y*d+a.col2.y*e,d=g;a=c.m_xf.R;var h=this.m_localAnchor2.x-c.m_sweep.localCenter.x,f=this.m_localAnchor2.y-c.m_sweep.localCenter.y,g=a.col1.x*h+a.col2.x*f,f=a.col1.y*h+a.col2.y*f,h=g,g=-this.m_mass*(this.m_u.x*(c.m_linearVelocity.x+-c.m_angularVelocity*f-(b.m_linearVelocity.x+-b.m_angularVelocity*e))+this.m_u.y*
(c.m_linearVelocity.y+c.m_angularVelocity*h-(b.m_linearVelocity.y+b.m_angularVelocity*d))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=g;a=g*this.m_u.x;g*=this.m_u.y;b.m_linearVelocity.x-=b.m_invMass*a;b.m_linearVelocity.y-=b.m_invMass*g;b.m_angularVelocity-=b.m_invI*(d*g-e*a);c.m_linearVelocity.x+=c.m_invMass*a;c.m_linearVelocity.y+=c.m_invMass*g;c.m_angularVelocity+=c.m_invI*(h*g-f*a)};l.prototype.SolvePositionConstraints=function(){var a;if(this.m_frequencyHz>0)return!0;var d=this.m_bodyA,
e=this.m_bodyB;a=d.m_xf.R;var g=this.m_localAnchor1.x-d.m_sweep.localCenter.x,j=this.m_localAnchor1.y-d.m_sweep.localCenter.y,k=a.col1.x*g+a.col2.x*j,j=a.col1.y*g+a.col2.y*j,g=k;a=e.m_xf.R;var n=this.m_localAnchor2.x-e.m_sweep.localCenter.x,f=this.m_localAnchor2.y-e.m_sweep.localCenter.y,k=a.col1.x*n+a.col2.x*f,f=a.col1.y*n+a.col2.y*f,n=k,k=e.m_sweep.c.x+n-d.m_sweep.c.x-g,m=e.m_sweep.c.y+f-d.m_sweep.c.y-j;a=Math.sqrt(k*k+m*m);k/=a;m/=a;a-=this.m_length;a=h.Clamp(a,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection);
var l=-this.m_mass*a;this.m_u.Set(k,m);k=l*this.m_u.x;m=l*this.m_u.y;d.m_sweep.c.x-=d.m_invMass*k;d.m_sweep.c.y-=d.m_invMass*m;d.m_sweep.a-=d.m_invI*(g*m-j*k);e.m_sweep.c.x+=e.m_invMass*k;e.m_sweep.c.y+=e.m_invMass*m;e.m_sweep.a+=e.m_invI*(n*m-f*k);d.SynchronizeTransform();e.SynchronizeTransform();return h.Abs(a)<b.b2_linearSlop};a.inherit(g,a.Dynamics.Joints.b2JointDef);g.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;g.b2DistanceJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new n;this.localAnchorB=new n};g.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};g.prototype.Initialize=function(a,b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(d));a=d.x-c.x;c=d.y-c.y;this.length=Math.sqrt(a*a+c*c);this.dampingRatio=this.frequencyHz=0};a.inherit(o,a.Dynamics.Joints.b2Joint);
o.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;o.b2FrictionJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_linearMass=new e;this.m_linearImpulse=new n};o.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};o.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};o.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*this.m_linearImpulse.x,
a*this.m_linearImpulse.y)};o.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);return a*this.m_angularImpulse};o.prototype.SetMaxForce=function(a){a===void 0&&(a=0);this.m_maxForce=a};o.prototype.GetMaxForce=function(){return this.m_maxForce};o.prototype.SetMaxTorque=function(a){a===void 0&&(a=0);this.m_maxTorque=a};o.prototype.GetMaxTorque=function(){return this.m_maxTorque};o.prototype.b2FrictionJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);
this.m_localAnchorB.SetV(a.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque};o.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,g=this.m_bodyB;b=d.m_xf.R;var h=this.m_localAnchorA.x-d.m_sweep.localCenter.x,j=this.m_localAnchorA.y-d.m_sweep.localCenter.y,c=b.col1.x*h+b.col2.x*j,j=b.col1.y*h+b.col2.y*j,h=c;b=g.m_xf.R;var f=this.m_localAnchorB.x-g.m_sweep.localCenter.x,
m=this.m_localAnchorB.y-g.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*m,m=b.col1.y*f+b.col2.y*m,f=c;b=d.m_invMass;var c=g.m_invMass,k=d.m_invI,n=g.m_invI,l=new e;l.col1.x=b+c;l.col2.x=0;l.col1.y=0;l.col2.y=b+c;l.col1.x+=k*j*j;l.col2.x+=-k*h*j;l.col1.y+=-k*h*j;l.col2.y+=k*h*h;l.col1.x+=n*m*m;l.col2.x+=-n*f*m;l.col1.y+=-n*f*m;l.col2.y+=n*f*f;l.GetInverse(this.m_linearMass);this.m_angularMass=k+n;if(this.m_angularMass>0)this.m_angularMass=1/this.m_angularMass;a.warmStarting?(this.m_linearImpulse.x*=
a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,d.m_linearVelocity.x-=b*a.x,d.m_linearVelocity.y-=b*a.y,d.m_angularVelocity-=k*(h*a.y-j*a.x+this.m_angularImpulse),g.m_linearVelocity.x+=c*a.x,g.m_linearVelocity.y+=c*a.y,g.m_angularVelocity+=n*(f*a.y-m*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};o.prototype.SolveVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB,g=d.m_linearVelocity,j=
d.m_angularVelocity,f=e.m_linearVelocity,m=e.m_angularVelocity,k=d.m_invMass,l=e.m_invMass,o=d.m_invI,q=e.m_invI;b=d.m_xf.R;var t=this.m_localAnchorA.x-d.m_sweep.localCenter.x,v=this.m_localAnchorA.y-d.m_sweep.localCenter.y,c=b.col1.x*t+b.col2.x*v,v=b.col1.y*t+b.col2.y*v,t=c;b=e.m_xf.R;var u=this.m_localAnchorB.x-e.m_sweep.localCenter.x,y=this.m_localAnchorB.y-e.m_sweep.localCenter.y,c=b.col1.x*u+b.col2.x*y,y=b.col1.y*u+b.col2.y*y,u=c;b=0;var c=-this.m_angularMass*(m-j),z=this.m_angularImpulse;b=
a.dt*this.m_maxTorque;this.m_angularImpulse=h.Clamp(this.m_angularImpulse+c,-b,b);c=this.m_angularImpulse-z;j-=o*c;m+=q*c;b=h.MulMV(this.m_linearMass,new n(-(f.x-m*y-g.x+j*v),-(f.y+m*u-g.y-j*t)));c=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(b);b=a.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b));b=h.SubtractVV(this.m_linearImpulse,c);g.x-=k*b.x;g.y-=k*b.y;j-=o*(t*b.y-v*b.x);f.x+=l*b.x;f.y+=l*b.y;m+=q*(u*b.y-
y*b.x);d.m_angularVelocity=j;e.m_angularVelocity=m};o.prototype.SolvePositionConstraints=function(){return!0};a.inherit(q,a.Dynamics.Joints.b2JointDef);q.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;q.b2FrictionJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};q.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_frictionJoint;this.maxTorque=this.maxForce=0};q.prototype.Initialize=
function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))};a.inherit(t,a.Dynamics.Joints.b2Joint);t.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;t.b2GearJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new n;this.m_groundAnchor2=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_J=new G};t.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};
t.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};t.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)};t.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,d=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,e=b.col1.x*c+b.col2.x*d,d=b.col1.y*c+b.col2.y*d;return a*(this.m_impulse*
this.m_J.angularB-e*this.m_impulse*this.m_J.linearB.y+d*this.m_impulse*this.m_J.linearB.x)};t.prototype.GetRatio=function(){return this.m_ratio};t.prototype.SetRatio=function(a){a===void 0&&(a=0);this.m_ratio=a};t.prototype.b2GearJoint=function(a){this.__super.b2Joint.call(this,a);var b=parseInt(a.joint1.m_type),c=parseInt(a.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var d=0,e=0;this.m_ground1=a.joint1.GetBodyA();this.m_bodyA=a.joint1.GetBodyB();b==v.e_revoluteJoint?
(this.m_revolute1=a.joint1 instanceof I?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),d=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof u?a.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),d=this.m_prismatic1.GetJointTranslation());this.m_ground2=a.joint2.GetBodyA();this.m_bodyB=a.joint2.GetBodyB();c==v.e_revoluteJoint?
(this.m_revolute2=a.joint2 instanceof I?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),e=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof u?a.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),e=this.m_prismatic2.GetJointTranslation());this.m_ratio=a.ratio;this.m_constant=d+this.m_ratio*e;this.m_impulse=0};t.prototype.InitVelocityConstraints=
function(a){var b=this.m_ground1,c=this.m_ground2,d=this.m_bodyA,e=this.m_bodyB,g=0,h=0,f=0,j=0,k=f=0,l=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,l+=d.m_invI):(b=b.m_xf.R,h=this.m_prismatic1.m_localXAxis1,g=b.col1.x*h.x+b.col2.x*h.y,h=b.col1.y*h.x+b.col2.y*h.y,b=d.m_xf.R,f=this.m_localAnchor1.x-d.m_sweep.localCenter.x,j=this.m_localAnchor1.y-d.m_sweep.localCenter.y,k=b.col1.x*f+b.col2.x*j,j=b.col1.y*f+b.col2.y*j,f=k*h-j*g,this.m_J.linearA.Set(-g,-h),this.m_J.angularA=-f,l+=d.m_invMass+
d.m_invI*f*f);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,l+=this.m_ratio*this.m_ratio*e.m_invI):(b=c.m_xf.R,h=this.m_prismatic2.m_localXAxis1,g=b.col1.x*h.x+b.col2.x*h.y,h=b.col1.y*h.x+b.col2.y*h.y,b=e.m_xf.R,f=this.m_localAnchor2.x-e.m_sweep.localCenter.x,j=this.m_localAnchor2.y-e.m_sweep.localCenter.y,k=b.col1.x*f+b.col2.x*j,j=b.col1.y*f+b.col2.y*j,f=k*h-j*g,this.m_J.linearB.Set(-this.m_ratio*g,-this.m_ratio*h),this.m_J.angularB=-this.m_ratio*f,l+=this.m_ratio*this.m_ratio*(e.m_invMass+e.m_invI*
f*f));this.m_mass=l>0?1/l:0;a.warmStarting?(d.m_linearVelocity.x+=d.m_invMass*this.m_impulse*this.m_J.linearA.x,d.m_linearVelocity.y+=d.m_invMass*this.m_impulse*this.m_J.linearA.y,d.m_angularVelocity+=d.m_invI*this.m_impulse*this.m_J.angularA,e.m_linearVelocity.x+=e.m_invMass*this.m_impulse*this.m_J.linearB.x,e.m_linearVelocity.y+=e.m_invMass*this.m_impulse*this.m_J.linearB.y,e.m_angularVelocity+=e.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};t.prototype.SolveVelocityConstraints=function(){var a=
this.m_bodyA,b=this.m_bodyB,c=-this.m_mass*this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);this.m_impulse+=c;a.m_linearVelocity.x+=a.m_invMass*c*this.m_J.linearA.x;a.m_linearVelocity.y+=a.m_invMass*c*this.m_J.linearA.y;a.m_angularVelocity+=a.m_invI*c*this.m_J.angularA;b.m_linearVelocity.x+=b.m_invMass*c*this.m_J.linearB.x;b.m_linearVelocity.y+=b.m_invMass*c*this.m_J.linearB.y;b.m_angularVelocity+=b.m_invI*c*this.m_J.angularB};t.prototype.SolvePositionConstraints=
function(){var a=this.m_bodyA,d=this.m_bodyB,e=0,g=0,e=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),g=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),e=-this.m_mass*(this.m_constant-(e+this.m_ratio*g));a.m_sweep.c.x+=a.m_invMass*e*this.m_J.linearA.x;a.m_sweep.c.y+=a.m_invMass*e*this.m_J.linearA.y;a.m_sweep.a+=a.m_invI*e*this.m_J.angularA;d.m_sweep.c.x+=d.m_invMass*e*this.m_J.linearB.x;d.m_sweep.c.y+=d.m_invMass*
e*this.m_J.linearB.y;d.m_sweep.a+=d.m_invI*e*this.m_J.angularB;a.SynchronizeTransform();d.SynchronizeTransform();return 0<b.b2_linearSlop};a.inherit(C,a.Dynamics.Joints.b2JointDef);C.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;C.b2GearJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};C.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};G.b2Jacobian=function(){this.linearA=
new n;this.linearB=new n};G.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};G.prototype.Set=function(a,b,c,d){b===void 0&&(b=0);d===void 0&&(d=0);this.linearA.SetV(a);this.angularA=b;this.linearB.SetV(c);this.angularB=d};G.prototype.Compute=function(a,b,c,d){b===void 0&&(b=0);d===void 0&&(d=0);return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*d};v.b2Joint=function(){this.m_edgeA=
new S;this.m_edgeB=new S;this.m_localCenterA=new n;this.m_localCenterB=new n};v.prototype.GetType=function(){return this.m_type};v.prototype.GetAnchorA=function(){return null};v.prototype.GetAnchorB=function(){return null};v.prototype.GetReactionForce=function(){return null};v.prototype.GetReactionTorque=function(){return 0};v.prototype.GetBodyA=function(){return this.m_bodyA};v.prototype.GetBodyB=function(){return this.m_bodyB};v.prototype.GetNext=function(){return this.m_next};v.prototype.GetUserData=
function(){return this.m_userData};v.prototype.SetUserData=function(a){this.m_userData=a};v.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};v.Create=function(a){var b=null;switch(a.type){case v.e_distanceJoint:b=new l(a instanceof g?a:null);break;case v.e_mouseJoint:b=new B(a instanceof Q?a:null);break;case v.e_prismaticJoint:b=new u(a instanceof K?a:null);break;case v.e_revoluteJoint:b=new I(a instanceof J?a:null);break;case v.e_pulleyJoint:b=new D(a instanceof
T?a:null);break;case v.e_gearJoint:b=new t(a instanceof C?a:null);break;case v.e_lineJoint:b=new j(a instanceof z?a:null);break;case v.e_weldJoint:b=new U(a instanceof P?a:null);break;case v.e_frictionJoint:b=new o(a instanceof q?a:null)}return b};v.Destroy=function(){};v.prototype.b2Joint=function(a){b.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=
a.userData};v.prototype.InitVelocityConstraints=function(){};v.prototype.SolveVelocityConstraints=function(){};v.prototype.FinalizeVelocityConstraints=function(){};v.prototype.SolvePositionConstraints=function(){return!1};a.postDefs.push(function(){a.Dynamics.Joints.b2Joint.e_unknownJoint=0;a.Dynamics.Joints.b2Joint.e_revoluteJoint=1;a.Dynamics.Joints.b2Joint.e_prismaticJoint=2;a.Dynamics.Joints.b2Joint.e_distanceJoint=3;a.Dynamics.Joints.b2Joint.e_pulleyJoint=4;a.Dynamics.Joints.b2Joint.e_mouseJoint=
5;a.Dynamics.Joints.b2Joint.e_gearJoint=6;a.Dynamics.Joints.b2Joint.e_lineJoint=7;a.Dynamics.Joints.b2Joint.e_weldJoint=8;a.Dynamics.Joints.b2Joint.e_frictionJoint=9;a.Dynamics.Joints.b2Joint.e_inactiveLimit=0;a.Dynamics.Joints.b2Joint.e_atLowerLimit=1;a.Dynamics.Joints.b2Joint.e_atUpperLimit=2;a.Dynamics.Joints.b2Joint.e_equalLimits=3});F.b2JointDef=function(){};F.prototype.b2JointDef=function(){this.type=v.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};S.b2JointEdge=
function(){};a.inherit(j,a.Dynamics.Joints.b2Joint);j.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;j.b2LineJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_localXAxis1=new n;this.m_localYAxis1=new n;this.m_axis=new n;this.m_perp=new n;this.m_K=new e;this.m_impulse=new n};j.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};j.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
j.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};j.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);return a*this.m_impulse.y};j.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),b=d.x-c.x,
c=d.y-c.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*c};j.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,c;c=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,g=c.col1.x*d+c.col2.x*e,e=c.col1.y*d+c.col2.y*e,d=g;c=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,f=this.m_localAnchor2.y-b.m_sweep.localCenter.y,g=c.col1.x*h+c.col2.x*f,f=c.col1.y*h+c.col2.y*f,h=g;c=b.m_sweep.c.x+h-(a.m_sweep.c.x+
d);var g=b.m_sweep.c.y+f-(a.m_sweep.c.y+e),j=a.GetWorldVector(this.m_localXAxis1),k=a.m_linearVelocity,l=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return c*-a*j.y+g*a*j.x+(j.x*(l.x+-b*f-k.x- -a*e)+j.y*(l.y+b*h-k.y-a*d))};j.prototype.IsLimitEnabled=function(){return this.m_enableLimit};j.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};j.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};j.prototype.GetUpperLimit=
function(){return this.m_upperTranslation};j.prototype.SetLimits=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};j.prototype.IsMotorEnabled=function(){return this.m_enableMotor};j.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};j.prototype.SetMotorSpeed=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);
this.m_motorSpeed=a};j.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};j.prototype.SetMaxMotorForce=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};j.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};j.prototype.GetMotorForce=function(){return this.m_motorImpulse};j.prototype.b2LineJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);
this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};j.prototype.InitVelocityConstraints=
function(a){var d=this.m_bodyA,e=this.m_bodyB,g,j=0;this.m_localCenterA.SetV(d.GetLocalCenter());this.m_localCenterB.SetV(e.GetLocalCenter());var k=d.GetTransform();e.GetTransform();g=d.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y,j=g.col1.x*l+g.col2.x*f,f=g.col1.y*l+g.col2.y*f,l=j;g=e.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,n=this.m_localAnchor2.y-this.m_localCenterB.y,j=g.col1.x*m+g.col2.x*n,n=g.col1.y*m+g.col2.y*n,m=j;g=
e.m_sweep.c.x+m-d.m_sweep.c.x-l;j=e.m_sweep.c.y+n-d.m_sweep.c.y-f;this.m_invMassA=d.m_invMass;this.m_invMassB=e.m_invMass;this.m_invIA=d.m_invI;this.m_invIB=e.m_invI;this.m_axis.SetV(h.MulMV(k.R,this.m_localXAxis1));this.m_a1=(g+l)*this.m_axis.y-(j+f)*this.m_axis.x;this.m_a2=m*this.m_axis.y-n*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(h.MulMV(k.R,
this.m_localYAxis1));this.m_s1=(g+l)*this.m_perp.y-(j+f)*this.m_perp.x;this.m_s2=m*this.m_perp.y-n*this.m_perp.x;k=this.m_invMassA;l=this.m_invMassB;f=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=k+l+f*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=f*this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=k+l+f*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;if(this.m_enableLimit)if(g=this.m_axis.x*g+this.m_axis.y*j,h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<
2*b.b2_linearSlop)this.m_limitState=v.e_equalLimits;else if(g<=this.m_lowerTranslation){if(this.m_limitState!=v.e_atLowerLimit)this.m_limitState=v.e_atLowerLimit,this.m_impulse.y=0}else if(g>=this.m_upperTranslation){if(this.m_limitState!=v.e_atUpperLimit)this.m_limitState=v.e_atUpperLimit,this.m_impulse.y=0}else this.m_limitState=v.e_inactiveLimit,this.m_impulse.y=0;else this.m_limitState=v.e_inactiveLimit;if(this.m_enableMotor==!1)this.m_motorImpulse=0;a.warmStarting?(this.m_impulse.x*=a.dtRatio,
this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,g=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,j=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,k=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,d.m_linearVelocity.x-=this.m_invMassA*a,d.m_linearVelocity.y-=this.m_invMassA*g,d.m_angularVelocity-=this.m_invIA*
j,e.m_linearVelocity.x+=this.m_invMassB*a,e.m_linearVelocity.y+=this.m_invMassB*g,e.m_angularVelocity+=this.m_invIB*k):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};j.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,g=c.m_linearVelocity,j=c.m_angularVelocity,f=0,m=0,k=0,l=0;if(this.m_enableMotor&&this.m_limitState!=v.e_equalLimits)l=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*
j-this.m_a1*e)),f=this.m_motorImpulse,m=a.dt*this.m_maxMotorForce,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+l,-m,m),l=this.m_motorImpulse-f,f=l*this.m_axis.x,m=l*this.m_axis.y,k=l*this.m_a1,l*=this.m_a2,d.x-=this.m_invMassA*f,d.y-=this.m_invMassA*m,e-=this.m_invIA*k,g.x+=this.m_invMassB*f,g.y+=this.m_invMassB*m,j+=this.m_invIB*l;m=this.m_perp.x*(g.x-d.x)+this.m_perp.y*(g.y-d.y)+this.m_s2*j-this.m_s1*e;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){k=this.m_axis.x*(g.x-d.x)+this.m_axis.y*
(g.y-d.y)+this.m_a2*j-this.m_a1*e;f=this.m_impulse.Copy();a=this.m_K.Solve(new n,-m,-k);this.m_impulse.Add(a);if(this.m_limitState==v.e_atLowerLimit)this.m_impulse.y=h.Max(this.m_impulse.y,0);else if(this.m_limitState==v.e_atUpperLimit)this.m_impulse.y=h.Min(this.m_impulse.y,0);m=-m-(this.m_impulse.y-f.y)*this.m_K.col2.x;k=0;k=this.m_K.col1.x!=0?m/this.m_K.col1.x+f.x:f.x;this.m_impulse.x=k;a.x=this.m_impulse.x-f.x;a.y=this.m_impulse.y-f.y;f=a.x*this.m_perp.x+a.y*this.m_axis.x;m=a.x*this.m_perp.y+
a.y*this.m_axis.y;k=a.x*this.m_s1+a.y*this.m_a1;l=a.x*this.m_s2+a.y*this.m_a2}else a=0,a=this.m_K.col1.x!=0?-m/this.m_K.col1.x:0,this.m_impulse.x+=a,f=a*this.m_perp.x,m=a*this.m_perp.y,k=a*this.m_s1,l=a*this.m_s2;d.x-=this.m_invMassA*f;d.y-=this.m_invMassA*m;e-=this.m_invIA*k;g.x+=this.m_invMassB*f;g.y+=this.m_invMassB*m;j+=this.m_invIB*l;b.m_linearVelocity.SetV(d);b.m_angularVelocity=e;c.m_linearVelocity.SetV(g);c.m_angularVelocity=j};j.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,
d=this.m_bodyB,g=a.m_sweep.c,j=a.m_sweep.a,k=d.m_sweep.c,l=d.m_sweep.a,o,f=0,m=0,q=0,t=0,v=o=0,u=0,m=!1,y=0,z=e.FromAngle(j),q=e.FromAngle(l);o=z;var u=this.m_localAnchor1.x-this.m_localCenterA.x,B=this.m_localAnchor1.y-this.m_localCenterA.y,f=o.col1.x*u+o.col2.x*B,B=o.col1.y*u+o.col2.y*B,u=f;o=q;q=this.m_localAnchor2.x-this.m_localCenterB.x;t=this.m_localAnchor2.y-this.m_localCenterB.y;f=o.col1.x*q+o.col2.x*t;t=o.col1.y*q+o.col2.y*t;q=f;o=k.x+q-g.x-u;f=k.y+t-g.y-B;if(this.m_enableLimit){this.m_axis=
h.MulMV(z,this.m_localXAxis1);this.m_a1=(o+u)*this.m_axis.y-(f+B)*this.m_axis.x;this.m_a2=q*this.m_axis.y-t*this.m_axis.x;var F=this.m_axis.x*o+this.m_axis.y*f;h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop?(y=h.Clamp(F,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection),v=h.Abs(F),m=!0):F<=this.m_lowerTranslation?(y=h.Clamp(F-this.m_lowerTranslation+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-F,m=!0):F>=this.m_upperTranslation&&(y=h.Clamp(F-this.m_upperTranslation+
b.b2_linearSlop,0,b.b2_maxLinearCorrection),v=F-this.m_upperTranslation,m=!0)}this.m_perp=h.MulMV(z,this.m_localYAxis1);this.m_s1=(o+u)*this.m_perp.y-(f+B)*this.m_perp.x;this.m_s2=q*this.m_perp.y-t*this.m_perp.x;z=new n;B=this.m_perp.x*o+this.m_perp.y*f;v=h.Max(v,h.Abs(B));u=0;m?(m=this.m_invMassA,q=this.m_invMassB,t=this.m_invIA,o=this.m_invIB,this.m_K.col1.x=m+q+t*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,this.m_K.col1.y=t*this.m_s1*this.m_a1+o*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,
this.m_K.col2.y=m+q+t*this.m_a1*this.m_a1+o*this.m_a2*this.m_a2,this.m_K.Solve(z,-B,-y)):(m=this.m_invMassA,q=this.m_invMassB,t=this.m_invIA,o=this.m_invIB,y=m+q+t*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,m=0,z.x=y!=0?-B/y:0,z.y=0);y=z.x*this.m_perp.x+z.y*this.m_axis.x;m=z.x*this.m_perp.y+z.y*this.m_axis.y;B=z.x*this.m_s1+z.y*this.m_a1;z=z.x*this.m_s2+z.y*this.m_a2;g.x-=this.m_invMassA*y;g.y-=this.m_invMassA*m;j-=this.m_invIA*B;k.x+=this.m_invMassB*y;k.y+=this.m_invMassB*m;l+=this.m_invIB*z;a.m_sweep.a=
j;d.m_sweep.a=l;a.SynchronizeTransform();d.SynchronizeTransform();return v<=b.b2_linearSlop&&u<=b.b2_angularSlop};a.inherit(z,a.Dynamics.Joints.b2JointDef);z.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;z.b2LineJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n};z.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=
!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};z.prototype.Initialize=function(a,b,c,d){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=this.bodyA.GetLocalVector(d)};a.inherit(B,a.Dynamics.Joints.b2Joint);B.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;B.b2MouseJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new e;
this.K1=new e;this.K2=new e;this.m_localAnchor=new n;this.m_target=new n;this.m_impulse=new n;this.m_mass=new e;this.m_C=new n};B.prototype.GetAnchorA=function(){return this.m_target};B.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};B.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*this.m_impulse.x,a*this.m_impulse.y)};B.prototype.GetReactionTorque=function(){return 0};B.prototype.GetTarget=function(){return this.m_target};B.prototype.SetTarget=
function(a){this.m_bodyB.IsAwake()==!1&&this.m_bodyB.SetAwake(!0);this.m_target=a};B.prototype.GetMaxForce=function(){return this.m_maxForce};B.prototype.SetMaxForce=function(a){a===void 0&&(a=0);this.m_maxForce=a};B.prototype.GetFrequency=function(){return this.m_frequencyHz};B.prototype.SetFrequency=function(a){a===void 0&&(a=0);this.m_frequencyHz=a};B.prototype.GetDampingRatio=function(){return this.m_dampingRatio};B.prototype.SetDampingRatio=function(a){a===void 0&&(a=0);this.m_dampingRatio=a};
B.prototype.b2MouseJoint=function(a){this.__super.b2Joint.call(this,a);this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,d=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*d.col1.x+c*d.col1.y;this.m_localAnchor.y=b*d.col2.x+c*d.col2.y;this.m_maxForce=a.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_beta=0};B.prototype.InitVelocityConstraints=function(a){var b=
this.m_bodyB,c=b.GetMass(),d=2*Math.PI*this.m_frequencyHz,e=c*d*d;this.m_gamma=a.dt*(2*c*this.m_dampingRatio*d+a.dt*e);this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0;this.m_beta=a.dt*e*this.m_gamma;var e=b.m_xf.R,c=this.m_localAnchor.x-b.m_sweep.localCenter.x,d=this.m_localAnchor.y-b.m_sweep.localCenter.y,g=e.col1.x*c+e.col2.x*d,d=e.col1.y*c+e.col2.y*d,c=g,e=b.m_invMass,g=b.m_invI;this.K1.col1.x=e;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=e;this.K2.col1.x=g*d*d;this.K2.col2.x=-g*c*d;this.K2.col1.y=
-g*c*d;this.K2.col2.y=g*c*c;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=b.m_sweep.c.x+c-this.m_target.x;this.m_C.y=b.m_sweep.c.y+d-this.m_target.y;b.m_angularVelocity*=0.98;this.m_impulse.x*=a.dtRatio;this.m_impulse.y*=a.dtRatio;b.m_linearVelocity.x+=e*this.m_impulse.x;b.m_linearVelocity.y+=e*this.m_impulse.y;b.m_angularVelocity+=g*(c*this.m_impulse.y-d*this.m_impulse.x)};B.prototype.SolveVelocityConstraints=
function(a){var b=this.m_bodyB,c,d=0,e=0;c=b.m_xf.R;var g=this.m_localAnchor.x-b.m_sweep.localCenter.x,h=this.m_localAnchor.y-b.m_sweep.localCenter.y,d=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=d,d=b.m_linearVelocity.x+-b.m_angularVelocity*h,f=b.m_linearVelocity.y+b.m_angularVelocity*g;c=this.m_mass;d=d+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;e=f+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;f=-(c.col1.x*d+c.col2.x*e);e=-(c.col1.y*d+c.col2.y*e);c=this.m_impulse.x;d=this.m_impulse.y;
this.m_impulse.x+=f;this.m_impulse.y+=e;a=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length());f=this.m_impulse.x-c;e=this.m_impulse.y-d;b.m_linearVelocity.x+=b.m_invMass*f;b.m_linearVelocity.y+=b.m_invMass*e;b.m_angularVelocity+=b.m_invI*(g*e-h*f)};B.prototype.SolvePositionConstraints=function(){return!0};a.inherit(Q,a.Dynamics.Joints.b2JointDef);Q.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;Q.b2MouseJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.target=new n};Q.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};a.inherit(u,a.Dynamics.Joints.b2Joint);u.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;u.b2PrismaticJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_localXAxis1=new n;this.m_localYAxis1=new n;this.m_axis=new n;this.m_perp=new n;
this.m_K=new d;this.m_impulse=new k};u.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};u.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};u.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};u.prototype.GetReactionTorque=function(a){a===
void 0&&(a=0);return a*this.m_impulse.y};u.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),d=b.GetWorldPoint(this.m_localAnchor2),b=d.x-c.x,c=d.y-c.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*c};u.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,c;c=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,g=c.col1.x*d+c.col2.x*e,e=c.col1.y*d+c.col2.y*
e,d=g;c=b.m_xf.R;var h=this.m_localAnchor2.x-b.m_sweep.localCenter.x,f=this.m_localAnchor2.y-b.m_sweep.localCenter.y,g=c.col1.x*h+c.col2.x*f,f=c.col1.y*h+c.col2.y*f,h=g;c=b.m_sweep.c.x+h-(a.m_sweep.c.x+d);var g=b.m_sweep.c.y+f-(a.m_sweep.c.y+e),j=a.GetWorldVector(this.m_localXAxis1),k=a.m_linearVelocity,l=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return c*-a*j.y+g*a*j.x+(j.x*(l.x+-b*f-k.x- -a*e)+j.y*(l.y+b*h-k.y-a*d))};u.prototype.IsLimitEnabled=function(){return this.m_enableLimit};
u.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};u.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};u.prototype.GetUpperLimit=function(){return this.m_upperTranslation};u.prototype.SetLimits=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};u.prototype.IsMotorEnabled=function(){return this.m_enableMotor};u.prototype.EnableMotor=
function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};u.prototype.SetMotorSpeed=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};u.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};u.prototype.SetMaxMotorForce=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};u.prototype.GetMotorForce=function(){return this.m_motorImpulse};u.prototype.b2PrismaticJoint=
function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;
this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};u.prototype.InitVelocityConstraints=function(a){var d=this.m_bodyA,e=this.m_bodyB,g,j=0;this.m_localCenterA.SetV(d.GetLocalCenter());this.m_localCenterB.SetV(e.GetLocalCenter());var k=d.GetTransform();e.GetTransform();g=d.m_xf.R;var l=this.m_localAnchor1.x-this.m_localCenterA.x,f=this.m_localAnchor1.y-this.m_localCenterA.y,j=g.col1.x*l+g.col2.x*f,f=g.col1.y*
l+g.col2.y*f,l=j;g=e.m_xf.R;var m=this.m_localAnchor2.x-this.m_localCenterB.x,n=this.m_localAnchor2.y-this.m_localCenterB.y,j=g.col1.x*m+g.col2.x*n,n=g.col1.y*m+g.col2.y*n,m=j;g=e.m_sweep.c.x+m-d.m_sweep.c.x-l;j=e.m_sweep.c.y+n-d.m_sweep.c.y-f;this.m_invMassA=d.m_invMass;this.m_invMassB=e.m_invMass;this.m_invIA=d.m_invI;this.m_invIB=e.m_invI;this.m_axis.SetV(h.MulMV(k.R,this.m_localXAxis1));this.m_a1=(g+l)*this.m_axis.y-(j+f)*this.m_axis.x;this.m_a2=m*this.m_axis.y-n*this.m_axis.x;this.m_motorMass=
this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass;this.m_perp.SetV(h.MulMV(k.R,this.m_localYAxis1));this.m_s1=(g+l)*this.m_perp.y-(j+f)*this.m_perp.x;this.m_s2=m*this.m_perp.y-n*this.m_perp.x;k=this.m_invMassA;l=this.m_invMassB;f=this.m_invIA;m=this.m_invIB;this.m_K.col1.x=k+l+f*this.m_s1*this.m_s1+m*this.m_s2*this.m_s2;this.m_K.col1.y=f*this.m_s1+m*this.m_s2;this.m_K.col1.z=f*
this.m_s1*this.m_a1+m*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=f+m;this.m_K.col2.z=f*this.m_a1+m*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=k+l+f*this.m_a1*this.m_a1+m*this.m_a2*this.m_a2;if(this.m_enableLimit)if(g=this.m_axis.x*g+this.m_axis.y*j,h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop)this.m_limitState=v.e_equalLimits;else if(g<=this.m_lowerTranslation){if(this.m_limitState!=v.e_atLowerLimit)this.m_limitState=
v.e_atLowerLimit,this.m_impulse.z=0}else if(g>=this.m_upperTranslation){if(this.m_limitState!=v.e_atUpperLimit)this.m_limitState=v.e_atUpperLimit,this.m_impulse.z=0}else this.m_limitState=v.e_inactiveLimit,this.m_impulse.z=0;else this.m_limitState=v.e_inactiveLimit;if(this.m_enableMotor==!1)this.m_motorImpulse=0;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,
g=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,j=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,k=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,d.m_linearVelocity.x-=this.m_invMassA*a,d.m_linearVelocity.y-=this.m_invMassA*g,d.m_angularVelocity-=this.m_invIA*j,e.m_linearVelocity.x+=this.m_invMassB*a,e.m_linearVelocity.y+=this.m_invMassB*g,e.m_angularVelocity+=this.m_invIB*
k):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};u.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=b.m_linearVelocity,e=b.m_angularVelocity,g=c.m_linearVelocity,j=c.m_angularVelocity,f=0,m=0,l=0,o=0;if(this.m_enableMotor&&this.m_limitState!=v.e_equalLimits)o=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*j-this.m_a1*e)),f=this.m_motorImpulse,a=a.dt*this.m_maxMotorForce,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+
o,-a,a),o=this.m_motorImpulse-f,f=o*this.m_axis.x,m=o*this.m_axis.y,l=o*this.m_a1,o*=this.m_a2,d.x-=this.m_invMassA*f,d.y-=this.m_invMassA*m,e-=this.m_invIA*l,g.x+=this.m_invMassB*f,g.y+=this.m_invMassB*m,j+=this.m_invIB*o;l=this.m_perp.x*(g.x-d.x)+this.m_perp.y*(g.y-d.y)+this.m_s2*j-this.m_s1*e;m=j-e;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){a=this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*j-this.m_a1*e;f=this.m_impulse.Copy();a=this.m_K.Solve33(new k,-l,-m,-a);this.m_impulse.Add(a);
if(this.m_limitState==v.e_atLowerLimit)this.m_impulse.z=h.Max(this.m_impulse.z,0);else if(this.m_limitState==v.e_atUpperLimit)this.m_impulse.z=h.Min(this.m_impulse.z,0);l=-l-(this.m_impulse.z-f.z)*this.m_K.col3.x;m=-m-(this.m_impulse.z-f.z)*this.m_K.col3.y;m=this.m_K.Solve22(new n,l,m);m.x+=f.x;m.y+=f.y;this.m_impulse.x=m.x;this.m_impulse.y=m.y;a.x=this.m_impulse.x-f.x;a.y=this.m_impulse.y-f.y;a.z=this.m_impulse.z-f.z;f=a.x*this.m_perp.x+a.z*this.m_axis.x;m=a.x*this.m_perp.y+a.z*this.m_axis.y;l=a.x*
this.m_s1+a.y+a.z*this.m_a1;o=a.x*this.m_s2+a.y+a.z*this.m_a2}else a=this.m_K.Solve22(new n,-l,-m),this.m_impulse.x+=a.x,this.m_impulse.y+=a.y,f=a.x*this.m_perp.x,m=a.x*this.m_perp.y,l=a.x*this.m_s1+a.y,o=a.x*this.m_s2+a.y;d.x-=this.m_invMassA*f;d.y-=this.m_invMassA*m;e-=this.m_invIA*l;g.x+=this.m_invMassB*f;g.y+=this.m_invMassB*m;j+=this.m_invIB*o;b.m_linearVelocity.SetV(d);b.m_angularVelocity=e;c.m_linearVelocity.SetV(g);c.m_angularVelocity=j};u.prototype.SolvePositionConstraints=function(){var a=
this.m_bodyA,d=this.m_bodyB,g=a.m_sweep.c,j=a.m_sweep.a,l=d.m_sweep.c,o=d.m_sweep.a,q,f=0,m=0,t=0,v=f=q=0,u=0,m=!1,z=0,y=e.FromAngle(j),B=e.FromAngle(o);q=y;var u=this.m_localAnchor1.x-this.m_localCenterA.x,F=this.m_localAnchor1.y-this.m_localCenterA.y,f=q.col1.x*u+q.col2.x*F,F=q.col1.y*u+q.col2.y*F,u=f;q=B;B=this.m_localAnchor2.x-this.m_localCenterB.x;t=this.m_localAnchor2.y-this.m_localCenterB.y;f=q.col1.x*B+q.col2.x*t;t=q.col1.y*B+q.col2.y*t;B=f;q=l.x+B-g.x-u;f=l.y+t-g.y-F;if(this.m_enableLimit){this.m_axis=
h.MulMV(y,this.m_localXAxis1);this.m_a1=(q+u)*this.m_axis.y-(f+F)*this.m_axis.x;this.m_a2=B*this.m_axis.y-t*this.m_axis.x;var C=this.m_axis.x*q+this.m_axis.y*f;h.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b.b2_linearSlop?(z=h.Clamp(C,-b.b2_maxLinearCorrection,b.b2_maxLinearCorrection),v=h.Abs(C),m=!0):C<=this.m_lowerTranslation?(z=h.Clamp(C-this.m_lowerTranslation+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),v=this.m_lowerTranslation-C,m=!0):C>=this.m_upperTranslation&&(z=h.Clamp(C-this.m_upperTranslation+
b.b2_linearSlop,0,b.b2_maxLinearCorrection),v=C-this.m_upperTranslation,m=!0)}this.m_perp=h.MulMV(y,this.m_localYAxis1);this.m_s1=(q+u)*this.m_perp.y-(f+F)*this.m_perp.x;this.m_s2=B*this.m_perp.y-t*this.m_perp.x;y=new k;F=this.m_perp.x*q+this.m_perp.y*f;B=o-j-this.m_refAngle;v=h.Max(v,h.Abs(F));u=h.Abs(B);m?(m=this.m_invMassA,t=this.m_invMassB,q=this.m_invIA,f=this.m_invIB,this.m_K.col1.x=m+t+q*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,this.m_K.col1.y=q*this.m_s1+f*this.m_s2,this.m_K.col1.z=q*this.m_s1*
this.m_a1+f*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=q+f,this.m_K.col2.z=q*this.m_a1+f*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+t+q*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_K.Solve33(y,-F,-B,-z)):(m=this.m_invMassA,t=this.m_invMassB,q=this.m_invIA,f=this.m_invIB,z=q*this.m_s1+f*this.m_s2,C=q+f,this.m_K.col1.Set(m+t+q*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,z,0),this.m_K.col2.Set(z,C,0),z=this.m_K.Solve22(new n,
-F,-B),y.x=z.x,y.y=z.y,y.z=0);z=y.x*this.m_perp.x+y.z*this.m_axis.x;m=y.x*this.m_perp.y+y.z*this.m_axis.y;F=y.x*this.m_s1+y.y+y.z*this.m_a1;y=y.x*this.m_s2+y.y+y.z*this.m_a2;g.x-=this.m_invMassA*z;g.y-=this.m_invMassA*m;j-=this.m_invIA*F;l.x+=this.m_invMassB*z;l.y+=this.m_invMassB*m;o+=this.m_invIB*y;a.m_sweep.a=j;d.m_sweep.a=o;a.SynchronizeTransform();d.SynchronizeTransform();return v<=b.b2_linearSlop&&u<=b.b2_angularSlop};a.inherit(K,a.Dynamics.Joints.b2JointDef);K.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;
K.b2PrismaticJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n;this.localAxisA=new n};K.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};K.prototype.Initialize=function(a,b,c,d){this.bodyA=a;this.bodyB=
b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=this.bodyA.GetLocalVector(d);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};a.inherit(D,a.Dynamics.Joints.b2Joint);D.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;D.b2PulleyJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new n;this.m_groundAnchor2=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_u1=new n;
this.m_u2=new n};D.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};D.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};D.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)};D.prototype.GetReactionTorque=function(){return 0};D.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor1);return a};D.prototype.GetGroundAnchorB=
function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor2);return a};D.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(b*b+a*a)};D.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+
this.m_groundAnchor2.y);return Math.sqrt(b*b+a*a)};D.prototype.GetRatio=function(){return this.m_ratio};D.prototype.b2PulleyJoint=function(a){this.__super.b2Joint.call(this,a);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y;
this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_ratio=a.ratio;this.m_constant=a.lengthA+this.m_ratio*a.lengthB;this.m_maxLength1=h.Min(a.maxLengthA,this.m_constant-this.m_ratio*D.b2_minPulleyLength);this.m_maxLength2=h.Min(a.maxLengthB,(this.m_constant-D.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};D.prototype.InitVelocityConstraints=function(a){var d=this.m_bodyA,e=this.m_bodyB,g;g=d.m_xf.R;var h=this.m_localAnchor1.x-
d.m_sweep.localCenter.x,j=this.m_localAnchor1.y-d.m_sweep.localCenter.y,k=g.col1.x*h+g.col2.x*j,j=g.col1.y*h+g.col2.y*j,h=k;g=e.m_xf.R;var f=this.m_localAnchor2.x-e.m_sweep.localCenter.x,m=this.m_localAnchor2.y-e.m_sweep.localCenter.y,k=g.col1.x*f+g.col2.x*m,m=g.col1.y*f+g.col2.y*m,f=k;g=e.m_sweep.c.x+f;var k=e.m_sweep.c.y+m,l=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(d.m_sweep.c.x+h-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),
d.m_sweep.c.y+j-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(g-l,k-n);g=this.m_u1.Length();k=this.m_u2.Length();g>b.b2_linearSlop?this.m_u1.Multiply(1/g):this.m_u1.SetZero();k>b.b2_linearSlop?this.m_u2.Multiply(1/k):this.m_u2.SetZero();this.m_constant-g-this.m_ratio*k>0?(this.m_state=v.e_inactiveLimit,this.m_impulse=0):this.m_state=v.e_atUpperLimit;g<this.m_maxLength1?(this.m_limitState1=v.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=v.e_atUpperLimit;k<this.m_maxLength2?
(this.m_limitState2=v.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=v.e_atUpperLimit;g=h*this.m_u1.y-j*this.m_u1.x;k=f*this.m_u2.y-m*this.m_u2.x;this.m_limitMass1=d.m_invMass+d.m_invI*g*g;this.m_limitMass2=e.m_invMass+e.m_invI*k*k;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;a.warmStarting?(this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=
a.dtRatio,this.m_limitImpulse2*=a.dtRatio,a=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,g=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,k=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,l=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,d.m_linearVelocity.x+=d.m_invMass*a,d.m_linearVelocity.y+=d.m_invMass*g,d.m_angularVelocity+=d.m_invI*(h*g-j*a),e.m_linearVelocity.x+=e.m_invMass*k,e.m_linearVelocity.y+=e.m_invMass*l,e.m_angularVelocity+=e.m_invI*(f*l-m*
k)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};D.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,c;c=a.m_xf.R;var d=this.m_localAnchor1.x-a.m_sweep.localCenter.x,e=this.m_localAnchor1.y-a.m_sweep.localCenter.y,g=c.col1.x*d+c.col2.x*e,e=c.col1.y*d+c.col2.y*e,d=g;c=b.m_xf.R;var j=this.m_localAnchor2.x-b.m_sweep.localCenter.x,f=this.m_localAnchor2.y-b.m_sweep.localCenter.y,g=c.col1.x*j+c.col2.x*f,f=c.col1.y*j+c.col2.y*f,j=g,k=g=c=0,l=0;c=l=c=l=k=g=c=0;
if(this.m_state==v.e_atUpperLimit)c=a.m_linearVelocity.x+-a.m_angularVelocity*e,g=a.m_linearVelocity.y+a.m_angularVelocity*d,k=b.m_linearVelocity.x+-b.m_angularVelocity*f,l=b.m_linearVelocity.y+b.m_angularVelocity*j,c=-(this.m_u1.x*c+this.m_u1.y*g)-this.m_ratio*(this.m_u2.x*k+this.m_u2.y*l),l=this.m_pulleyMass*-c,c=this.m_impulse,this.m_impulse=h.Max(0,this.m_impulse+l),l=this.m_impulse-c,c=-l*this.m_u1.x,g=-l*this.m_u1.y,k=-this.m_ratio*l*this.m_u2.x,l=-this.m_ratio*l*this.m_u2.y,a.m_linearVelocity.x+=
a.m_invMass*c,a.m_linearVelocity.y+=a.m_invMass*g,a.m_angularVelocity+=a.m_invI*(d*g-e*c),b.m_linearVelocity.x+=b.m_invMass*k,b.m_linearVelocity.y+=b.m_invMass*l,b.m_angularVelocity+=b.m_invI*(j*l-f*k);if(this.m_limitState1==v.e_atUpperLimit)c=a.m_linearVelocity.x+-a.m_angularVelocity*e,g=a.m_linearVelocity.y+a.m_angularVelocity*d,c=-(this.m_u1.x*c+this.m_u1.y*g),l=-this.m_limitMass1*c,c=this.m_limitImpulse1,this.m_limitImpulse1=h.Max(0,this.m_limitImpulse1+l),l=this.m_limitImpulse1-c,c=-l*this.m_u1.x,
g=-l*this.m_u1.y,a.m_linearVelocity.x+=a.m_invMass*c,a.m_linearVelocity.y+=a.m_invMass*g,a.m_angularVelocity+=a.m_invI*(d*g-e*c);if(this.m_limitState2==v.e_atUpperLimit)k=b.m_linearVelocity.x+-b.m_angularVelocity*f,l=b.m_linearVelocity.y+b.m_angularVelocity*j,c=-(this.m_u2.x*k+this.m_u2.y*l),l=-this.m_limitMass2*c,c=this.m_limitImpulse2,this.m_limitImpulse2=h.Max(0,this.m_limitImpulse2+l),l=this.m_limitImpulse2-c,k=-l*this.m_u2.x,l=-l*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*k,b.m_linearVelocity.y+=
b.m_invMass*l,b.m_angularVelocity+=b.m_invI*(j*l-f*k)};D.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,d=this.m_bodyB,e,g=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,j=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,k=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,f=0,m=0,n=0,o=0,q=e=0,t=0,u=0,y=q=u=e=q=e=0;if(this.m_state==v.e_atUpperLimit)e=a.m_xf.R,f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,m=this.m_localAnchor1.y-
a.m_sweep.localCenter.y,q=e.col1.x*f+e.col2.x*m,m=e.col1.y*f+e.col2.y*m,f=q,e=d.m_xf.R,n=this.m_localAnchor2.x-d.m_sweep.localCenter.x,o=this.m_localAnchor2.y-d.m_sweep.localCenter.y,q=e.col1.x*n+e.col2.x*o,o=e.col1.y*n+e.col2.y*o,n=q,e=a.m_sweep.c.x+f,q=a.m_sweep.c.y+m,t=d.m_sweep.c.x+n,u=d.m_sweep.c.y+o,this.m_u1.Set(e-g,q-j),this.m_u2.Set(t-k,u-l),e=this.m_u1.Length(),q=this.m_u2.Length(),e>b.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero(),q>b.b2_linearSlop?this.m_u2.Multiply(1/q):this.m_u2.SetZero(),
e=this.m_constant-e-this.m_ratio*q,y=h.Max(y,-e),e=h.Clamp(e+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),u=-this.m_pulleyMass*e,e=-u*this.m_u1.x,q=-u*this.m_u1.y,t=-this.m_ratio*u*this.m_u2.x,u=-this.m_ratio*u*this.m_u2.y,a.m_sweep.c.x+=a.m_invMass*e,a.m_sweep.c.y+=a.m_invMass*q,a.m_sweep.a+=a.m_invI*(f*q-m*e),d.m_sweep.c.x+=d.m_invMass*t,d.m_sweep.c.y+=d.m_invMass*u,d.m_sweep.a+=d.m_invI*(n*u-o*t),a.SynchronizeTransform(),d.SynchronizeTransform();if(this.m_limitState1==v.e_atUpperLimit)e=a.m_xf.R,
f=this.m_localAnchor1.x-a.m_sweep.localCenter.x,m=this.m_localAnchor1.y-a.m_sweep.localCenter.y,q=e.col1.x*f+e.col2.x*m,m=e.col1.y*f+e.col2.y*m,f=q,e=a.m_sweep.c.x+f,q=a.m_sweep.c.y+m,this.m_u1.Set(e-g,q-j),e=this.m_u1.Length(),e>b.b2_linearSlop?(this.m_u1.x*=1/e,this.m_u1.y*=1/e):this.m_u1.SetZero(),e=this.m_maxLength1-e,y=h.Max(y,-e),e=h.Clamp(e+b.b2_linearSlop,-b.b2_maxLinearCorrection,0),u=-this.m_limitMass1*e,e=-u*this.m_u1.x,q=-u*this.m_u1.y,a.m_sweep.c.x+=a.m_invMass*e,a.m_sweep.c.y+=a.m_invMass*
q,a.m_sweep.a+=a.m_invI*(f*q-m*e),a.SynchronizeTransform();if(this.m_limitState2==v.e_atUpperLimit)e=d.m_xf.R,n=this.m_localAnchor2.x-d.m_sweep.localCenter.x,o=this.m_localAnchor2.y-d.m_sweep.localCenter.y,q=e.col1.x*n+e.col2.x*o,o=e.col1.y*n+e.col2.y*o,n=q,t=d.m_sweep.c.x+n,u=d.m_sweep.c.y+o,this.m_u2.Set(t-k,u-l),q=this.m_u2.Length(),q>b.b2_linearSlop?(this.m_u2.x*=1/q,this.m_u2.y*=1/q):this.m_u2.SetZero(),e=this.m_maxLength2-q,y=h.Max(y,-e),e=h.Clamp(e+b.b2_linearSlop,-b.b2_maxLinearCorrection,
0),u=-this.m_limitMass2*e,t=-u*this.m_u2.x,u=-u*this.m_u2.y,d.m_sweep.c.x+=d.m_invMass*t,d.m_sweep.c.y+=d.m_invMass*u,d.m_sweep.a+=d.m_invI*(n*u-o*t),d.SynchronizeTransform();return y<b.b2_linearSlop};a.postDefs.push(function(){a.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});a.inherit(T,a.Dynamics.Joints.b2JointDef);T.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;T.b2PulleyJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new n;
this.groundAnchorB=new n;this.localAnchorA=new n;this.localAnchorB=new n};T.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};T.prototype.Initialize=function(a,b,c,d,e,g,h){h===void 0&&(h=0);this.bodyA=a;this.bodyB=b;this.groundAnchorA.SetV(c);
this.groundAnchorB.SetV(d);this.localAnchorA=this.bodyA.GetLocalPoint(e);this.localAnchorB=this.bodyB.GetLocalPoint(g);a=e.x-c.x;c=e.y-c.y;this.lengthA=Math.sqrt(a*a+c*c);c=g.x-d.x;d=g.y-d.y;this.lengthB=Math.sqrt(c*c+d*d);this.ratio=h;h=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=h-this.ratio*D.b2_minPulleyLength;this.maxLengthB=(h-D.b2_minPulleyLength)/this.ratio};a.inherit(I,a.Dynamics.Joints.b2Joint);I.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;I.b2RevoluteJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.K=new e;this.K1=new e;this.K2=new e;this.K3=new e;this.impulse3=new k;this.impulse2=new n;this.reduced=new n;this.m_localAnchor1=new n;this.m_localAnchor2=new n;this.m_impulse=new k;this.m_mass=new d};I.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};I.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};I.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*this.m_impulse.x,a*this.m_impulse.y)};
I.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);return a*this.m_impulse.z};I.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};I.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};I.prototype.IsLimitEnabled=function(){return this.m_enableLimit};I.prototype.EnableLimit=function(a){this.m_enableLimit=a};I.prototype.GetLowerLimit=function(){return this.m_lowerAngle};I.prototype.GetUpperLimit=
function(){return this.m_upperAngle};I.prototype.SetLimits=function(a,b){a===void 0&&(a=0);b===void 0&&(b=0);this.m_lowerAngle=a;this.m_upperAngle=b};I.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};I.prototype.EnableMotor=function(a){this.m_enableMotor=a};I.prototype.SetMotorSpeed=function(a){a===void 0&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};I.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};
I.prototype.SetMaxMotorTorque=function(a){a===void 0&&(a=0);this.m_maxMotorTorque=a};I.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};I.prototype.b2RevoluteJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=
a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=v.e_inactiveLimit};I.prototype.InitVelocityConstraints=function(a){var d=this.m_bodyA,e=this.m_bodyB,g,j=0;g=d.m_xf.R;var k=this.m_localAnchor1.x-d.m_sweep.localCenter.x,l=this.m_localAnchor1.y-d.m_sweep.localCenter.y,j=g.col1.x*k+g.col2.x*l,l=g.col1.y*k+g.col2.y*l,k=j;g=e.m_xf.R;var f=this.m_localAnchor2.x-e.m_sweep.localCenter.x,m=this.m_localAnchor2.y-e.m_sweep.localCenter.y,j=g.col1.x*f+g.col2.x*m,
m=g.col1.y*f+g.col2.y*m,f=j;g=d.m_invMass;var j=e.m_invMass,n=d.m_invI,o=e.m_invI;this.m_mass.col1.x=g+j+l*l*n+m*m*o;this.m_mass.col2.x=-l*k*n-m*f*o;this.m_mass.col3.x=-l*n-m*o;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=g+j+k*k*n+f*f*o;this.m_mass.col3.y=k*n+f*o;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=n+o;this.m_motorMass=1/(n+o);if(this.m_enableMotor==!1)this.m_motorImpulse=0;if(this.m_enableLimit){var q=e.m_sweep.a-d.m_sweep.a-
this.m_referenceAngle;if(h.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b.b2_angularSlop)this.m_limitState=v.e_equalLimits;else if(q<=this.m_lowerAngle){if(this.m_limitState!=v.e_atLowerLimit)this.m_impulse.z=0;this.m_limitState=v.e_atLowerLimit}else if(q>=this.m_upperAngle){if(this.m_limitState!=v.e_atUpperLimit)this.m_impulse.z=0;this.m_limitState=v.e_atUpperLimit}else this.m_limitState=v.e_inactiveLimit,this.m_impulse.z=0}else this.m_limitState=v.e_inactiveLimit;a.warmStarting?(this.m_impulse.x*=
a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x,q=this.m_impulse.y,d.m_linearVelocity.x-=g*a,d.m_linearVelocity.y-=g*q,d.m_angularVelocity-=n*(k*q-l*a+this.m_motorImpulse+this.m_impulse.z),e.m_linearVelocity.x+=j*a,e.m_linearVelocity.y+=j*q,e.m_angularVelocity+=o*(f*q-m*a+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};I.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,d=0,e=d=0,g=0,j=
0,f=0,k=b.m_linearVelocity,l=b.m_angularVelocity,n=c.m_linearVelocity,o=c.m_angularVelocity,q=b.m_invMass,t=c.m_invMass,u=b.m_invI,y=c.m_invI;if(this.m_enableMotor&&this.m_limitState!=v.e_equalLimits)e=this.m_motorMass*-(o-l-this.m_motorSpeed),g=this.m_motorImpulse,j=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=h.Clamp(this.m_motorImpulse+e,-j,j),e=this.m_motorImpulse-g,l-=u*e,o+=y*e;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){var a=b.m_xf.R,e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,
g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,d=a.col1.x*e+a.col2.x*g,g=a.col1.y*e+a.col2.y*g,e=d,a=c.m_xf.R,j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,f=this.m_localAnchor2.y-c.m_sweep.localCenter.y,d=a.col1.x*j+a.col2.x*f,f=a.col1.y*j+a.col2.y*f,j=d,a=n.x+-o*f-k.x- -l*g,z=n.y+o*j-k.y-l*e;this.m_mass.Solve33(this.impulse3,-a,-z,-(o-l));if(this.m_limitState==v.e_equalLimits)this.m_impulse.Add(this.impulse3);else if(this.m_limitState==v.e_atLowerLimit){if(d=this.m_impulse.z+this.impulse3.z,
d<0)this.m_mass.Solve22(this.reduced,-a,-z),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0}else if(this.m_limitState==v.e_atUpperLimit&&(d=this.m_impulse.z+this.impulse3.z,d>0))this.m_mass.Solve22(this.reduced,-a,-z),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,
this.m_impulse.z=0;k.x-=q*this.impulse3.x;k.y-=q*this.impulse3.y;l-=u*(e*this.impulse3.y-g*this.impulse3.x+this.impulse3.z);n.x+=t*this.impulse3.x;n.y+=t*this.impulse3.y;o+=y*(j*this.impulse3.y-f*this.impulse3.x+this.impulse3.z)}else a=b.m_xf.R,e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,d=a.col1.x*e+a.col2.x*g,g=a.col1.y*e+a.col2.y*g,e=d,a=c.m_xf.R,j=this.m_localAnchor2.x-c.m_sweep.localCenter.x,f=this.m_localAnchor2.y-c.m_sweep.localCenter.y,d=
a.col1.x*j+a.col2.x*f,f=a.col1.y*j+a.col2.y*f,j=d,this.m_mass.Solve22(this.impulse2,-(n.x+-o*f-k.x- -l*g),-(n.y+o*j-k.y-l*e)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,k.x-=q*this.impulse2.x,k.y-=q*this.impulse2.y,l-=u*(e*this.impulse2.y-g*this.impulse2.x),n.x+=t*this.impulse2.x,n.y+=t*this.impulse2.y,o+=y*(j*this.impulse2.y-f*this.impulse2.x);b.m_linearVelocity.SetV(k);b.m_angularVelocity=l;c.m_linearVelocity.SetV(n);c.m_angularVelocity=o};I.prototype.SolvePositionConstraints=
function(){var a=0,d,e=this.m_bodyA,g=this.m_bodyB,j=0,k=d=0,l=0,f=0;if(this.m_enableLimit&&this.m_limitState!=v.e_inactiveLimit){var a=g.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,m=0;this.m_limitState==v.e_equalLimits?(a=h.Clamp(a-this.m_lowerAngle,-b.b2_maxAngularCorrection,b.b2_maxAngularCorrection),m=-this.m_motorMass*a,j=h.Abs(a)):this.m_limitState==v.e_atLowerLimit?(a-=this.m_lowerAngle,j=-a,a=h.Clamp(a+b.b2_angularSlop,-b.b2_maxAngularCorrection,0),m=-this.m_motorMass*a):this.m_limitState==
v.e_atUpperLimit&&(a-=this.m_upperAngle,j=a,a=h.Clamp(a-b.b2_angularSlop,0,b.b2_maxAngularCorrection),m=-this.m_motorMass*a);e.m_sweep.a-=e.m_invI*m;g.m_sweep.a+=g.m_invI*m;e.SynchronizeTransform();g.SynchronizeTransform()}d=e.m_xf.R;m=this.m_localAnchor1.x-e.m_sweep.localCenter.x;a=this.m_localAnchor1.y-e.m_sweep.localCenter.y;k=d.col1.x*m+d.col2.x*a;a=d.col1.y*m+d.col2.y*a;m=k;d=g.m_xf.R;var n=this.m_localAnchor2.x-g.m_sweep.localCenter.x,o=this.m_localAnchor2.y-g.m_sweep.localCenter.y,k=d.col1.x*
n+d.col2.x*o,o=d.col1.y*n+d.col2.y*o,n=k,l=g.m_sweep.c.x+n-e.m_sweep.c.x-m,f=g.m_sweep.c.y+o-e.m_sweep.c.y-a,q=l*l+f*f;d=Math.sqrt(q);var k=e.m_invMass,t=g.m_invMass,u=e.m_invI,y=g.m_invI,z=10*b.b2_linearSlop;q>z*z&&(q=1/(k+t),l=q*-l,f=q*-f,e.m_sweep.c.x-=0.5*k*l,e.m_sweep.c.y-=0.5*k*f,g.m_sweep.c.x+=0.5*t*l,g.m_sweep.c.y+=0.5*t*f,l=g.m_sweep.c.x+n-e.m_sweep.c.x-m,f=g.m_sweep.c.y+o-e.m_sweep.c.y-a);this.K1.col1.x=k+t;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=k+t;this.K2.col1.x=u*a*a;this.K2.col2.x=
-u*m*a;this.K2.col1.y=-u*m*a;this.K2.col2.y=u*m*m;this.K3.col1.x=y*o*o;this.K3.col2.x=-y*n*o;this.K3.col1.y=-y*n*o;this.K3.col2.y=y*n*n;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(I.tImpulse,-l,-f);l=I.tImpulse.x;f=I.tImpulse.y;e.m_sweep.c.x-=e.m_invMass*l;e.m_sweep.c.y-=e.m_invMass*f;e.m_sweep.a-=e.m_invI*(m*f-a*l);g.m_sweep.c.x+=g.m_invMass*l;g.m_sweep.c.y+=g.m_invMass*f;g.m_sweep.a+=g.m_invI*(n*f-o*l);e.SynchronizeTransform();g.SynchronizeTransform();return d<=b.b2_linearSlop&&
j<=b.b2_angularSlop};a.postDefs.push(function(){a.Dynamics.Joints.b2RevoluteJoint.tImpulse=new n});a.inherit(J,a.Dynamics.Joints.b2JointDef);J.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;J.b2RevoluteJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};J.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);
this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=this.enableLimit=!1};J.prototype.Initialize=function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};a.inherit(U,a.Dynamics.Joints.b2Joint);U.prototype.__super=a.Dynamics.Joints.b2Joint.prototype;U.b2WeldJoint=function(){a.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_localAnchorA=new n;this.m_localAnchorB=new n;this.m_impulse=new k;this.m_mass=new d};U.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};U.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};U.prototype.GetReactionForce=function(a){a===void 0&&(a=0);return new n(a*this.m_impulse.x,a*this.m_impulse.y)};U.prototype.GetReactionTorque=function(a){a===void 0&&(a=0);return a*this.m_impulse.z};U.prototype.b2WeldJoint=
function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_mass=new d};U.prototype.InitVelocityConstraints=function(a){var b,c=0,d=this.m_bodyA,e=this.m_bodyB;b=d.m_xf.R;var g=this.m_localAnchorA.x-d.m_sweep.localCenter.x,h=this.m_localAnchorA.y-d.m_sweep.localCenter.y,c=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=c;b=e.m_xf.R;var f=this.m_localAnchorB.x-
e.m_sweep.localCenter.x,j=this.m_localAnchorB.y-e.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*j,j=b.col1.y*f+b.col2.y*j,f=c;b=d.m_invMass;var c=e.m_invMass,k=d.m_invI,l=e.m_invI;this.m_mass.col1.x=b+c+h*h*k+j*j*l;this.m_mass.col2.x=-h*g*k-j*f*l;this.m_mass.col3.x=-h*k-j*l;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+c+g*g*k+f*f*l;this.m_mass.col3.y=g*k+f*l;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=k+l;a.warmStarting?(this.m_impulse.x*=
a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,d.m_linearVelocity.x-=b*this.m_impulse.x,d.m_linearVelocity.y-=b*this.m_impulse.y,d.m_angularVelocity-=k*(g*this.m_impulse.y-h*this.m_impulse.x+this.m_impulse.z),e.m_linearVelocity.x+=c*this.m_impulse.x,e.m_linearVelocity.y+=c*this.m_impulse.y,e.m_angularVelocity+=l*(f*this.m_impulse.y-j*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};U.prototype.SolveVelocityConstraints=function(){var a,b=0,c=this.m_bodyA,d=this.m_bodyB,
e=c.m_linearVelocity,g=c.m_angularVelocity,h=d.m_linearVelocity,f=d.m_angularVelocity,j=c.m_invMass,l=d.m_invMass,n=c.m_invI,o=d.m_invI;a=c.m_xf.R;var q=this.m_localAnchorA.x-c.m_sweep.localCenter.x,t=this.m_localAnchorA.y-c.m_sweep.localCenter.y,b=a.col1.x*q+a.col2.x*t,t=a.col1.y*q+a.col2.y*t,q=b;a=d.m_xf.R;var u=this.m_localAnchorB.x-d.m_sweep.localCenter.x,v=this.m_localAnchorB.y-d.m_sweep.localCenter.y,b=a.col1.x*u+a.col2.x*v,v=a.col1.y*u+a.col2.y*v,u=b;a=h.x-f*v-e.x+g*t;var b=h.y+f*u-e.y-g*q,
y=f-g,z=new k;this.m_mass.Solve33(z,-a,-b,-y);this.m_impulse.Add(z);e.x-=j*z.x;e.y-=j*z.y;g-=n*(q*z.y-t*z.x+z.z);h.x+=l*z.x;h.y+=l*z.y;f+=o*(u*z.y-v*z.x+z.z);c.m_angularVelocity=g;d.m_angularVelocity=f};U.prototype.SolvePositionConstraints=function(){var a,d=0,e=this.m_bodyA,g=this.m_bodyB;a=e.m_xf.R;var j=this.m_localAnchorA.x-e.m_sweep.localCenter.x,l=this.m_localAnchorA.y-e.m_sweep.localCenter.y,d=a.col1.x*j+a.col2.x*l,l=a.col1.y*j+a.col2.y*l,j=d;a=g.m_xf.R;var n=this.m_localAnchorB.x-g.m_sweep.localCenter.x,
f=this.m_localAnchorB.y-g.m_sweep.localCenter.y,d=a.col1.x*n+a.col2.x*f,f=a.col1.y*n+a.col2.y*f,n=d;a=e.m_invMass;var d=g.m_invMass,m=e.m_invI,o=g.m_invI,q=g.m_sweep.c.x+n-e.m_sweep.c.x-j,t=g.m_sweep.c.y+f-e.m_sweep.c.y-l,u=g.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,v=10*b.b2_linearSlop,y=Math.sqrt(q*q+t*t),z=h.Abs(u);y>v&&(m*=1,o*=1);this.m_mass.col1.x=a+d+l*l*m+f*f*o;this.m_mass.col2.x=-l*j*m-f*n*o;this.m_mass.col3.x=-l*m-f*o;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=a+d+j*j*m+
n*n*o;this.m_mass.col3.y=j*m+n*o;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=m+o;v=new k;this.m_mass.Solve33(v,-q,-t,-u);e.m_sweep.c.x-=a*v.x;e.m_sweep.c.y-=a*v.y;e.m_sweep.a-=m*(j*v.y-l*v.x+v.z);g.m_sweep.c.x+=d*v.x;g.m_sweep.c.y+=d*v.y;g.m_sweep.a+=o*(n*v.y-f*v.x+v.z);e.SynchronizeTransform();g.SynchronizeTransform();return y<=b.b2_linearSlop&&z<=b.b2_angularSlop};a.inherit(P,a.Dynamics.Joints.b2JointDef);P.prototype.__super=a.Dynamics.Joints.b2JointDef.prototype;
P.b2WeldJointDef=function(){a.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new n;this.localAnchorB=new n};P.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=v.e_weldJoint;this.referenceAngle=0};P.prototype.Initialize=function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();(function(){var b=
a.Dynamics.b2DebugDraw;b.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var a=this;this.m_sprite={graphics:{clear:function(){a.m_ctx.clearRect(0,0,a.m_ctx.canvas.width,a.m_ctx.canvas.height)}}}};b.prototype._color=function(a,b){return"rgba("+((a&16711680)>>16)+","+((a&65280)>>8)+","+(a&255)+","+b+")"};b.prototype.b2DebugDraw=function(){this.m_drawFlags=0};b.prototype.SetFlags=function(a){a===void 0&&(a=0);this.m_drawFlags=a};b.prototype.GetFlags=
function(){return this.m_drawFlags};b.prototype.AppendFlags=function(a){a===void 0&&(a=0);this.m_drawFlags|=a};b.prototype.ClearFlags=function(a){a===void 0&&(a=0);this.m_drawFlags&=~a};b.prototype.SetSprite=function(a){this.m_ctx=a};b.prototype.GetSprite=function(){return this.m_ctx};b.prototype.SetDrawScale=function(a){a===void 0&&(a=0);this.m_drawScale=a};b.prototype.GetDrawScale=function(){return this.m_drawScale};b.prototype.SetLineThickness=function(a){a===void 0&&(a=0);this.m_lineThickness=
a;this.m_ctx.strokeWidth=a};b.prototype.GetLineThickness=function(){return this.m_lineThickness};b.prototype.SetAlpha=function(a){a===void 0&&(a=0);this.m_alpha=a};b.prototype.GetAlpha=function(){return this.m_alpha};b.prototype.SetFillAlpha=function(a){a===void 0&&(a=0);this.m_fillAlpha=a};b.prototype.GetFillAlpha=function(){return this.m_fillAlpha};b.prototype.SetXFormScale=function(a){a===void 0&&(a=0);this.m_xformScale=a};b.prototype.GetXFormScale=function(){return this.m_xformScale};b.prototype.DrawPolygon=
function(a,b,c){if(b){var l=this.m_ctx,k=this.m_drawScale;l.beginPath();l.strokeStyle=this._color(c.color,this.m_alpha);l.moveTo(a[0].x*k,a[0].y*k);for(c=1;c<b;c++)l.lineTo(a[c].x*k,a[c].y*k);l.lineTo(a[0].x*k,a[0].y*k);l.closePath();l.stroke()}};b.prototype.DrawSolidPolygon=function(a,b,c){if(b){var l=this.m_ctx,k=this.m_drawScale;l.beginPath();l.strokeStyle=this._color(c.color,this.m_alpha);l.fillStyle=this._color(c.color,this.m_fillAlpha);l.moveTo(a[0].x*k,a[0].y*k);for(c=1;c<b;c++)l.lineTo(a[c].x*
k,a[c].y*k);l.lineTo(a[0].x*k,a[0].y*k);l.closePath();l.fill();l.stroke()}};b.prototype.DrawCircle=function(a,b,c){if(b){var l=this.m_ctx,k=this.m_drawScale;l.beginPath();l.strokeStyle=this._color(c.color,this.m_alpha);l.arc(a.x*k,a.y*k,b*k,0,Math.PI*2,!0);l.closePath();l.stroke()}};b.prototype.DrawSolidCircle=function(a,b,c,l){if(b){var k=this.m_ctx,o=this.m_drawScale,g=a.x*o,q=a.y*o;k.moveTo(0,0);k.beginPath();k.strokeStyle=this._color(l.color,this.m_alpha);k.fillStyle=this._color(l.color,this.m_fillAlpha);
k.arc(g,q,b*o,0,Math.PI*2,!0);k.moveTo(g,q);k.lineTo((a.x+c.x*b)*o,(a.y+c.y*b)*o);k.closePath();k.fill();k.stroke()}};b.prototype.DrawSegment=function(a,b,c){var l=this.m_ctx,k=this.m_drawScale;l.strokeStyle=this._color(c.color,this.m_alpha);l.beginPath();l.moveTo(a.x*k,a.y*k);l.lineTo(b.x*k,b.y*k);l.closePath();l.stroke()};b.prototype.DrawTransform=function(a){var b=this.m_ctx,c=this.m_drawScale;b.beginPath();b.strokeStyle=this._color(16711680,this.m_alpha);b.moveTo(a.position.x*c,a.position.y*c);
b.lineTo((a.position.x+this.m_xformScale*a.R.col1.x)*c,(a.position.y+this.m_xformScale*a.R.col1.y)*c);b.strokeStyle=this._color(65280,this.m_alpha);b.moveTo(a.position.x*c,a.position.y*c);b.lineTo((a.position.x+this.m_xformScale*a.R.col2.x)*c,(a.position.y+this.m_xformScale*a.R.col2.y)*c);b.closePath();b.stroke()}})();var t;for(t=0;t<a.postDefs.length;++t)a.postDefs[t]();delete a.postDefs;b.Box2D=a;b.b2AABB=a.Collision.b2AABB;b.b2Vec2=a.Common.Math.b2Vec2;b.b2BodyDef=a.Dynamics.b2BodyDef;b.b2Body=
a.Dynamics.b2Body;b.b2FixtureDef=a.Dynamics.b2FixtureDef;b.b2Fixture=a.Dynamics.b2Fixture;b.b2World=a.Dynamics.b2World;b.b2MassData=a.Collision.Shapes.b2MassData;b.b2PolygonShape=a.Collision.Shapes.b2PolygonShape;b.b2CircleShape=a.Collision.Shapes.b2CircleShape;b.b2DebugDraw=a.Dynamics.b2DebugDraw;b.b2RevoluteJointDef=a.Dynamics.Joints.b2RevoluteJointDef;b.b2PrismaticJointDef=a.Dynamics.Joints.b2PrismaticJointDef;b.b2Transform=a.Common.Math.b2Transform;b.b2WorldManifold=a.Collision.b2WorldManifold}},
[]);
require.define({controllers:function(q,b){var a=q("gamejs"),l=q("gamejs/utils/vectors"),o=q("./utils"),t=q("./combatracer"),c=o.vec,e=o.arr,l=a.utils.vectors,o=a.utils.math;radians=o.radians;degrees=o.degrees;var d=b.STEER_NONE=0,h=b.STEER_RIGHT=1,n=b.STEER_LEFT=2,k=b.ACC_NONE=0,M=b.ACC_ACCELERATE=1,g=b.ACC_BRAKE=2,y={1:{FIRE_CHANCE:0.2,MAX_SPEED_BUFF:0,MAX_SPEED_DEBUFF:30},2:{FIRE_CHANCE:0.5,MAX_SPEED_BUFF:10,MAX_SPEED_DEBUFF:25},3:{FIRE_CHANCE:0.6,MAX_SPEED_BUFF:20,MAX_SPEED_DEBUFF:10}};b.AIController=function(a,
b,g){a.max_steer_angle*=1.1;a.turn_msec=50;this.difficulty=y[t.game.player.singleplayer.difficulty];this.scene=g;this.car=a;this.world=b;this.cur_wp=1;this.ceasfire=!1;this.ceasfire_cur_cooldown=0;this.ceasfire_cooldown=1E3;this.stationary=0;this.update=function(b,g){if(this.car.alive){this.car.accelerate=M;var k=this.world.ai_waypoints[this.cur_wp],o=this.world.ai_waypoints[this.cur_wp<this.world.max_waypoint?this.cur_wp+1:1],j=this.car.getSpeedKMH(),q=this.scene.player_car.getRacePosition(),t=this.car.getRacePosition();
q<t?a.mod_speed<this.difficulty.MAX_SPEED_BUFF&&(a.mod_speed+=5*(g/1E3)):q>t&&a.mod_speed>-this.difficulty.MAX_SPEED_DEBUFF&&(a.mod_speed-=5*(g/1E3));if(j<6)if(this.car.alive){if(this.stationary+=g,this.stationary>3E3)this.car.teleport([k.x,k.y]),this.stationary=0}else this.stationary=0;else this.stationary=0;q=e(this.car.body.GetPosition());j=e(this.car.body.GetLocalPoint(c(k.x,k.y)));k=l.distance(q,[k.x,k.y]);l.distance(q,[o.x,o.y]);o=degrees(l.angle([0,-1],j));if(k<10||j.y>0&&k<35)this.cur_wp<
this.world.max_waypoint?this.cur_wp++:this.cur_wp=1,k=this.world.ai_waypoints[this.cur_wp];this.car.steer=o>10?j[0]>0?h:n:d;this.ceasfire_cur_cooldown<=0?(this.ceasfire=Math.random()>this.difficulty.FIRE_CHANCE?!0:!1,this.ceasfire_cur_cooldown=this.ceasfire_cooldown):this.ceasfire_cur_cooldown-=g;["front_weapon","util","rear_weapon"].forEach(function(a){this.car[a]&&(this.car["fire_"+a]=this.ceasfire?!1:this.car[a].AI())},this)}};return this};b.MultiplayerController=function(){this.bindings={accelerate:a.event.K_UP,
brake:a.event.K_DOWN,steer_left:a.event.K_LEFT,steer_right:a.event.K_RIGHT,fire_front_weapon:a.event.K_x,fire_rear_weapon:a.event.K_v,fire_util:a.event.K_c};this.actions={accelerate:k,steer:d,fire_front_weapon:!1,fire_rear_weapon:!1,fire_util:!1};this.update=function(a){var b=!1,c,e,l,o;c=a[this.bindings.accelerate]?M:a[this.bindings.brake]?g:k;e=a[this.bindings.steer_right]?h:a[this.bindings.steer_left]?n:d;l=a[this.bindings.fire_front_weapon]?!0:!1;o=a[this.bindings.fire_rear_weapon]?!0:!1;a=a[this.bindings.util]?
!0:!1;if(c!==this.actions.accelerate)this.actions.accelerate=c,b=!0;if(e!==this.actions.steer)this.actions.steer=e,b=!0;if(l!==this.actions.fire_front_weapon)this.actions.fire_front_weapon=l,b=!0;if(o!==this.actions.fire_rear_weapon)this.actions.fire_rear_weapon=o,b=!0;if(a!==this.actions.fire_util)this.actions.fire_util=a,b=!0;return b};return this};b.PlayerCarController=function(b){this.car=b;this.bindings={accelerate:a.event.K_UP,brake:a.event.K_DOWN,steer_left:a.event.K_LEFT,steer_right:a.event.K_RIGHT,
fire_front_weapon:a.event.K_x,fire_rear_weapon:a.event.K_v,fire_util:a.event.K_c};this.update=function(a){if(this.car.alive)this.car.accelerate=a[this.bindings.accelerate]?M:a[this.bindings.brake]?g:k,this.car.steer=a[this.bindings.steer_right]?h:a[this.bindings.steer_left]?n:d,this.car.fire_front_weapon=a[this.bindings.fire_front_weapon]?!0:!1,this.car.fire_rear_weapon=a[this.bindings.fire_rear_weapon]?!0:!1,this.car.fire_util=a[this.bindings.fire_util]?!0:!1};return this}}},["gamejs","gamejs/utils/vectors",
"utils","combatracer"]);
require.define({json:function(q,b){var a;if(!a)b.JSON=a={};(function(){function l(a){return a<10?"0"+a:a}function o(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var b=n[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function q(a,b){var c,e,l,n,G=d,v,F=b[a];F&&typeof F==="object"&&typeof F.toJSON==="function"&&(F=F.toJSON(a));typeof k==="function"&&(F=k.call(b,a,F));switch(typeof F){case "string":return o(F);case "number":return isFinite(F)?
String(F):"null";case "boolean":case "null":return String(F);case "object":if(!F)return"null";d+=h;v=[];if(Object.prototype.toString.apply(F)==="[object Array]"){n=F.length;for(c=0;c<n;c+=1)v[c]=q(c,F)||"null";l=v.length===0?"[]":d?"[\n"+d+v.join(",\n"+d)+"\n"+G+"]":"["+v.join(",")+"]";d=G;return l}if(k&&typeof k==="object"){n=k.length;for(c=0;c<n;c+=1)e=k[c],typeof e==="string"&&(l=q(e,F))&&v.push(o(e)+(d?": ":":")+l)}else for(e in F)Object.prototype.hasOwnProperty.call(F,e)&&(l=q(e,F))&&v.push(o(e)+
(d?": ":":")+l);l=v.length===0?"{}":d?"{\n"+d+v.join(",\n"+d)+"\n"+G+"}":"{"+v.join(",")+"}";d=G;return l}}if(typeof Date.prototype.toJSON!=="function")Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+l(this.getUTCMonth()+1)+"-"+l(this.getUTCDate())+"T"+l(this.getUTCHours())+":"+l(this.getUTCMinutes())+":"+l(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()};var c=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,h,n={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;if(typeof a.stringify!=="function")b.stringify=a.stringify=function(a,b,c){var e;h=d="";if(typeof c==="number")for(e=0;e<c;e+=1)h+=" ";else typeof c==="string"&&(h=c);if((k=b)&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number"))throw Error("JSON.stringify");return q("",
{"":a})};if(typeof a.parse!=="function")b.parse=a.parse=function(a,b){function d(a,c){var e,h,k=a[c];if(k&&typeof k==="object")for(e in k)Object.prototype.hasOwnProperty.call(k,e)&&(h=d(k,e),h!==void 0?k[e]=h:delete k[e]);return b.call(a,c,k)}var e,a=String(a);c.lastIndex=0;c.test(a)&&(a=a.replace(c,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),typeof b==="function"?d({"":e},""):e;console.log(a);throw new SyntaxError("JSON.parse");}})()}},[]);
require.define({sounds:function(q,b){function a(a,b){this.audios=[];this.next=0;for(var e,l=0;l<b;l++)e=new o.mixer.Sound("sounds/fx/"+a),e.setVolume(0.2),e.audio.addEventListener("ended",function(){d>0&&d--},!0),this.audios.push(e);this.play=function(){if(d<c.get("MAX_GLOBAL_SOUND_CHANNELS")&&(this.audios[this.next].play(),d++,this.next++,this.next==this.audios.length))this.next=0};return this}function l(){this.audios={};this.playing=null;this.t=0;this.third_launched=this.second_launched=!1;this.play=
function(){};this.play_by_speed=function(a,b){a<5?this.play(0):this.play(Math.min(parseInt(Math.ceil(a*10/(b*2))),5))};this.stop=function(){};this.update=function(a){if(this.playing!==null)this.t<=0?(this.playing.seek(0),this.t=300):this.t-=a}}var o=q("gamejs"),t=q("./resources"),c=q("./settings"),e={},d=0;b.engine=null;b.play=function(a,b){if(c.get("SOUND"))if(a.position&&b){var d=b.getScreenPoint(a.position);d[0]>=0&&d[1]>=0&&d[0]<=b.width&&d[1]<=b.height&&e[a.filename].play()}else e[a.filename].play()};
b.init=function(){t.sound_fx.forEach(function(b){e[b]=new a(b,c.get("MAX_INDIVIDUAL_SOUND_CHANNELS"))});b.engine=new l}}},["gamejs","resources","settings"]);
require.define({gamescenes:function(q,b){function a(b){b.size=[220,200];a.superConstructor.apply(this,[b]);this.scene=b.scene;this.quitbtn=new n.Button({parent:this,text:"Quit",size:[180,40],lean:"both",position:[20,20]});this.quitbtn.onClick(function(){this.close();this.scene.game.showSPGameOver(this.scene.genScoreTable(),0,this.scene)},this);this.continuebtn=new n.Button({parent:this,text:"Continue",size:[180,40],lean:"both",position:[20,70]});this.continuebtn.onClick(function(){this.close();this.scene.paused=
!1},this)}var l=q("gamejs"),o=q("./utils"),t=q("./sounds"),c=q("./combatracer"),e=q("./cars"),d=q("./bots");q("./box2d");var h=q("./gamejs-gui"),n=q("./ui"),k=q("./leagues"),M=l.utils.math;radians=M.radians;degrees=M.degrees;var g=q("./world"),y=q("./renderer"),R=q("./settings"),L=q("./controllers");q("./car_descriptions");var M=b.LevelScene=function(a){this.game=c.game;this.level=a;this.cache=y.cache;this.paused=this.started=!1;this.time_to_start=3E3;this.controllers=[];this.keys_down={};this.started=
!1;this.max_laps=a.laps?a.laps:3;this.gui=new h.GUI(this.game.display);this.background=o.renderLevelBackground(a,!0);this.world=g.buildWorld(a,g.MODE_STANDALONE);this.renderer=new y.RaceRenderer(R.get("SCREEN_WIDTH"),R.get("SCREEN_HEIGHT"),this.world,this.background,this.cache);this.handleEvent=function(a){if(a.type===l.event.KEY_DOWN){this.keys_down[a.key]=!0;if(a.key===l.event.K_SPACE)this.paused=!this.paused;if(a.key===l.event.K_ESC&&this.dialog)this.dialog.visible?(this.paused=!1,this.dialog.hide()):
(this.paused=!0,this.dialog.show())}else a.type===l.event.KEY_UP&&(this.keys_down[a.key]=!1);this.gui.despatchEvent(a)};this.updateZoom=function(){this.keys_down[l.event.K_p]?this.renderer.increaseZoom():this.keys_down[l.event.K_l]&&this.renderer.decreaseZoom()};this.destroy=function(){R.get("SOUND")&&t.engine.stop()}},C=b.MultiplayerLevelScene=function(a,b,c){C.superConstructor.apply(this,[a,b,c]);this.game=a;this.processed_events={};this.world.mode=g.MODE_CLIENT;this.last_known_event_no=this.last_event_no=
0;this.queued_updates=[];this.time_to_start=3E3;this.player_car=null;this.delta=this.time=this.upds_stacked=0;this.last_t=null;this.deltas=[];this.delta_q=0;this.states={};this.queued_events={};this.extradelay=50;this.last_upd_time=0;this.carid=null;this.bfs=0;this.send_update=!0;this.time_since_last_update_sent=0;this.state=1;this.controllers[this.controllers.length]=this.controller=new L.MultiplayerController;this.setState=function(a){var b=0,c=0,d;for(d in this.states){if(d==a){b=d;c=0;break}if(d<
a&&d>b)b=d;else if(d>a&&(d<c||c===0))c=d}if(b||c){d=this.states[b];var e=c?this.states[c]:null,g=0;b&&c&&(g=(a-b)/(c-b));var h,k;for(k in d)if(h=this.world.getObjectById(k))e&&e[k]&&h.interpolate?(c=h.interpolate(d[k],e[k],g),this.last_upd_time=a):(this.bfs++,c=d[k],this.last_upd_time=b),h.setState(c)}else console.log("no known state!")};this.update=function(a){this.time+=a;this.handleWorldUpdate();this.paused=!1;this.updateZoom(a);if(this.time_to_start<0)this.started=!0;var b=this.time+this.delta-
10;this.processEvents(b);if(this.started){this.setState(b);if(b>this.last_upd_time)this.world.b2world.Step((b-this.last_upd_time)/1E3,10,8),this.world.b2world.ClearForces(),this.last_upd_time=b;this.controllers.forEach(function(b){if(b.update(this.keys_down,a))this.send_update=!0},this);this.world.update(a)}this.time_since_last_update_sent+=a;if(this.time_since_last_update_sent>1E3&&!this.send_update)this.send_update=!0;this.sendInfo()};this.sendInfo=function(){if(this.send_update)this.game.getCommunicator().queueMessage("GAME_UPDATE",
{actions:this.controller.actions,eventno:this.last_known_event_no}),this.send_update=!1,this.time_since_last_update_sent=0};this.processEvents=function(a){for(;this.queued_events[this.last_event_no+1]&&this.queued_events[this.last_event_no+1].t<=a;){var b=this.queued_events[this.last_event_no+1];this.world.handleEvent(b.type,b.descr);this.last_event_no=b.no;delete this.queued_events[b.no];if(!this.player_car&&this.carid&&(obj=this.world.getObjectById(this.carid)))this.player_car=obj,this.renderer.follow(obj),
this.game.getCommunicator().queueMessage("GAME_READY",{})}};this.handleWorldUpdate=function(){this.queued_updates.forEach(function(a){this.time_to_start=a.tts;this.state=a.st;a.events.forEach(function(b){if(b.no>this.last_event_no&&!this.queued_events[b.no])b.t=a.t,this.queued_events[b.no]=b,this.last_known_event_no=b.no},this);this.carid=a.carid;this.states[a.t]=a.states;this.last_t=a.t;this.upds_stacked=0},this);for(var a in this.states)a<this.time+this.delta-300&&a!=this.last_t&&delete this.states[a];
if(this.queued_updates.length)a=this.time-this.queued_updates[0].t,this.deltas.push(a),dlen=this.deltas.length,this.delta_q+=a,dlen>60&&(this.delta_q-=this.deltas.shift(),dlen=60),this.delta=parseInt(this.delta_q/dlen);this.queued_updates=[]};this.draw=function(a,b){this.renderer.render(a);R.get("SOUND")&&(this.renderer.follow_object&&this.renderer.follow_object.type=="car"&&t.engine.play_by_speed(this.renderer.follow_object.getSpeedKMH(),this.renderer.follow_object.max_speed),t.engine.update(b));
this.state==2&&this.renderer.follow_object.active==!1&&this.world.objects.car.some(function(a){if(a.active)return this.renderer.follow_object=a,!0;return!1},this);this.renderer.renderHUD(a,{car:this.player_car,max_laps:this.max_laps,time_to_start:this.time_to_start,paused:this.paused,delta:this.delta,msDuration:b,bfs:this.bfs,message:this.state==2?"Finished!":""})};this.handleMessage=function(a,b){a=="GAME_UPDATE"?this.queued_updates[this.queued_updates.length]=b:a=="GAME_OVER"?this.game.showGameOver(b.table):
a=="CRITICAL_ERR"&&(this.returnToTitle(),this.game.title_scene.alert(b.text))}};l.utils.objects.extend(C,M);var G=b.SingleplayerLevelScene=function(b,g){G.superConstructor.apply(this,[b]);this.dialog=new a({parent:this.gui,scene:this});this.test_ai=g;var h=e.carEventFromDescription([this.world.start_positions[1].x,this.world.start_positions[1].y],this.world.start_positions[1].angle,c.game.player.singleplayer.car,c.game.player.alias,!0);this.player_car=this.world.event("create",h);this.test_ai?this.controllers.push(new L.AIController(this.player_car,
this.world,this)):this.controllers.push(new L.PlayerCarController(this.player_car));var j=k[this.game.player.singleplayer.league];if(!this.test_ai)for(i=1;i<4;i++)this.world.start_positions[i+1]&&(h=d[j.bots[i-1]],h=e.carEventFromDescription([this.world.start_positions[i+1].x,this.world.start_positions[i+1].y],this.world.start_positions[i+1].angle,h,h.name,!1),h=this.world.event("create",h),this.controllers.push(new L.AIController(h,this.world,this)));this.renderer.follow(this.player_car);this.update=
function(a){this.updateZoom(a);if(this.time_to_start>-1E3&&(this.time_to_start-=a,this.time_to_start<0))this.started=!0;!this.paused&&this.started&&(this.controllers.forEach(function(b){b.update(this.keys_down,a)},this),this.world.update(a),this.world.b2world.Step(a/1E3,10,8),this.world.b2world.ClearForces());this.player_car.lap>this.max_laps&&this.game.showSPGameOver(this.genScoreTable(),this.player_car.getRacePosition(),this)};this.draw=function(a,b){this.renderer.render(a);R.get("SOUND")&&(this.renderer.follow_object&&
this.renderer.follow_object.type=="car"&&t.engine.play_by_speed(this.renderer.follow_object.getSpeedKMH(),this.renderer.follow_object.max_speed),t.engine.update(b));this.renderer.renderHUD(a,{car:this.player_car,max_laps:this.max_laps,msDuration:b,time_to_start:this.time_to_start,paused:this.paused});this.dialog.visible&&this.gui.draw(!0)};this.genScoreTable=function(){var a=this.world.objects.car.map(function(a,b){return{place:a.getRacePosition(),id:b,player:a.alias,kills:a.kills,deaths:a.deaths}});
a.sort(function(a,b){if(a.place>b.place)return 1;else if(a.place<b.place)return-1;return 0});return a};this.handleMessage=function(){}};l.utils.objects.extend(G,M);l.utils.objects.extend(a,h.Dialog)}},["gamejs","utils","sounds","combatracer","cars","bots","box2d","gamejs-gui","ui","leagues","world","renderer","settings","controllers","car_descriptions"]);
require.define({levels:function(q,b){var a=q("resources"),l=q("gamejs");b.init=function(){for(var o="",q=0;q<a.levels.length;q++)o=a.levels[q],b[o]=l.http.load("./levels/"+o+".json"),b[o].id=o}}},["resources","gamejs"]);
require.define({main:function(q){var b=q("gamejs"),a=q("./combatracer"),l=q("./settings"),o=q("./skin"),t=q("./levels");b.display.setCaption("Bandit Racer");var c;c=new Image;c.addEventListener("load",function(){function e(){var a=k.getSize();b.draw.rect(k,o.ui_background,new b.Rect([0,0],a));a=[a[0]/2-q[0]/2,a[1]/2-q[1]/2-100];k.blit(h,a);if(n){var c=n(),c=Math.min(Math.max(c-0.5,0)*2,1);b.draw.rect(k,"black",new b.Rect([a[0]-100,a[1]+260],[q[0]+200,40]),2);b.draw.rect(k,"black",new b.Rect([a[0]-
100,a[1]+260],[(q[0]+200)*c,40]),0)}}var d=document.createElement("canvas");d.width=c.naturalWidth||c.width;d.height=c.naturalHeight||c.height;d.getContext("2d").drawImage(c,0,0);c.getSize=function(){return[c.naturalWidth,c.naturalHeight]};var h=new b.Surface(c.getSize());h._canvas=d;var n,k=d=null,q=h.getSize();l.init();k=b.display.setMode([l.get("SCREEN_WIDTH"),l.get("SCREEN_HEIGHT")]);b.time.fpsCallback(e,this,50);b.preload(a.getPreloadList());t.init();n=b.ready(function(){var c=new a.init;b.time.deleteCallback(e,
50);c.start(k)})},!0);c.src=(window.$g&&$g.resourceBaseHref||".")+"/images/ui/logo.png"}},["gamejs","combatracer","settings","skin","levels"]);
